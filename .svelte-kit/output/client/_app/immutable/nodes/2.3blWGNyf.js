var qx=Object.defineProperty;var Su=n=>{throw TypeError(n)};var eg=(n,e,t)=>e in n?qx(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var E=(n,e,t)=>eg(n,typeof e!="symbol"?e+"":e,t),Ol=(n,e,t)=>e.has(n)||Su("Cannot "+t);var h=(n,e,t)=>(Ol(n,e,"read from private field"),t?t.call(n):e.get(n)),k=(n,e,t)=>e.has(n)?Su("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),m=(n,e,t,r)=>(Ol(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),X=(n,e,t)=>(Ol(n,e,"access private method"),t);var ao=(n,e,t,r)=>({set _(s){m(n,e,s,t)},get _(){return h(n,e,r)}});import"../chunks/CWj6FrbW.js";import{i as ja}from"../chunks/CHT6rAQA.js";import{l as Kd,a as tg,c as ol,e as ht,s as xe,o as rg,b as ng}from"../chunks/CBvRkXU8.js";import{B as Il,w as ur,af as sg,ab as ig,x as ag,v as og,h as u,L as nt,y as cg,z as lg,A as ku,C as Sl,I as oo,ad as dg,ai as ug,D as lf,F as df,G as fg,ax as uf,am as ff,a9 as hf,a0 as Te,ay as Pu,az as kl,Z as hg,a8 as Uu,aA as Vd,aB as xg,aC as Jd,aD as Nu,aE as gg,al as pg,aF as bg,aG as mg,aH as yg,ae as wg,X as vg,aI as Ag,aJ as Eg,aa as Tg,aK as Og,aL as Ig,aM as Sg,aN as kg,aO as Pg,aP as Ug,e as $,Y as xf,p as Za,c as Qd,f as hn,a as re,m as Ya,l as ue,n as T,o as A,aQ as It,t as Ge,i as ke,q as U,a4 as kr,N as K,aR as Nt,aS as cl,aT as Dn,aU as Ng}from"../chunks/kDIz_Wqo.js";import{_ as Zr,p as Xn,i as Oe}from"../chunks/B-v8Sb_b.js";function Ln(n,e){return e}function Cg(n,e,t,r){for(var s=[],i=e.length,a=0;a<i;a++)gg(e[a].e,s,!0);var o=i>0&&s.length===0&&t!==null;if(o){var c=t.parentNode;pg(c),c.append(t),r.clear(),ts(n,e[0].prev,e[i-1].next)}bg(s,()=>{for(var l=0;l<i;l++){var d=e[l];o||(r.delete(d.k),ts(n,d.prev,d.next)),mg(d.e,!o)}})}function Pr(n,e,t,r,s,i=null){var a=n,o={flags:e,items:new Map,first:null},c=(e&uf)!==0;if(c){var l=n;a=ur?Il(sg(l)):l.appendChild(ig())}ur&&ag();var d=null,f=!1,x=nt(()=>{var g=t();return hf(g)?g:g==null?[]:ff(g)});og(()=>{var g=u(x),b=g.length;if(f&&b===0)return;f=b===0;let p=!1;if(ur){var y=cg(a)===lg;y!==(b===0)&&(a=ku(),Il(a),Sl(!1),p=!0)}if(ur){for(var v=null,I,N=0;N<b;N++){if(oo.nodeType===dg&&oo.data===ug){a=oo,p=!0,Sl(!1);break}var P=g[N],S=r(P,N);I=gf(oo,o,v,null,P,S,N,s,e,t),o.items.set(S,I),v=I}b>0&&Il(ku())}ur||Bg(g,o,a,s,e,r,t),i!==null&&(b===0?d?lf(d):d=df(()=>i(a)):d!==null&&fg(d,()=>{d=null})),p&&Sl(!0),u(x)}),ur&&(a=oo)}function Bg(n,e,t,r,s,i,a){var Pe,O,L,ce;var o=(s&xg)!==0,c=(s&(Jd|Vd))!==0,l=n.length,d=e.items,f=e.first,x=f,g,b=null,p,y=[],v=[],I,N,P,S;if(o)for(S=0;S<l;S+=1)I=n[S],N=i(I,S),P=d.get(N),P!==void 0&&((Pe=P.a)==null||Pe.measure(),(p??(p=new Set)).add(P));for(S=0;S<l;S+=1){if(I=n[S],N=i(I,S),P=d.get(N),P===void 0){var C=x?x.e.nodes_start:t;b=gf(C,e,b,b===null?e.first:b.next,I,N,S,r,s,a),d.set(N,b),y=[],v=[],x=b.next;continue}if(c&&_g(P,I,S,s),(P.e.f&kl)!==0&&(lf(P.e),o&&((O=P.a)==null||O.unfix(),(p??(p=new Set)).delete(P))),P!==x){if(g!==void 0&&g.has(P)){if(y.length<v.length){var z=v[0],G;b=z.prev;var ne=y[0],J=y[y.length-1];for(G=0;G<y.length;G+=1)Cu(y[G],z,t);for(G=0;G<v.length;G+=1)g.delete(v[G]);ts(e,ne.prev,J.next),ts(e,b,ne),ts(e,J,z),x=z,b=J,S-=1,y=[],v=[]}else g.delete(P),Cu(P,x,t),ts(e,P.prev,P.next),ts(e,P,b===null?e.first:b.next),ts(e,b,P),b=P;continue}for(y=[],v=[];x!==null&&x.k!==N;)(x.e.f&kl)===0&&(g??(g=new Set)).add(x),v.push(x),x=x.next;if(x===null)continue;P=x}y.push(P),b=P,x=P.next}if(x!==null||g!==void 0){for(var B=g===void 0?[]:ff(g);x!==null;)(x.e.f&kl)===0&&B.push(x),x=x.next;var oe=B.length;if(oe>0){var he=(s&uf)!==0&&l===0?t:null;if(o){for(S=0;S<oe;S+=1)(L=B[S].a)==null||L.measure();for(S=0;S<oe;S+=1)(ce=B[S].a)==null||ce.fix()}Cg(e,B,he,d)}}o&&hg(()=>{var de;if(p!==void 0)for(P of p)(de=P.a)==null||de.apply()}),Uu.first=e.first&&e.first.e,Uu.last=b&&b.e}function _g(n,e,t,r){(r&Jd)!==0&&Nu(n.v,e),(r&Vd)!==0?Nu(n.i,t):n.i=t}function gf(n,e,t,r,s,i,a,o,c,l){var d=(c&Jd)!==0,f=(c&yg)===0,x=d?f?Te(s,!1,!1):Pu(s):s,g=(c&Vd)===0?a:Pu(a),b={i:g,v:x,k:i,a:null,e:null,prev:t,next:r};try{return b.e=df(()=>o(n,x,g,l),ur),b.e.prev=t&&t.e,b.e.next=r&&r.e,t===null?e.first=b:(t.next=b,t.e.next=b.e),r!==null&&(r.prev=b,r.e.prev=b.e),b}finally{}}function Cu(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,i=n.e.nodes_start;i!==r;){var a=wg(i);s.before(i),i=a}}function ts(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const Bu=[...` 	
\r\f \v\uFEFF`];function Rg(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,a=0;(a=r.indexOf(s,a))>=0;){var o=a+i;(a===0||Bu.includes(r[a-1]))&&(o===r.length||Bu.includes(r[o]))?r=(a===0?"":r.substring(0,a))+r.substring(o+1):a=o}}return r===""?null:r}function Sr(n,e,t,r,s,i){var a=n.__className;if(ur||a!==t||a===void 0){var o=Rg(t,r,i);(!ur||o!==n.getAttribute("class"))&&(o==null?n.removeAttribute("class"):n.className=o),n.__className=t}else if(i&&s!==i)for(var c in i){var l=!!i[c];(s==null||l!==!!s[c])&&n.classList.toggle(c,l)}return i}function pf(n,e,t=!1){if(n.multiple){if(e==null)return;if(!hf(e))return Ag();for(var r of n.options)r.selected=e.includes(vo(r));return}for(r of n.options){var s=vo(r);if(Eg(s,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function Dg(n){var e=new MutationObserver(()=>{pf(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Tg(()=>{e.disconnect()})}function pi(n,e,t=e){var r=!0;Kd(n,"change",s=>{var i=s?"[selected]":":checked",a;if(n.multiple)a=[].map.call(n.querySelectorAll(i),vo);else{var o=n.querySelector(i)??n.querySelector("option:not([disabled])");a=o&&vo(o)}t(a)}),vg(()=>{var s=e();if(pf(n,s,r),r&&s===void 0){var i=n.querySelector(":checked");i!==null&&(s=vo(i),t(s))}n.__value=s,r=!1}),Dg(n)}function vo(n){return"__value"in n?n.__value:n.value}const Lg=Symbol("is custom element"),Fg=Symbol("is html");function Mn(n){if(ur){var e=!1,t=()=>{if(!e){if(e=!0,n.hasAttribute("value")){var r=n.value;Ls(n,"value",null),n.value=r}if(n.hasAttribute("checked")){var s=n.checked;Ls(n,"checked",null),n.checked=s}}};n.__on_r=t,Og(t),tg()}}function Ls(n,e,t,r){var s=Mg(n);ur&&(s[e]=n.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&n.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(n[Ig]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Gg(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Mg(n){return n.__attributes??(n.__attributes={[Lg]:n.nodeName.includes("-"),[Fg]:n.namespaceURI===Sg})}var _u=new Map;function Gg(n){var e=_u.get(n.nodeName);if(e)return e;_u.set(n.nodeName,e=[]);for(var t,r=n,s=Element.prototype;s!==r;){t=Pg(r);for(var i in t)t[i].set&&e.push(i);r=kg(r)}return e}function vs(n,e,t=e){var r=Ug();Kd(n,"input",s=>{var i=s?n.defaultValue:n.value;if(i=Pl(n)?Ul(i):i,t(i),r&&i!==(i=e())){var a=n.selectionStart,o=n.selectionEnd;n.value=i??"",o!==null&&(n.selectionStart=a,n.selectionEnd=Math.min(o,n.value.length))}}),(ur&&n.defaultValue!==n.value||$(e)==null&&n.value)&&t(Pl(n)?Ul(n.value):n.value),xf(()=>{var s=e();Pl(n)&&s===Ul(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function Xg(n,e,t=e){Kd(n,"change",r=>{var s=r?n.defaultChecked:n.checked;t(s)}),(ur&&n.defaultChecked!==n.checked||$(e)==null)&&t(n.checked),xf(()=>{var r=e();n.checked=!!r})}function Pl(n){var e=n.type;return e==="number"||e==="range"}function Ul(n){return n===""?null:+n}function Hg(n){return function(...e){var t=e[0];return t.preventDefault(),n==null?void 0:n.apply(this,e)}}const bf="6.15.0";function zg(n,e,t){const r=e.split("|").map(i=>i.trim());for(let i=0;i<r.length;i++)switch(e){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof n===e)return}const s=new Error(`invalid value for type ${e}`);throw s.code="INVALID_ARGUMENT",s.argument=`value.${t}`,s.value=n,s}async function Xt(n){const e=Object.keys(n);return(await Promise.all(e.map(r=>Promise.resolve(n[r])))).reduce((r,s,i)=>(r[e[i]]=s,r),{})}function me(n,e,t){for(let r in e){let s=e[r];const i=t?t[r]:null;i&&zg(s,i,r),Object.defineProperty(n,r,{enumerable:!0,value:s,writable:!1})}}function Fi(n,e){if(n==null)return"null";if(e==null&&(e=new Set),typeof n=="object"){if(e.has(n))return"[Circular]";e.add(n)}if(Array.isArray(n))return"[ "+n.map(t=>Fi(t,e)).join(", ")+" ]";if(n instanceof Uint8Array){const t="0123456789abcdef";let r="0x";for(let s=0;s<n.length;s++)r+=t[n[s]>>4],r+=t[n[s]&15];return r}if(typeof n=="object"&&typeof n.toJSON=="function")return Fi(n.toJSON(),e);switch(typeof n){case"boolean":case"number":case"symbol":return n.toString();case"bigint":return BigInt(n).toString();case"string":return JSON.stringify(n);case"object":{const t=Object.keys(n);return t.sort(),"{ "+t.map(r=>`${Fi(r,e)}: ${Fi(n[r],e)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function Bt(n,e){return n&&n.code===e}function Wd(n){return Bt(n,"CALL_EXCEPTION")}function ut(n,e,t){let r=n;{const i=[];if(t){if("message"in t||"code"in t||"name"in t)throw new Error(`value will overwrite populated values: ${Fi(t)}`);for(const a in t){if(a==="shortMessage")continue;const o=t[a];i.push(a+"="+Fi(o))}}i.push(`code=${e}`),i.push(`version=${bf}`),i.length&&(n+=" ("+i.join(", ")+")")}let s;switch(e){case"INVALID_ARGUMENT":s=new TypeError(n);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":s=new RangeError(n);break;default:s=new Error(n)}return me(s,{code:e}),t&&Object.assign(s,t),s.shortMessage==null&&me(s,{shortMessage:r}),s}function F(n,e,t,r){if(!n)throw ut(e,t,r)}function w(n,e,t,r){F(n,e,"INVALID_ARGUMENT",{argument:t,value:r})}function mf(n,e,t){t==null&&(t=""),t&&(t=": "+t),F(n>=e,"missing argument"+t,"MISSING_ARGUMENT",{count:n,expectedCount:e}),F(n<=e,"too many arguments"+t,"UNEXPECTED_ARGUMENT",{count:n,expectedCount:e})}const $g=["NFD","NFC","NFKD","NFKC"].reduce((n,e)=>{try{if("test".normalize(e)!=="test")throw new Error("bad");if(e==="NFD"&&"é".normalize("NFD")!=="é")throw new Error("broken");n.push(e)}catch{}return n},[]);function yf(n){F($g.indexOf(n)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:n}})}function Is(n,e,t){if(t==null&&(t=""),n!==e){let r=t,s="new";t&&(r+=".",s+=" "+t),F(!1,`private constructor; use ${r}from* methods`,"UNSUPPORTED_OPERATION",{operation:s})}}function wf(n,e,t){if(n instanceof Uint8Array)return t?new Uint8Array(n):n;if(typeof n=="string"&&n.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const r=new Uint8Array((n.length-2)/2);let s=2;for(let i=0;i<r.length;i++)r[i]=parseInt(n.substring(s,s+2),16),s+=2;return r}w(!1,"invalid BytesLike value",e||"value",n)}function ae(n,e){return wf(n,e,!1)}function _t(n,e){return wf(n,e,!0)}function je(n,e){return!(typeof n!="string"||!n.match(/^0x[0-9A-Fa-f]*$/)||typeof e=="number"&&n.length!==2+2*e||e===!0&&n.length%2!==0)}function ll(n){return je(n,!0)||n instanceof Uint8Array}const Ru="0123456789abcdef";function V(n){const e=ae(n);let t="0x";for(let r=0;r<e.length;r++){const s=e[r];t+=Ru[(s&240)>>4]+Ru[s&15]}return t}function qe(n){return"0x"+n.map(e=>V(e).substring(2)).join("")}function bi(n){return je(n,!0)?(n.length-2)/2:ae(n).length}function ct(n,e,t){const r=ae(n);return t!=null&&t>r.length&&F(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:t}),V(r.slice(e??0,t??r.length))}function vf(n,e,t){const r=ae(n);F(e>=r.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(r),length:e,offset:e+1});const s=new Uint8Array(e);return s.fill(0),t?s.set(r,e-r.length):s.set(r,0),V(s)}function tt(n,e){return vf(n,e,!0)}function Af(n,e){return vf(n,e,!1)}const dl=BigInt(0),$r=BigInt(1),Mi=9007199254740991;function Fc(n,e){const t=ul(n,"value"),r=BigInt(_e(e,"width"));if(F(t>>r===dl,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:n}),t>>r-$r){const s=($r<<r)-$r;return-((~t&s)+$r)}return t}function jd(n,e){let t=fe(n,"value");const r=BigInt(_e(e,"width")),s=$r<<r-$r;if(t<dl){t=-t,F(t<=s,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:n});const i=($r<<r)-$r;return(~t&i)+$r}else F(t<s,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:n});return t}function $s(n,e){const t=ul(n,"value"),r=BigInt(_e(e,"bits"));return t&($r<<r)-$r}function fe(n,e){switch(typeof n){case"bigint":return n;case"number":return w(Number.isInteger(n),"underflow",e||"value",n),w(n>=-Mi&&n<=Mi,"overflow",e||"value",n),BigInt(n);case"string":try{if(n==="")throw new Error("empty string");return n[0]==="-"&&n[1]!=="-"?-BigInt(n.substring(1)):BigInt(n)}catch(t){w(!1,`invalid BigNumberish string: ${t.message}`,e||"value",n)}}w(!1,"invalid BigNumberish value",e||"value",n)}function ul(n,e){const t=fe(n,e);return F(t>=dl,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:n}),t}const Du="0123456789abcdef";function Kr(n){if(n instanceof Uint8Array){let e="0x0";for(const t of n)e+=Du[t>>4],e+=Du[t&15];return BigInt(e)}return fe(n)}function _e(n,e){switch(typeof n){case"bigint":return w(n>=-Mi&&n<=Mi,"overflow",e||"value",n),Number(n);case"number":return w(Number.isInteger(n),"underflow",e||"value",n),w(n>=-Mi&&n<=Mi,"overflow",e||"value",n),n;case"string":try{if(n==="")throw new Error("empty string");return _e(BigInt(n),e)}catch(t){w(!1,`invalid numeric string: ${t.message}`,e||"value",n)}}w(!1,"invalid numeric value",e||"value",n)}function Kg(n){return _e(Kr(n))}function $n(n,e){let r=ul(n,"value").toString(16);if(e==null)r.length%2&&(r="0"+r);else{const s=_e(e,"width");for(F(s*2>=r.length,`value exceeds width (${s} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:n});r.length<s*2;)r="0"+r}return"0x"+r}function gt(n){const e=ul(n,"value");if(e===dl)return new Uint8Array([]);let t=e.toString(16);t.length%2&&(t="0"+t);const r=new Uint8Array(t.length/2);for(let s=0;s<r.length;s++){const i=s*2;r[s]=parseInt(t.substring(i,i+2),16)}return r}function zr(n){let e=V(ll(n)?n:gt(n)).substring(2);for(;e.startsWith("0");)e=e.substring(1);return e===""&&(e="0"),"0x"+e}const Mc="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let cc=null;function Vg(n){if(cc==null){cc={};for(let t=0;t<Mc.length;t++)cc[Mc[t]]=BigInt(t)}const e=cc[n];return w(e!=null,"invalid base58 value","letter",n),e}const Jg=BigInt(0),rd=BigInt(58);function Ef(n){const e=ae(n);let t=Kr(e),r="";for(;t;)r=Mc[Number(t%rd)]+r,t/=rd;for(let s=0;s<e.length&&!e[s];s++)r=Mc[0]+r;return r}function Qg(n){let e=Jg;for(let t=0;t<n.length;t++)e*=rd,e+=Vg(n[t]);return e}function Wg(n){n=atob(n);const e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return ae(e)}function jg(n){const e=ae(n);let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return btoa(t)}var Qi;class Tf{constructor(e,t,r){E(this,"filter");E(this,"emitter");k(this,Qi);m(this,Qi,t),me(this,{emitter:e,filter:r})}async removeListener(){h(this,Qi)!=null&&await this.emitter.off(this.filter,h(this,Qi))}}Qi=new WeakMap;function Zg(n,e,t,r,s){w(!1,`invalid codepoint at offset ${e}; ${n}`,"bytes",t)}function Of(n,e,t,r,s){if(n==="BAD_PREFIX"||n==="UNEXPECTED_CONTINUE"){let i=0;for(let a=e+1;a<t.length&&t[a]>>6===2;a++)i++;return i}return n==="OVERRUN"?t.length-e-1:0}function Yg(n,e,t,r,s){return n==="OVERLONG"?(w(typeof s=="number","invalid bad code point for replacement","badCodepoint",s),r.push(s),0):(r.push(65533),Of(n,e,t))}const qg=Object.freeze({error:Zg,ignore:Of,replace:Yg});function ep(n,e){e==null&&(e=qg.error);const t=ae(n,"bytes"),r=[];let s=0;for(;s<t.length;){const i=t[s++];if(i>>7===0){r.push(i);continue}let a=null,o=null;if((i&224)===192)a=1,o=127;else if((i&240)===224)a=2,o=2047;else if((i&248)===240)a=3,o=65535;else{(i&192)===128?s+=e("UNEXPECTED_CONTINUE",s-1,t,r):s+=e("BAD_PREFIX",s-1,t,r);continue}if(s-1+a>=t.length){s+=e("OVERRUN",s-1,t,r);continue}let c=i&(1<<8-a-1)-1;for(let l=0;l<a;l++){let d=t[s];if((d&192)!=128){s+=e("MISSING_CONTINUE",s,t,r),c=null;break}c=c<<6|d&63,s++}if(c!==null){if(c>1114111){s+=e("OUT_OF_RANGE",s-1-a,t,r,c);continue}if(c>=55296&&c<=57343){s+=e("UTF16_SURROGATE",s-1-a,t,r,c);continue}if(c<=o){s+=e("OVERLONG",s-1-a,t,r,c);continue}r.push(c)}}return r}function Be(n,e){w(typeof n=="string","invalid string value","str",n),e!=null&&(yf(e),n=n.normalize(e));let t=[];for(let r=0;r<n.length;r++){const s=n.charCodeAt(r);if(s<128)t.push(s);else if(s<2048)t.push(s>>6|192),t.push(s&63|128);else if((s&64512)==55296){r++;const i=n.charCodeAt(r);w(r<n.length&&(i&64512)===56320,"invalid surrogate pair","str",n);const a=65536+((s&1023)<<10)+(i&1023);t.push(a>>18|240),t.push(a>>12&63|128),t.push(a>>6&63|128),t.push(a&63|128)}else t.push(s>>12|224),t.push(s>>6&63|128),t.push(s&63|128)}return new Uint8Array(t)}function tp(n){return n.map(e=>e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10&1023)+55296,(e&1023)+56320))).join("")}function Gc(n,e){return tp(ep(n,e))}function If(n){async function e(t,r){F(r==null||!r.cancelled,"request cancelled before sending","CANCELLED");const s=t.url.split(":")[0].toLowerCase();F(s==="http"||s==="https",`unsupported protocol ${s}`,"UNSUPPORTED_OPERATION",{info:{protocol:s},operation:"request"}),F(s==="https"||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let i=null;const a=new AbortController,o=setTimeout(()=>{i=ut("request timeout","TIMEOUT"),a.abort()},t.timeout);r&&r.addListener(()=>{i=ut("request cancelled","CANCELLED"),a.abort()});const c=Object.assign({},n,{method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:a.signal});let l;try{l=await fetch(t.url,c)}catch(g){throw clearTimeout(o),i||g}clearTimeout(o);const d={};l.headers.forEach((g,b)=>{d[b.toLowerCase()]=g});const f=await l.arrayBuffer(),x=f==null?null:new Uint8Array(f);return{statusCode:l.status,statusMessage:l.statusText,headers:d,body:x}}return e}const rp=12,np=250;let Lu=If();const sp=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),ip=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let Nl=!1;async function Sf(n,e){try{const t=n.match(sp);if(!t)throw new Error("invalid data");return new As(200,"OK",{"content-type":t[1]||"text/plain"},t[2]?Wg(t[3]):op(t[3]))}catch{return new As(599,"BAD REQUEST (invalid data: URI)",{},null,new Ts(n))}}function kf(n){async function e(t,r){try{const s=t.match(ip);if(!s)throw new Error("invalid link");return new Ts(`${n}${s[2]}`)}catch{return new As(599,"BAD REQUEST (invalid IPFS URI)",{},null,new Ts(t))}}return e}const lc={data:Sf,ipfs:kf("https://gateway.ipfs.io/ipfs/")},Pf=new WeakMap;var Qs,ss;class ap{constructor(e){k(this,Qs);k(this,ss);m(this,Qs,[]),m(this,ss,!1),Pf.set(e,()=>{if(!h(this,ss)){m(this,ss,!0);for(const t of h(this,Qs))setTimeout(()=>{t()},0);m(this,Qs,[])}})}addListener(e){F(!h(this,ss),"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),h(this,Qs).push(e)}get cancelled(){return h(this,ss)}checkSignal(){F(!this.cancelled,"cancelled","CANCELLED",{})}}Qs=new WeakMap,ss=new WeakMap;function dc(n){if(n==null)throw new Error("missing signal; should not happen");return n.checkSignal(),n}var Wi,ji,Lr,On,Zi,Yi,Tt,or,In,Ws,js,Zs,tn,Fr,is,Ys,ho;const el=class el{constructor(e){k(this,Ys);k(this,Wi);k(this,ji);k(this,Lr);k(this,On);k(this,Zi);k(this,Yi);k(this,Tt);k(this,or);k(this,In);k(this,Ws);k(this,js);k(this,Zs);k(this,tn);k(this,Fr);k(this,is);m(this,Yi,String(e)),m(this,Wi,!1),m(this,ji,!0),m(this,Lr,{}),m(this,On,""),m(this,Zi,3e5),m(this,Fr,{slotInterval:np,maxAttempts:rp}),m(this,is,null)}get url(){return h(this,Yi)}set url(e){m(this,Yi,String(e))}get body(){return h(this,Tt)==null?null:new Uint8Array(h(this,Tt))}set body(e){if(e==null)m(this,Tt,void 0),m(this,or,void 0);else if(typeof e=="string")m(this,Tt,Be(e)),m(this,or,"text/plain");else if(e instanceof Uint8Array)m(this,Tt,e),m(this,or,"application/octet-stream");else if(typeof e=="object")m(this,Tt,Be(JSON.stringify(e))),m(this,or,"application/json");else throw new Error("invalid body")}hasBody(){return h(this,Tt)!=null}get method(){return h(this,On)?h(this,On):this.hasBody()?"POST":"GET"}set method(e){e==null&&(e=""),m(this,On,String(e).toUpperCase())}get headers(){const e=Object.assign({},h(this,Lr));return h(this,In)&&(e.authorization=`Basic ${jg(Be(h(this,In)))}`),this.allowGzip&&(e["accept-encoding"]="gzip"),e["content-type"]==null&&h(this,or)&&(e["content-type"]=h(this,or)),this.body&&(e["content-length"]=String(this.body.length)),e}getHeader(e){return this.headers[e.toLowerCase()]}setHeader(e,t){h(this,Lr)[String(e).toLowerCase()]=String(t)}clearHeaders(){m(this,Lr,{})}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let r=0;return{next:()=>{if(r<t.length){const s=t[r++];return{value:[s,e[s]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return h(this,In)||null}setCredentials(e,t){w(!e.match(/:/),"invalid basic authentication username","username","[REDACTED]"),m(this,In,`${e}:${t}`)}get allowGzip(){return h(this,ji)}set allowGzip(e){m(this,ji,!!e)}get allowInsecureAuthentication(){return!!h(this,Wi)}set allowInsecureAuthentication(e){m(this,Wi,!!e)}get timeout(){return h(this,Zi)}set timeout(e){w(e>=0,"timeout must be non-zero","timeout",e),m(this,Zi,e)}get preflightFunc(){return h(this,Ws)||null}set preflightFunc(e){m(this,Ws,e)}get processFunc(){return h(this,js)||null}set processFunc(e){m(this,js,e)}get retryFunc(){return h(this,Zs)||null}set retryFunc(e){m(this,Zs,e)}get getUrlFunc(){return h(this,is)||Lu}set getUrlFunc(e){m(this,is,e)}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${h(this,Tt)?V(h(this,Tt)):"null"}>`}setThrottleParams(e){e.slotInterval!=null&&(h(this,Fr).slotInterval=e.slotInterval),e.maxAttempts!=null&&(h(this,Fr).maxAttempts=e.maxAttempts)}send(){return F(h(this,tn)==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),m(this,tn,new ap(this)),X(this,Ys,ho).call(this,0,Fu()+this.timeout,0,this,new As(0,"",{},null,this))}cancel(){F(h(this,tn)!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const e=Pf.get(this);if(!e)throw new Error("missing signal; should not happen");e()}redirect(e){const t=this.url.split(":")[0].toLowerCase(),r=e.split(":")[0].toLowerCase();F(this.method==="GET"&&(t!=="https"||r!=="http")&&e.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(e)})`});const s=new el(e);return s.method="GET",s.allowGzip=this.allowGzip,s.timeout=this.timeout,m(s,Lr,Object.assign({},h(this,Lr))),h(this,Tt)&&m(s,Tt,new Uint8Array(h(this,Tt))),m(s,or,h(this,or)),s}clone(){const e=new el(this.url);return m(e,On,h(this,On)),h(this,Tt)&&m(e,Tt,h(this,Tt)),m(e,or,h(this,or)),m(e,Lr,Object.assign({},h(this,Lr))),m(e,In,h(this,In)),this.allowGzip&&(e.allowGzip=!0),e.timeout=this.timeout,this.allowInsecureAuthentication&&(e.allowInsecureAuthentication=!0),m(e,Ws,h(this,Ws)),m(e,js,h(this,js)),m(e,Zs,h(this,Zs)),m(e,Fr,Object.assign({},h(this,Fr))),m(e,is,h(this,is)),e}static lockConfig(){Nl=!0}static getGateway(e){return lc[e.toLowerCase()]||null}static registerGateway(e,t){if(e=e.toLowerCase(),e==="http"||e==="https")throw new Error(`cannot intercept ${e}; use registerGetUrl`);if(Nl)throw new Error("gateways locked");lc[e]=t}static registerGetUrl(e){if(Nl)throw new Error("gateways locked");Lu=e}static createGetUrlFunc(e){return If(e)}static createDataGateway(){return Sf}static createIpfsGatewayFunc(e){return kf(e)}};Wi=new WeakMap,ji=new WeakMap,Lr=new WeakMap,On=new WeakMap,Zi=new WeakMap,Yi=new WeakMap,Tt=new WeakMap,or=new WeakMap,In=new WeakMap,Ws=new WeakMap,js=new WeakMap,Zs=new WeakMap,tn=new WeakMap,Fr=new WeakMap,is=new WeakMap,Ys=new WeakSet,ho=async function(e,t,r,s,i){var d,f,x;if(e>=h(this,Fr).maxAttempts)return i.makeServerError("exceeded maximum retry limit");F(Fu()<=t,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:s}),r>0&&await cp(r);let a=this.clone();const o=(a.url.split(":")[0]||"").toLowerCase();if(o in lc){const g=await lc[o](a.url,dc(h(s,tn)));if(g instanceof As){let b=g;if(this.processFunc){dc(h(s,tn));try{b=await this.processFunc(a,b)}catch(p){(p.throttle==null||typeof p.stall!="number")&&b.makeServerError("error in post-processing function",p).assertOk()}}return b}a=g}this.preflightFunc&&(a=await this.preflightFunc(a));const c=await this.getUrlFunc(a,dc(h(s,tn)));let l=new As(c.statusCode,c.statusMessage,c.headers,c.body,s);if(l.statusCode===301||l.statusCode===302){try{const g=l.headers.location||"";return X(d=a.redirect(g),Ys,ho).call(d,e+1,t,0,s,l)}catch{}return l}else if(l.statusCode===429&&(this.retryFunc==null||await this.retryFunc(a,l,e))){const g=l.headers["retry-after"];let b=h(this,Fr).slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return typeof g=="string"&&g.match(/^[1-9][0-9]*$/)&&(b=parseInt(g)),X(f=a.clone(),Ys,ho).call(f,e+1,t,b,s,l)}if(this.processFunc){dc(h(s,tn));try{l=await this.processFunc(a,l)}catch(g){(g.throttle==null||typeof g.stall!="number")&&l.makeServerError("error in post-processing function",g).assertOk();let b=h(this,Fr).slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return g.stall>=0&&(b=g.stall),X(x=a.clone(),Ys,ho).call(x,e+1,t,b,s,l)}}return l};let Ts=el;var Lo,Fo,Mo,cr,qi,qs;const vu=class vu{constructor(e,t,r,s,i){k(this,Lo);k(this,Fo);k(this,Mo);k(this,cr);k(this,qi);k(this,qs);m(this,Lo,e),m(this,Fo,t),m(this,Mo,Object.keys(r).reduce((a,o)=>(a[o.toLowerCase()]=String(r[o]),a),{})),m(this,cr,s==null?null:new Uint8Array(s)),m(this,qi,i||null),m(this,qs,{message:""})}toString(){return`<FetchResponse status=${this.statusCode} body=${h(this,cr)?V(h(this,cr)):"null"}>`}get statusCode(){return h(this,Lo)}get statusMessage(){return h(this,Fo)}get headers(){return Object.assign({},h(this,Mo))}get body(){return h(this,cr)==null?null:new Uint8Array(h(this,cr))}get bodyText(){try{return h(this,cr)==null?"":Gc(h(this,cr))}catch{F(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{F(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let r=0;return{next:()=>{if(r<t.length){const s=t[r++];return{value:[s,e[s]],done:!1}}return{value:void 0,done:!0}}}}makeServerError(e,t){let r;e?r=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${e})`:(e=`${this.statusCode} ${this.statusMessage}`,r=`CLIENT ESCALATED SERVER ERROR (${e})`);const s=new vu(599,r,this.headers,this.body,h(this,qi)||void 0);return m(s,qs,{message:e,error:t}),s}throwThrottleError(e,t){t==null?t=-1:w(Number.isInteger(t)&&t>=0,"invalid stall timeout","stall",t);const r=new Error(e||"throttling requests");throw me(r,{stall:t,throttle:!0}),r}getHeader(e){return this.headers[e.toLowerCase()]}hasBody(){return h(this,cr)!=null}get request(){return h(this,qi)}ok(){return h(this,qs).message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:e,error:t}=h(this,qs);e===""&&(e=`server response ${this.statusCode} ${this.statusMessage}`);let r=null;this.request&&(r=this.request.url);let s=null;try{h(this,cr)&&(s=Gc(h(this,cr)))}catch{}F(!1,e,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:t,info:{requestUrl:r,responseBody:s,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}};Lo=new WeakMap,Fo=new WeakMap,Mo=new WeakMap,cr=new WeakMap,qi=new WeakMap,qs=new WeakMap;let As=vu;function Fu(){return new Date().getTime()}function op(n){return Be(n.replace(/%([0-9a-f][0-9a-f])/gi,(e,t)=>String.fromCharCode(parseInt(t,16))))}function cp(n){return new Promise(e=>setTimeout(e,n))}const lp=BigInt(-1),Br=BigInt(0),Gi=BigInt(1),dp=BigInt(5),Pi={};let $i="0000";for(;$i.length<80;)$i+=$i;function Ns(n){let e=$i;for(;e.length<n;)e+=e;return BigInt("1"+e.substring(0,n))}function co(n,e,t){const r=BigInt(e.width);if(e.signed){const s=Gi<<r-Gi;F(t==null||n>=-s&&n<s,"overflow","NUMERIC_FAULT",{operation:t,fault:"overflow",value:n}),n>Br?n=Fc($s(n,r),r):n=-Fc($s(-n,r),r)}else{const s=Gi<<r;F(t==null||n>=0&&n<s,"overflow","NUMERIC_FAULT",{operation:t,fault:"overflow",value:n}),n=(n%s+s)%s&s-Gi}return n}function Cl(n){typeof n=="number"&&(n=`fixed128x${n}`);let e=!0,t=128,r=18;if(typeof n=="string"){if(n!=="fixed")if(n==="ufixed")e=!1;else{const i=n.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);w(i,"invalid fixed format","format",n),e=i[1]!=="u",t=parseInt(i[2]),r=parseInt(i[3])}}else if(n){const i=n,a=(o,c,l)=>i[o]==null?l:(w(typeof i[o]===c,"invalid fixed format ("+o+" not "+c+")","format."+o,i[o]),i[o]);e=a("signed","boolean",e),t=a("width","number",t),r=a("decimals","number",r)}w(t%8===0,"invalid FixedNumber width (not byte aligned)","format.width",t),w(r<=80,"invalid FixedNumber decimals (too large)","format.decimals",r);const s=(e?"":"u")+"fixed"+String(t)+"x"+String(r);return{signed:e,width:t,decimals:r,name:s}}function up(n,e){let t="";n<Br&&(t="-",n*=lp);let r=n.toString();if(e===0)return t+r;for(;r.length<=e;)r=$i+r;const s=r.length-e;for(r=r.substring(0,s)+"."+r.substring(s);r[0]==="0"&&r[1]!==".";)r=r.substring(1);for(;r[r.length-1]==="0"&&r[r.length-2]!==".";)r=r.substring(0,r.length-1);return t+r}var Mr,rt,Kt,et,Bs,wn,nd,sd,id,ad;const rs=class rs{constructor(e,t,r){k(this,et);E(this,"format");k(this,Mr);k(this,rt);k(this,Kt);E(this,"_value");Is(e,Pi,"FixedNumber"),m(this,rt,t),m(this,Mr,r);const s=up(t,r.decimals);me(this,{format:r.name,_value:s}),m(this,Kt,Ns(r.decimals))}get signed(){return h(this,Mr).signed}get width(){return h(this,Mr).width}get decimals(){return h(this,Mr).decimals}get value(){return h(this,rt)}addUnsafe(e){return X(this,et,nd).call(this,e)}add(e){return X(this,et,nd).call(this,e,"add")}subUnsafe(e){return X(this,et,sd).call(this,e)}sub(e){return X(this,et,sd).call(this,e,"sub")}mulUnsafe(e){return X(this,et,id).call(this,e)}mul(e){return X(this,et,id).call(this,e,"mul")}mulSignal(e){X(this,et,Bs).call(this,e);const t=h(this,rt)*h(e,rt);return F(t%h(this,Kt)===Br,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),X(this,et,wn).call(this,t/h(this,Kt),"mulSignal")}divUnsafe(e){return X(this,et,ad).call(this,e)}div(e){return X(this,et,ad).call(this,e,"div")}divSignal(e){F(h(e,rt)!==Br,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),X(this,et,Bs).call(this,e);const t=h(this,rt)*h(this,Kt);return F(t%h(e,rt)===Br,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),X(this,et,wn).call(this,t/h(e,rt),"divSignal")}cmp(e){let t=this.value,r=e.value;const s=this.decimals-e.decimals;return s>0?r*=Ns(s):s<0&&(t*=Ns(-s)),t<r?-1:t>r?1:0}eq(e){return this.cmp(e)===0}lt(e){return this.cmp(e)<0}lte(e){return this.cmp(e)<=0}gt(e){return this.cmp(e)>0}gte(e){return this.cmp(e)>=0}floor(){let e=h(this,rt);return h(this,rt)<Br&&(e-=h(this,Kt)-Gi),e=h(this,rt)/h(this,Kt)*h(this,Kt),X(this,et,wn).call(this,e,"floor")}ceiling(){let e=h(this,rt);return h(this,rt)>Br&&(e+=h(this,Kt)-Gi),e=h(this,rt)/h(this,Kt)*h(this,Kt),X(this,et,wn).call(this,e,"ceiling")}round(e){if(e==null&&(e=0),e>=this.decimals)return this;const t=this.decimals-e,r=dp*Ns(t-1);let s=this.value+r;const i=Ns(t);return s=s/i*i,co(s,h(this,Mr),"round"),new rs(Pi,s,h(this,Mr))}isZero(){return h(this,rt)===Br}isNegative(){return h(this,rt)<Br}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(e){return rs.fromString(this.toString(),e)}static fromValue(e,t,r){const s=t==null?0:_e(t),i=Cl(r);let a=fe(e,"value");const o=s-i.decimals;if(o>0){const c=Ns(o);F(a%c===Br,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:e}),a/=c}else o<0&&(a*=Ns(-o));return co(a,i,"fromValue"),new rs(Pi,a,i)}static fromString(e,t){const r=e.match(/^(-?)([0-9]*)\.?([0-9]*)$/);w(r&&r[2].length+r[3].length>0,"invalid FixedNumber string value","value",e);const s=Cl(t);let i=r[2]||"0",a=r[3]||"";for(;a.length<s.decimals;)a+=$i;F(a.substring(s.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:e}),a=a.substring(0,s.decimals);const o=BigInt(r[1]+i+a);return co(o,s,"fromString"),new rs(Pi,o,s)}static fromBytes(e,t){let r=Kr(ae(e,"value"));const s=Cl(t);return s.signed&&(r=Fc(r,s.width)),co(r,s,"fromBytes"),new rs(Pi,r,s)}};Mr=new WeakMap,rt=new WeakMap,Kt=new WeakMap,et=new WeakSet,Bs=function(e){w(this.format===e.format,"incompatible format; use fixedNumber.toFormat","other",e)},wn=function(e,t){return e=co(e,h(this,Mr),t),new rs(Pi,e,h(this,Mr))},nd=function(e,t){return X(this,et,Bs).call(this,e),X(this,et,wn).call(this,h(this,rt)+h(e,rt),t)},sd=function(e,t){return X(this,et,Bs).call(this,e),X(this,et,wn).call(this,h(this,rt)-h(e,rt),t)},id=function(e,t){return X(this,et,Bs).call(this,e),X(this,et,wn).call(this,h(this,rt)*h(e,rt)/h(this,Kt),t)},ad=function(e,t){return F(h(e,rt)!==Br,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),X(this,et,Bs).call(this,e),X(this,et,wn).call(this,h(this,rt)*h(this,Kt)/h(e,rt),t)};let Xc=rs;function fp(n){let e=n.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function Mu(n,e,t){let r=0;for(let s=0;s<t;s++)r=r*256+n[e+s];return r}function Gu(n,e,t,r){const s=[];for(;t<e+1+r;){const i=Uf(n,t);s.push(i.result),t+=i.consumed,F(t<=e+1+r,"child data too short","BUFFER_OVERRUN",{buffer:n,length:r,offset:e})}return{consumed:1+r,result:s}}function Uf(n,e){F(n.length!==0,"data too short","BUFFER_OVERRUN",{buffer:n,length:0,offset:1});const t=r=>{F(r<=n.length,"data short segment too short","BUFFER_OVERRUN",{buffer:n,length:n.length,offset:r})};if(n[e]>=248){const r=n[e]-247;t(e+1+r);const s=Mu(n,e+1,r);return t(e+1+r+s),Gu(n,e,e+1+r,r+s)}else if(n[e]>=192){const r=n[e]-192;return t(e+1+r),Gu(n,e,e+1,r)}else if(n[e]>=184){const r=n[e]-183;t(e+1+r);const s=Mu(n,e+1,r);t(e+1+r+s);const i=V(n.slice(e+1+r,e+1+r+s));return{consumed:1+r+s,result:i}}else if(n[e]>=128){const r=n[e]-128;t(e+1+r);const s=V(n.slice(e+1,e+1+r));return{consumed:1+r,result:s}}return{consumed:1,result:fp(n[e])}}function qo(n){const e=ae(n,"data"),t=Uf(e,0);return w(t.consumed===e.length,"unexpected junk after rlp payload","data",n),t.result}function Xu(n){const e=[];for(;n;)e.unshift(n&255),n>>=8;return e}function Nf(n){if(Array.isArray(n)){let r=[];if(n.forEach(function(i){r=r.concat(Nf(i))}),r.length<=55)return r.unshift(192+r.length),r;const s=Xu(r.length);return s.unshift(247+s.length),s.concat(r)}const e=Array.prototype.slice.call(ae(n,"object"));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const t=Xu(e.length);return t.unshift(183+t.length),t.concat(e)}const Hu="0123456789abcdef";function Kn(n){let e="0x";for(const t of Nf(n))e+=Hu[t>>4],e+=Hu[t&15];return e}const Cf=["wei","kwei","mwei","gwei","szabo","finney","ether"];function pt(n,e){let t=18;if(typeof e=="string"){const r=Cf.indexOf(e);w(r>=0,"invalid unit","unit",e),t=3*r}else e!=null&&(t=_e(e,"unit"));return Xc.fromValue(n,t,{decimals:t,width:512}).toString()}function _s(n,e){w(typeof n=="string","value must be a string","value",n);let t=18;if(typeof e=="string"){const r=Cf.indexOf(e);w(r>=0,"invalid unit","unit",e),t=3*r}else e!=null&&(t=_e(e,"unit"));return Xc.fromString(n,{decimals:t,width:512}).value}function zu(n){return pt(n,18)}function hp(n){const e=ae(n,"randomBytes");e[6]=e[6]&15|64,e[8]=e[8]&63|128;const t=V(e);return[t.substring(2,10),t.substring(10,14),t.substring(14,18),t.substring(18,22),t.substring(22,34)].join("-")}const Qt=32,od=new Uint8Array(Qt),xp=["then"],uc={},Bf=new WeakMap;function Fs(n){return Bf.get(n)}function $u(n,e){Bf.set(n,e)}function lo(n,e){const t=new Error(`deferred error during ABI decoding triggered accessing ${n}`);throw t.error=e,t}function cd(n,e,t){return n.indexOf(null)>=0?e.map((r,s)=>r instanceof La?cd(Fs(r),r,t):r):n.reduce((r,s,i)=>{let a=e.getValue(s);return s in r||(t&&a instanceof La&&(a=cd(Fs(a),a,t)),r[s]=a),r},{})}var ea;const Xi=class Xi extends Array{constructor(...t){const r=t[0];let s=t[1],i=(t[2]||[]).slice(),a=!0;r!==uc&&(s=t,i=[],a=!1);super(s.length);k(this,ea);s.forEach((l,d)=>{this[d]=l});const o=i.reduce((l,d)=>(typeof d=="string"&&l.set(d,(l.get(d)||0)+1),l),new Map);if($u(this,Object.freeze(s.map((l,d)=>{const f=i[d];return f!=null&&o.get(f)===1?f:null}))),m(this,ea,[]),h(this,ea)==null&&h(this,ea),!a)return;Object.freeze(this);const c=new Proxy(this,{get:(l,d,f)=>{if(typeof d=="string"){if(d.match(/^[0-9]+$/)){const g=_e(d,"%index");if(g<0||g>=this.length)throw new RangeError("out of result range");const b=l[g];return b instanceof Error&&lo(`index ${g}`,b),b}if(xp.indexOf(d)>=0)return Reflect.get(l,d,f);const x=l[d];if(x instanceof Function)return function(...g){return x.apply(this===f?l:this,g)};if(!(d in l))return l.getValue.apply(this===f?l:this,[d])}return Reflect.get(l,d,f)}});return $u(c,Fs(this)),c}toArray(t){const r=[];return this.forEach((s,i)=>{s instanceof Error&&lo(`index ${i}`,s),t&&s instanceof Xi&&(s=s.toArray(t)),r.push(s)}),r}toObject(t){const r=Fs(this);return r.reduce((s,i,a)=>(F(i!=null,`value at index ${a} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),cd(r,this,t)),{})}slice(t,r){t==null&&(t=0),t<0&&(t+=this.length,t<0&&(t=0)),r==null&&(r=this.length),r<0&&(r+=this.length,r<0&&(r=0)),r>this.length&&(r=this.length);const s=Fs(this),i=[],a=[];for(let o=t;o<r;o++)i.push(this[o]),a.push(s[o]);return new Xi(uc,i,a)}filter(t,r){const s=Fs(this),i=[],a=[];for(let o=0;o<this.length;o++){const c=this[o];c instanceof Error&&lo(`index ${o}`,c),t.call(r,c,o,this)&&(i.push(c),a.push(s[o]))}return new Xi(uc,i,a)}map(t,r){const s=[];for(let i=0;i<this.length;i++){const a=this[i];a instanceof Error&&lo(`index ${i}`,a),s.push(t.call(r,a,i,this))}return s}getValue(t){const r=Fs(this).indexOf(t);if(r===-1)return;const s=this[r];return s instanceof Error&&lo(`property ${JSON.stringify(t)}`,s.error),s}static fromItems(t,r){return new Xi(uc,t,r)}};ea=new WeakMap;let La=Xi;function Ku(n){let e=gt(n);return F(e.length<=Qt,"value out-of-bounds","BUFFER_OVERRUN",{buffer:e,length:Qt,offset:e.length}),e.length!==Qt&&(e=_t(qe([od.slice(e.length%Qt),e]))),e}class Qn{constructor(e,t,r,s){E(this,"name");E(this,"type");E(this,"localName");E(this,"dynamic");me(this,{name:e,type:t,localName:r,dynamic:s},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(e,t){w(!1,e,this.localName,t)}}var Sn,ei,ta,Ec;class ld{constructor(){k(this,ta);k(this,Sn);k(this,ei);m(this,Sn,[]),m(this,ei,0)}get data(){return qe(h(this,Sn))}get length(){return h(this,ei)}appendWriter(e){return X(this,ta,Ec).call(this,_t(e.data))}writeBytes(e){let t=_t(e);const r=t.length%Qt;return r&&(t=_t(qe([t,od.slice(r)]))),X(this,ta,Ec).call(this,t)}writeValue(e){return X(this,ta,Ec).call(this,Ku(e))}writeUpdatableValue(){const e=h(this,Sn).length;return h(this,Sn).push(od),m(this,ei,h(this,ei)+Qt),t=>{h(this,Sn)[e]=Ku(t)}}}Sn=new WeakMap,ei=new WeakMap,ta=new WeakSet,Ec=function(e){return h(this,Sn).push(e),m(this,ei,h(this,ei)+e.length),e.length};var Yt,lr,ti,ri,as,Ti,ud,_f;const Au=class Au{constructor(e,t,r){k(this,Ti);E(this,"allowLoose");k(this,Yt);k(this,lr);k(this,ti);k(this,ri);k(this,as);me(this,{allowLoose:!!t}),m(this,Yt,_t(e)),m(this,ti,0),m(this,ri,null),m(this,as,r??1024),m(this,lr,0)}get data(){return V(h(this,Yt))}get dataLength(){return h(this,Yt).length}get consumed(){return h(this,lr)}get bytes(){return new Uint8Array(h(this,Yt))}subReader(e){const t=new Au(h(this,Yt).slice(h(this,lr)+e),this.allowLoose,h(this,as));return m(t,ri,this),t}readBytes(e,t){let r=X(this,Ti,_f).call(this,0,e,!!t);return X(this,Ti,ud).call(this,e),m(this,lr,h(this,lr)+r.length),r.slice(0,e)}readValue(){return Kr(this.readBytes(Qt))}readIndex(){return Kg(this.readBytes(Qt))}};Yt=new WeakMap,lr=new WeakMap,ti=new WeakMap,ri=new WeakMap,as=new WeakMap,Ti=new WeakSet,ud=function(e){var t;if(h(this,ri))return X(t=h(this,ri),Ti,ud).call(t,e);m(this,ti,h(this,ti)+e),F(h(this,as)<1||h(this,ti)<=h(this,as)*this.dataLength,`compressed ABI data exceeds inflation ratio of ${h(this,as)} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:_t(h(this,Yt)),offset:h(this,lr),length:e,info:{bytesRead:h(this,ti),dataLength:this.dataLength}})},_f=function(e,t,r){let s=Math.ceil(t/Qt)*Qt;return h(this,lr)+s>h(this,Yt).length&&(this.allowLoose&&r&&h(this,lr)+t<=h(this,Yt).length?s=t:F(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:_t(h(this,Yt)),length:h(this,Yt).length,offset:h(this,lr)+s})),h(this,Yt).slice(h(this,lr),h(this,lr)+s)};let dd=Au;function fr(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}function Zd(n,...e){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(n.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${n.length}`)}function Rf(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");fr(n.outputLen),fr(n.blockLen)}function Fa(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function Df(n,e){Zd(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const Bl=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lf=n=>n instanceof Uint8Array,Tc=n=>new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4)),Oc=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),jr=(n,e)=>n<<32-e|n>>>e,gp=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!gp)throw new Error("Non little-endian hardware is not supported");const pp=async()=>{};async function Vu(n,e,t){let r=Date.now();for(let s=0;s<n;s++){t(s);const i=Date.now()-r;i>=0&&i<e||(await pp(),r+=i)}}function bp(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function Ma(n){if(typeof n=="string"&&(n=bp(n)),!Lf(n))throw new Error(`expected Uint8Array, got ${typeof n}`);return n}function mp(...n){const e=new Uint8Array(n.reduce((r,s)=>r+s.length,0));let t=0;return n.forEach(r=>{if(!Lf(r))throw new Error("Uint8Array expected");e.set(r,t),t+=r.length}),e}class Yd{clone(){return this._cloneInto()}}const yp={}.toString;function Ff(n,e){if(e!==void 0&&yp.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(n,e)}function fl(n){const e=r=>n().update(Ma(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function wp(n=32){if(Bl&&typeof Bl.getRandomValues=="function")return Bl.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}class Mf extends Yd{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Rf(e);const r=Ma(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<i.length;a++)i[a]^=54;this.iHash.update(i),this.oHash=e.create();for(let a=0;a<i.length;a++)i[a]^=106;this.oHash.update(i),i.fill(0)}update(e){return Fa(this),this.iHash.update(e),this}digestInto(e){Fa(this),Zd(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:i,blockLen:a,outputLen:o}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hl=(n,e,t)=>new Mf(n,e).update(t).digest();hl.create=(n,e)=>new Mf(n,e);function vp(n,e,t,r){Rf(n);const s=Ff({dkLen:32,asyncTick:10},r),{c:i,dkLen:a,asyncTick:o}=s;if(fr(i),fr(a),fr(o),i<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const c=Ma(e),l=Ma(t),d=new Uint8Array(a),f=hl.create(n,c),x=f._cloneInto().update(l);return{c:i,dkLen:a,asyncTick:o,DK:d,PRF:f,PRFSalt:x}}function Ap(n,e,t,r,s){return n.destroy(),e.destroy(),r&&r.destroy(),s.fill(0),t}function qd(n,e,t,r){const{c:s,dkLen:i,DK:a,PRF:o,PRFSalt:c}=vp(n,e,t,r);let l;const d=new Uint8Array(4),f=Oc(d),x=new Uint8Array(o.outputLen);for(let g=1,b=0;b<i;g++,b+=o.outputLen){const p=a.subarray(b,b+o.outputLen);f.setInt32(0,g,!1),(l=c._cloneInto(l)).update(d).digestInto(x),p.set(x.subarray(0,p.length));for(let y=1;y<s;y++){o._cloneInto(l).update(x).digestInto(x);for(let v=0;v<p.length;v++)p[v]^=x[v]}}return Ap(o,c,a,l,x)}function Ep(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),i=BigInt(4294967295),a=Number(t>>s&i),o=Number(t&i),c=r?4:0,l=r?0:4;n.setUint32(e+c,a,r),n.setUint32(e+l,o,r)}class eu extends Yd{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Oc(this.buffer)}update(e){Fa(this);const{view:t,buffer:r,blockLen:s}=this;e=Ma(e);const i=e.length;for(let a=0;a<i;){const o=Math.min(s-this.pos,i-a);if(o===s){const c=Oc(e);for(;s<=i-a;a+=s)this.process(c,a);continue}r.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Fa(this),Df(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:i}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let f=a;f<s;f++)t[f]=0;Ep(r,s-8,BigInt(this.length*8),i),this.process(r,0);const o=Oc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)o.setUint32(4*f,d[f],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:i,destroyed:a,pos:o}=this;return e.length=s,e.pos=o,e.finished=i,e.destroyed=a,s%t&&e.buffer.set(r),e}}const Tp=(n,e,t)=>n&e^~n&t,Op=(n,e,t)=>n&e^n&t^e&t,Ip=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Wn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),jn=new Uint32Array(64);class Sp extends eu{constructor(){super(64,32,8,!1),this.A=Wn[0]|0,this.B=Wn[1]|0,this.C=Wn[2]|0,this.D=Wn[3]|0,this.E=Wn[4]|0,this.F=Wn[5]|0,this.G=Wn[6]|0,this.H=Wn[7]|0}get(){const{A:e,B:t,C:r,D:s,E:i,F:a,G:o,H:c}=this;return[e,t,r,s,i,a,o,c]}set(e,t,r,s,i,a,o,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)jn[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const x=jn[f-15],g=jn[f-2],b=jr(x,7)^jr(x,18)^x>>>3,p=jr(g,17)^jr(g,19)^g>>>10;jn[f]=p+jn[f-7]+b+jn[f-16]|0}let{A:r,B:s,C:i,D:a,E:o,F:c,G:l,H:d}=this;for(let f=0;f<64;f++){const x=jr(o,6)^jr(o,11)^jr(o,25),g=d+x+Tp(o,c,l)+Ip[f]+jn[f]|0,p=(jr(r,2)^jr(r,13)^jr(r,22))+Op(r,s,i)|0;d=l,l=c,c=o,o=a+g|0,a=i,i=s,s=r,r=g+p|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(r,s,i,a,o,c,l,d)}roundClean(){jn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const qa=fl(()=>new Sp),fc=BigInt(2**32-1),fd=BigInt(32);function Gf(n,e=!1){return e?{h:Number(n&fc),l:Number(n>>fd&fc)}:{h:Number(n>>fd&fc)|0,l:Number(n&fc)|0}}function Xf(n,e=!1){let t=new Uint32Array(n.length),r=new Uint32Array(n.length);for(let s=0;s<n.length;s++){const{h:i,l:a}=Gf(n[s],e);[t[s],r[s]]=[i,a]}return[t,r]}const kp=(n,e)=>BigInt(n>>>0)<<fd|BigInt(e>>>0),Pp=(n,e,t)=>n>>>t,Up=(n,e,t)=>n<<32-t|e>>>t,Np=(n,e,t)=>n>>>t|e<<32-t,Cp=(n,e,t)=>n<<32-t|e>>>t,Bp=(n,e,t)=>n<<64-t|e>>>t-32,_p=(n,e,t)=>n>>>t-32|e<<64-t,Rp=(n,e)=>e,Dp=(n,e)=>n,Hf=(n,e,t)=>n<<t|e>>>32-t,zf=(n,e,t)=>e<<t|n>>>32-t,$f=(n,e,t)=>e<<t-32|n>>>64-t,Kf=(n,e,t)=>n<<t-32|e>>>64-t;function Lp(n,e,t,r){const s=(e>>>0)+(r>>>0);return{h:n+t+(s/2**32|0)|0,l:s|0}}const Fp=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),Mp=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,Gp=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),Xp=(n,e,t,r,s)=>e+t+r+s+(n/2**32|0)|0,Hp=(n,e,t,r,s)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(s>>>0),zp=(n,e,t,r,s,i)=>e+t+r+s+i+(n/2**32|0)|0,Me={fromBig:Gf,split:Xf,toBig:kp,shrSH:Pp,shrSL:Up,rotrSH:Np,rotrSL:Cp,rotrBH:Bp,rotrBL:_p,rotr32H:Rp,rotr32L:Dp,rotlSH:Hf,rotlSL:zf,rotlBH:$f,rotlBL:Kf,add:Lp,add3L:Fp,add3H:Mp,add4L:Gp,add4H:Xp,add5H:zp,add5L:Hp},[$p,Kp]=Me.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),Zn=new Uint32Array(80),Yn=new Uint32Array(80);class Vp extends eu{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:s,Ch:i,Cl:a,Dh:o,Dl:c,Eh:l,El:d,Fh:f,Fl:x,Gh:g,Gl:b,Hh:p,Hl:y}=this;return[e,t,r,s,i,a,o,c,l,d,f,x,g,b,p,y]}set(e,t,r,s,i,a,o,c,l,d,f,x,g,b,p,y){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=s|0,this.Ch=i|0,this.Cl=a|0,this.Dh=o|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=f|0,this.Fl=x|0,this.Gh=g|0,this.Gl=b|0,this.Hh=p|0,this.Hl=y|0}process(e,t){for(let N=0;N<16;N++,t+=4)Zn[N]=e.getUint32(t),Yn[N]=e.getUint32(t+=4);for(let N=16;N<80;N++){const P=Zn[N-15]|0,S=Yn[N-15]|0,C=Me.rotrSH(P,S,1)^Me.rotrSH(P,S,8)^Me.shrSH(P,S,7),z=Me.rotrSL(P,S,1)^Me.rotrSL(P,S,8)^Me.shrSL(P,S,7),G=Zn[N-2]|0,ne=Yn[N-2]|0,J=Me.rotrSH(G,ne,19)^Me.rotrBH(G,ne,61)^Me.shrSH(G,ne,6),B=Me.rotrSL(G,ne,19)^Me.rotrBL(G,ne,61)^Me.shrSL(G,ne,6),oe=Me.add4L(z,B,Yn[N-7],Yn[N-16]),he=Me.add4H(oe,C,J,Zn[N-7],Zn[N-16]);Zn[N]=he|0,Yn[N]=oe|0}let{Ah:r,Al:s,Bh:i,Bl:a,Ch:o,Cl:c,Dh:l,Dl:d,Eh:f,El:x,Fh:g,Fl:b,Gh:p,Gl:y,Hh:v,Hl:I}=this;for(let N=0;N<80;N++){const P=Me.rotrSH(f,x,14)^Me.rotrSH(f,x,18)^Me.rotrBH(f,x,41),S=Me.rotrSL(f,x,14)^Me.rotrSL(f,x,18)^Me.rotrBL(f,x,41),C=f&g^~f&p,z=x&b^~x&y,G=Me.add5L(I,S,z,Kp[N],Yn[N]),ne=Me.add5H(G,v,P,C,$p[N],Zn[N]),J=G|0,B=Me.rotrSH(r,s,28)^Me.rotrBH(r,s,34)^Me.rotrBH(r,s,39),oe=Me.rotrSL(r,s,28)^Me.rotrBL(r,s,34)^Me.rotrBL(r,s,39),he=r&i^r&o^i&o,Pe=s&a^s&c^a&c;v=p|0,I=y|0,p=g|0,y=b|0,g=f|0,b=x|0,{h:f,l:x}=Me.add(l|0,d|0,ne|0,J|0),l=o|0,d=c|0,o=i|0,c=a|0,i=r|0,a=s|0;const O=Me.add3L(J,oe,Pe);r=Me.add3H(O,ne,B,he),s=O|0}({h:r,l:s}=Me.add(this.Ah|0,this.Al|0,r|0,s|0)),{h:i,l:a}=Me.add(this.Bh|0,this.Bl|0,i|0,a|0),{h:o,l:c}=Me.add(this.Ch|0,this.Cl|0,o|0,c|0),{h:l,l:d}=Me.add(this.Dh|0,this.Dl|0,l|0,d|0),{h:f,l:x}=Me.add(this.Eh|0,this.El|0,f|0,x|0),{h:g,l:b}=Me.add(this.Fh|0,this.Fl|0,g|0,b|0),{h:p,l:y}=Me.add(this.Gh|0,this.Gl|0,p|0,y|0),{h:v,l:I}=Me.add(this.Hh|0,this.Hl|0,v|0,I|0),this.set(r,s,i,a,o,c,l,d,f,x,g,b,p,y,v,I)}roundClean(){Zn.fill(0),Yn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const tu=fl(()=>new Vp);function Jp(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}const Ju=Jp(),Qu=Ju.crypto||Ju.msCrypto;function Qp(n){switch(n){case"sha256":return qa.create();case"sha512":return tu.create()}w(!1,"invalid hashing algorithm name","algorithm",n)}function Wp(n,e){const t={sha256:qa,sha512:tu}[n];return w(t!=null,"invalid hmac algorithm","algorithm",n),hl.create(t,e)}function jp(n,e,t,r,s){const i={sha256:qa,sha512:tu}[s];return w(i!=null,"invalid pbkdf2 algorithm","algorithm",s),qd(i,n,e,{c:t,dkLen:r})}function Zp(n){F(Qu!=null,"platform does not support secure random numbers","UNSUPPORTED_OPERATION",{operation:"randomBytes"}),w(Number.isInteger(n)&&n>0&&n<=1024,"invalid length","length",n);const e=new Uint8Array(n);return Qu.getRandomValues(e),e}let Vf=!1;const Jf=function(n,e,t){return Wp(n,e).update(t).digest()};let Qf=Jf;function eo(n,e,t){const r=ae(e,"key"),s=ae(t,"data");return V(Qf(n,r,s))}eo._=Jf;eo.lock=function(){Vf=!0};eo.register=function(n){if(Vf)throw new Error("computeHmac is locked");Qf=n};Object.freeze(eo);const[Wf,jf,Zf]=[[],[],[]],Yp=BigInt(0),uo=BigInt(1),qp=BigInt(2),eb=BigInt(7),tb=BigInt(256),rb=BigInt(113);for(let n=0,e=uo,t=1,r=0;n<24;n++){[t,r]=[r,(2*t+3*r)%5],Wf.push(2*(5*r+t)),jf.push((n+1)*(n+2)/2%64);let s=Yp;for(let i=0;i<7;i++)e=(e<<uo^(e>>eb)*rb)%tb,e&qp&&(s^=uo<<(uo<<BigInt(i))-uo);Zf.push(s)}const[nb,sb]=Xf(Zf,!0),Wu=(n,e,t)=>t>32?$f(n,e,t):Hf(n,e,t),ju=(n,e,t)=>t>32?Kf(n,e,t):zf(n,e,t);function ib(n,e=24){const t=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let a=0;a<10;a++)t[a]=n[a]^n[a+10]^n[a+20]^n[a+30]^n[a+40];for(let a=0;a<10;a+=2){const o=(a+8)%10,c=(a+2)%10,l=t[c],d=t[c+1],f=Wu(l,d,1)^t[o],x=ju(l,d,1)^t[o+1];for(let g=0;g<50;g+=10)n[a+g]^=f,n[a+g+1]^=x}let s=n[2],i=n[3];for(let a=0;a<24;a++){const o=jf[a],c=Wu(s,i,o),l=ju(s,i,o),d=Wf[a];s=n[d],i=n[d+1],n[d]=c,n[d+1]=l}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)t[o]=n[a+o];for(let o=0;o<10;o++)n[a+o]^=~t[(o+2)%10]&t[(o+4)%10]}n[0]^=nb[r],n[1]^=sb[r]}t.fill(0)}class ru extends Yd{constructor(e,t,r,s=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=s,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,fr(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Tc(this.state)}keccak(){ib(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){Fa(this);const{blockLen:t,state:r}=this;e=Ma(e);const s=e.length;for(let i=0;i<s;){const a=Math.min(t-this.pos,s-i);for(let o=0;o<a;o++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:s}=this;e[r]^=t,(t&128)!==0&&r===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Fa(this,!1),Zd(e),this.finish();const t=this.state,{blockLen:r}=this;for(let s=0,i=e.length;s<i;){this.posOut>=r&&this.keccak();const a=Math.min(r-this.posOut,i-s);e.set(t.subarray(this.posOut,this.posOut+a),s),this.posOut+=a,s+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return fr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Df(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:s,rounds:i,enableXOF:a}=this;return e||(e=new ru(t,r,s,a,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=s,e.enableXOF=a,e.destroyed=this.destroyed,e}}const ab=(n,e,t)=>fl(()=>new ru(e,n,t)),ob=ab(1,136,256/8);let Yf=!1;const qf=function(n){return ob(n)};let eh=qf;function Ue(n){const e=ae(n,"data");return V(eh(e))}Ue._=qf;Ue.lock=function(){Yf=!0};Ue.register=function(n){if(Yf)throw new TypeError("keccak256 is locked");eh=n};Object.freeze(Ue);const cb=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),th=Uint8Array.from({length:16},(n,e)=>e),lb=th.map(n=>(9*n+5)%16);let nu=[th],su=[lb];for(let n=0;n<4;n++)for(let e of[nu,su])e.push(e[n].map(t=>cb[t]));const rh=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(n=>new Uint8Array(n)),db=nu.map((n,e)=>n.map(t=>rh[e][t])),ub=su.map((n,e)=>n.map(t=>rh[e][t])),fb=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),hb=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),hc=(n,e)=>n<<e|n>>>32-e;function Zu(n,e,t,r){return n===0?e^t^r:n===1?e&t|~e&r:n===2?(e|~t)^r:n===3?e&r|t&~r:e^(t|~r)}const xc=new Uint32Array(16);class xb extends eu{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:s,h4:i}=this;return[e,t,r,s,i]}set(e,t,r,s,i){this.h0=e|0,this.h1=t|0,this.h2=r|0,this.h3=s|0,this.h4=i|0}process(e,t){for(let g=0;g<16;g++,t+=4)xc[g]=e.getUint32(t,!0);let r=this.h0|0,s=r,i=this.h1|0,a=i,o=this.h2|0,c=o,l=this.h3|0,d=l,f=this.h4|0,x=f;for(let g=0;g<5;g++){const b=4-g,p=fb[g],y=hb[g],v=nu[g],I=su[g],N=db[g],P=ub[g];for(let S=0;S<16;S++){const C=hc(r+Zu(g,i,o,l)+xc[v[S]]+p,N[S])+f|0;r=f,f=l,l=hc(o,10)|0,o=i,i=C}for(let S=0;S<16;S++){const C=hc(s+Zu(b,a,c,d)+xc[I[S]]+y,P[S])+x|0;s=x,x=d,d=hc(c,10)|0,c=a,a=C}}this.set(this.h1+o+d|0,this.h2+l+x|0,this.h3+f+s|0,this.h4+r+a|0,this.h0+i+c|0)}roundClean(){xc.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const gb=fl(()=>new xb);let nh=!1;const sh=function(n){return gb(n)};let ih=sh;function to(n){const e=ae(n,"data");return V(ih(e))}to._=sh;to.lock=function(){nh=!0};to.register=function(n){if(nh)throw new TypeError("ripemd160 is locked");ih=n};Object.freeze(to);let ah=!1;const oh=function(n,e,t,r,s){return jp(n,e,t,r,s)};let ch=oh;function Ss(n,e,t,r,s){const i=ae(n,"password"),a=ae(e,"salt");return V(ch(i,a,t,r,s))}Ss._=oh;Ss.lock=function(){ah=!0};Ss.register=function(n){if(ah)throw new Error("pbkdf2 is locked");ch=n};Object.freeze(Ss);let lh=!1;const dh=function(n){return new Uint8Array(Zp(n))};let uh=dh;function Hn(n){return uh(n)}Hn._=dh;Hn.lock=function(){lh=!0};Hn.register=function(n){if(lh)throw new Error("randomBytes is locked");uh=n};Object.freeze(Hn);const Ze=(n,e)=>n<<e|n>>>32-e;function Yu(n,e,t,r,s,i){let a=n[e++]^t[r++],o=n[e++]^t[r++],c=n[e++]^t[r++],l=n[e++]^t[r++],d=n[e++]^t[r++],f=n[e++]^t[r++],x=n[e++]^t[r++],g=n[e++]^t[r++],b=n[e++]^t[r++],p=n[e++]^t[r++],y=n[e++]^t[r++],v=n[e++]^t[r++],I=n[e++]^t[r++],N=n[e++]^t[r++],P=n[e++]^t[r++],S=n[e++]^t[r++],C=a,z=o,G=c,ne=l,J=d,B=f,oe=x,he=g,Pe=b,O=p,L=y,ce=v,de=I,R=N,_=P,q=S;for(let se=0;se<8;se+=2)J^=Ze(C+de|0,7),Pe^=Ze(J+C|0,9),de^=Ze(Pe+J|0,13),C^=Ze(de+Pe|0,18),O^=Ze(B+z|0,7),R^=Ze(O+B|0,9),z^=Ze(R+O|0,13),B^=Ze(z+R|0,18),_^=Ze(L+oe|0,7),G^=Ze(_+L|0,9),oe^=Ze(G+_|0,13),L^=Ze(oe+G|0,18),ne^=Ze(q+ce|0,7),he^=Ze(ne+q|0,9),ce^=Ze(he+ne|0,13),q^=Ze(ce+he|0,18),z^=Ze(C+ne|0,7),G^=Ze(z+C|0,9),ne^=Ze(G+z|0,13),C^=Ze(ne+G|0,18),oe^=Ze(B+J|0,7),he^=Ze(oe+B|0,9),J^=Ze(he+oe|0,13),B^=Ze(J+he|0,18),ce^=Ze(L+O|0,7),Pe^=Ze(ce+L|0,9),O^=Ze(Pe+ce|0,13),L^=Ze(O+Pe|0,18),de^=Ze(q+_|0,7),R^=Ze(de+q|0,9),_^=Ze(R+de|0,13),q^=Ze(_+R|0,18);s[i++]=a+C|0,s[i++]=o+z|0,s[i++]=c+G|0,s[i++]=l+ne|0,s[i++]=d+J|0,s[i++]=f+B|0,s[i++]=x+oe|0,s[i++]=g+he|0,s[i++]=b+Pe|0,s[i++]=p+O|0,s[i++]=y+L|0,s[i++]=v+ce|0,s[i++]=I+de|0,s[i++]=N+R|0,s[i++]=P+_|0,s[i++]=S+q|0}function Ki(n,e,t,r,s){let i=r+0,a=r+16*s;for(let o=0;o<16;o++)t[a+o]=n[e+(2*s-1)*16+o];for(let o=0;o<s;o++,i+=16,e+=16)Yu(t,a,n,e,t,i),o>0&&(a+=16),Yu(t,i,n,e+=16,t,a)}function fh(n,e,t){const r=Ff({dkLen:32,asyncTick:10,maxmem:1073742848},t),{N:s,r:i,p:a,dkLen:o,asyncTick:c,maxmem:l,onProgress:d}=r;if(fr(s),fr(i),fr(a),fr(o),fr(c),fr(l),d!==void 0&&typeof d!="function")throw new Error("progressCb should be function");const f=128*i,x=f/4;if(s<=1||(s&s-1)!==0||s>=2**(f/8)||s>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(a<0||a>(2**32-1)*32/f)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(o<0||o>(2**32-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const g=f*(s+a);if(g>l)throw new Error(`Scrypt: parameters too large, ${g} (128 * r * (N + p)) > ${l} (maxmem)`);const b=qd(qa,n,e,{c:1,dkLen:f*a}),p=Tc(b),y=Tc(new Uint8Array(f*s)),v=Tc(new Uint8Array(f));let I=()=>{};if(d){const N=2*s*a,P=Math.max(Math.floor(N/1e4),1);let S=0;I=()=>{S++,d&&(!(S%P)||S===N)&&d(S/N)}}return{N:s,r:i,p:a,dkLen:o,blockSize32:x,V:y,B32:p,B:b,tmp:v,blockMixCb:I,asyncTick:c}}function hh(n,e,t,r,s){const i=qd(qa,n,t,{c:1,dkLen:e});return t.fill(0),r.fill(0),s.fill(0),i}function pb(n,e,t){const{N:r,r:s,p:i,dkLen:a,blockSize32:o,V:c,B32:l,B:d,tmp:f,blockMixCb:x}=fh(n,e,t);for(let g=0;g<i;g++){const b=o*g;for(let p=0;p<o;p++)c[p]=l[b+p];for(let p=0,y=0;p<r-1;p++)Ki(c,y,c,y+=o,s),x();Ki(c,(r-1)*o,l,b,s),x();for(let p=0;p<r;p++){const y=l[b+o-16]%r;for(let v=0;v<o;v++)f[v]=l[b+v]^c[y*o+v];Ki(f,0,l,b,s),x()}}return hh(n,a,d,c,f)}async function bb(n,e,t){const{N:r,r:s,p:i,dkLen:a,blockSize32:o,V:c,B32:l,B:d,tmp:f,blockMixCb:x,asyncTick:g}=fh(n,e,t);for(let b=0;b<i;b++){const p=o*b;for(let v=0;v<o;v++)c[v]=l[p+v];let y=0;await Vu(r-1,g,()=>{Ki(c,y,c,y+=o,s),x()}),Ki(c,(r-1)*o,l,p,s),x(),await Vu(r,g,()=>{const v=l[p+o-16]%r;for(let I=0;I<o;I++)f[I]=l[p+I]^c[v*o+I];Ki(f,0,l,p,s),x()})}return hh(n,a,d,c,f)}let xh=!1,gh=!1;const ph=async function(n,e,t,r,s,i,a){return await bb(n,e,{N:t,r,p:s,dkLen:i,onProgress:a})},bh=function(n,e,t,r,s,i){return pb(n,e,{N:t,r,p:s,dkLen:i})};let mh=ph,yh=bh;async function ro(n,e,t,r,s,i,a){const o=ae(n,"passwd"),c=ae(e,"salt");return V(await mh(o,c,t,r,s,i,a))}ro._=ph;ro.lock=function(){gh=!0};ro.register=function(n){if(gh)throw new Error("scrypt is locked");mh=n};Object.freeze(ro);function no(n,e,t,r,s,i){const a=ae(n,"passwd"),o=ae(e,"salt");return V(yh(a,o,t,r,s,i))}no._=bh;no.lock=function(){xh=!0};no.register=function(n){if(xh)throw new Error("scryptSync is locked");yh=n};Object.freeze(no);const wh=function(n){return Qp("sha256").update(n).digest()};let vh=wh,Ah=!1;function Nr(n){const e=ae(n,"data");return V(vh(e))}Nr._=wh;Nr.lock=function(){Ah=!0};Nr.register=function(n){if(Ah)throw new Error("sha256 is locked");vh=n};Object.freeze(Nr);Object.freeze(Nr);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Eh=BigInt(0),xl=BigInt(1),mb=BigInt(2),gl=n=>n instanceof Uint8Array,yb=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Ga(n){if(!gl(n))throw new Error("Uint8Array expected");let e="";for(let t=0;t<n.length;t++)e+=yb[n[t]];return e}function Th(n){const e=n.toString(16);return e.length&1?`0${e}`:e}function iu(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}function Xa(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let r=0;r<t.length;r++){const s=r*2,i=n.slice(s,s+2),a=Number.parseInt(i,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");t[r]=a}return t}function mi(n){return iu(Ga(n))}function au(n){if(!gl(n))throw new Error("Uint8Array expected");return iu(Ga(Uint8Array.from(n).reverse()))}function Ha(n,e){return Xa(n.toString(16).padStart(e*2,"0"))}function ou(n,e){return Ha(n,e).reverse()}function wb(n){return Xa(Th(n))}function Dr(n,e,t){let r;if(typeof e=="string")try{r=Xa(e)}catch(i){throw new Error(`${n} must be valid hex string, got "${e}". Cause: ${i}`)}else if(gl(e))r=Uint8Array.from(e);else throw new Error(`${n} must be hex string or Uint8Array`);const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(`${n} expected ${t} bytes, got ${s}`);return r}function Oo(...n){const e=new Uint8Array(n.reduce((r,s)=>r+s.length,0));let t=0;return n.forEach(r=>{if(!gl(r))throw new Error("Uint8Array expected");e.set(r,t),t+=r.length}),e}function vb(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ab(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function Eb(n){let e;for(e=0;n>Eh;n>>=xl,e+=1);return e}function Tb(n,e){return n>>BigInt(e)&xl}const Ob=(n,e,t)=>n|(t?xl:Eh)<<BigInt(e),cu=n=>(mb<<BigInt(n-1))-xl,_l=n=>new Uint8Array(n),qu=n=>Uint8Array.from(n);function Oh(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=_l(n),s=_l(n),i=0;const a=()=>{r.fill(1),s.fill(0),i=0},o=(...f)=>t(s,r,...f),c=(f=_l())=>{s=o(qu([0]),f),r=o(),f.length!==0&&(s=o(qu([1]),f),r=o())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const x=[];for(;f<e;){r=o();const g=r.slice();x.push(g),f+=r.length}return Oo(...x)};return(f,x)=>{a(),c(f);let g;for(;!(g=x(l()));)c();return a(),g}}const Ib={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||n instanceof Uint8Array,isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function ec(n,e,t={}){const r=(s,i,a)=>{const o=Ib[i];if(typeof o!="function")throw new Error(`Invalid validator "${i}", expected function`);const c=n[s];if(!(a&&c===void 0)&&!o(c,n))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${i}`)};for(const[s,i]of Object.entries(e))r(s,i,!1);for(const[s,i]of Object.entries(t))r(s,i,!0);return n}const Sb=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Tb,bitLen:Eb,bitMask:cu,bitSet:Ob,bytesToHex:Ga,bytesToNumberBE:mi,bytesToNumberLE:au,concatBytes:Oo,createHmacDrbg:Oh,ensureBytes:Dr,equalBytes:vb,hexToBytes:Xa,hexToNumber:iu,numberToBytesBE:Ha,numberToBytesLE:ou,numberToHexUnpadded:Th,numberToVarBytesBE:wb,utf8ToBytes:Ab,validateObject:ec},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const St=BigInt(0),vt=BigInt(1),Ms=BigInt(2),kb=BigInt(3),hd=BigInt(4),e0=BigInt(5),t0=BigInt(8);BigInt(9);BigInt(16);function er(n,e){const t=n%e;return t>=St?t:e+t}function Pb(n,e,t){if(t<=St||e<St)throw new Error("Expected power/modulo > 0");if(t===vt)return St;let r=vt;for(;e>St;)e&vt&&(r=r*n%t),n=n*n%t,e>>=vt;return r}function xr(n,e,t){let r=n;for(;e-- >St;)r*=r,r%=t;return r}function xd(n,e){if(n===St||e<=St)throw new Error(`invert: expected positive integers, got n=${n} mod=${e}`);let t=er(n,e),r=e,s=St,i=vt;for(;t!==St;){const o=r/t,c=r%t,l=s-i*o;r=t,t=c,s=i,i=l}if(r!==vt)throw new Error("invert: does not exist");return er(s,e)}function Ub(n){const e=(n-vt)/Ms;let t,r,s;for(t=n-vt,r=0;t%Ms===St;t/=Ms,r++);for(s=Ms;s<n&&Pb(s,e,n)!==n-vt;s++);if(r===1){const a=(n+vt)/hd;return function(c,l){const d=c.pow(l,a);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}const i=(t+vt)/Ms;return function(o,c){if(o.pow(c,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let l=r,d=o.pow(o.mul(o.ONE,s),t),f=o.pow(c,i),x=o.pow(c,t);for(;!o.eql(x,o.ONE);){if(o.eql(x,o.ZERO))return o.ZERO;let g=1;for(let p=o.sqr(x);g<l&&!o.eql(p,o.ONE);g++)p=o.sqr(p);const b=o.pow(d,vt<<BigInt(l-g-1));d=o.sqr(b),f=o.mul(f,b),x=o.mul(x,d),l=g}return f}}function Nb(n){if(n%hd===kb){const e=(n+vt)/hd;return function(r,s){const i=r.pow(s,e);if(!r.eql(r.sqr(i),s))throw new Error("Cannot find square root");return i}}if(n%t0===e0){const e=(n-e0)/t0;return function(r,s){const i=r.mul(s,Ms),a=r.pow(i,e),o=r.mul(s,a),c=r.mul(r.mul(o,Ms),a),l=r.mul(o,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),s))throw new Error("Cannot find square root");return l}}return Ub(n)}const Cb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Bb(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Cb.reduce((r,s)=>(r[s]="function",r),e);return ec(n,t)}function _b(n,e,t){if(t<St)throw new Error("Expected power > 0");if(t===St)return n.ONE;if(t===vt)return e;let r=n.ONE,s=e;for(;t>St;)t&vt&&(r=n.mul(r,s)),s=n.sqr(s),t>>=vt;return r}function Rb(n,e){const t=new Array(e.length),r=e.reduce((i,a,o)=>n.is0(a)?i:(t[o]=i,n.mul(i,a)),n.ONE),s=n.inv(r);return e.reduceRight((i,a,o)=>n.is0(a)?i:(t[o]=n.mul(i,t[o]),n.mul(i,a)),s),t}function Ih(n,e){const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Db(n,e,t=!1,r={}){if(n<=St)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:i}=Ih(n,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=Nb(n),o=Object.freeze({ORDER:n,BITS:s,BYTES:i,MASK:cu(s),ZERO:St,ONE:vt,create:c=>er(c,n),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return St<=c&&c<n},is0:c=>c===St,isOdd:c=>(c&vt)===vt,neg:c=>er(-c,n),eql:(c,l)=>c===l,sqr:c=>er(c*c,n),add:(c,l)=>er(c+l,n),sub:(c,l)=>er(c-l,n),mul:(c,l)=>er(c*l,n),pow:(c,l)=>_b(o,c,l),div:(c,l)=>er(c*xd(l,n),n),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>xd(c,n),sqrt:r.sqrt||(c=>a(o,c)),invertBatch:c=>Rb(o,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>t?ou(c,i):Ha(c,i),fromBytes:c=>{if(c.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${c.length}`);return t?au(c):mi(c)}});return Object.freeze(o)}function Sh(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function kh(n){const e=Sh(n);return e+Math.ceil(e/2)}function Lb(n,e,t=!1){const r=n.length,s=Sh(e),i=kh(e);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const a=t?mi(n):au(n),o=er(a,e-vt)+vt;return t?ou(o,s):Ha(o,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fb=BigInt(0),Rl=BigInt(1);function Mb(n,e){const t=(s,i)=>{const a=i.negate();return s?a:i},r=s=>{const i=Math.ceil(e/s)+1,a=2**(s-1);return{windows:i,windowSize:a}};return{constTimeNegate:t,unsafeLadder(s,i){let a=n.ZERO,o=s;for(;i>Fb;)i&Rl&&(a=a.add(o)),o=o.double(),i>>=Rl;return a},precomputeWindow(s,i){const{windows:a,windowSize:o}=r(i),c=[];let l=s,d=l;for(let f=0;f<a;f++){d=l,c.push(d);for(let x=1;x<o;x++)d=d.add(l),c.push(d);l=d.double()}return c},wNAF(s,i,a){const{windows:o,windowSize:c}=r(s);let l=n.ZERO,d=n.BASE;const f=BigInt(2**s-1),x=2**s,g=BigInt(s);for(let b=0;b<o;b++){const p=b*c;let y=Number(a&f);a>>=g,y>c&&(y-=x,a+=Rl);const v=p,I=p+Math.abs(y)-1,N=b%2!==0,P=y<0;y===0?d=d.add(t(N,i[v])):l=l.add(t(P,i[I]))}return{p:l,f:d}},wNAFCached(s,i,a,o){const c=s._WINDOW_SIZE||1;let l=i.get(s);return l||(l=this.precomputeWindow(s,c),c!==1&&i.set(s,o(l))),this.wNAF(c,l,a)}}}function Ph(n){return Bb(n.Fp),ec(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ih(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Gb(n){const e=Ph(n);ec(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:s}=e;if(t){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:Xb,hexToBytes:Hb}=Sb,Ks={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(n){const{Err:e}=Ks;if(n.length<2||n[0]!==2)throw new e("Invalid signature integer tag");const t=n[1],r=n.subarray(2,t+2);if(!t||r.length!==t)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:Xb(r),l:n.subarray(t+2)}},toSig(n){const{Err:e}=Ks,t=typeof n=="string"?Hb(n):n;if(!(t instanceof Uint8Array))throw new Error("ui8a expected");let r=t.length;if(r<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:s,l:i}=Ks._parseInt(t.subarray(2)),{d:a,l:o}=Ks._parseInt(i);if(o.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:a}},hexFromSig(n){const e=l=>Number.parseInt(l[0],16)&8?"00"+l:l,t=l=>{const d=l.toString(16);return d.length&1?`0${d}`:d},r=e(t(n.s)),s=e(t(n.r)),i=r.length/2,a=s.length/2,o=t(i),c=t(a);return`30${t(a+i+4)}02${c}${s}02${o}${r}`}},Fn=BigInt(0),Ir=BigInt(1);BigInt(2);const r0=BigInt(3);BigInt(4);function zb(n){const e=Gb(n),{Fp:t}=e,r=e.toBytes||((b,p,y)=>{const v=p.toAffine();return Oo(Uint8Array.from([4]),t.toBytes(v.x),t.toBytes(v.y))}),s=e.fromBytes||(b=>{const p=b.subarray(1),y=t.fromBytes(p.subarray(0,t.BYTES)),v=t.fromBytes(p.subarray(t.BYTES,2*t.BYTES));return{x:y,y:v}});function i(b){const{a:p,b:y}=e,v=t.sqr(b),I=t.mul(v,b);return t.add(t.add(I,t.mul(b,p)),y)}if(!t.eql(t.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function a(b){return typeof b=="bigint"&&Fn<b&&b<e.n}function o(b){if(!a(b))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(b){const{allowedPrivateKeyLengths:p,nByteLength:y,wrapPrivateKey:v,n:I}=e;if(p&&typeof b!="bigint"){if(b instanceof Uint8Array&&(b=Ga(b)),typeof b!="string"||!p.includes(b.length))throw new Error("Invalid key");b=b.padStart(y*2,"0")}let N;try{N=typeof b=="bigint"?b:mi(Dr("private key",b,y))}catch{throw new Error(`private key must be ${y} bytes, hex or bigint, not ${typeof b}`)}return v&&(N=er(N,I)),o(N),N}const l=new Map;function d(b){if(!(b instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(p,y,v){if(this.px=p,this.py=y,this.pz=v,p==null||!t.isValid(p))throw new Error("x required");if(y==null||!t.isValid(y))throw new Error("y required");if(v==null||!t.isValid(v))throw new Error("z required")}static fromAffine(p){const{x:y,y:v}=p||{};if(!p||!t.isValid(y)||!t.isValid(v))throw new Error("invalid affine point");if(p instanceof f)throw new Error("projective point not allowed");const I=N=>t.eql(N,t.ZERO);return I(y)&&I(v)?f.ZERO:new f(y,v,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){const y=t.invertBatch(p.map(v=>v.pz));return p.map((v,I)=>v.toAffine(y[I])).map(f.fromAffine)}static fromHex(p){const y=f.fromAffine(s(Dr("pointHex",p)));return y.assertValidity(),y}static fromPrivateKey(p){return f.BASE.multiply(c(p))}_setWindowSize(p){this._WINDOW_SIZE=p,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:p,y}=this.toAffine();if(!t.isValid(p)||!t.isValid(y))throw new Error("bad point: x or y not FE");const v=t.sqr(y),I=i(p);if(!t.eql(v,I))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:p}=this.toAffine();if(t.isOdd)return!t.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){d(p);const{px:y,py:v,pz:I}=this,{px:N,py:P,pz:S}=p,C=t.eql(t.mul(y,S),t.mul(N,I)),z=t.eql(t.mul(v,S),t.mul(P,I));return C&&z}negate(){return new f(this.px,t.neg(this.py),this.pz)}double(){const{a:p,b:y}=e,v=t.mul(y,r0),{px:I,py:N,pz:P}=this;let S=t.ZERO,C=t.ZERO,z=t.ZERO,G=t.mul(I,I),ne=t.mul(N,N),J=t.mul(P,P),B=t.mul(I,N);return B=t.add(B,B),z=t.mul(I,P),z=t.add(z,z),S=t.mul(p,z),C=t.mul(v,J),C=t.add(S,C),S=t.sub(ne,C),C=t.add(ne,C),C=t.mul(S,C),S=t.mul(B,S),z=t.mul(v,z),J=t.mul(p,J),B=t.sub(G,J),B=t.mul(p,B),B=t.add(B,z),z=t.add(G,G),G=t.add(z,G),G=t.add(G,J),G=t.mul(G,B),C=t.add(C,G),J=t.mul(N,P),J=t.add(J,J),G=t.mul(J,B),S=t.sub(S,G),z=t.mul(J,ne),z=t.add(z,z),z=t.add(z,z),new f(S,C,z)}add(p){d(p);const{px:y,py:v,pz:I}=this,{px:N,py:P,pz:S}=p;let C=t.ZERO,z=t.ZERO,G=t.ZERO;const ne=e.a,J=t.mul(e.b,r0);let B=t.mul(y,N),oe=t.mul(v,P),he=t.mul(I,S),Pe=t.add(y,v),O=t.add(N,P);Pe=t.mul(Pe,O),O=t.add(B,oe),Pe=t.sub(Pe,O),O=t.add(y,I);let L=t.add(N,S);return O=t.mul(O,L),L=t.add(B,he),O=t.sub(O,L),L=t.add(v,I),C=t.add(P,S),L=t.mul(L,C),C=t.add(oe,he),L=t.sub(L,C),G=t.mul(ne,O),C=t.mul(J,he),G=t.add(C,G),C=t.sub(oe,G),G=t.add(oe,G),z=t.mul(C,G),oe=t.add(B,B),oe=t.add(oe,B),he=t.mul(ne,he),O=t.mul(J,O),oe=t.add(oe,he),he=t.sub(B,he),he=t.mul(ne,he),O=t.add(O,he),B=t.mul(oe,O),z=t.add(z,B),B=t.mul(L,O),C=t.mul(Pe,C),C=t.sub(C,B),B=t.mul(Pe,oe),G=t.mul(L,G),G=t.add(G,B),new f(C,z,G)}subtract(p){return this.add(p.negate())}is0(){return this.equals(f.ZERO)}wNAF(p){return g.wNAFCached(this,l,p,y=>{const v=t.invertBatch(y.map(I=>I.pz));return y.map((I,N)=>I.toAffine(v[N])).map(f.fromAffine)})}multiplyUnsafe(p){const y=f.ZERO;if(p===Fn)return y;if(o(p),p===Ir)return this;const{endo:v}=e;if(!v)return g.unsafeLadder(this,p);let{k1neg:I,k1:N,k2neg:P,k2:S}=v.splitScalar(p),C=y,z=y,G=this;for(;N>Fn||S>Fn;)N&Ir&&(C=C.add(G)),S&Ir&&(z=z.add(G)),G=G.double(),N>>=Ir,S>>=Ir;return I&&(C=C.negate()),P&&(z=z.negate()),z=new f(t.mul(z.px,v.beta),z.py,z.pz),C.add(z)}multiply(p){o(p);let y=p,v,I;const{endo:N}=e;if(N){const{k1neg:P,k1:S,k2neg:C,k2:z}=N.splitScalar(y);let{p:G,f:ne}=this.wNAF(S),{p:J,f:B}=this.wNAF(z);G=g.constTimeNegate(P,G),J=g.constTimeNegate(C,J),J=new f(t.mul(J.px,N.beta),J.py,J.pz),v=G.add(J),I=ne.add(B)}else{const{p:P,f:S}=this.wNAF(y);v=P,I=S}return f.normalizeZ([v,I])[0]}multiplyAndAddUnsafe(p,y,v){const I=f.BASE,N=(S,C)=>C===Fn||C===Ir||!S.equals(I)?S.multiplyUnsafe(C):S.multiply(C),P=N(this,y).add(N(p,v));return P.is0()?void 0:P}toAffine(p){const{px:y,py:v,pz:I}=this,N=this.is0();p==null&&(p=N?t.ONE:t.inv(I));const P=t.mul(y,p),S=t.mul(v,p),C=t.mul(I,p);if(N)return{x:t.ZERO,y:t.ZERO};if(!t.eql(C,t.ONE))throw new Error("invZ was invalid");return{x:P,y:S}}isTorsionFree(){const{h:p,isTorsionFree:y}=e;if(p===Ir)return!0;if(y)return y(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:p,clearCofactor:y}=e;return p===Ir?this:y?y(f,this):this.multiplyUnsafe(e.h)}toRawBytes(p=!0){return this.assertValidity(),r(f,this,p)}toHex(p=!0){return Ga(this.toRawBytes(p))}}f.BASE=new f(e.Gx,e.Gy,t.ONE),f.ZERO=new f(t.ZERO,t.ONE,t.ZERO);const x=e.nBitLength,g=Mb(f,e.endo?Math.ceil(x/2):x);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:a}}function $b(n){const e=Ph(n);return ec(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Kb(n){const e=$b(n),{Fp:t,n:r}=e,s=t.BYTES+1,i=2*t.BYTES+1;function a(O){return Fn<O&&O<t.ORDER}function o(O){return er(O,r)}function c(O){return xd(O,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:d,weierstrassEquation:f,isWithinCurveOrder:x}=zb({...e,toBytes(O,L,ce){const de=L.toAffine(),R=t.toBytes(de.x),_=Oo;return ce?_(Uint8Array.from([L.hasEvenY()?2:3]),R):_(Uint8Array.from([4]),R,t.toBytes(de.y))},fromBytes(O){const L=O.length,ce=O[0],de=O.subarray(1);if(L===s&&(ce===2||ce===3)){const R=mi(de);if(!a(R))throw new Error("Point is not on curve");const _=f(R);let q=t.sqrt(_);const se=(q&Ir)===Ir;return(ce&1)===1!==se&&(q=t.neg(q)),{x:R,y:q}}else if(L===i&&ce===4){const R=t.fromBytes(de.subarray(0,t.BYTES)),_=t.fromBytes(de.subarray(t.BYTES,2*t.BYTES));return{x:R,y:_}}else throw new Error(`Point of length ${L} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),g=O=>Ga(Ha(O,e.nByteLength));function b(O){const L=r>>Ir;return O>L}function p(O){return b(O)?o(-O):O}const y=(O,L,ce)=>mi(O.slice(L,ce));class v{constructor(L,ce,de){this.r=L,this.s=ce,this.recovery=de,this.assertValidity()}static fromCompact(L){const ce=e.nByteLength;return L=Dr("compactSignature",L,ce*2),new v(y(L,0,ce),y(L,ce,2*ce))}static fromDER(L){const{r:ce,s:de}=Ks.toSig(Dr("DER",L));return new v(ce,de)}assertValidity(){if(!x(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!x(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(L){return new v(this.r,this.s,L)}recoverPublicKey(L){const{r:ce,s:de,recovery:R}=this,_=z(Dr("msgHash",L));if(R==null||![0,1,2,3].includes(R))throw new Error("recovery id invalid");const q=R===2||R===3?ce+e.n:ce;if(q>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const se=(R&1)===0?"02":"03",ye=l.fromHex(se+g(q)),ve=c(q),Ae=o(-_*ve),Re=o(de*ve),Ke=l.BASE.multiplyAndAddUnsafe(ye,Ae,Re);if(!Ke)throw new Error("point at infinify");return Ke.assertValidity(),Ke}hasHighS(){return b(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Xa(this.toDERHex())}toDERHex(){return Ks.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Xa(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}const I={isValidPrivateKey(O){try{return d(O),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const O=kh(e.n);return Lb(e.randomBytes(O),e.n)},precompute(O=8,L=l.BASE){return L._setWindowSize(O),L.multiply(BigInt(3)),L}};function N(O,L=!0){return l.fromPrivateKey(O).toRawBytes(L)}function P(O){const L=O instanceof Uint8Array,ce=typeof O=="string",de=(L||ce)&&O.length;return L?de===s||de===i:ce?de===2*s||de===2*i:O instanceof l}function S(O,L,ce=!0){if(P(O))throw new Error("first arg must be private key");if(!P(L))throw new Error("second arg must be public key");return l.fromHex(L).multiply(d(O)).toRawBytes(ce)}const C=e.bits2int||function(O){const L=mi(O),ce=O.length*8-e.nBitLength;return ce>0?L>>BigInt(ce):L},z=e.bits2int_modN||function(O){return o(C(O))},G=cu(e.nBitLength);function ne(O){if(typeof O!="bigint")throw new Error("bigint expected");if(!(Fn<=O&&O<G))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Ha(O,e.nByteLength)}function J(O,L,ce=B){if(["recovered","canonical"].some(Q=>Q in ce))throw new Error("sign() legacy options not supported");const{hash:de,randomBytes:R}=e;let{lowS:_,prehash:q,extraEntropy:se}=ce;_==null&&(_=!0),O=Dr("msgHash",O),q&&(O=Dr("prehashed msgHash",de(O)));const ye=z(O),ve=d(L),Ae=[ne(ve),ne(ye)];if(se!=null){const Q=se===!0?R(t.BYTES):se;Ae.push(Dr("extraEntropy",Q))}const Re=Oo(...Ae),Ke=ye;function M(Q){const D=C(Q);if(!x(D))return;const Y=c(D),H=l.BASE.multiply(D).toAffine(),W=o(H.x);if(W===Fn)return;const j=o(Y*o(Ke+W*ve));if(j===Fn)return;let Z=(H.x===W?0:2)|Number(H.y&Ir),pe=j;return _&&b(j)&&(pe=p(j),Z^=1),new v(W,pe,Z)}return{seed:Re,k2sig:M}}const B={lowS:e.lowS,prehash:!1},oe={lowS:e.lowS,prehash:!1};function he(O,L,ce=B){const{seed:de,k2sig:R}=J(O,L,ce),_=e;return Oh(_.hash.outputLen,_.nByteLength,_.hmac)(de,R)}l.BASE._setWindowSize(8);function Pe(O,L,ce,de=oe){var H;const R=O;if(L=Dr("msgHash",L),ce=Dr("publicKey",ce),"strict"in de)throw new Error("options.strict was renamed to lowS");const{lowS:_,prehash:q}=de;let se,ye;try{if(typeof R=="string"||R instanceof Uint8Array)try{se=v.fromDER(R)}catch(W){if(!(W instanceof Ks.Err))throw W;se=v.fromCompact(R)}else if(typeof R=="object"&&typeof R.r=="bigint"&&typeof R.s=="bigint"){const{r:W,s:j}=R;se=new v(W,j)}else throw new Error("PARSE");ye=l.fromHex(ce)}catch(W){if(W.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(_&&se.hasHighS())return!1;q&&(L=e.hash(L));const{r:ve,s:Ae}=se,Re=z(L),Ke=c(Ae),M=o(Re*Ke),Q=o(ve*Ke),D=(H=l.BASE.multiplyAndAddUnsafe(ye,M,Q))==null?void 0:H.toAffine();return D?o(D.x)===ve:!1}return{CURVE:e,getPublicKey:N,getSharedSecret:S,sign:he,verify:Pe,ProjectivePoint:l,Signature:v,utils:I}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Vb(n){return{hash:n,hmac:(e,...t)=>hl(n,e,mp(...t)),randomBytes:wp}}function Jb(n,e){const t=r=>Kb({...n,...Vb(r)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Uh=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n0=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Qb=BigInt(1),gd=BigInt(2),s0=(n,e)=>(n+e/gd)/e;function Wb(n){const e=Uh,t=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),a=BigInt(23),o=BigInt(44),c=BigInt(88),l=n*n*n%e,d=l*l*n%e,f=xr(d,t,e)*d%e,x=xr(f,t,e)*d%e,g=xr(x,gd,e)*l%e,b=xr(g,s,e)*g%e,p=xr(b,i,e)*b%e,y=xr(p,o,e)*p%e,v=xr(y,c,e)*y%e,I=xr(v,o,e)*p%e,N=xr(I,t,e)*d%e,P=xr(N,a,e)*b%e,S=xr(P,r,e)*l%e,C=xr(S,gd,e);if(!pd.eql(pd.sqr(C),n))throw new Error("Cannot find square root");return C}const pd=Db(Uh,void 0,void 0,{sqrt:Wb}),es=Jb({a:BigInt(0),b:BigInt(7),Fp:pd,n:n0,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=n0,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Qb*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,a=BigInt("0x100000000000000000000000000000000"),o=s0(i*n,e),c=s0(-r*n,e);let l=er(n-o*t-c*s,e),d=er(-o*r-c*i,e);const f=l>a,x=d>a;if(f&&(l=e-l),x&&(d=e-d),l>a||d>a)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:f,k1:l,k2neg:x,k2:d}}}},qa);BigInt(0);es.ProjectivePoint;const za="0x0000000000000000000000000000000000000000",i0="0x0000000000000000000000000000000000000000000000000000000000000000",jb=`Ethereum Signed Message:
`,a0=BigInt(0),o0=BigInt(1),c0=BigInt(2),l0=BigInt(27),d0=BigInt(28),gc=BigInt(35),Ui={};function u0(n){return tt(gt(n),32)}var ra,rn,na,ni;const _r=class _r{constructor(e,t,r,s){k(this,ra);k(this,rn);k(this,na);k(this,ni);Is(e,Ui,"Signature"),m(this,ra,t),m(this,rn,r),m(this,na,s),m(this,ni,null)}get r(){return h(this,ra)}set r(e){w(bi(e)===32,"invalid r","value",e),m(this,ra,V(e))}get s(){return w(parseInt(h(this,rn).substring(0,3))<8,"non-canonical s; use ._s","s",h(this,rn)),h(this,rn)}set s(e){w(bi(e)===32,"invalid s","value",e),m(this,rn,V(e))}get _s(){return h(this,rn)}isValid(){return parseInt(h(this,rn).substring(0,3))<8}get v(){return h(this,na)}set v(e){const t=_e(e,"value");w(t===27||t===28,"invalid v","v",e),m(this,na,t)}get networkV(){return h(this,ni)}get legacyChainId(){const e=this.networkV;return e==null?null:_r.getChainId(e)}get yParity(){return this.v===27?0:1}get yParityAndS(){const e=ae(this.s);return this.yParity&&(e[0]|=128),V(e)}get compactSerialized(){return qe([this.r,this.yParityAndS])}get serialized(){return qe([this.r,this.s,this.yParity?"0x1c":"0x1b"])}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this._s}"${this.isValid()?"":', valid: "false"'}, yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const e=new _r(Ui,this.r,this._s,this.v);return this.networkV&&m(e,ni,this.networkV),e}toJSON(){const e=this.networkV;return{_type:"signature",networkV:e!=null?e.toString():null,r:this.r,s:this._s,v:this.v}}static getChainId(e){const t=fe(e,"v");return t==l0||t==d0?a0:(w(t>=gc,"invalid EIP-155 v","v",e),(t-gc)/c0)}static getChainIdV(e,t){return fe(e)*c0+BigInt(35+t-27)}static getNormalizedV(e){const t=fe(e);return t===a0||t===l0?27:t===o0||t===d0?28:(w(t>=gc,"invalid v","v",e),t&o0?27:28)}static from(e){function t(l,d){w(l,d,"signature",e)}if(e==null)return new _r(Ui,i0,i0,27);if(typeof e=="string"){const l=ae(e,"signature");if(l.length===64){const d=V(l.slice(0,32)),f=l.slice(32,64),x=f[0]&128?28:27;return f[0]&=127,new _r(Ui,d,V(f),x)}if(l.length===65){const d=V(l.slice(0,32)),f=V(l.slice(32,64)),x=_r.getNormalizedV(l[64]);return new _r(Ui,d,f,x)}t(!1,"invalid raw signature length")}if(e instanceof _r)return e.clone();const r=e.r;t(r!=null,"missing r");const s=u0(r),i=function(l,d){if(l!=null)return u0(l);if(d!=null){t(je(d,32),"invalid yParityAndS");const f=ae(d);return f[0]&=127,V(f)}t(!1,"missing s")}(e.s,e.yParityAndS),{networkV:a,v:o}=function(l,d,f){if(l!=null){const x=fe(l);return{networkV:x>=gc?x:void 0,v:_r.getNormalizedV(x)}}if(d!=null)return t(je(d,32),"invalid yParityAndS"),{v:ae(d)[0]&128?28:27};if(f!=null){switch(_e(f,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}t(!1,"invalid yParity")}t(!1,"missing v")}(e.v,e.yParityAndS,e.yParity),c=new _r(Ui,s,i,o);return a&&m(c,ni,a),t(e.yParity==null||_e(e.yParity,"sig.yParity")===c.yParity,"yParity mismatch"),t(e.yParityAndS==null||e.yParityAndS===c.yParityAndS,"yParityAndS mismatch"),c}};ra=new WeakMap,rn=new WeakMap,na=new WeakMap,ni=new WeakMap;let jt=_r;var kn;const Gs=class Gs{constructor(e){k(this,kn);w(bi(e)===32,"invalid private key","privateKey","[REDACTED]"),m(this,kn,V(e))}get privateKey(){return h(this,kn)}get publicKey(){return Gs.computePublicKey(h(this,kn))}get compressedPublicKey(){return Gs.computePublicKey(h(this,kn),!0)}sign(e){w(bi(e)===32,"invalid digest length","digest",e);const t=es.sign(_t(e),_t(h(this,kn)),{lowS:!0});return jt.from({r:$n(t.r,32),s:$n(t.s,32),v:t.recovery?28:27})}computeSharedSecret(e){const t=Gs.computePublicKey(e);return V(es.getSharedSecret(_t(h(this,kn)),ae(t),!1))}static computePublicKey(e,t){let r=ae(e,"key");if(r.length===32){const i=es.getPublicKey(r,!!t);return V(i)}if(r.length===64){const i=new Uint8Array(65);i[0]=4,i.set(r,1),r=i}const s=es.ProjectivePoint.fromHex(r);return V(s.toRawBytes(t))}static recoverPublicKey(e,t){w(bi(e)===32,"invalid digest length","digest",e);const r=jt.from(t);let s=es.Signature.fromCompact(_t(qe([r.r,r.s])));s=s.addRecoveryBit(r.yParity);const i=s.recoverPublicKey(_t(e));return w(i!=null,"invalid signature for digest","signature",t),"0x"+i.toHex(!1)}static addPoints(e,t,r){const s=es.ProjectivePoint.fromHex(Gs.computePublicKey(e).substring(2)),i=es.ProjectivePoint.fromHex(Gs.computePublicKey(t).substring(2));return"0x"+s.add(i).toHex(!!r)}};kn=new WeakMap;let gn=Gs;const Zb=BigInt(0),Yb=BigInt(36);function f0(n){n=n.toLowerCase();const e=n.substring(2).split(""),t=new Uint8Array(40);for(let s=0;s<40;s++)t[s]=e[s].charCodeAt(0);const r=ae(Ue(t));for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&(e[s]=e[s].toUpperCase()),(r[s>>1]&15)>=8&&(e[s+1]=e[s+1].toUpperCase());return"0x"+e.join("")}const lu={};for(let n=0;n<10;n++)lu[String(n)]=String(n);for(let n=0;n<26;n++)lu[String.fromCharCode(65+n)]=String(10+n);const h0=15;function qb(n){n=n.toUpperCase(),n=n.substring(4)+n.substring(0,2)+"00";let e=n.split("").map(r=>lu[r]).join("");for(;e.length>=h0;){let r=e.substring(0,h0);e=parseInt(r,10)%97+e.substring(r.length)}let t=String(98-parseInt(e,10)%97);for(;t.length<2;)t="0"+t;return t}const em=function(){const n={};for(let e=0;e<36;e++){const t="0123456789abcdefghijklmnopqrstuvwxyz"[e];n[t]=BigInt(e)}return n}();function tm(n){n=n.toLowerCase();let e=Zb;for(let t=0;t<n.length;t++)e=e*Yb+em[n[t]];return e}function ze(n){if(w(typeof n=="string","invalid address","address",n),n.match(/^(0x)?[0-9a-fA-F]{40}$/)){n.startsWith("0x")||(n="0x"+n);const e=f0(n);return w(!n.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||e===n,"bad address checksum","address",n),e}if(n.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){w(n.substring(2,4)===qb(n),"bad icap checksum","address",n);let e=tm(n.substring(4)).toString(16);for(;e.length<40;)e="0"+e;return f0("0x"+e)}w(!1,"invalid address","address",n)}function rm(n){const e=ze(n.from);let r=fe(n.nonce,"tx.nonce").toString(16);return r==="0"?r="0x":r.length%2?r="0x0"+r:r="0x"+r,ze(ct(Ue(Kn([e,r])),12))}function Nh(n){return n&&typeof n.getAddress=="function"}function bd(n){try{return ze(n),!0}catch{}return!1}async function Dl(n,e){const t=await e;return(t==null||t==="0x0000000000000000000000000000000000000000")&&(F(typeof n!="string","unconfigured name","UNCONFIGURED_NAME",{value:n}),w(!1,"invalid AddressLike value; did not resolve to a value address","target",n)),ze(t)}function kt(n,e){if(typeof n=="string")return n.match(/^0x[0-9a-f]{40}$/i)?ze(n):(F(e!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),Dl(n,e.resolveName(n)));if(Nh(n))return Dl(n,n.getAddress());if(n&&typeof n.then=="function")return Dl(n,n);w(!1,"unsupported addressable value","target",n)}const An={};function ge(n,e){let t=!1;return e<0&&(t=!0,e*=-1),new Ht(An,`${t?"":"u"}int${e}`,n,{signed:t,width:e})}function Ye(n,e){return new Ht(An,`bytes${e||""}`,n,{size:e})}const x0=Symbol.for("_ethers_typed");var si;const En=class En{constructor(e,t,r,s){E(this,"type");E(this,"value");k(this,si);E(this,"_typedSymbol");s==null&&(s=null),Is(An,e,"Typed"),me(this,{_typedSymbol:x0,type:t,value:r}),m(this,si,s),this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(e=>e.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return h(this,si)}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return h(this,si)===!0?-1:h(this,si)===!1?this.value.length:null}static from(e,t){return new En(An,e,t)}static uint8(e){return ge(e,8)}static uint16(e){return ge(e,16)}static uint24(e){return ge(e,24)}static uint32(e){return ge(e,32)}static uint40(e){return ge(e,40)}static uint48(e){return ge(e,48)}static uint56(e){return ge(e,56)}static uint64(e){return ge(e,64)}static uint72(e){return ge(e,72)}static uint80(e){return ge(e,80)}static uint88(e){return ge(e,88)}static uint96(e){return ge(e,96)}static uint104(e){return ge(e,104)}static uint112(e){return ge(e,112)}static uint120(e){return ge(e,120)}static uint128(e){return ge(e,128)}static uint136(e){return ge(e,136)}static uint144(e){return ge(e,144)}static uint152(e){return ge(e,152)}static uint160(e){return ge(e,160)}static uint168(e){return ge(e,168)}static uint176(e){return ge(e,176)}static uint184(e){return ge(e,184)}static uint192(e){return ge(e,192)}static uint200(e){return ge(e,200)}static uint208(e){return ge(e,208)}static uint216(e){return ge(e,216)}static uint224(e){return ge(e,224)}static uint232(e){return ge(e,232)}static uint240(e){return ge(e,240)}static uint248(e){return ge(e,248)}static uint256(e){return ge(e,256)}static uint(e){return ge(e,256)}static int8(e){return ge(e,-8)}static int16(e){return ge(e,-16)}static int24(e){return ge(e,-24)}static int32(e){return ge(e,-32)}static int40(e){return ge(e,-40)}static int48(e){return ge(e,-48)}static int56(e){return ge(e,-56)}static int64(e){return ge(e,-64)}static int72(e){return ge(e,-72)}static int80(e){return ge(e,-80)}static int88(e){return ge(e,-88)}static int96(e){return ge(e,-96)}static int104(e){return ge(e,-104)}static int112(e){return ge(e,-112)}static int120(e){return ge(e,-120)}static int128(e){return ge(e,-128)}static int136(e){return ge(e,-136)}static int144(e){return ge(e,-144)}static int152(e){return ge(e,-152)}static int160(e){return ge(e,-160)}static int168(e){return ge(e,-168)}static int176(e){return ge(e,-176)}static int184(e){return ge(e,-184)}static int192(e){return ge(e,-192)}static int200(e){return ge(e,-200)}static int208(e){return ge(e,-208)}static int216(e){return ge(e,-216)}static int224(e){return ge(e,-224)}static int232(e){return ge(e,-232)}static int240(e){return ge(e,-240)}static int248(e){return ge(e,-248)}static int256(e){return ge(e,-256)}static int(e){return ge(e,-256)}static bytes1(e){return Ye(e,1)}static bytes2(e){return Ye(e,2)}static bytes3(e){return Ye(e,3)}static bytes4(e){return Ye(e,4)}static bytes5(e){return Ye(e,5)}static bytes6(e){return Ye(e,6)}static bytes7(e){return Ye(e,7)}static bytes8(e){return Ye(e,8)}static bytes9(e){return Ye(e,9)}static bytes10(e){return Ye(e,10)}static bytes11(e){return Ye(e,11)}static bytes12(e){return Ye(e,12)}static bytes13(e){return Ye(e,13)}static bytes14(e){return Ye(e,14)}static bytes15(e){return Ye(e,15)}static bytes16(e){return Ye(e,16)}static bytes17(e){return Ye(e,17)}static bytes18(e){return Ye(e,18)}static bytes19(e){return Ye(e,19)}static bytes20(e){return Ye(e,20)}static bytes21(e){return Ye(e,21)}static bytes22(e){return Ye(e,22)}static bytes23(e){return Ye(e,23)}static bytes24(e){return Ye(e,24)}static bytes25(e){return Ye(e,25)}static bytes26(e){return Ye(e,26)}static bytes27(e){return Ye(e,27)}static bytes28(e){return Ye(e,28)}static bytes29(e){return Ye(e,29)}static bytes30(e){return Ye(e,30)}static bytes31(e){return Ye(e,31)}static bytes32(e){return Ye(e,32)}static address(e){return new En(An,"address",e)}static bool(e){return new En(An,"bool",!!e)}static bytes(e){return new En(An,"bytes",e)}static string(e){return new En(An,"string",e)}static array(e,t){throw new Error("not implemented yet")}static tuple(e,t){throw new Error("not implemented yet")}static overrides(e){return new En(An,"overrides",Object.assign({},e))}static isTyped(e){return e&&typeof e=="object"&&"_typedSymbol"in e&&e._typedSymbol===x0}static dereference(e,t){if(En.isTyped(e)){if(e.type!==t)throw new Error(`invalid type: expecetd ${t}, got ${e.type}`);return e.value}return e}};si=new WeakMap;let Ht=En;class nm extends Qn{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,t){let r=Ht.dereference(t,"string");try{r=ze(r)}catch(s){return this._throwError(s.message,t)}return e.writeValue(r)}decode(e){return ze($n(e.readValue(),20))}}class sm extends Qn{constructor(t){super(t.name,t.type,"_",t.dynamic);E(this,"coder");this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,r){return this.coder.encode(t,r)}decode(t){return this.coder.decode(t)}}function Ch(n,e,t){let r=[];if(Array.isArray(t))r=t;else if(t&&typeof t=="object"){let c={};r=e.map(l=>{const d=l.localName;return F(d,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:t}),F(!c[d],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:t}),c[d]=!0,t[d]})}else w(!1,"invalid tuple value","tuple",t);w(e.length===r.length,"types/value length mismatch","tuple",t);let s=new ld,i=new ld,a=[];e.forEach((c,l)=>{let d=r[l];if(c.dynamic){let f=i.length;c.encode(i,d);let x=s.writeUpdatableValue();a.push(g=>{x(g+f)})}else c.encode(s,d)}),a.forEach(c=>{c(s.length)});let o=n.appendWriter(s);return o+=n.appendWriter(i),o}function Bh(n,e){let t=[],r=[],s=n.subReader(0);return e.forEach(i=>{let a=null;if(i.dynamic){let o=n.readIndex(),c=s.subReader(o);try{a=i.decode(c)}catch(l){if(Bt(l,"BUFFER_OVERRUN"))throw l;a=l,a.baseType=i.name,a.name=i.localName,a.type=i.type}}else try{a=i.decode(n)}catch(o){if(Bt(o,"BUFFER_OVERRUN"))throw o;a=o,a.baseType=i.name,a.name=i.localName,a.type=i.type}if(a==null)throw new Error("investigate");t.push(a),r.push(i.localName||null)}),La.fromItems(t,r)}class im extends Qn{constructor(t,r,s){const i=t.type+"["+(r>=0?r:"")+"]",a=r===-1||t.dynamic;super("array",i,s,a);E(this,"coder");E(this,"length");me(this,{coder:t,length:r})}defaultValue(){const t=this.coder.defaultValue(),r=[];for(let s=0;s<this.length;s++)r.push(t);return r}encode(t,r){const s=Ht.dereference(r,"array");Array.isArray(s)||this._throwError("expected array value",s);let i=this.length;i===-1&&(i=s.length,t.writeValue(s.length)),mf(s.length,i,"coder array"+(this.localName?" "+this.localName:""));let a=[];for(let o=0;o<s.length;o++)a.push(this.coder);return Ch(t,a,s)}decode(t){let r=this.length;r===-1&&(r=t.readIndex(),F(r*Qt<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:r*Qt,length:t.dataLength}));let s=[];for(let i=0;i<r;i++)s.push(new sm(this.coder));return Bh(t,s)}}class am extends Qn{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,t){const r=Ht.dereference(t,"bool");return e.writeValue(r?1:0)}decode(e){return!!e.readValue()}}class _h extends Qn{constructor(e,t){super(e,e,t,!0)}defaultValue(){return"0x"}encode(e,t){t=_t(t);let r=e.writeValue(t.length);return r+=e.writeBytes(t),r}decode(e){return e.readBytes(e.readIndex(),!0)}}class om extends _h{constructor(e){super("bytes",e)}decode(e){return V(super.decode(e))}}class cm extends Qn{constructor(t,r){let s="bytes"+String(t);super(s,s,r,!1);E(this,"size");me(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(t,r){let s=_t(Ht.dereference(r,this.type));return s.length!==this.size&&this._throwError("incorrect data length",r),t.writeBytes(s)}decode(t){return V(t.readBytes(this.size))}}const lm=new Uint8Array([]);class dm extends Qn{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,t){return t!=null&&this._throwError("not null",t),e.writeBytes(lm)}decode(e){return e.readBytes(0),null}}const um=BigInt(0),fm=BigInt(1),hm=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class xm extends Qn{constructor(t,r,s){const i=(r?"int":"uint")+t*8;super(i,i,s,!1);E(this,"size");E(this,"signed");me(this,{size:t,signed:r},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,r){let s=fe(Ht.dereference(r,this.type)),i=$s(hm,Qt*8);if(this.signed){let a=$s(i,this.size*8-1);(s>a||s<-(a+fm))&&this._throwError("value out-of-bounds",r),s=jd(s,8*Qt)}else(s<um||s>$s(i,this.size*8))&&this._throwError("value out-of-bounds",r);return t.writeValue(s)}decode(t){let r=$s(t.readValue(),this.size*8);return this.signed&&(r=Fc(r,this.size*8)),r}}class gm extends _h{constructor(e){super("string",e)}defaultValue(){return""}encode(e,t){return super.encode(e,Be(Ht.dereference(t,"string")))}decode(e){return Gc(super.decode(e))}}class pc extends Qn{constructor(t,r){let s=!1;const i=[];t.forEach(o=>{o.dynamic&&(s=!0),i.push(o.type)});const a="tuple("+i.join(",")+")";super("tuple",a,r,s);E(this,"coders");me(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach(s=>{t.push(s.defaultValue())});const r=this.coders.reduce((s,i)=>{const a=i.localName;return a&&(s[a]||(s[a]=0),s[a]++),s},{});return this.coders.forEach((s,i)=>{let a=s.localName;!a||r[a]!==1||(a==="length"&&(a="_length"),t[a]==null&&(t[a]=t[i]))}),Object.freeze(t)}encode(t,r){const s=Ht.dereference(r,"tuple");return Ch(t,this.coders,s)}decode(t){return Bh(t,this.coders)}}function Ll(n,e){return{address:ze(n),storageKeys:e.map((t,r)=>(w(je(t,32),"invalid slot",`storageKeys[${r}]`,t),t.toLowerCase()))}}function Oi(n){if(Array.isArray(n))return n.map((t,r)=>Array.isArray(t)?(w(t.length===2,"invalid slot set",`value[${r}]`,t),Ll(t[0],t[1])):(w(t!=null&&typeof t=="object","invalid address-slot set","value",n),Ll(t.address,t.storageKeys)));w(n!=null&&typeof n=="object","invalid access list","value",n);const e=Object.keys(n).map(t=>{const r=n[t].reduce((s,i)=>(s[i]=!0,s),{});return Ll(t,Object.keys(r).sort())});return e.sort((t,r)=>t.address.localeCompare(r.address)),e}function Rh(n){return{address:ze(n.address),nonce:fe(n.nonce!=null?n.nonce:0),chainId:fe(n.chainId!=null?n.chainId:0),signature:jt.from(n.signature)}}function tc(n){let e;return typeof n=="string"?e=gn.computePublicKey(n,!1):e=n.publicKey,ze(Ue("0x"+e.substring(4)).substring(26))}function pm(n,e){return tc(gn.recoverPublicKey(n,e))}const Ot=BigInt(0),bm=BigInt(2),mm=BigInt(27),ym=BigInt(28),wm=BigInt(35),vm=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Fl=4096*32;function Am(n){return{blobToKzgCommitment:r=>{if("computeBlobProof"in n){if("blobToKzgCommitment"in n&&typeof n.blobToKzgCommitment=="function")return ae(n.blobToKzgCommitment(V(r)))}else if("blobToKzgCommitment"in n&&typeof n.blobToKzgCommitment=="function")return ae(n.blobToKzgCommitment(r));if("blobToKZGCommitment"in n&&typeof n.blobToKZGCommitment=="function")return ae(n.blobToKZGCommitment(V(r)));w(!1,"unsupported KZG library","kzg",n)},computeBlobKzgProof:(r,s)=>{if("computeBlobProof"in n&&typeof n.computeBlobProof=="function")return ae(n.computeBlobProof(V(r),V(s)));if("computeBlobKzgProof"in n&&typeof n.computeBlobKzgProof=="function")return n.computeBlobKzgProof(r,s);if("computeBlobKZGProof"in n&&typeof n.computeBlobKZGProof=="function")return ae(n.computeBlobKZGProof(V(r),V(s)));w(!1,"unsupported KZG library","kzg",n)}}}function g0(n,e){let t=n.toString(16);for(;t.length<2;)t="0"+t;return t+=Nr(e).substring(4),"0x"+t}function so(n){return n==="0x"?null:ze(n)}function pl(n,e){try{return Oi(n)}catch(t){w(!1,t.message,e,n)}}function Em(n,e){try{if(!Array.isArray(n))throw new Error("authorizationList: invalid array");const t=[];for(let r=0;r<n.length;r++){const s=n[r];if(!Array.isArray(s))throw new Error(`authorization[${r}]: invalid array`);if(s.length!==6)throw new Error(`authorization[${r}]: wrong length`);if(!s[1])throw new Error(`authorization[${r}]: null address`);t.push({address:so(s[1]),nonce:st(s[2],"nonce"),chainId:st(s[0],"chainId"),signature:jt.from({yParity:Ii(s[3],"yParity"),r:tt(s[4],32),s:tt(s[5],32)})})}return t}catch(t){w(!1,t.message,e,n)}}function Ii(n,e){return n==="0x"?0:_e(n,e)}function st(n,e){if(n==="0x")return Ot;const t=fe(n,e);return w(t<=vm,"value exceeds uint size",e,t),t}function We(n,e){const t=fe(n,"value"),r=gt(t);return w(r.length<=32,"value too large",`tx.${e}`,t),r}function bl(n){return Oi(n).map(e=>[e.address,e.storageKeys])}function Tm(n){return n.map(e=>[We(e.chainId,"chainId"),e.address,We(e.nonce,"nonce"),We(e.signature.yParity,"yParity"),gt(e.signature.r),gt(e.signature.s)])}function Om(n,e){w(Array.isArray(n),`invalid ${e}`,"value",n);for(let t=0;t<n.length;t++)w(je(n[t],32),"invalid ${ param } hash",`value[${t}]`,n[t]);return n}function Im(n){const e=qo(n);w(Array.isArray(e)&&(e.length===9||e.length===6),"invalid field count for legacy transaction","data",n);const t={type:0,nonce:Ii(e[0],"nonce"),gasPrice:st(e[1],"gasPrice"),gasLimit:st(e[2],"gasLimit"),to:so(e[3]),value:st(e[4],"value"),data:V(e[5]),chainId:Ot};if(e.length===6)return t;const r=st(e[6],"v"),s=st(e[7],"r"),i=st(e[8],"s");if(s===Ot&&i===Ot)t.chainId=r;else{let a=(r-wm)/bm;a<Ot&&(a=Ot),t.chainId=a,w(a!==Ot||r===mm||r===ym,"non-canonical legacy v","v",e[6]),t.signature=jt.from({r:tt(e[7],32),s:tt(e[8],32),v:r})}return t}function Sm(n,e){const t=[We(n.nonce,"nonce"),We(n.gasPrice||0,"gasPrice"),We(n.gasLimit,"gasLimit"),n.to||"0x",We(n.value,"value"),n.data];let r=Ot;if(n.chainId!=Ot)r=fe(n.chainId,"tx.chainId"),w(!e||e.networkV==null||e.legacyChainId===r,"tx.chainId/sig.v mismatch","sig",e);else if(n.signature){const i=n.signature.legacyChainId;i!=null&&(r=i)}if(!e)return r!==Ot&&(t.push(gt(r)),t.push("0x"),t.push("0x")),Kn(t);let s=BigInt(27+e.yParity);return r!==Ot?s=jt.getChainIdV(r,e.v):BigInt(e.v)!==s&&w(!1,"tx.chainId/sig.v mismatch","sig",e),t.push(gt(s)),t.push(gt(e.r)),t.push(gt(e.s)),Kn(t)}function ml(n,e){let t;try{if(t=Ii(e[0],"yParity"),t!==0&&t!==1)throw new Error("bad yParity")}catch{w(!1,"invalid yParity","yParity",e[0])}const r=tt(e[1],32),s=tt(e[2],32),i=jt.from({r,s,yParity:t});n.signature=i}function km(n){const e=qo(ae(n).slice(1));w(Array.isArray(e)&&(e.length===9||e.length===12),"invalid field count for transaction type: 2","data",V(n));const t={type:2,chainId:st(e[0],"chainId"),nonce:Ii(e[1],"nonce"),maxPriorityFeePerGas:st(e[2],"maxPriorityFeePerGas"),maxFeePerGas:st(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:st(e[4],"gasLimit"),to:so(e[5]),value:st(e[6],"value"),data:V(e[7]),accessList:pl(e[8],"accessList")};return e.length===9||ml(t,e.slice(9)),t}function Pm(n,e){const t=[We(n.chainId,"chainId"),We(n.nonce,"nonce"),We(n.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),We(n.maxFeePerGas||0,"maxFeePerGas"),We(n.gasLimit,"gasLimit"),n.to||"0x",We(n.value,"value"),n.data,bl(n.accessList||[])];return e&&(t.push(We(e.yParity,"yParity")),t.push(gt(e.r)),t.push(gt(e.s))),qe(["0x02",Kn(t)])}function Um(n){const e=qo(ae(n).slice(1));w(Array.isArray(e)&&(e.length===8||e.length===11),"invalid field count for transaction type: 1","data",V(n));const t={type:1,chainId:st(e[0],"chainId"),nonce:Ii(e[1],"nonce"),gasPrice:st(e[2],"gasPrice"),gasLimit:st(e[3],"gasLimit"),to:so(e[4]),value:st(e[5],"value"),data:V(e[6]),accessList:pl(e[7],"accessList")};return e.length===8||ml(t,e.slice(8)),t}function Nm(n,e){const t=[We(n.chainId,"chainId"),We(n.nonce,"nonce"),We(n.gasPrice||0,"gasPrice"),We(n.gasLimit,"gasLimit"),n.to||"0x",We(n.value,"value"),n.data,bl(n.accessList||[])];return e&&(t.push(We(e.yParity,"recoveryParam")),t.push(gt(e.r)),t.push(gt(e.s))),qe(["0x01",Kn(t)])}function Cm(n){let e=qo(ae(n).slice(1)),t="3",r=null;if(e.length===4&&Array.isArray(e[0])){t="3 (network format)";const i=e[1],a=e[2],o=e[3];w(Array.isArray(i),"invalid network format: blobs not an array","fields[1]",i),w(Array.isArray(a),"invalid network format: commitments not an array","fields[2]",a),w(Array.isArray(o),"invalid network format: proofs not an array","fields[3]",o),w(i.length===a.length,"invalid network format: blobs/commitments length mismatch","fields",e),w(i.length===o.length,"invalid network format: blobs/proofs length mismatch","fields",e),r=[];for(let c=0;c<e[1].length;c++)r.push({data:i[c],commitment:a[c],proof:o[c]});e=e[0]}w(Array.isArray(e)&&(e.length===11||e.length===14),`invalid field count for transaction type: ${t}`,"data",V(n));const s={type:3,chainId:st(e[0],"chainId"),nonce:Ii(e[1],"nonce"),maxPriorityFeePerGas:st(e[2],"maxPriorityFeePerGas"),maxFeePerGas:st(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:st(e[4],"gasLimit"),to:so(e[5]),value:st(e[6],"value"),data:V(e[7]),accessList:pl(e[8],"accessList"),maxFeePerBlobGas:st(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};r&&(s.blobs=r),w(s.to!=null,`invalid address for transaction type: ${t}`,"data",n),w(Array.isArray(s.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",n);for(let i=0;i<s.blobVersionedHashes.length;i++)w(je(s.blobVersionedHashes[i],32),`invalid blobVersionedHash at index ${i}: must be length 32`,"data",n);return e.length===11||ml(s,e.slice(11)),s}function Bm(n,e,t){const r=[We(n.chainId,"chainId"),We(n.nonce,"nonce"),We(n.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),We(n.maxFeePerGas||0,"maxFeePerGas"),We(n.gasLimit,"gasLimit"),n.to||za,We(n.value,"value"),n.data,bl(n.accessList||[]),We(n.maxFeePerBlobGas||0,"maxFeePerBlobGas"),Om(n.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(r.push(We(e.yParity,"yParity")),r.push(gt(e.r)),r.push(gt(e.s)),t)?qe(["0x03",Kn([r,t.map(s=>s.data),t.map(s=>s.commitment),t.map(s=>s.proof)])]):qe(["0x03",Kn(r)])}function _m(n){const e=qo(ae(n).slice(1));w(Array.isArray(e)&&(e.length===10||e.length===13),"invalid field count for transaction type: 4","data",V(n));const t={type:4,chainId:st(e[0],"chainId"),nonce:Ii(e[1],"nonce"),maxPriorityFeePerGas:st(e[2],"maxPriorityFeePerGas"),maxFeePerGas:st(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:st(e[4],"gasLimit"),to:so(e[5]),value:st(e[6],"value"),data:V(e[7]),accessList:pl(e[8],"accessList"),authorizationList:Em(e[9],"authorizationList")};return e.length===10||ml(t,e.slice(10)),t}function Rm(n,e){const t=[We(n.chainId,"chainId"),We(n.nonce,"nonce"),We(n.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),We(n.maxFeePerGas||0,"maxFeePerGas"),We(n.gasLimit,"gasLimit"),n.to||"0x",We(n.value,"value"),n.data,bl(n.accessList||[]),Tm(n.authorizationList||[])];return e&&(t.push(We(e.yParity,"yParity")),t.push(gt(e.r)),t.push(gt(e.s))),qe(["0x04",Kn(t)])}var Gr,sa,ia,aa,oa,ca,la,da,ua,fa,ha,xa,ii,os,nn,cs,ga,pa,Ic;const qr=class qr{constructor(){k(this,pa);k(this,Gr);k(this,sa);k(this,ia);k(this,aa);k(this,oa);k(this,ca);k(this,la);k(this,da);k(this,ua);k(this,fa);k(this,ha);k(this,xa);k(this,ii);k(this,os);k(this,nn);k(this,cs);k(this,ga);m(this,Gr,null),m(this,sa,null),m(this,aa,0),m(this,oa,Ot),m(this,ca,null),m(this,la,null),m(this,da,null),m(this,ia,"0x"),m(this,ua,Ot),m(this,fa,Ot),m(this,ha,null),m(this,xa,null),m(this,ii,null),m(this,os,null),m(this,nn,null),m(this,cs,null),m(this,ga,null)}get type(){return h(this,Gr)}set type(e){switch(e){case null:m(this,Gr,null);break;case 0:case"legacy":m(this,Gr,0);break;case 1:case"berlin":case"eip-2930":m(this,Gr,1);break;case 2:case"london":case"eip-1559":m(this,Gr,2);break;case 3:case"cancun":case"eip-4844":m(this,Gr,3);break;case 4:case"pectra":case"eip-7702":m(this,Gr,4);break;default:w(!1,"unsupported transaction type","type",e)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const e=h(this,sa);return e==null&&this.type===3?za:e}set to(e){m(this,sa,e==null?null:ze(e))}get nonce(){return h(this,aa)}set nonce(e){m(this,aa,_e(e,"value"))}get gasLimit(){return h(this,oa)}set gasLimit(e){m(this,oa,fe(e))}get gasPrice(){const e=h(this,ca);return e==null&&(this.type===0||this.type===1)?Ot:e}set gasPrice(e){m(this,ca,e==null?null:fe(e,"gasPrice"))}get maxPriorityFeePerGas(){const e=h(this,la);return e??(this.type===2||this.type===3?Ot:null)}set maxPriorityFeePerGas(e){m(this,la,e==null?null:fe(e,"maxPriorityFeePerGas"))}get maxFeePerGas(){const e=h(this,da);return e??(this.type===2||this.type===3?Ot:null)}set maxFeePerGas(e){m(this,da,e==null?null:fe(e,"maxFeePerGas"))}get data(){return h(this,ia)}set data(e){m(this,ia,V(e))}get value(){return h(this,ua)}set value(e){m(this,ua,fe(e,"value"))}get chainId(){return h(this,fa)}set chainId(e){m(this,fa,fe(e))}get signature(){return h(this,ha)||null}set signature(e){m(this,ha,e==null?null:jt.from(e))}get accessList(){const e=h(this,xa)||null;return e??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(e){m(this,xa,e==null?null:Oi(e))}get authorizationList(){const e=h(this,ga)||null;return e==null&&this.type===4?[]:e}set authorizationList(e){m(this,ga,e==null?null:e.map(t=>Rh(t)))}get maxFeePerBlobGas(){const e=h(this,ii);return e==null&&this.type===3?Ot:e}set maxFeePerBlobGas(e){m(this,ii,e==null?null:fe(e,"maxFeePerBlobGas"))}get blobVersionedHashes(){let e=h(this,os);return e==null&&this.type===3?[]:e}set blobVersionedHashes(e){if(e!=null){w(Array.isArray(e),"blobVersionedHashes must be an Array","value",e),e=e.slice();for(let t=0;t<e.length;t++)w(je(e[t],32),"invalid blobVersionedHash",`value[${t}]`,e[t])}m(this,os,e)}get blobs(){return h(this,cs)==null?null:h(this,cs).map(e=>Object.assign({},e))}set blobs(e){if(e==null){m(this,cs,null);return}const t=[],r=[];for(let s=0;s<e.length;s++){const i=e[s];if(ll(i)){F(h(this,nn),"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let a=ae(i);if(w(a.length<=Fl,"blob is too large",`blobs[${s}]`,i),a.length!==Fl){const l=new Uint8Array(Fl);l.set(a),a=l}const o=h(this,nn).blobToKzgCommitment(a),c=V(h(this,nn).computeBlobKzgProof(a,o));t.push({data:V(a),commitment:V(o),proof:c}),r.push(g0(1,o))}else{const a=V(i.commitment);t.push({data:V(i.data),commitment:a,proof:V(i.proof)}),r.push(g0(1,a))}}m(this,cs,t),m(this,os,r)}get kzg(){return h(this,nn)}set kzg(e){e==null?m(this,nn,null):m(this,nn,Am(e))}get hash(){return this.signature==null?null:Ue(X(this,pa,Ic).call(this,!0,!1))}get unsignedHash(){return Ue(this.unsignedSerialized)}get from(){return this.signature==null?null:pm(this.unsignedHash,this.signature)}get fromPublicKey(){return this.signature==null?null:gn.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return this.signature!=null}get serialized(){return X(this,pa,Ic).call(this,!0,!0)}get unsignedSerialized(){return X(this,pa,Ic).call(this,!1,!1)}inferType(){const e=this.inferTypes();return e.indexOf(2)>=0?2:e.pop()}inferTypes(){const e=this.gasPrice!=null,t=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,r=this.accessList!=null,s=h(this,ii)!=null||h(this,os);this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&F(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),F(!t||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),F(this.type!==0||!r,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const i=[];return this.type!=null?i.push(this.type):this.authorizationList&&this.authorizationList.length?i.push(4):t?i.push(2):e?(i.push(1),r||i.push(0)):r?(i.push(1),i.push(2)):(s&&this.to||(i.push(0),i.push(1),i.push(2)),i.push(3)),i.sort(),i}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return qr.from(this)}toJSON(){const e=t=>t==null?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:e(this.gasLimit),gasPrice:e(this.gasPrice),maxPriorityFeePerGas:e(this.maxPriorityFeePerGas),maxFeePerGas:e(this.maxFeePerGas),value:e(this.value),chainId:e(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(e){if(e==null)return new qr;if(typeof e=="string"){const r=ae(e);if(r[0]>=127)return qr.from(Im(r));switch(r[0]){case 1:return qr.from(Um(r));case 2:return qr.from(km(r));case 3:return qr.from(Cm(r));case 4:return qr.from(_m(r))}F(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const t=new qr;return e.type!=null&&(t.type=e.type),e.to!=null&&(t.to=e.to),e.nonce!=null&&(t.nonce=e.nonce),e.gasLimit!=null&&(t.gasLimit=e.gasLimit),e.gasPrice!=null&&(t.gasPrice=e.gasPrice),e.maxPriorityFeePerGas!=null&&(t.maxPriorityFeePerGas=e.maxPriorityFeePerGas),e.maxFeePerGas!=null&&(t.maxFeePerGas=e.maxFeePerGas),e.maxFeePerBlobGas!=null&&(t.maxFeePerBlobGas=e.maxFeePerBlobGas),e.data!=null&&(t.data=e.data),e.value!=null&&(t.value=e.value),e.chainId!=null&&(t.chainId=e.chainId),e.signature!=null&&(t.signature=jt.from(e.signature)),e.accessList!=null&&(t.accessList=e.accessList),e.authorizationList!=null&&(t.authorizationList=e.authorizationList),e.blobVersionedHashes!=null&&(t.blobVersionedHashes=e.blobVersionedHashes),e.kzg!=null&&(t.kzg=e.kzg),e.blobs!=null&&(t.blobs=e.blobs),e.hash!=null&&(w(t.isSigned(),"unsigned transaction cannot define '.hash'","tx",e),w(t.hash===e.hash,"hash mismatch","tx",e)),e.from!=null&&(w(t.isSigned(),"unsigned transaction cannot define '.from'","tx",e),w(t.from.toLowerCase()===(e.from||"").toLowerCase(),"from mismatch","tx",e)),t}};Gr=new WeakMap,sa=new WeakMap,ia=new WeakMap,aa=new WeakMap,oa=new WeakMap,ca=new WeakMap,la=new WeakMap,da=new WeakMap,ua=new WeakMap,fa=new WeakMap,ha=new WeakMap,xa=new WeakMap,ii=new WeakMap,os=new WeakMap,nn=new WeakMap,cs=new WeakMap,ga=new WeakMap,pa=new WeakSet,Ic=function(e,t){F(!e||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const r=e?this.signature:null;switch(this.inferType()){case 0:return Sm(this,r);case 1:return Nm(this,r);case 2:return Pm(this,r);case 3:return Bm(this,r,t?this.blobs:null);case 4:return Rm(this,r)}F(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})};let Io=qr;function Dm(n){return w(typeof n.address=="string","invalid address for hashAuthorization","auth.address",n),Ue(qe(["0x05",Kn([n.chainId!=null?gt(n.chainId):"0x",ze(n.address),n.nonce!=null?gt(n.nonce):"0x"])]))}function Vn(n){return Ue(Be(n))}var Lm="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";const p0=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),b0=4;function Fm(n){let e=0;function t(){return n[e++]<<8|n[e++]}let r=t(),s=1,i=[0,1];for(let S=1;S<r;S++)i.push(s+=t());let a=t(),o=e;e+=a;let c=0,l=0;function d(){return c==0&&(l=l<<8|n[e++],c=8),l>>--c&1}const f=31,x=2**f,g=x>>>1,b=g>>1,p=x-1;let y=0;for(let S=0;S<f;S++)y=y<<1|d();let v=[],I=0,N=x;for(;;){let S=Math.floor(((y-I+1)*s-1)/N),C=0,z=r;for(;z-C>1;){let J=C+z>>>1;S<i[J]?z=J:C=J}if(C==0)break;v.push(C);let G=I+Math.floor(N*i[C]/s),ne=I+Math.floor(N*i[C+1]/s)-1;for(;((G^ne)&g)==0;)y=y<<1&p|d(),G=G<<1&p,ne=ne<<1&p|1;for(;G&~ne&b;)y=y&g|y<<1&p>>>1|d(),G=G<<1^g,ne=(ne^g)<<1|g|1;I=G,N=1+ne-G}let P=r-4;return v.map(S=>{switch(S-P){case 3:return P+65792+(n[o++]<<16|n[o++]<<8|n[o++]);case 2:return P+256+(n[o++]<<8|n[o++]);case 1:return P+n[o++];default:return S-1}})}function Mm(n){let e=0;return()=>n[e++]}function Dh(n){return Mm(Fm(Gm(n)))}function Gm(n){let e=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((s,i)=>e[s.charCodeAt(0)]=i);let t=n.length,r=new Uint8Array(6*t>>3);for(let s=0,i=0,a=0,o=0;s<t;s++)o=o<<6|e[n.charCodeAt(s)],a+=6,a>=8&&(r[i++]=o>>(a-=8));return r}function Xm(n){return n&1?~n>>1:n>>1}function Hm(n,e){let t=Array(n);for(let r=0,s=0;r<n;r++)t[r]=s+=Xm(e());return t}function So(n,e=0){let t=[];for(;;){let r=n(),s=n();if(!s)break;e+=r;for(let i=0;i<s;i++)t.push(e+i);e+=s+1}return t}function Lh(n){return ko(()=>{let e=So(n);if(e.length)return e})}function Fh(n){let e=[];for(;;){let t=n();if(t==0)break;e.push(zm(t,n))}for(;;){let t=n()-1;if(t<0)break;e.push($m(t,n))}return e.flat()}function ko(n){let e=[];for(;;){let t=n(e.length);if(!t)break;e.push(t)}return e}function Mh(n,e,t){let r=Array(n).fill().map(()=>[]);for(let s=0;s<e;s++)Hm(n,t).forEach((i,a)=>r[a].push(i));return r}function zm(n,e){let t=1+e(),r=e(),s=ko(e);return Mh(s.length,1+n,e).flatMap((a,o)=>{let[c,...l]=a;return Array(s[o]).fill().map((d,f)=>{let x=f*r;return[c+f*t,l.map(g=>g+x)]})})}function $m(n,e){let t=1+e();return Mh(t,1+n,e).map(s=>[s[0],s.slice(1)])}function Km(n){let e=[],t=So(n);return s(r([]),[]),e;function r(i){let a=n(),o=ko(()=>{let c=So(n).map(l=>t[l]);if(c.length)return r(c)});return{S:a,B:o,Q:i}}function s({S:i,B:a},o,c){if(!(i&4&&c===o[o.length-1])){i&2&&(c=o[o.length-1]),i&1&&e.push(o);for(let l of a)for(let d of l.Q)s(l,[...o,d],c)}}}function Vm(n){return n.toString(16).toUpperCase().padStart(2,"0")}function Gh(n){return`{${Vm(n)}}`}function Jm(n){let e=[];for(let t=0,r=n.length;t<r;){let s=n.codePointAt(t);t+=s<65536?1:2,e.push(s)}return e}function $a(n){let t=n.length;if(t<4096)return String.fromCodePoint(...n);let r=[];for(let s=0;s<t;)r.push(String.fromCodePoint(...n.slice(s,s+=4096)));return r.join("")}function Qm(n,e){let t=n.length,r=t-e.length;for(let s=0;r==0&&s<t;s++)r=n[s]-e[s];return r}var Wm="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";const Po=44032,Hc=4352,zc=4449,$c=4519,Xh=19,Hh=21,Ka=28,Kc=Hh*Ka,jm=Xh*Kc,Zm=Po+jm,Ym=Hc+Xh,qm=zc+Hh,ey=$c+Ka;function xo(n){return n>>24&255}function zh(n){return n&16777215}let md,m0,yd,Sc;function ty(){let n=Dh(Wm);md=new Map(Lh(n).flatMap((e,t)=>e.map(r=>[r,t+1<<24]))),m0=new Set(So(n)),yd=new Map,Sc=new Map;for(let[e,t]of Fh(n)){if(!m0.has(e)&&t.length==2){let[r,s]=t,i=Sc.get(r);i||(i=new Map,Sc.set(r,i)),i.set(s,e)}yd.set(e,t.reverse())}}function $h(n){return n>=Po&&n<Zm}function ry(n,e){if(n>=Hc&&n<Ym&&e>=zc&&e<qm)return Po+(n-Hc)*Kc+(e-zc)*Ka;if($h(n)&&e>$c&&e<ey&&(n-Po)%Ka==0)return n+(e-$c);{let t=Sc.get(n);return t&&(t=t.get(e),t)?t:-1}}function Kh(n){md||ty();let e=[],t=[],r=!1;function s(i){let a=md.get(i);a&&(r=!0,i|=a),e.push(i)}for(let i of n)for(;;){if(i<128)e.push(i);else if($h(i)){let a=i-Po,o=a/Kc|0,c=a%Kc/Ka|0,l=a%Ka;s(Hc+o),s(zc+c),l>0&&s($c+l)}else{let a=yd.get(i);a?t.push(...a):s(i)}if(!t.length)break;i=t.pop()}if(r&&e.length>1){let i=xo(e[0]);for(let a=1;a<e.length;a++){let o=xo(e[a]);if(o==0||i<=o){i=o;continue}let c=a-1;for(;;){let l=e[c+1];if(e[c+1]=e[c],e[c]=l,!c||(i=xo(e[--c]),i<=o))break}i=xo(e[a])}}return e}function ny(n){let e=[],t=[],r=-1,s=0;for(let i of n){let a=xo(i),o=zh(i);if(r==-1)a==0?r=o:e.push(o);else if(s>0&&s>=a)a==0?(e.push(r,...t),t.length=0,r=o):t.push(o),s=a;else{let c=ry(r,o);c>=0?r=c:s==0&&a==0?(e.push(r),r=o):(t.push(o),s=a)}}return r>=0&&e.push(r,...t),e}function Vh(n){return Kh(n).map(zh)}function sy(n){return ny(Kh(n))}const y0=45,Jh=".",Qh=65039,Wh=1,Vc=n=>Array.from(n);function Uo(n,e){return n.P.has(e)||n.Q.has(e)}class iy extends Array{get is_emoji(){return!0}}let wd,jh,Vs,vd,Zh,Vi,Ml,Ri,Rs,w0,Ad;function du(){if(wd)return;let n=Dh(Lm);const e=()=>So(n),t=()=>new Set(e()),r=(d,f)=>f.forEach(x=>d.add(x));wd=new Map(Fh(n)),jh=t(),Vs=e(),vd=new Set(e().map(d=>Vs[d])),Vs=new Set(Vs),Zh=t(),t();let s=Lh(n),i=n();const a=()=>{let d=new Set;return e().forEach(f=>r(d,s[f])),r(d,e()),d};Vi=ko(d=>{let f=ko(n).map(x=>x+96);if(f.length){let x=d>=i;f[0]-=32,f=$a(f),x&&(f=`Restricted[${f}]`);let g=a(),b=a(),p=!n();return{N:f,P:g,Q:b,M:p,R:x}}}),Ml=t(),Ri=new Map;let o=e().concat(Vc(Ml)).sort((d,f)=>d-f);o.forEach((d,f)=>{let x=n(),g=o[f]=x?o[f-x]:{V:[],M:new Map};g.V.push(d),Ml.has(d)||Ri.set(d,g)});for(let{V:d,M:f}of new Set(Ri.values())){let x=[];for(let b of d){let p=Vi.filter(v=>Uo(v,b)),y=x.find(({G:v})=>p.some(I=>v.has(I)));y||(y={G:new Set,V:[]},x.push(y)),y.V.push(b),r(y.G,p)}let g=x.flatMap(b=>Vc(b.G));for(let{G:b,V:p}of x){let y=new Set(g.filter(v=>!b.has(v)));for(let v of p)f.set(v,y)}}Rs=new Set;let c=new Set;const l=d=>Rs.has(d)?c.add(d):Rs.add(d);for(let d of Vi){for(let f of d.P)l(f);for(let f of d.Q)l(f)}for(let d of Rs)!Ri.has(d)&&!c.has(d)&&Ri.set(d,Wh);r(Rs,Vh(Rs)),w0=Km(n).map(d=>iy.from(d)).sort(Qm),Ad=new Map;for(let d of w0){let f=[Ad];for(let x of d){let g=f.map(b=>{let p=b.get(x);return p||(p=new Map,b.set(x,p)),p});x===Qh?f.push(...g):f=g}for(let x of f)x.V=d}}function uu(n){return(Yh(n)?"":`${fu(yl([n]))} `)+Gh(n)}function fu(n){return`"${n}"‎`}function ay(n){if(n.length>=4&&n[2]==y0&&n[3]==y0)throw new Error(`invalid label extension: "${$a(n.slice(0,4))}"`)}function oy(n){for(let t=n.lastIndexOf(95);t>0;)if(n[--t]!==95)throw new Error("underscore allowed only at start")}function cy(n){let e=n[0],t=p0.get(e);if(t)throw Ao(`leading ${t}`);let r=n.length,s=-1;for(let i=1;i<r;i++){e=n[i];let a=p0.get(e);if(a){if(s==i)throw Ao(`${t} + ${a}`);s=i+1,t=a}}if(s==r)throw Ao(`trailing ${t}`)}function yl(n,e=1/0,t=Gh){let r=[];ly(n[0])&&r.push("◌"),n.length>e&&(e>>=1,n=[...n.slice(0,e),8230,...n.slice(-e)]);let s=0,i=n.length;for(let a=0;a<i;a++){let o=n[a];Yh(o)&&(r.push($a(n.slice(s,a))),r.push(t(o)),s=a+1)}return r.push($a(n.slice(s,i))),r.join("")}function ly(n){return du(),Vs.has(n)}function Yh(n){return du(),Zh.has(n)}function dy(n){return xy(uy(n,sy,by))}function uy(n,e,t){if(!n)return[];du();let r=0;return n.split(Jh).map(s=>{let i=Jm(s),a={input:i,offset:r};r+=i.length+1;try{let o=a.tokens=py(i,e,t),c=o.length,l;if(!c)throw new Error("empty label");let d=a.output=o.flat();if(oy(d),!(a.emoji=c>1||o[0].is_emoji)&&d.every(x=>x<128))ay(d),l="ASCII";else{let x=o.flatMap(g=>g.is_emoji?[]:g);if(!x.length)l="Emoji";else{if(Vs.has(d[0]))throw Ao("leading combining mark");for(let p=1;p<c;p++){let y=o[p];if(!y.is_emoji&&Vs.has(y[0]))throw Ao(`emoji + combining mark: "${$a(o[p-1])} + ${yl([y[0]])}"`)}cy(d);let g=Vc(new Set(x)),[b]=hy(g);gy(b,x),fy(b,g),l=b.N}}a.type=l}catch(o){a.error=o}return a})}function fy(n,e){let t,r=[];for(let s of e){let i=Ri.get(s);if(i===Wh)return;if(i){let a=i.M.get(s);if(t=t?t.filter(o=>a.has(o)):Vc(a),!t.length)return}else r.push(s)}if(t){for(let s of t)if(r.every(i=>Uo(s,i)))throw new Error(`whole-script confusable: ${n.N}/${s.N}`)}}function hy(n){let e=Vi;for(let t of n){let r=e.filter(s=>Uo(s,t));if(!r.length)throw Vi.some(s=>Uo(s,t))?ex(e[0],t):qh(t);if(e=r,r.length==1)break}return e}function xy(n){return n.map(({input:e,error:t,output:r})=>{if(t){let s=t.message;throw new Error(n.length==1?s:`Invalid label ${fu(yl(e,63))}: ${s}`)}return $a(r)}).join(Jh)}function qh(n){return new Error(`disallowed character: ${uu(n)}`)}function ex(n,e){let t=uu(e),r=Vi.find(s=>s.P.has(e));return r&&(t=`${r.N} ${t}`),new Error(`illegal mixture: ${n.N} + ${t}`)}function Ao(n){return new Error(`illegal placement: ${n}`)}function gy(n,e){for(let t of e)if(!Uo(n,t))throw ex(n,t);if(n.M){let t=Vh(e);for(let r=1,s=t.length;r<s;r++)if(vd.has(t[r])){let i=r+1;for(let a;i<s&&vd.has(a=t[i]);i++)for(let o=r;o<i;o++)if(t[o]==a)throw new Error(`duplicate non-spacing marks: ${uu(a)}`);if(i-r>b0)throw new Error(`excessive non-spacing marks: ${fu(yl(t.slice(r-1,i)))} (${i-r}/${b0})`);r=i}}}function py(n,e,t){let r=[],s=[];for(n=n.slice().reverse();n.length;){let i=my(n);if(i)s.length&&(r.push(e(s)),s=[]),r.push(t(i));else{let a=n.pop();if(Rs.has(a))s.push(a);else{let o=wd.get(a);if(o)s.push(...o);else if(!jh.has(a))throw qh(a)}}}return s.length&&r.push(e(s)),r}function by(n){return n.filter(e=>e!=Qh)}function my(n,e){let t=Ad,r,s=n.length;for(;s&&(t=t.get(n[--s]),!!t);){let{V:i}=t;i&&(r=i,n.length=s)}return r}const tx=new Uint8Array(32);tx.fill(0);function v0(n){return w(n.length!==0,"invalid ENS name; empty component","comp",n),n}function rx(n){const e=Be(yy(n)),t=[];if(n.length===0)return t;let r=0;for(let s=0;s<e.length;s++)e[s]===46&&(t.push(v0(e.slice(r,s))),r=s+1);return w(r<e.length,"invalid ENS name; empty component","name",n),t.push(v0(e.slice(r))),t}function yy(n){try{if(n.length===0)throw new Error("empty label");return dy(n)}catch(e){w(!1,`invalid ENS name (${e.message})`,"name",n)}}function Ed(n){w(typeof n=="string","invalid ENS name; not a string","name",n),w(n.length,"invalid ENS name (empty label)","name",n);let e=tx;const t=rx(n);for(;t.length;)e=Ue(qe([e,Ue(t.pop())]));return V(e)}function wy(n,e){const t=e;return w(t<=255,"DNS encoded label cannot exceed 255","length",t),V(qe(rx(n).map(r=>{w(r.length<=t,`label ${JSON.stringify(n)} exceeds ${t} bytes`,"name",n);const s=new Uint8Array(r.length+1);return s.set(r,1),s[0]=s.length-1,s})))+"00"}function vy(n){return typeof n=="string"&&(n=Be(n)),Ue(qe([Be(jb),Be(String(n.length)),n]))}const Ay=new RegExp("^bytes([0-9]+)$"),Ey=new RegExp("^(u?int)([0-9]*)$"),Ty=new RegExp("^(.*)\\[([0-9]*)\\]$");function nx(n,e,t){switch(n){case"address":return ae(t?tt(e,32):ze(e));case"string":return Be(e);case"bytes":return ae(e);case"bool":return e=e?"0x01":"0x00",ae(t?tt(e,32):e)}let r=n.match(Ey);if(r){let s=r[1]==="int",i=parseInt(r[2]||"256");return w((!r[2]||r[2]===String(i))&&i%8===0&&i!==0&&i<=256,"invalid number type","type",n),t&&(i=256),s&&(e=jd(e,i)),ae(tt(gt(e),i/8))}if(r=n.match(Ay),r){const s=parseInt(r[1]);return w(String(s)===r[1]&&s!==0&&s<=32,"invalid bytes type","type",n),w(bi(e)===s,`invalid value for ${n}`,"value",e),t?ae(Af(e,32)):e}if(r=n.match(Ty),r&&Array.isArray(e)){const s=r[1],i=parseInt(r[2]||String(e.length));w(i===e.length,`invalid array length for ${n}`,"value",e);const a=[];return e.forEach(function(o){a.push(nx(s,o,!0))}),ae(qe(a))}w(!1,"invalid type","type",n)}function Oy(n,e){w(n.length===e.length,"wrong number of values; expected ${ types.length }","values",e);const t=[];return n.forEach(function(r,s){t.push(nx(r,e[s]))}),V(qe(t))}function Lt(n,e){return Ue(Oy(n,e))}const sx=new Uint8Array(32);sx.fill(0);const Iy=BigInt(-1),ix=BigInt(0),ax=BigInt(1),Sy=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function ky(n){const e=ae(n),t=e.length%32;return t?qe([e,sx.slice(t)]):V(e)}const Py=$n(ax,32),Uy=$n(ix,32),A0={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},Gl=["name","version","chainId","verifyingContract","salt"];function E0(n){return function(e){return w(typeof e=="string",`invalid domain value for ${JSON.stringify(n)}`,`domain.${n}`,e),e}}const Ny={name:E0("name"),version:E0("version"),chainId:function(n){const e=fe(n,"domain.chainId");return w(e>=0,"invalid chain ID","domain.chainId",n),Number.isSafeInteger(e)?Number(e):zr(e)},verifyingContract:function(n){try{return ze(n).toLowerCase()}catch{}w(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",n)},salt:function(n){const e=ae(n,"domain.salt");return w(e.length===32,'invalid domain value "salt"',"domain.salt",n),V(e)}};function Xl(n){{const e=n.match(/^(u?)int(\d+)$/);if(e){const t=e[1]==="",r=parseInt(e[2]);w(r%8===0&&r!==0&&r<=256&&e[2]===String(r),"invalid numeric width","type",n);const s=$s(Sy,t?r-1:r),i=t?(s+ax)*Iy:ix;return function(a){const o=fe(a,"value");return w(o>=i&&o<=s,`value out-of-bounds for ${n}`,"value",o),$n(t?jd(o,256):o,32)}}}{const e=n.match(/^bytes(\d+)$/);if(e){const t=parseInt(e[1]);return w(t!==0&&t<=32&&e[1]===String(t),"invalid bytes width","type",n),function(r){const s=ae(r);return w(s.length===t,`invalid length for ${n}`,"value",r),ky(r)}}}switch(n){case"address":return function(e){return tt(ze(e),32)};case"bool":return function(e){return e?Py:Uy};case"bytes":return function(e){return Ue(e)};case"string":return function(e){return Vn(e)}}return null}function T0(n,e){return`${n}(${e.map(({name:t,type:r})=>r+" "+t).join(",")})`}function bc(n){const e=n.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:n}}var Go,Pn,ba,tl,ox;const wr=class wr{constructor(e){k(this,tl);E(this,"primaryType");k(this,Go);k(this,Pn);k(this,ba);m(this,Pn,new Map),m(this,ba,new Map);const t=new Map,r=new Map,s=new Map,i={};Object.keys(e).forEach(c=>{i[c]=e[c].map(({name:l,type:d})=>{let{base:f,index:x}=bc(d);return f==="int"&&!e.int&&(f="int256"),f==="uint"&&!e.uint&&(f="uint256"),{name:l,type:f+(x||"")}}),t.set(c,new Set),r.set(c,[]),s.set(c,new Set)}),m(this,Go,JSON.stringify(i));for(const c in i){const l=new Set;for(const d of i[c]){w(!l.has(d.name),`duplicate variable name ${JSON.stringify(d.name)} in ${JSON.stringify(c)}`,"types",e),l.add(d.name);const f=bc(d.type).base;w(f!==c,`circular type reference to ${JSON.stringify(f)}`,"types",e),!Xl(f)&&(w(r.has(f),`unknown type ${JSON.stringify(f)}`,"types",e),r.get(f).push(c),t.get(c).add(f))}}const a=Array.from(r.keys()).filter(c=>r.get(c).length===0);w(a.length!==0,"missing primary type","types",e),w(a.length===1,`ambiguous primary types or unused types: ${a.map(c=>JSON.stringify(c)).join(", ")}`,"types",e),me(this,{primaryType:a[0]});function o(c,l){w(!l.has(c),`circular type reference to ${JSON.stringify(c)}`,"types",e),l.add(c);for(const d of t.get(c))if(r.has(d)){o(d,l);for(const f of l)s.get(f).add(d)}l.delete(c)}o(this.primaryType,new Set);for(const[c,l]of s){const d=Array.from(l);d.sort(),h(this,Pn).set(c,T0(c,i[c])+d.map(f=>T0(f,i[f])).join(""))}}get types(){return JSON.parse(h(this,Go))}getEncoder(e){let t=h(this,ba).get(e);return t||(t=X(this,tl,ox).call(this,e),h(this,ba).set(e,t)),t}encodeType(e){const t=h(this,Pn).get(e);return w(t,`unknown type: ${JSON.stringify(e)}`,"name",e),t}encodeData(e,t){return this.getEncoder(e)(t)}hashStruct(e,t){return Ue(this.encodeData(e,t))}encode(e){return this.encodeData(this.primaryType,e)}hash(e){return this.hashStruct(this.primaryType,e)}_visit(e,t,r){if(Xl(e))return r(e,t);const s=bc(e).array;if(s)return w(s.count===-1||s.count===t.length,`array length mismatch; expected length ${s.count}`,"value",t),t.map(a=>this._visit(s.prefix,a,r));const i=this.types[e];if(i)return i.reduce((a,{name:o,type:c})=>(a[o]=this._visit(c,t[o],r),a),{});w(!1,`unknown type: ${e}`,"type",e)}visit(e,t){return this._visit(this.primaryType,e,t)}static from(e){return new wr(e)}static getPrimaryType(e){return wr.from(e).primaryType}static hashStruct(e,t,r){return wr.from(t).hashStruct(e,r)}static hashDomain(e){const t=[];for(const r in e){if(e[r]==null)continue;const s=A0[r];w(s,`invalid typed-data domain key: ${JSON.stringify(r)}`,"domain",e),t.push({name:r,type:s})}return t.sort((r,s)=>Gl.indexOf(r.name)-Gl.indexOf(s.name)),wr.hashStruct("EIP712Domain",{EIP712Domain:t},e)}static encode(e,t,r){return qe(["0x1901",wr.hashDomain(e),wr.from(t).hash(r)])}static hash(e,t,r){return Ue(wr.encode(e,t,r))}static async resolveNames(e,t,r,s){e=Object.assign({},e);for(const o in e)e[o]==null&&delete e[o];const i={};e.verifyingContract&&!je(e.verifyingContract,20)&&(i[e.verifyingContract]="0x");const a=wr.from(t);a.visit(r,(o,c)=>(o==="address"&&!je(c,20)&&(i[c]="0x"),c));for(const o in i)i[o]=await s(o);return e.verifyingContract&&i[e.verifyingContract]&&(e.verifyingContract=i[e.verifyingContract]),r=a.visit(r,(o,c)=>o==="address"&&i[c]?i[c]:c),{domain:e,value:r}}static getPayload(e,t,r){wr.hashDomain(e);const s={},i=[];Gl.forEach(c=>{const l=e[c];l!=null&&(s[c]=Ny[c](l),i.push({name:c,type:A0[c]}))});const a=wr.from(t);t=a.types;const o=Object.assign({},t);return w(o.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",t),o.EIP712Domain=i,a.encode(r),{types:o,domain:s,primaryType:a.primaryType,message:a.visit(r,(c,l)=>{if(c.match(/^bytes(\d*)/))return V(ae(l));if(c.match(/^u?int/))return fe(l).toString();switch(c){case"address":return l.toLowerCase();case"bool":return!!l;case"string":return w(typeof l=="string","invalid string","value",l),l}w(!1,"unsupported type","type",c)})}}};Go=new WeakMap,Pn=new WeakMap,ba=new WeakMap,tl=new WeakSet,ox=function(e){{const s=Xl(e);if(s)return s}const t=bc(e).array;if(t){const s=t.prefix,i=this.getEncoder(s);return a=>{w(t.count===-1||t.count===a.length,`array length mismatch; expected length ${t.count}`,"value",a);let o=a.map(i);return h(this,Pn).has(s)&&(o=o.map(Ue)),Ue(qe(o))}}const r=this.types[e];if(r){const s=Vn(h(this,Pn).get(e));return i=>{const a=r.map(({name:o,type:c})=>{const l=this.getEncoder(c)(i[o]);return h(this,Pn).has(c)?Ue(l):l});return a.unshift(s),qe(a)}}w(!1,`unknown type: ${e}`,"type",e)};let Va=wr;function Wt(n){const e=new Set;return n.forEach(t=>e.add(t)),Object.freeze(e)}const Cy="external public payable override",By=Wt(Cy.split(" ")),cx="constant external internal payable private public pure view override",_y=Wt(cx.split(" ")),lx="constructor error event fallback function receive struct",dx=Wt(lx.split(" ")),ux="calldata memory storage payable indexed",Ry=Wt(ux.split(" ")),Dy="tuple returns",Ly=[lx,ux,Dy,cx].join(" "),Fy=Wt(Ly.split(" ")),My={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},Gy=new RegExp("^(\\s*)"),Xy=new RegExp("^([0-9]+)"),Hy=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),fx=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),hx=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");var Ut,Xr,Xo,Td;const rl=class rl{constructor(e){k(this,Xo);k(this,Ut);k(this,Xr);m(this,Ut,0),m(this,Xr,e.slice())}get offset(){return h(this,Ut)}get length(){return h(this,Xr).length-h(this,Ut)}clone(){return new rl(h(this,Xr))}reset(){m(this,Ut,0)}popKeyword(e){const t=this.peek();if(t.type!=="KEYWORD"||!e.has(t.text))throw new Error(`expected keyword ${t.text}`);return this.pop().text}popType(e){if(this.peek().type!==e){const t=this.peek();throw new Error(`expected ${e}; got ${t.type} ${JSON.stringify(t.text)}`)}return this.pop().text}popParen(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=X(this,Xo,Td).call(this,h(this,Ut)+1,e.match+1);return m(this,Ut,e.match+1),t}popParams(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=[];for(;h(this,Ut)<e.match-1;){const r=this.peek().linkNext;t.push(X(this,Xo,Td).call(this,h(this,Ut)+1,r)),m(this,Ut,r)}return m(this,Ut,e.match+1),t}peek(){if(h(this,Ut)>=h(this,Xr).length)throw new Error("out-of-bounds");return h(this,Xr)[h(this,Ut)]}peekKeyword(e){const t=this.peekType("KEYWORD");return t!=null&&e.has(t)?t:null}peekType(e){if(this.length===0)return null;const t=this.peek();return t.type===e?t.text:null}pop(){const e=this.peek();return ao(this,Ut)._++,e}toString(){const e=[];for(let t=h(this,Ut);t<h(this,Xr).length;t++){const r=h(this,Xr)[t];e.push(`${r.type}:${r.text}`)}return`<TokenString ${e.join(" ")}>`}};Ut=new WeakMap,Xr=new WeakMap,Xo=new WeakSet,Td=function(e=0,t=0){return new rl(h(this,Xr).slice(e,t).map(r=>Object.freeze(Object.assign({},r,{match:r.match-e,linkBack:r.linkBack-e,linkNext:r.linkNext-e}))))};let Vr=rl;function ks(n){const e=[],t=a=>{const o=i<n.length?JSON.stringify(n[i]):"$EOI";throw new Error(`invalid token ${o} at ${i}: ${a}`)};let r=[],s=[],i=0;for(;i<n.length;){let a=n.substring(i),o=a.match(Gy);o&&(i+=o[1].length,a=n.substring(i));const c={depth:r.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:i,value:-1};e.push(c);let l=My[a[0]]||"";if(l){if(c.type=l,c.text=a[0],i++,l==="OPEN_PAREN")r.push(e.length-1),s.push(e.length-1);else if(l=="CLOSE_PAREN")r.length===0&&t("no matching open bracket"),c.match=r.pop(),e[c.match].match=e.length-1,c.depth--,c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1;else if(l==="COMMA")c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1,s.push(e.length-1);else if(l==="OPEN_BRACKET")c.type="BRACKET";else if(l==="CLOSE_BRACKET"){let d=e.pop().text;if(e.length>0&&e[e.length-1].type==="NUMBER"){const f=e.pop().text;d=f+d,e[e.length-1].value=_e(f)}if(e.length===0||e[e.length-1].type!=="BRACKET")throw new Error("missing opening bracket");e[e.length-1].text+=d}continue}if(o=a.match(Hy),o){if(c.text=o[1],i+=c.text.length,Fy.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(hx)){c.type="TYPE";continue}c.type="ID";continue}if(o=a.match(Xy),o){c.text=o[1],c.type="NUMBER",i+=c.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(a[0])} at position ${i}`)}return new Vr(e.map(a=>Object.freeze(a)))}function O0(n,e){let t=[];for(const r in e.keys())n.has(r)&&t.push(r);if(t.length>1)throw new Error(`conflicting types: ${t.join(", ")}`)}function wl(n,e){if(e.peekKeyword(dx)){const t=e.pop().text;if(t!==n)throw new Error(`expected ${n}, got ${t}`)}return e.popType("ID")}function Jn(n,e){const t=new Set;for(;;){const r=n.peekType("KEYWORD");if(r==null||e&&!e.has(r))break;if(n.pop(),t.has(r))throw new Error(`duplicate keywords: ${JSON.stringify(r)}`);t.add(r)}return Object.freeze(t)}function xx(n){let e=Jn(n,_y);return O0(e,Wt("constant payable nonpayable".split(" "))),O0(e,Wt("pure view payable nonpayable".split(" "))),e.has("view")?"view":e.has("pure")?"pure":e.has("payable")?"payable":e.has("nonpayable")?"nonpayable":e.has("constant")?"view":"nonpayable"}function zn(n,e){return n.popParams().map(t=>Rt.from(t,e))}function gx(n){if(n.peekType("AT")){if(n.pop(),n.peekType("NUMBER"))return fe(n.pop().text);throw new Error("invalid gas")}return null}function wi(n){if(n.length)throw new Error(`unexpected tokens at offset ${n.offset}: ${n.toString()}`)}const zy=new RegExp(/^(.*)\[([0-9]*)\]$/);function I0(n){const e=n.match(hx);if(w(e,"invalid type","type",n),n==="uint")return"uint256";if(n==="int")return"int256";if(e[2]){const t=parseInt(e[2]);w(t!==0&&t<=32,"invalid bytes length","type",n)}else if(e[3]){const t=parseInt(e[3]);w(t!==0&&t<=256&&t%8===0,"invalid numeric width","type",n)}return n}const xt={},rr=Symbol.for("_ethers_internal"),S0="_ParamTypeInternal",k0="_ErrorInternal",P0="_EventInternal",U0="_ConstructorInternal",N0="_FallbackInternal",C0="_FunctionInternal",B0="_StructInternal";var ma,kc;const vr=class vr{constructor(e,t,r,s,i,a,o,c){k(this,ma);E(this,"name");E(this,"type");E(this,"baseType");E(this,"indexed");E(this,"components");E(this,"arrayLength");E(this,"arrayChildren");if(Is(e,xt,"ParamType"),Object.defineProperty(this,rr,{value:S0}),a&&(a=Object.freeze(a.slice())),s==="array"){if(o==null||c==null)throw new Error("")}else if(o!=null||c!=null)throw new Error("");if(s==="tuple"){if(a==null)throw new Error("")}else if(a!=null)throw new Error("");me(this,{name:t,type:r,baseType:s,indexed:i,components:a,arrayLength:o,arrayChildren:c})}format(e){if(e==null&&(e="sighash"),e==="json"){const r=this.name||"";if(this.isArray()){const i=JSON.parse(this.arrayChildren.format("json"));return i.name=r,i.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(i)}const s={type:this.baseType==="tuple"?"tuple":this.type,name:r};return typeof this.indexed=="boolean"&&(s.indexed=this.indexed),this.isTuple()&&(s.components=this.components.map(i=>JSON.parse(i.format(e)))),JSON.stringify(s)}let t="";return this.isArray()?(t+=this.arrayChildren.format(e),t+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?t+="("+this.components.map(r=>r.format(e)).join(e==="full"?", ":",")+")":t+=this.type,e!=="sighash"&&(this.indexed===!0&&(t+=" indexed"),e==="full"&&this.name&&(t+=" "+this.name)),t}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(e,t){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(this.arrayLength!==-1&&e.length!==this.arrayLength)throw new Error("array is wrong length");const r=this;return e.map(s=>r.arrayChildren.walk(s,t))}if(this.isTuple()){if(!Array.isArray(e))throw new Error("invalid tuple value");if(e.length!==this.components.length)throw new Error("array is wrong length");const r=this;return e.map((s,i)=>r.components[i].walk(s,t))}return t(this.type,e)}async walkAsync(e,t){const r=[],s=[e];return X(this,ma,kc).call(this,r,e,t,i=>{s[0]=i}),r.length&&await Promise.all(r),s[0]}static from(e,t){if(vr.isParamType(e))return e;if(typeof e=="string")try{return vr.from(ks(e),t)}catch{w(!1,"invalid param type","obj",e)}else if(e instanceof Vr){let o="",c="",l=null;Jn(e,Wt(["tuple"])).has("tuple")||e.peekType("OPEN_PAREN")?(c="tuple",l=e.popParams().map(p=>vr.from(p)),o=`tuple(${l.map(p=>p.format()).join(",")})`):(o=I0(e.popType("TYPE")),c=o);let d=null,f=null;for(;e.length&&e.peekType("BRACKET");){const p=e.pop();d=new vr(xt,"",o,c,null,l,f,d),f=p.value,o+=p.text,c="array",l=null}let x=null;if(Jn(e,Ry).has("indexed")){if(!t)throw new Error("");x=!0}const b=e.peekType("ID")?e.pop().text:"";if(e.length)throw new Error("leftover tokens");return new vr(xt,b,o,c,x,l,f,d)}const r=e.name;w(!r||typeof r=="string"&&r.match(fx),"invalid name","obj.name",r);let s=e.indexed;s!=null&&(w(t,"parameter cannot be indexed","obj.indexed",e.indexed),s=!!s);let i=e.type,a=i.match(zy);if(a){const o=parseInt(a[2]||"-1"),c=vr.from({type:a[1],components:e.components});return new vr(xt,r||"",i,"array",s,null,o,c)}if(i==="tuple"||i.startsWith("tuple(")||i.startsWith("(")){const o=e.components!=null?e.components.map(l=>vr.from(l)):null;return new vr(xt,r||"",i,"tuple",s,o,null,null)}return i=I0(e.type),new vr(xt,r||"",i,i,s,null,null,null)}static isParamType(e){return e&&e[rr]===S0}};ma=new WeakSet,kc=function(e,t,r,s){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const a=this.arrayChildren,o=t.slice();o.forEach((c,l)=>{var d;X(d=a,ma,kc).call(d,e,c,r,f=>{o[l]=f})}),s(o);return}if(this.isTuple()){const a=this.components;let o;if(Array.isArray(t))o=t.slice();else{if(t==null||typeof t!="object")throw new Error("invalid tuple value");o=a.map(c=>{if(!c.name)throw new Error("cannot use object value with unnamed components");if(!(c.name in t))throw new Error(`missing value for component ${c.name}`);return t[c.name]})}if(o.length!==this.components.length)throw new Error("array is wrong length");o.forEach((c,l)=>{var d;X(d=a[l],ma,kc).call(d,e,c,r,f=>{o[l]=f})}),s(o);return}const i=r(this.type,t);i.then?e.push(async function(){s(await i)}()):s(i)};let Rt=vr;class vi{constructor(e,t,r){E(this,"type");E(this,"inputs");Is(e,xt,"Fragment"),r=Object.freeze(r.slice()),me(this,{type:t,inputs:r})}static from(e){if(typeof e=="string"){try{vi.from(JSON.parse(e))}catch{}return vi.from(ks(e))}if(e instanceof Vr)switch(e.peekKeyword(dx)){case"constructor":return Gn.from(e);case"error":return tr.from(e);case"event":return un.from(e);case"fallback":case"receive":return Tn.from(e);case"function":return fn.from(e);case"struct":return yi.from(e)}else if(typeof e=="object"){switch(e.type){case"constructor":return Gn.from(e);case"error":return tr.from(e);case"event":return un.from(e);case"fallback":case"receive":return Tn.from(e);case"function":return fn.from(e);case"struct":return yi.from(e)}F(!1,`unsupported type: ${e.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}w(!1,"unsupported frgament object","obj",e)}static isConstructor(e){return Gn.isFragment(e)}static isError(e){return tr.isFragment(e)}static isEvent(e){return un.isFragment(e)}static isFunction(e){return fn.isFragment(e)}static isStruct(e){return yi.isFragment(e)}}class vl extends vi{constructor(t,r,s,i){super(t,r,i);E(this,"name");w(typeof s=="string"&&s.match(fx),"invalid identifier","name",s),i=Object.freeze(i.slice()),me(this,{name:s})}}function No(n,e){return"("+e.map(t=>t.format(n)).join(n==="full"?", ":",")+")"}class tr extends vl{constructor(e,t,r){super(e,"error",t,r),Object.defineProperty(this,rr,{value:k0})}get selector(){return Vn(this.format("sighash")).substring(0,10)}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(r=>JSON.parse(r.format(e)))});const t=[];return e!=="sighash"&&t.push("error"),t.push(this.name+No(e,this.inputs)),t.join(" ")}static from(e){if(tr.isFragment(e))return e;if(typeof e=="string")return tr.from(ks(e));if(e instanceof Vr){const t=wl("error",e),r=zn(e);return wi(e),new tr(xt,t,r)}return new tr(xt,e.name,e.inputs?e.inputs.map(Rt.from):[])}static isFragment(e){return e&&e[rr]===k0}}class un extends vl{constructor(t,r,s,i){super(t,"event",r,s);E(this,"anonymous");Object.defineProperty(this,rr,{value:P0}),me(this,{anonymous:i})}get topicHash(){return Vn(this.format("sighash"))}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(s=>JSON.parse(s.format(t)))});const r=[];return t!=="sighash"&&r.push("event"),r.push(this.name+No(t,this.inputs)),t!=="sighash"&&this.anonymous&&r.push("anonymous"),r.join(" ")}static getTopicHash(t,r){return r=(r||[]).map(i=>Rt.from(i)),new un(xt,t,r,!1).topicHash}static from(t){if(un.isFragment(t))return t;if(typeof t=="string")try{return un.from(ks(t))}catch{w(!1,"invalid event fragment","obj",t)}else if(t instanceof Vr){const r=wl("event",t),s=zn(t,!0),i=!!Jn(t,Wt(["anonymous"])).has("anonymous");return wi(t),new un(xt,r,s,i)}return new un(xt,t.name,t.inputs?t.inputs.map(r=>Rt.from(r,!0)):[],!!t.anonymous)}static isFragment(t){return t&&t[rr]===P0}}class Gn extends vi{constructor(t,r,s,i,a){super(t,r,s);E(this,"payable");E(this,"gas");Object.defineProperty(this,rr,{value:U0}),me(this,{payable:i,gas:a})}format(t){if(F(t!=null&&t!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),t==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(s=>JSON.parse(s.format(t)))});const r=[`constructor${No(t,this.inputs)}`];return this.payable&&r.push("payable"),this.gas!=null&&r.push(`@${this.gas.toString()}`),r.join(" ")}static from(t){if(Gn.isFragment(t))return t;if(typeof t=="string")try{return Gn.from(ks(t))}catch{w(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof Vr){Jn(t,Wt(["constructor"]));const r=zn(t),s=!!Jn(t,By).has("payable"),i=gx(t);return wi(t),new Gn(xt,"constructor",r,s,i)}return new Gn(xt,"constructor",t.inputs?t.inputs.map(Rt.from):[],!!t.payable,t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[rr]===U0}}class Tn extends vi{constructor(t,r,s){super(t,"fallback",r);E(this,"payable");Object.defineProperty(this,rr,{value:N0}),me(this,{payable:s})}format(t){const r=this.inputs.length===0?"receive":"fallback";if(t==="json"){const s=this.payable?"payable":"nonpayable";return JSON.stringify({type:r,stateMutability:s})}return`${r}()${this.payable?" payable":""}`}static from(t){if(Tn.isFragment(t))return t;if(typeof t=="string")try{return Tn.from(ks(t))}catch{w(!1,"invalid fallback fragment","obj",t)}else if(t instanceof Vr){const r=t.toString(),s=t.peekKeyword(Wt(["fallback","receive"]));if(w(s,"type must be fallback or receive","obj",r),t.popKeyword(Wt(["fallback","receive"]))==="receive"){const c=zn(t);return w(c.length===0,"receive cannot have arguments","obj.inputs",c),Jn(t,Wt(["payable"])),wi(t),new Tn(xt,[],!0)}let a=zn(t);a.length?w(a.length===1&&a[0].type==="bytes","invalid fallback inputs","obj.inputs",a.map(c=>c.format("minimal")).join(", ")):a=[Rt.from("bytes")];const o=xx(t);if(w(o==="nonpayable"||o==="payable","fallback cannot be constants","obj.stateMutability",o),Jn(t,Wt(["returns"])).has("returns")){const c=zn(t);w(c.length===1&&c[0].type==="bytes","invalid fallback outputs","obj.outputs",c.map(l=>l.format("minimal")).join(", "))}return wi(t),new Tn(xt,a,o==="payable")}if(t.type==="receive")return new Tn(xt,[],!0);if(t.type==="fallback"){const r=[Rt.from("bytes")],s=t.stateMutability==="payable";return new Tn(xt,r,s)}w(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[rr]===N0}}class fn extends vl{constructor(t,r,s,i,a,o){super(t,"function",r,i);E(this,"constant");E(this,"outputs");E(this,"stateMutability");E(this,"payable");E(this,"gas");Object.defineProperty(this,rr,{value:C0}),a=Object.freeze(a.slice()),me(this,{constant:s==="view"||s==="pure",gas:o,outputs:a,payable:s==="payable",stateMutability:s})}get selector(){return Vn(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(s=>JSON.parse(s.format(t))),outputs:this.outputs.map(s=>JSON.parse(s.format(t)))});const r=[];return t!=="sighash"&&r.push("function"),r.push(this.name+No(t,this.inputs)),t!=="sighash"&&(this.stateMutability!=="nonpayable"&&r.push(this.stateMutability),this.outputs&&this.outputs.length&&(r.push("returns"),r.push(No(t,this.outputs))),this.gas!=null&&r.push(`@${this.gas.toString()}`)),r.join(" ")}static getSelector(t,r){return r=(r||[]).map(i=>Rt.from(i)),new fn(xt,t,"view",r,[],null).selector}static from(t){if(fn.isFragment(t))return t;if(typeof t=="string")try{return fn.from(ks(t))}catch{w(!1,"invalid function fragment","obj",t)}else if(t instanceof Vr){const s=wl("function",t),i=zn(t),a=xx(t);let o=[];Jn(t,Wt(["returns"])).has("returns")&&(o=zn(t));const c=gx(t);return wi(t),new fn(xt,s,a,i,o,c)}let r=t.stateMutability;return r==null&&(r="payable",typeof t.constant=="boolean"?(r="view",t.constant||(r="payable",typeof t.payable=="boolean"&&!t.payable&&(r="nonpayable"))):typeof t.payable=="boolean"&&!t.payable&&(r="nonpayable")),new fn(xt,t.name,r,t.inputs?t.inputs.map(Rt.from):[],t.outputs?t.outputs.map(Rt.from):[],t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[rr]===C0}}class yi extends vl{constructor(e,t,r){super(e,"struct",t,r),Object.defineProperty(this,rr,{value:B0})}format(){throw new Error("@TODO")}static from(e){if(typeof e=="string")try{return yi.from(ks(e))}catch{w(!1,"invalid struct fragment","obj",e)}else if(e instanceof Vr){const t=wl("struct",e),r=zn(e);return wi(e),new yi(xt,t,r)}return new yi(xt,e.name,e.inputs?e.inputs.map(Rt.from):[])}static isFragment(e){return e&&e[rr]===B0}}const Jr=new Map;Jr.set(0,"GENERIC_PANIC");Jr.set(1,"ASSERT_FALSE");Jr.set(17,"OVERFLOW");Jr.set(18,"DIVIDE_BY_ZERO");Jr.set(33,"ENUM_RANGE_ERROR");Jr.set(34,"BAD_STORAGE_DATA");Jr.set(49,"STACK_UNDERFLOW");Jr.set(50,"ARRAY_RANGE_ERROR");Jr.set(65,"OUT_OF_MEMORY");Jr.set(81,"UNINITIALIZED_FUNCTION_CALL");const $y=new RegExp(/^bytes([0-9]*)$/),Ky=new RegExp(/^(u?int)([0-9]*)$/);let Hl=null,_0=1024;function Vy(n,e,t,r){let s="missing revert data",i=null;const a=null;let o=null;if(t){s="execution reverted";const l=ae(t);if(t=V(t),l.length===0)s+=" (no data present; likely require(false) occurred",i="require(false)";else if(l.length%32!==4)s+=" (could not decode reason; invalid data length)";else if(V(l.slice(0,4))==="0x08c379a0")try{i=r.decode(["string"],l.slice(4))[0],o={signature:"Error(string)",name:"Error",args:[i]},s+=`: ${JSON.stringify(i)}`}catch{s+=" (could not decode reason; invalid string data)"}else if(V(l.slice(0,4))==="0x4e487b71")try{const d=Number(r.decode(["uint256"],l.slice(4))[0]);o={signature:"Panic(uint256)",name:"Panic",args:[d]},i=`Panic due to ${Jr.get(d)||"UNKNOWN"}(${d})`,s+=`: ${i}`}catch{s+=" (could not decode panic code)"}else s+=" (unknown custom error)"}const c={to:e.to?ze(e.to):null,data:e.data||"0x"};return e.from&&(c.from=ze(e.from)),ut(s,"CALL_EXCEPTION",{action:n,data:t,reason:i,transaction:c,invocation:a,revert:o})}var ls,Di;const nl=class nl{constructor(){k(this,ls)}getDefaultValue(e){const t=e.map(s=>X(this,ls,Di).call(this,Rt.from(s)));return new pc(t,"_").defaultValue()}encode(e,t){mf(t.length,e.length,"types/values length mismatch");const r=e.map(a=>X(this,ls,Di).call(this,Rt.from(a))),s=new pc(r,"_"),i=new ld;return s.encode(i,t),i.data}decode(e,t,r){const s=e.map(a=>X(this,ls,Di).call(this,Rt.from(a)));return new pc(s,"_").decode(new dd(t,r,_0))}static _setDefaultMaxInflation(e){w(typeof e=="number"&&Number.isInteger(e),"invalid defaultMaxInflation factor","value",e),_0=e}static defaultAbiCoder(){return Hl==null&&(Hl=new nl),Hl}static getBuiltinCallException(e,t,r){return Vy(e,t,r,nl.defaultAbiCoder())}};ls=new WeakSet,Di=function(e){if(e.isArray())return new im(X(this,ls,Di).call(this,e.arrayChildren),e.arrayLength,e.name);if(e.isTuple())return new pc(e.components.map(r=>X(this,ls,Di).call(this,r)),e.name);switch(e.baseType){case"address":return new nm(e.name);case"bool":return new am(e.name);case"string":return new gm(e.name);case"bytes":return new om(e.name);case"":return new dm(e.name)}let t=e.type.match(Ky);if(t){let r=parseInt(t[2]||"256");return w(r!==0&&r<=256&&r%8===0,"invalid "+t[1]+" bit length","param",e),new xm(r/8,t[1]==="int",e.name)}if(t=e.type.match($y),t){let r=parseInt(t[1]);return w(r!==0&&r<=32,"invalid bytes length","param",e),new cm(r,e.name)}w(!1,"invalid type","type",e.type)};let Co=nl;class Jy{constructor(e,t,r){E(this,"fragment");E(this,"name");E(this,"signature");E(this,"topic");E(this,"args");const s=e.name,i=e.format();me(this,{fragment:e,name:s,signature:i,topic:t,args:r})}}class Qy{constructor(e,t,r,s){E(this,"fragment");E(this,"name");E(this,"args");E(this,"signature");E(this,"selector");E(this,"value");const i=e.name,a=e.format();me(this,{fragment:e,name:i,args:r,signature:a,selector:t,value:s})}}class Wy{constructor(e,t,r){E(this,"fragment");E(this,"name");E(this,"args");E(this,"signature");E(this,"selector");const s=e.name,i=e.format();me(this,{fragment:e,name:s,args:r,signature:i,selector:t})}}class R0{constructor(e){E(this,"hash");E(this,"_isIndexed");me(this,{hash:e,_isIndexed:!0})}static isIndexed(e){return!!(e&&e._isIndexed)}}const D0={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},L0={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:n=>`reverted with reason string ${JSON.stringify(n)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:n=>{let e="unknown panic code";return n>=0&&n<=255&&D0[n.toString()]&&(e=D0[n.toString()]),`reverted with panic code 0x${n.toString(16)} (${e})`}}};var sn,an,on,Ft,bn,Pc,Uc;const Xs=class Xs{constructor(e){k(this,bn);E(this,"fragments");E(this,"deploy");E(this,"fallback");E(this,"receive");k(this,sn);k(this,an);k(this,on);k(this,Ft);let t=[];typeof e=="string"?t=JSON.parse(e):t=e,m(this,on,new Map),m(this,sn,new Map),m(this,an,new Map);const r=[];for(const a of t)try{r.push(vi.from(a))}catch(o){console.log(`[Warning] Invalid Fragment ${JSON.stringify(a)}:`,o.message)}me(this,{fragments:Object.freeze(r)});let s=null,i=!1;m(this,Ft,this.getAbiCoder()),this.fragments.forEach((a,o)=>{let c;switch(a.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}me(this,{deploy:a});return;case"fallback":a.inputs.length===0?i=!0:(w(!s||a.payable!==s.payable,"conflicting fallback fragments",`fragments[${o}]`,a),s=a,i=s.payable);return;case"function":c=h(this,on);break;case"event":c=h(this,an);break;case"error":c=h(this,sn);break;default:return}const l=a.format();c.has(l)||c.set(l,a)}),this.deploy||me(this,{deploy:Gn.from("constructor()")}),me(this,{fallback:s,receive:i})}format(e){const t=e?"minimal":"full";return this.fragments.map(s=>s.format(t))}formatJson(){const e=this.fragments.map(t=>t.format("json"));return JSON.stringify(e.map(t=>JSON.parse(t)))}getAbiCoder(){return Co.defaultAbiCoder()}getFunctionName(e){const t=X(this,bn,Pc).call(this,e,null,!1);return w(t,"no matching function","key",e),t.name}hasFunction(e){return!!X(this,bn,Pc).call(this,e,null,!1)}getFunction(e,t){return X(this,bn,Pc).call(this,e,t||null,!0)}forEachFunction(e){const t=Array.from(h(this,on).keys());t.sort((r,s)=>r.localeCompare(s));for(let r=0;r<t.length;r++){const s=t[r];e(h(this,on).get(s),r)}}getEventName(e){const t=X(this,bn,Uc).call(this,e,null,!1);return w(t,"no matching event","key",e),t.name}hasEvent(e){return!!X(this,bn,Uc).call(this,e,null,!1)}getEvent(e,t){return X(this,bn,Uc).call(this,e,t||null,!0)}forEachEvent(e){const t=Array.from(h(this,an).keys());t.sort((r,s)=>r.localeCompare(s));for(let r=0;r<t.length;r++){const s=t[r];e(h(this,an).get(s),r)}}getError(e,t){if(je(e)){const s=e.toLowerCase();if(L0[s])return tr.from(L0[s].signature);for(const i of h(this,sn).values())if(s===i.selector)return i;return null}if(e.indexOf("(")===-1){const s=[];for(const[i,a]of h(this,sn))i.split("(")[0]===e&&s.push(a);if(s.length===0)return e==="Error"?tr.from("error Error(string)"):e==="Panic"?tr.from("error Panic(uint256)"):null;if(s.length>1){const i=s.map(a=>JSON.stringify(a.format())).join(", ");w(!1,`ambiguous error description (i.e. ${i})`,"name",e)}return s[0]}if(e=tr.from(e).format(),e==="Error(string)")return tr.from("error Error(string)");if(e==="Panic(uint256)")return tr.from("error Panic(uint256)");const r=h(this,sn).get(e);return r||null}forEachError(e){const t=Array.from(h(this,sn).keys());t.sort((r,s)=>r.localeCompare(s));for(let r=0;r<t.length;r++){const s=t[r];e(h(this,sn).get(s),r)}}_decodeParams(e,t){return h(this,Ft).decode(e,t)}_encodeParams(e,t){return h(this,Ft).encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,t){if(typeof e=="string"){const r=this.getError(e);w(r,"unknown error","fragment",e),e=r}return w(ct(t,0,4)===e.selector,`data signature does not match error ${e.name}.`,"data",t),this._decodeParams(e.inputs,ct(t,4))}encodeErrorResult(e,t){if(typeof e=="string"){const r=this.getError(e);w(r,"unknown error","fragment",e),e=r}return qe([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionData(e,t){if(typeof e=="string"){const r=this.getFunction(e);w(r,"unknown function","fragment",e),e=r}return w(ct(t,0,4)===e.selector,`data signature does not match function ${e.name}.`,"data",t),this._decodeParams(e.inputs,ct(t,4))}encodeFunctionData(e,t){if(typeof e=="string"){const r=this.getFunction(e);w(r,"unknown function","fragment",e),e=r}return qe([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionResult(e,t){if(typeof e=="string"){const i=this.getFunction(e);w(i,"unknown function","fragment",e),e=i}let r="invalid length for result data";const s=_t(t);if(s.length%32===0)try{return h(this,Ft).decode(e.outputs,s)}catch{r="could not decode result data"}F(!1,r,"BAD_DATA",{value:V(s),info:{method:e.name,signature:e.format()}})}makeError(e,t){const r=ae(e,"data"),s=Co.getBuiltinCallException("call",t,r);if(s.message.startsWith("execution reverted (unknown custom error)")){const o=V(r.slice(0,4)),c=this.getError(o);if(c)try{const l=h(this,Ft).decode(c.inputs,r.slice(4));s.revert={name:c.name,signature:c.format(),args:l},s.reason=s.revert.signature,s.message=`execution reverted: ${s.reason}`}catch{s.message="execution reverted (coult not decode custom error)"}}const a=this.parseTransaction(t);return a&&(s.invocation={method:a.name,signature:a.signature,args:a.args}),s}encodeFunctionResult(e,t){if(typeof e=="string"){const r=this.getFunction(e);w(r,"unknown function","fragment",e),e=r}return V(h(this,Ft).encode(e.outputs,t||[]))}encodeFilterTopics(e,t){if(typeof e=="string"){const i=this.getEvent(e);w(i,"unknown event","eventFragment",e),e=i}F(t.length<=e.inputs.length,`too many arguments for ${e.format()}`,"UNEXPECTED_ARGUMENT",{count:t.length,expectedCount:e.inputs.length});const r=[];e.anonymous||r.push(e.topicHash);const s=(i,a)=>i.type==="string"?Vn(a):i.type==="bytes"?Ue(V(a)):(i.type==="bool"&&typeof a=="boolean"?a=a?"0x01":"0x00":i.type.match(/^u?int/)?a=$n(a):i.type.match(/^bytes/)?a=Af(a,32):i.type==="address"&&h(this,Ft).encode(["address"],[a]),tt(V(a),32));for(t.forEach((i,a)=>{const o=e.inputs[a];if(!o.indexed){w(i==null,"cannot filter non-indexed parameters; must be null","contract."+o.name,i);return}i==null?r.push(null):o.baseType==="array"||o.baseType==="tuple"?w(!1,"filtering with tuples or arrays not supported","contract."+o.name,i):Array.isArray(i)?r.push(i.map(c=>s(o,c))):r.push(s(o,i))});r.length&&r[r.length-1]===null;)r.pop();return r}encodeEventLog(e,t){if(typeof e=="string"){const a=this.getEvent(e);w(a,"unknown event","eventFragment",e),e=a}const r=[],s=[],i=[];return e.anonymous||r.push(e.topicHash),w(t.length===e.inputs.length,"event arguments/values mismatch","values",t),e.inputs.forEach((a,o)=>{const c=t[o];if(a.indexed)if(a.type==="string")r.push(Vn(c));else if(a.type==="bytes")r.push(Ue(c));else{if(a.baseType==="tuple"||a.baseType==="array")throw new Error("not implemented");r.push(h(this,Ft).encode([a.type],[c]))}else s.push(a),i.push(c)}),{data:h(this,Ft).encode(s,i),topics:r}}decodeEventLog(e,t,r){if(typeof e=="string"){const g=this.getEvent(e);w(g,"unknown event","eventFragment",e),e=g}if(r!=null&&!e.anonymous){const g=e.topicHash;w(je(r[0],32)&&r[0].toLowerCase()===g,"fragment/topic mismatch","topics[0]",r[0]),r=r.slice(1)}const s=[],i=[],a=[];e.inputs.forEach((g,b)=>{g.indexed?g.type==="string"||g.type==="bytes"||g.baseType==="tuple"||g.baseType==="array"?(s.push(Rt.from({type:"bytes32",name:g.name})),a.push(!0)):(s.push(g),a.push(!1)):(i.push(g),a.push(!1))});const o=r!=null?h(this,Ft).decode(s,qe(r)):null,c=h(this,Ft).decode(i,t,!0),l=[],d=[];let f=0,x=0;return e.inputs.forEach((g,b)=>{let p=null;if(g.indexed)if(o==null)p=new R0(null);else if(a[b])p=new R0(o[x++]);else try{p=o[x++]}catch(y){p=y}else try{p=c[f++]}catch(y){p=y}l.push(p),d.push(g.name||null)}),La.fromItems(l,d)}parseTransaction(e){const t=ae(e.data,"tx.data"),r=fe(e.value!=null?e.value:0,"tx.value"),s=this.getFunction(V(t.slice(0,4)));if(!s)return null;const i=h(this,Ft).decode(s.inputs,t.slice(4));return new Qy(s,s.selector,i,r)}parseCallResult(e){throw new Error("@TODO")}parseLog(e){const t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new Jy(t,t.topicHash,this.decodeEventLog(t,e.data,e.topics))}parseError(e){const t=V(e),r=this.getError(ct(t,0,4));if(!r)return null;const s=h(this,Ft).decode(r.inputs,ct(t,4));return new Wy(r,r.selector,s)}static from(e){return e instanceof Xs?e:typeof e=="string"?new Xs(JSON.parse(e)):typeof e.formatJson=="function"?new Xs(e.formatJson()):typeof e.format=="function"?new Xs(e.format("json")):new Xs(e)}};sn=new WeakMap,an=new WeakMap,on=new WeakMap,Ft=new WeakMap,bn=new WeakSet,Pc=function(e,t,r){if(je(e)){const i=e.toLowerCase();for(const a of h(this,on).values())if(i===a.selector)return a;return null}if(e.indexOf("(")===-1){const i=[];for(const[a,o]of h(this,on))a.split("(")[0]===e&&i.push(o);if(t){const a=t.length>0?t[t.length-1]:null;let o=t.length,c=!0;Ht.isTyped(a)&&a.type==="overrides"&&(c=!1,o--);for(let l=i.length-1;l>=0;l--){const d=i[l].inputs.length;d!==o&&(!c||d!==o-1)&&i.splice(l,1)}for(let l=i.length-1;l>=0;l--){const d=i[l].inputs;for(let f=0;f<t.length;f++)if(Ht.isTyped(t[f])){if(f>=d.length){if(t[f].type==="overrides")continue;i.splice(l,1);break}if(t[f].type!==d[f].baseType){i.splice(l,1);break}}}}if(i.length===1&&t&&t.length!==i[0].inputs.length){const a=t[t.length-1];(a==null||Array.isArray(a)||typeof a!="object")&&i.splice(0,1)}if(i.length===0)return null;if(i.length>1&&r){const a=i.map(o=>JSON.stringify(o.format())).join(", ");w(!1,`ambiguous function description (i.e. matches ${a})`,"key",e)}return i[0]}const s=h(this,on).get(fn.from(e).format());return s||null},Uc=function(e,t,r){if(je(e)){const i=e.toLowerCase();for(const a of h(this,an).values())if(i===a.topicHash)return a;return null}if(e.indexOf("(")===-1){const i=[];for(const[a,o]of h(this,an))a.split("(")[0]===e&&i.push(o);if(t){for(let a=i.length-1;a>=0;a--)i[a].inputs.length<t.length&&i.splice(a,1);for(let a=i.length-1;a>=0;a--){const o=i[a].inputs;for(let c=0;c<t.length;c++)if(Ht.isTyped(t[c])&&t[c].type!==o[c].baseType){i.splice(a,1);break}}}if(i.length===0)return null;if(i.length>1&&r){const a=i.map(o=>JSON.stringify(o.format())).join(", ");w(!1,`ambiguous event description (i.e. matches ${a})`,"key",e)}return i[0]}const s=h(this,an).get(un.from(e).format());return s||null};let Od=Xs;const px=BigInt(0);function Ji(n){return n??null}function wt(n){return n==null?null:n.toString()}class F0{constructor(e,t,r){E(this,"gasPrice");E(this,"maxFeePerGas");E(this,"maxPriorityFeePerGas");me(this,{gasPrice:Ji(e),maxFeePerGas:Ji(t),maxPriorityFeePerGas:Ji(r)})}toJSON(){const{gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:r}=this;return{_type:"FeeData",gasPrice:wt(e),maxFeePerGas:wt(t),maxPriorityFeePerGas:wt(r)}}}function Bo(n){const e={};n.to&&(e.to=n.to),n.from&&(e.from=n.from),n.data&&(e.data=V(n.data));const t="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const s of t)!(s in n)||n[s]==null||(e[s]=fe(n[s],`request.${s}`));const r="type,nonce".split(/,/);for(const s of r)!(s in n)||n[s]==null||(e[s]=_e(n[s],`request.${s}`));return n.accessList&&(e.accessList=Oi(n.accessList)),n.authorizationList&&(e.authorizationList=n.authorizationList.slice()),"blockTag"in n&&(e.blockTag=n.blockTag),"enableCcipRead"in n&&(e.enableCcipRead=!!n.enableCcipRead),"customData"in n&&(e.customData=n.customData),"blobVersionedHashes"in n&&n.blobVersionedHashes&&(e.blobVersionedHashes=n.blobVersionedHashes.slice()),"kzg"in n&&(e.kzg=n.kzg),"blobs"in n&&n.blobs&&(e.blobs=n.blobs.map(s=>ll(s)?V(s):Object.assign({},s))),e}var Un;class jy{constructor(e,t){E(this,"provider");E(this,"number");E(this,"hash");E(this,"timestamp");E(this,"parentHash");E(this,"parentBeaconBlockRoot");E(this,"nonce");E(this,"difficulty");E(this,"gasLimit");E(this,"gasUsed");E(this,"stateRoot");E(this,"receiptsRoot");E(this,"blobGasUsed");E(this,"excessBlobGas");E(this,"miner");E(this,"prevRandao");E(this,"extraData");E(this,"baseFeePerGas");k(this,Un);m(this,Un,e.transactions.map(r=>typeof r!="string"?new _o(r,t):r)),me(this,{provider:t,hash:Ji(e.hash),number:e.number,timestamp:e.timestamp,parentHash:e.parentHash,parentBeaconBlockRoot:e.parentBeaconBlockRoot,nonce:e.nonce,difficulty:e.difficulty,gasLimit:e.gasLimit,gasUsed:e.gasUsed,blobGasUsed:e.blobGasUsed,excessBlobGas:e.excessBlobGas,miner:e.miner,prevRandao:Ji(e.prevRandao),extraData:e.extraData,baseFeePerGas:Ji(e.baseFeePerGas),stateRoot:e.stateRoot,receiptsRoot:e.receiptsRoot})}get transactions(){return h(this,Un).map(e=>typeof e=="string"?e:e.hash)}get prefetchedTransactions(){const e=h(this,Un).slice();return e.length===0?[]:(F(typeof e[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),e)}toJSON(){const{baseFeePerGas:e,difficulty:t,extraData:r,gasLimit:s,gasUsed:i,hash:a,miner:o,prevRandao:c,nonce:l,number:d,parentHash:f,parentBeaconBlockRoot:x,stateRoot:g,receiptsRoot:b,timestamp:p,transactions:y}=this;return{_type:"Block",baseFeePerGas:wt(e),difficulty:wt(t),extraData:r,gasLimit:wt(s),gasUsed:wt(i),blobGasUsed:wt(this.blobGasUsed),excessBlobGas:wt(this.excessBlobGas),hash:a,miner:o,prevRandao:c,nonce:l,number:d,parentHash:f,timestamp:p,parentBeaconBlockRoot:x,stateRoot:g,receiptsRoot:b,transactions:y}}[Symbol.iterator](){let e=0;const t=this.transactions;return{next:()=>e<this.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}get length(){return h(this,Un).length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(e){let t;if(typeof e=="number")t=h(this,Un)[e];else{const r=e.toLowerCase();for(const s of h(this,Un))if(typeof s=="string"){if(s!==r)continue;t=s;break}else{if(s.hash!==r)continue;t=s;break}}if(t==null)throw new Error("no such tx");return typeof t=="string"?await this.provider.getTransaction(t):t}getPrefetchedTransaction(e){const t=this.prefetchedTransactions;if(typeof e=="number")return t[e];e=e.toLowerCase();for(const r of t)if(r.hash===e)return r;w(!1,"no matching transaction","indexOrHash",e)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return Zy(this)}}Un=new WeakMap;class rc{constructor(e,t){E(this,"provider");E(this,"transactionHash");E(this,"blockHash");E(this,"blockNumber");E(this,"removed");E(this,"address");E(this,"data");E(this,"topics");E(this,"index");E(this,"transactionIndex");this.provider=t;const r=Object.freeze(e.topics.slice());me(this,{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,removed:e.removed,address:e.address,data:e.data,topics:r,index:e.index,transactionIndex:e.transactionIndex})}toJSON(){const{address:e,blockHash:t,blockNumber:r,data:s,index:i,removed:a,topics:o,transactionHash:c,transactionIndex:l}=this;return{_type:"log",address:e,blockHash:t,blockNumber:r,data:s,index:i,removed:a,topics:o,transactionHash:c,transactionIndex:l}}async getBlock(){const e=await this.provider.getBlock(this.blockHash);return F(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransaction(){const e=await this.provider.getTransaction(this.transactionHash);return F(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransactionReceipt(){const e=await this.provider.getTransactionReceipt(this.transactionHash);return F(!!e,"failed to find transaction receipt","UNKNOWN_ERROR",{}),e}removedEvent(){return Yy(this)}}var Ho;class bx{constructor(e,t){E(this,"provider");E(this,"to");E(this,"from");E(this,"contractAddress");E(this,"hash");E(this,"index");E(this,"blockHash");E(this,"blockNumber");E(this,"logsBloom");E(this,"gasUsed");E(this,"blobGasUsed");E(this,"cumulativeGasUsed");E(this,"gasPrice");E(this,"blobGasPrice");E(this,"type");E(this,"status");E(this,"root");k(this,Ho);m(this,Ho,Object.freeze(e.logs.map(s=>new rc(s,t))));let r=px;e.effectiveGasPrice!=null?r=e.effectiveGasPrice:e.gasPrice!=null&&(r=e.gasPrice),me(this,{provider:t,to:e.to,from:e.from,contractAddress:e.contractAddress,hash:e.hash,index:e.index,blockHash:e.blockHash,blockNumber:e.blockNumber,logsBloom:e.logsBloom,gasUsed:e.gasUsed,cumulativeGasUsed:e.cumulativeGasUsed,blobGasUsed:e.blobGasUsed,gasPrice:r,blobGasPrice:e.blobGasPrice,type:e.type,status:e.status,root:e.root})}get logs(){return h(this,Ho)}toJSON(){const{to:e,from:t,contractAddress:r,hash:s,index:i,blockHash:a,blockNumber:o,logsBloom:c,logs:l,status:d,root:f}=this;return{_type:"TransactionReceipt",blockHash:a,blockNumber:o,contractAddress:r,cumulativeGasUsed:wt(this.cumulativeGasUsed),from:t,gasPrice:wt(this.gasPrice),blobGasUsed:wt(this.blobGasUsed),blobGasPrice:wt(this.blobGasPrice),gasUsed:wt(this.gasUsed),hash:s,index:i,logs:l,logsBloom:c,root:f,status:d,to:e}}get length(){return this.logs.length}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.logs[e++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const e=await this.provider.getBlock(this.blockHash);if(e==null)throw new Error("TODO");return e}async getTransaction(){const e=await this.provider.getTransaction(this.hash);if(e==null)throw new Error("TODO");return e}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return yx(this)}reorderedEvent(e){return F(!e||e.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),mx(this,e)}}Ho=new WeakMap;var ds;const Eu=class Eu{constructor(e,t){E(this,"provider");E(this,"blockNumber");E(this,"blockHash");E(this,"index");E(this,"hash");E(this,"type");E(this,"to");E(this,"from");E(this,"nonce");E(this,"gasLimit");E(this,"gasPrice");E(this,"maxPriorityFeePerGas");E(this,"maxFeePerGas");E(this,"maxFeePerBlobGas");E(this,"data");E(this,"value");E(this,"chainId");E(this,"signature");E(this,"accessList");E(this,"blobVersionedHashes");E(this,"authorizationList");k(this,ds);this.provider=t,this.blockNumber=e.blockNumber!=null?e.blockNumber:null,this.blockHash=e.blockHash!=null?e.blockHash:null,this.hash=e.hash,this.index=e.index,this.type=e.type,this.from=e.from,this.to=e.to||null,this.gasLimit=e.gasLimit,this.nonce=e.nonce,this.data=e.data,this.value=e.value,this.gasPrice=e.gasPrice,this.maxPriorityFeePerGas=e.maxPriorityFeePerGas!=null?e.maxPriorityFeePerGas:null,this.maxFeePerGas=e.maxFeePerGas!=null?e.maxFeePerGas:null,this.maxFeePerBlobGas=e.maxFeePerBlobGas!=null?e.maxFeePerBlobGas:null,this.chainId=e.chainId,this.signature=e.signature,this.accessList=e.accessList!=null?e.accessList:null,this.blobVersionedHashes=e.blobVersionedHashes!=null?e.blobVersionedHashes:null,this.authorizationList=e.authorizationList!=null?e.authorizationList:null,m(this,ds,-1)}toJSON(){const{blockNumber:e,blockHash:t,index:r,hash:s,type:i,to:a,from:o,nonce:c,data:l,signature:d,accessList:f,blobVersionedHashes:x}=this;return{_type:"TransactionResponse",accessList:f,blockNumber:e,blockHash:t,blobVersionedHashes:x,chainId:wt(this.chainId),data:l,from:o,gasLimit:wt(this.gasLimit),gasPrice:wt(this.gasPrice),hash:s,maxFeePerGas:wt(this.maxFeePerGas),maxPriorityFeePerGas:wt(this.maxPriorityFeePerGas),maxFeePerBlobGas:wt(this.maxFeePerBlobGas),nonce:c,signature:d,to:a,index:r,type:i,value:wt(this.value)}}async getBlock(){let e=this.blockNumber;if(e==null){const r=await this.getTransaction();r&&(e=r.blockNumber)}if(e==null)return null;const t=this.provider.getBlock(e);if(t==null)throw new Error("TODO");return t}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){const{tx:t,blockNumber:r}=await Xt({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return t==null||t.blockNumber==null?0:r-t.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(e,t){const r=e??1,s=t??0;let i=h(this,ds),a=-1,o=i===-1;const c=async()=>{if(o)return null;const{blockNumber:x,nonce:g}=await Xt({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(g<this.nonce){i=x;return}if(o)return null;const b=await this.getTransaction();if(!(b&&b.blockNumber!=null))for(a===-1&&(a=i-3,a<h(this,ds)&&(a=h(this,ds)));a<=x;){if(o)return null;const p=await this.provider.getBlock(a,!0);if(p==null)return;for(const y of p)if(y===this.hash)return;for(let y=0;y<p.length;y++){const v=await p.getTransaction(y);if(v.from===this.from&&v.nonce===this.nonce){if(o)return null;const I=await this.provider.getTransactionReceipt(v.hash);if(I==null||x-I.blockNumber+1<r)return;let N="replaced";v.data===this.data&&v.to===this.to&&v.value===this.value?N="repriced":v.data==="0x"&&v.from===v.to&&v.value===px&&(N="cancelled"),F(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:N==="replaced"||N==="cancelled",reason:N,replacement:v.replaceableTransaction(i),hash:v.hash,receipt:I})}}a++}},l=x=>{if(x==null||x.status!==0)return x;F(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:x.to,from:x.from,data:""},receipt:x})},d=await this.provider.getTransactionReceipt(this.hash);if(r===0)return l(d);if(d){if(r===1||await d.confirmations()>=r)return l(d)}else if(await c(),r===0)return null;return await new Promise((x,g)=>{const b=[],p=()=>{b.forEach(v=>v())};if(b.push(()=>{o=!0}),s>0){const v=setTimeout(()=>{p(),g(ut("wait for transaction timeout","TIMEOUT"))},s);b.push(()=>{clearTimeout(v)})}const y=async v=>{if(await v.confirmations()>=r){p();try{x(l(v))}catch(I){g(I)}}};if(b.push(()=>{this.provider.off(this.hash,y)}),this.provider.on(this.hash,y),i>=0){const v=async()=>{try{await c()}catch(I){if(Bt(I,"TRANSACTION_REPLACED")){p(),g(I);return}}o||this.provider.once("block",v)};b.push(()=>{this.provider.off("block",v)}),this.provider.once("block",v)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return F(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),yx(this)}reorderedEvent(e){return F(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),F(!e||e.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),mx(this,e)}replaceableTransaction(e){w(Number.isInteger(e)&&e>=0,"invalid startBlock","startBlock",e);const t=new Eu(this,this.provider);return m(t,ds,e),t}};ds=new WeakMap;let _o=Eu;function Zy(n){return{orphan:"drop-block",hash:n.hash,number:n.number}}function mx(n,e){return{orphan:"reorder-transaction",tx:n,other:e}}function yx(n){return{orphan:"drop-transaction",tx:n}}function Yy(n){return{orphan:"drop-log",log:{transactionHash:n.transactionHash,blockHash:n.blockHash,blockNumber:n.blockNumber,address:n.address,data:n.data,topics:Object.freeze(n.topics.slice()),index:n.index}}}class hu extends rc{constructor(t,r,s){super(t,t.provider);E(this,"interface");E(this,"fragment");E(this,"args");const i=r.decodeEventLog(s,t.data,t.topics);me(this,{args:i,fragment:s,interface:r})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class wx extends rc{constructor(t,r){super(t,t.provider);E(this,"error");me(this,{error:r})}}var ya;class qy extends bx{constructor(t,r,s){super(s,r);k(this,ya);m(this,ya,t)}get logs(){return super.logs.map(t=>{const r=t.topics.length?h(this,ya).getEvent(t.topics[0]):null;if(r)try{return new hu(t,h(this,ya),r)}catch(s){return new wx(t,s)}return t})}}ya=new WeakMap;var zo;class xu extends _o{constructor(t,r,s){super(s,r);k(this,zo);m(this,zo,t)}async wait(t,r){const s=await super.wait(t,r);return s==null?null:new qy(h(this,zo),this.provider,s)}}zo=new WeakMap;class vx extends Tf{constructor(t,r,s,i){super(t,r,s);E(this,"log");me(this,{log:i})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class ew extends vx{constructor(e,t,r,s,i){super(e,t,r,new hu(i,e.interface,s));const a=e.interface.decodeEventLog(s,this.log.data,this.log.topics);me(this,{args:a,fragment:s})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const M0=BigInt(0);function Ax(n){return n&&typeof n.call=="function"}function Ex(n){return n&&typeof n.estimateGas=="function"}function Al(n){return n&&typeof n.resolveName=="function"}function Tx(n){return n&&typeof n.sendTransaction=="function"}function Ox(n){if(n!=null){if(Al(n))return n;if(n.provider)return n.provider}}var $o;class tw{constructor(e,t,r){k(this,$o);E(this,"fragment");if(me(this,{fragment:t}),t.inputs.length<r.length)throw new Error("too many arguments");const s=Ai(e.runner,"resolveName"),i=Al(s)?s:null;m(this,$o,async function(){const a=await Promise.all(t.inputs.map((o,c)=>r[c]==null?null:o.walkAsync(r[c],(d,f)=>d==="address"?Array.isArray(f)?Promise.all(f.map(x=>kt(x,i))):kt(f,i):f)));return e.interface.encodeFilterTopics(t,a)}())}getTopicFilter(){return h(this,$o)}}$o=new WeakMap;function Ai(n,e){return n==null?null:typeof n[e]=="function"?n:n.provider&&typeof n.provider[e]=="function"?n.provider:null}function Js(n){return n==null?null:n.provider||null}async function Ix(n,e){const t=Ht.dereference(n,"overrides");w(typeof t=="object","invalid overrides parameter","overrides",n);const r=Bo(t);return w(r.to==null||(e||[]).indexOf("to")>=0,"cannot override to","overrides.to",r.to),w(r.data==null||(e||[]).indexOf("data")>=0,"cannot override data","overrides.data",r.data),r.from&&(r.from=r.from),r}async function rw(n,e,t){const r=Ai(n,"resolveName"),s=Al(r)?r:null;return await Promise.all(e.map((i,a)=>i.walkAsync(t[a],(o,c)=>(c=Ht.dereference(c,o),o==="address"?kt(c,s):c))))}function nw(n){const e=async function(a){const o=await Ix(a,["data"]);o.to=await n.getAddress(),o.from&&(o.from=await kt(o.from,Ox(n.runner)));const c=n.interface,l=fe(o.value||M0,"overrides.value")===M0,d=(o.data||"0x")==="0x";c.fallback&&!c.fallback.payable&&c.receive&&!d&&!l&&w(!1,"cannot send data to receive or send value to non-payable fallback","overrides",a),w(c.fallback||d,"cannot send data to receive-only contract","overrides.data",o.data);const f=c.receive||c.fallback&&c.fallback.payable;return w(f||l,"cannot send value to non-payable fallback","overrides.value",o.value),w(c.fallback||d,"cannot send data to receive-only contract","overrides.data",o.data),o},t=async function(a){const o=Ai(n.runner,"call");F(Ax(o),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const c=await e(a);try{return await o.call(c)}catch(l){throw Wd(l)&&l.data?n.interface.makeError(l.data,c):l}},r=async function(a){const o=n.runner;F(Tx(o),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const c=await o.sendTransaction(await e(a)),l=Js(n.runner);return new xu(n.interface,l,c)},s=async function(a){const o=Ai(n.runner,"estimateGas");return F(Ex(o),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await o.estimateGas(await e(a))},i=async a=>await r(a);return me(i,{_contract:n,estimateGas:s,populateTransaction:e,send:r,staticCall:t}),i}function sw(n,e){const t=function(...l){const d=n.interface.getFunction(e,l);return F(d,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:l}}),d},r=async function(...l){const d=t(...l);let f={};if(d.inputs.length+1===l.length&&(f=await Ix(l.pop()),f.from&&(f.from=await kt(f.from,Ox(n.runner)))),d.inputs.length!==l.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const x=await rw(n.runner,d.inputs,l);return Object.assign({},f,await Xt({to:n.getAddress(),data:n.interface.encodeFunctionData(d,x)}))},s=async function(...l){const d=await o(...l);return d.length===1?d[0]:d},i=async function(...l){const d=n.runner;F(Tx(d),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const f=await d.sendTransaction(await r(...l)),x=Js(n.runner);return new xu(n.interface,x,f)},a=async function(...l){const d=Ai(n.runner,"estimateGas");return F(Ex(d),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await d.estimateGas(await r(...l))},o=async function(...l){const d=Ai(n.runner,"call");F(Ax(d),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const f=await r(...l);let x="0x";try{x=await d.call(f)}catch(b){throw Wd(b)&&b.data?n.interface.makeError(b.data,f):b}const g=t(...l);return n.interface.decodeFunctionResult(g,x)},c=async(...l)=>t(...l).constant?await s(...l):await i(...l);return me(c,{name:n.interface.getFunctionName(e),_contract:n,_key:e,getFragment:t,estimateGas:a,populateTransaction:r,send:i,staticCall:s,staticCallResult:o}),Object.defineProperty(c,"fragment",{configurable:!1,enumerable:!0,get:()=>{const l=n.interface.getFunction(e);return F(l,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),l}}),c}function iw(n,e){const t=function(...s){const i=n.interface.getEvent(e,s);return F(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:s}}),i},r=function(...s){return new tw(n,t(...s),s)};return me(r,{name:n.interface.getEventName(e),_contract:n,_key:e,getFragment:t}),Object.defineProperty(r,"fragment",{configurable:!1,enumerable:!0,get:()=>{const s=n.interface.getEvent(e);return F(s,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),s}}),r}const Jc=Symbol.for("_ethersInternal_contract"),Sx=new WeakMap;function aw(n,e){Sx.set(n[Jc],e)}function ar(n){return Sx.get(n[Jc])}function ow(n){return n&&typeof n=="object"&&"getTopicFilter"in n&&typeof n.getTopicFilter=="function"&&n.fragment}async function gu(n,e){let t,r=null;if(Array.isArray(e)){const i=function(a){if(je(a,32))return a;const o=n.interface.getEvent(a);return w(o,"unknown fragment","name",a),o.topicHash};t=e.map(a=>a==null?null:Array.isArray(a)?a.map(i):i(a))}else e==="*"?t=[null]:typeof e=="string"?je(e,32)?t=[e]:(r=n.interface.getEvent(e),w(r,"unknown fragment","event",e),t=[r.topicHash]):ow(e)?t=await e.getTopicFilter():"fragment"in e?(r=e.fragment,t=[r.topicHash]):w(!1,"unknown event name","event",e);t=t.map(i=>{if(i==null)return null;if(Array.isArray(i)){const a=Array.from(new Set(i.map(o=>o.toLowerCase())).values());return a.length===1?a[0]:(a.sort(),a)}return i.toLowerCase()});const s=t.map(i=>i==null?"null":Array.isArray(i)?i.join("|"):i).join("&");return{fragment:r,tag:s,topics:t}}async function go(n,e){const{subs:t}=ar(n);return t.get((await gu(n,e)).tag)||null}async function G0(n,e,t){const r=Js(n.runner);F(r,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:e});const{fragment:s,tag:i,topics:a}=await gu(n,t),{addr:o,subs:c}=ar(n);let l=c.get(i);if(!l){const f={address:o||n,topics:a},x=y=>{let v=s;if(v==null)try{v=n.interface.getEvent(y.topics[0])}catch{}if(v){const I=v,N=s?n.interface.decodeEventLog(s,y.data,y.topics):[];Sd(n,t,N,P=>new ew(n,P,t,I,y))}else Sd(n,t,[],I=>new vx(n,I,t,y))};let g=[];l={tag:i,listeners:[],start:()=>{g.length||g.push(r.on(f,x))},stop:async()=>{if(g.length==0)return;let y=g;g=[],await Promise.all(y),r.off(f,x)}},c.set(i,l)}return l}let Id=Promise.resolve();async function cw(n,e,t,r){await Id;const s=await go(n,e);if(!s)return!1;const i=s.listeners.length;return s.listeners=s.listeners.filter(({listener:a,once:o})=>{const c=Array.from(t);r&&c.push(r(o?null:a));try{a.call(n,...c)}catch{}return!o}),s.listeners.length===0&&(s.stop(),ar(n).subs.delete(s.tag)),i>0}async function Sd(n,e,t,r){try{await Id}catch{}const s=cw(n,e,t,r);return Id=s,await s}const mc=["then"];var cf;cf=Jc;const To=class To{constructor(e,t,r,s){E(this,"target");E(this,"interface");E(this,"runner");E(this,"filters");E(this,cf);E(this,"fallback");w(typeof e=="string"||Nh(e),"invalid value for Contract target","target",e),r==null&&(r=null);const i=Od.from(t);me(this,{target:e,runner:r,interface:i}),Object.defineProperty(this,Jc,{value:{}});let a,o=null,c=null;if(s){const f=Js(r);c=new xu(this.interface,f,s)}let l=new Map;if(typeof e=="string")if(je(e))o=e,a=Promise.resolve(e);else{const f=Ai(r,"resolveName");if(!Al(f))throw ut("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});a=f.resolveName(e).then(x=>{if(x==null)throw ut("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:e});return ar(this).addr=x,x})}else a=e.getAddress().then(f=>{if(f==null)throw new Error("TODO");return ar(this).addr=f,f});aw(this,{addrPromise:a,addr:o,deployTx:c,subs:l});const d=new Proxy({},{get:(f,x,g)=>{if(typeof x=="symbol"||mc.indexOf(x)>=0)return Reflect.get(f,x,g);try{return this.getEvent(x)}catch(b){if(!Bt(b,"INVALID_ARGUMENT")||b.argument!=="key")throw b}},has:(f,x)=>mc.indexOf(x)>=0?Reflect.has(f,x):Reflect.has(f,x)||this.interface.hasEvent(String(x))});return me(this,{filters:d}),me(this,{fallback:i.receive||i.fallback?nw(this):null}),new Proxy(this,{get:(f,x,g)=>{if(typeof x=="symbol"||x in f||mc.indexOf(x)>=0)return Reflect.get(f,x,g);try{return f.getFunction(x)}catch(b){if(!Bt(b,"INVALID_ARGUMENT")||b.argument!=="key")throw b}},has:(f,x)=>typeof x=="symbol"||x in f||mc.indexOf(x)>=0?Reflect.has(f,x):f.interface.hasFunction(x)})}connect(e){return new To(this.target,this.interface,e)}attach(e){return new To(e,this.interface,this.runner)}async getAddress(){return await ar(this).addrPromise}async getDeployedCode(){const e=Js(this.runner);F(e,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const t=await e.getCode(await this.getAddress());return t==="0x"?null:t}async waitForDeployment(){const e=this.deploymentTransaction();if(e)return await e.wait(),this;if(await this.getDeployedCode()!=null)return this;const r=Js(this.runner);return F(r!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((s,i)=>{const a=async()=>{try{if(await this.getDeployedCode()!=null)return s(this);r.once("block",a)}catch(o){i(o)}};a()})}deploymentTransaction(){return ar(this).deployTx}getFunction(e){return typeof e!="string"&&(e=e.format()),sw(this,e)}getEvent(e){return typeof e!="string"&&(e=e.format()),iw(this,e)}async queryTransaction(e){throw new Error("@TODO")}async queryFilter(e,t,r){t==null&&(t=0),r==null&&(r="latest");const{addr:s,addrPromise:i}=ar(this),a=s||await i,{fragment:o,topics:c}=await gu(this,e),l={address:a,topics:c,fromBlock:t,toBlock:r},d=Js(this.runner);return F(d,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await d.getLogs(l)).map(f=>{let x=o;if(x==null)try{x=this.interface.getEvent(f.topics[0])}catch{}if(x)try{return new hu(f,this.interface,x)}catch(g){return new wx(f,g)}return new rc(f,d)})}async on(e,t){const r=await G0(this,"on",e);return r.listeners.push({listener:t,once:!1}),r.start(),this}async once(e,t){const r=await G0(this,"once",e);return r.listeners.push({listener:t,once:!0}),r.start(),this}async emit(e,...t){return await Sd(this,e,t,null)}async listenerCount(e){if(e){const s=await go(this,e);return s?s.listeners.length:0}const{subs:t}=ar(this);let r=0;for(const{listeners:s}of t.values())r+=s.length;return r}async listeners(e){if(e){const s=await go(this,e);return s?s.listeners.map(({listener:i})=>i):[]}const{subs:t}=ar(this);let r=[];for(const{listeners:s}of t.values())r=r.concat(s.map(({listener:i})=>i));return r}async off(e,t){const r=await go(this,e);if(!r)return this;if(t){const s=r.listeners.map(({listener:i})=>i).indexOf(t);s>=0&&r.listeners.splice(s,1)}return(t==null||r.listeners.length===0)&&(r.stop(),ar(this).subs.delete(r.tag)),this}async removeAllListeners(e){if(e){const t=await go(this,e);if(!t)return this;t.stop(),ar(this).subs.delete(t.tag)}else{const{subs:t}=ar(this);for(const{tag:r,stop:s}of t.values())s(),t.delete(r)}return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return await this.off(e,t)}static buildClass(e){class t extends To{constructor(s,i=null){super(s,e,i)}}return t}static from(e,t,r){return r==null&&(r=null),new this(e,t,r)}};let kd=To;function lw(){return kd}class Ur extends lw(){}function zl(n){return n.match(/^ipfs:\/\/ipfs\//i)?n=n.substring(12):n.match(/^ipfs:\/\//i)?n=n.substring(7):w(!1,"unsupported IPFS format","link",n),`https://gateway.ipfs.io/ipfs/${n}`}class dw{constructor(e){E(this,"name");me(this,{name:e})}connect(e){return this}supportsCoinType(e){return!1}async encodeAddress(e,t){throw new Error("unsupported coin")}async decodeAddress(e,t){throw new Error("unsupported coin")}}const kx=new RegExp("^(ipfs)://(.*)$","i"),X0=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),kx,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];var us,ai,fs,Li,sl,Px;const Hi=class Hi{constructor(e,t,r){k(this,fs);E(this,"provider");E(this,"address");E(this,"name");k(this,us);k(this,ai);me(this,{provider:e,address:t,name:r}),m(this,us,null),m(this,ai,new Ur(t,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],e))}async supportsWildcard(){return h(this,us)==null&&m(this,us,(async()=>{try{return await h(this,ai).supportsInterface("0x9061b923")}catch(e){if(Bt(e,"CALL_EXCEPTION"))return!1;throw m(this,us,null),e}})()),await h(this,us)}async getAddress(e){if(e==null&&(e=60),e===60)try{const i=await X(this,fs,Li).call(this,"addr(bytes32)");return i==null||i===za?null:i}catch(i){if(Bt(i,"CALL_EXCEPTION"))return null;throw i}if(e>=0&&e<2147483648){let i=e+2147483648;const a=await X(this,fs,Li).call(this,"addr(bytes32,uint)",[i]);if(je(a,20))return ze(a)}let t=null;for(const i of this.provider.plugins)if(i instanceof dw&&i.supportsCoinType(e)){t=i;break}if(t==null)return null;const r=await X(this,fs,Li).call(this,"addr(bytes32,uint)",[e]);if(r==null||r==="0x")return null;const s=await t.decodeAddress(e,r);if(s!=null)return s;F(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${e})`,info:{coinType:e,data:r}})}async getText(e){const t=await X(this,fs,Li).call(this,"text(bytes32,string)",[e]);return t==null||t==="0x"?null:t}async getContentHash(){const e=await X(this,fs,Li).call(this,"contenthash(bytes32)");if(e==null||e==="0x")return null;const t=e.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(t){const s=t[1]==="e3010170"?"ipfs":"ipns",i=parseInt(t[4],16);if(t[5].length===i*2)return`${s}://${Ef("0x"+t[2])}`}const r=e.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(r&&r[1].length===64)return`bzz://${r[1]}`;F(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:e}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const e=[{type:"name",value:this.name}];try{const t=await this.getText("avatar");if(t==null)return e.push({type:"!avatar",value:""}),{url:null,linkage:e};e.push({type:"avatar",value:t});for(let r=0;r<X0.length;r++){const s=t.match(X0[r]);if(s==null)continue;const i=s[1].toLowerCase();switch(i){case"https":case"data":return e.push({type:"url",value:t}),{linkage:e,url:t};case"ipfs":{const a=zl(t);return e.push({type:"ipfs",value:t}),e.push({type:"url",value:a}),{linkage:e,url:a}}case"erc721":case"erc1155":{const a=i==="erc721"?"tokenURI(uint256)":"uri(uint256)";e.push({type:i,value:t});const o=await this.getAddress();if(o==null)return e.push({type:"!owner",value:""}),{url:null,linkage:e};const c=(s[2]||"").split("/");if(c.length!==2)return e.push({type:`!${i}caip`,value:s[2]||""}),{url:null,linkage:e};const l=c[1],d=new Ur(c[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(i==="erc721"){const p=await d.ownerOf(l);if(o!==p)return e.push({type:"!owner",value:p}),{url:null,linkage:e};e.push({type:"owner",value:p})}else if(i==="erc1155"){const p=await d.balanceOf(o,l);if(!p)return e.push({type:"!balance",value:"0"}),{url:null,linkage:e};e.push({type:"balance",value:p.toString()})}let f=await d[a](l);if(f==null||f==="0x")return e.push({type:"!metadata-url",value:""}),{url:null,linkage:e};e.push({type:"metadata-url-base",value:f}),i==="erc1155"&&(f=f.replace("{id}",$n(l,32).substring(2)),e.push({type:"metadata-url-expanded",value:f})),f.match(/^ipfs:/i)&&(f=zl(f)),e.push({type:"metadata-url",value:f});let x={};const g=await new Ts(f).send();g.assertOk();try{x=g.bodyJson}catch{try{e.push({type:"!metadata",value:g.bodyText})}catch{const v=g.body;return v&&e.push({type:"!metadata",value:V(v)}),{url:null,linkage:e}}return{url:null,linkage:e}}if(!x)return e.push({type:"!metadata",value:""}),{url:null,linkage:e};e.push({type:"metadata",value:JSON.stringify(x)});let b=x.image;if(typeof b!="string")return e.push({type:"!imageUrl",value:""}),{url:null,linkage:e};if(!b.match(/^(https:\/\/|data:)/i)){if(b.match(kx)==null)return e.push({type:"!imageUrl-ipfs",value:b}),{url:null,linkage:e};e.push({type:"imageUrl-ipfs",value:b}),b=zl(b)}return e.push({type:"url",value:b}),{linkage:e,url:b}}}}}catch{}return{linkage:e,url:null}}static async getEnsAddress(e){const t=await e.getNetwork(),r=t.getPlugin("org.ethers.plugins.network.Ens");return F(r,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:t}}),r.address}static async fromName(e,t){var s;let r=t;for(;;){if(r===""||r==="."||t!=="eth"&&r==="eth")return null;const i=await X(s=Hi,sl,Px).call(s,e,r);if(i!=null){const a=new Hi(e,i,t);return r!==t&&!await a.supportsWildcard()?null:a}r=r.split(".").slice(1).join(".")}}};us=new WeakMap,ai=new WeakMap,fs=new WeakSet,Li=async function(e,t){t=(t||[]).slice();const r=h(this,ai).interface;t.unshift(Ed(this.name));let s=null;await this.supportsWildcard()&&(s=r.getFunction(e),F(s,"missing fragment","UNKNOWN_ERROR",{info:{funcName:e}}),t=[wy(this.name,255),r.encodeFunctionData(s,t)],e="resolve(bytes,bytes)"),t.push({enableCcipRead:!0});try{const i=await h(this,ai)[e](...t);return s?r.decodeFunctionResult(s,i)[0]:i}catch(i){if(!Bt(i,"CALL_EXCEPTION"))throw i}return null},sl=new WeakSet,Px=async function(e,t){const r=await Hi.getEnsAddress(e);try{const i=await new Ur(r,["function resolver(bytes32) view returns (address)"],e).resolver(Ed(t),{enableCcipRead:!0});return i===za?null:i}catch(s){throw s}return null},k(Hi,sl);let Qc=Hi;const H0=BigInt(0);function Qe(n,e){return function(t){return t==null?e:n(t)}}function Ro(n,e){return t=>{if(e&&t==null)return null;if(!Array.isArray(t))throw new Error("not an array");return t.map(r=>n(r))}}function nc(n,e){return t=>{const r={};for(const s in n){let i=s;if(e&&s in e&&!(i in t)){for(const a of e[s])if(a in t){i=a;break}}try{const a=n[s](t[i]);a!==void 0&&(r[s]=a)}catch(a){const o=a instanceof Error?a.message:"not-an-error";F(!1,`invalid value for value.${s} (${o})`,"BAD_DATA",{value:t})}}return r}}function uw(n){switch(n){case!0:case"true":return!0;case!1:case"false":return!1}w(!1,`invalid boolean; ${JSON.stringify(n)}`,"value",n)}function Ja(n){return w(je(n,!0),"invalid data","value",n),n}function Ct(n){return w(je(n,32),"invalid hash","value",n),n}const fw=nc({address:ze,blockHash:Ct,blockNumber:_e,data:Ja,index:_e,removed:Qe(uw,!1),topics:Ro(Ct),transactionHash:Ct,transactionIndex:_e},{index:["logIndex"]});function hw(n){return fw(n)}const xw=nc({hash:Qe(Ct),parentHash:Ct,parentBeaconBlockRoot:Qe(Ct,null),number:_e,timestamp:_e,nonce:Qe(Ja),difficulty:fe,gasLimit:fe,gasUsed:fe,stateRoot:Qe(Ct,null),receiptsRoot:Qe(Ct,null),blobGasUsed:Qe(fe,null),excessBlobGas:Qe(fe,null),miner:Qe(ze),prevRandao:Qe(Ct,null),extraData:Ja,baseFeePerGas:Qe(fe)},{prevRandao:["mixHash"]});function gw(n){const e=xw(n);return e.transactions=n.transactions.map(t=>typeof t=="string"?t:Ux(t)),e}const pw=nc({transactionIndex:_e,blockNumber:_e,transactionHash:Ct,address:ze,topics:Ro(Ct),data:Ja,index:_e,blockHash:Ct},{index:["logIndex"]});function bw(n){return pw(n)}const mw=nc({to:Qe(ze,null),from:Qe(ze,null),contractAddress:Qe(ze,null),index:_e,root:Qe(V),gasUsed:fe,blobGasUsed:Qe(fe,null),logsBloom:Qe(Ja),blockHash:Ct,hash:Ct,logs:Ro(bw),blockNumber:_e,cumulativeGasUsed:fe,effectiveGasPrice:Qe(fe),blobGasPrice:Qe(fe,null),status:Qe(_e),type:Qe(_e,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function yw(n){return mw(n)}function Ux(n){n.to&&fe(n.to)===H0&&(n.to="0x0000000000000000000000000000000000000000");const e=nc({hash:Ct,index:Qe(_e,void 0),type:t=>t==="0x"||t==null?0:_e(t),accessList:Qe(Oi,null),blobVersionedHashes:Qe(Ro(Ct,!0),null),authorizationList:Qe(Ro(t=>{let r;if(t.signature)r=t.signature;else{let s=t.yParity;s==="0x1b"?s=0:s==="0x1c"&&(s=1),r=Object.assign({},t,{yParity:s})}return{address:ze(t.address),chainId:fe(t.chainId),nonce:fe(t.nonce),signature:jt.from(r)}},!1),null),blockHash:Qe(Ct,null),blockNumber:Qe(_e,null),transactionIndex:Qe(_e,null),from:ze,gasPrice:Qe(fe),maxPriorityFeePerGas:Qe(fe),maxFeePerGas:Qe(fe),maxFeePerBlobGas:Qe(fe,null),gasLimit:fe,to:Qe(ze,null),value:fe,nonce:_e,data:Ja,creates:Qe(ze,null),chainId:Qe(fe,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(n);if(e.to==null&&e.creates==null&&(e.creates=rm(e)),(n.type===1||n.type===2)&&n.accessList==null&&(e.accessList=[]),n.signature?e.signature=jt.from(n.signature):e.signature=jt.from(n),e.chainId==null){const t=e.signature.legacyChainId;t!=null&&(e.chainId=t)}return e.blockHash&&fe(e.blockHash)===H0&&(e.blockHash=null),e}const ww="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";class sc{constructor(e){E(this,"name");me(this,{name:e})}clone(){return new sc(this.name)}}class El extends sc{constructor(t,r){t==null&&(t=0);super(`org.ethers.network.plugins.GasCost#${t||0}`);E(this,"effectiveBlock");E(this,"txBase");E(this,"txCreate");E(this,"txDataZero");E(this,"txDataNonzero");E(this,"txAccessListStorageKey");E(this,"txAccessListAddress");const s={effectiveBlock:t};function i(a,o){let c=(r||{})[a];c==null&&(c=o),w(typeof c=="number",`invalud value for ${a}`,"costs",r),s[a]=c}i("txBase",21e3),i("txCreate",32e3),i("txDataZero",4),i("txDataNonzero",16),i("txAccessListStorageKey",1900),i("txAccessListAddress",2400),me(this,s)}clone(){return new El(this.effectiveBlock,this)}}class Tl extends sc{constructor(t,r){super("org.ethers.plugins.network.Ens");E(this,"address");E(this,"targetNetwork");me(this,{address:t||ww,targetNetwork:r??1})}clone(){return new Tl(this.address,this.targetNetwork)}}var Ko,Vo;class vw extends sc{constructor(t,r){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin");k(this,Ko);k(this,Vo);m(this,Ko,t),m(this,Vo,r)}get url(){return h(this,Ko)}get processFunc(){return h(this,Vo)}clone(){return this}}Ko=new WeakMap,Vo=new WeakMap;const $l=new Map;var wa,va,hs;const zi=class zi{constructor(e,t){k(this,wa);k(this,va);k(this,hs);m(this,wa,e),m(this,va,fe(t)),m(this,hs,new Map)}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return h(this,wa)}set name(e){m(this,wa,e)}get chainId(){return h(this,va)}set chainId(e){m(this,va,fe(e,"chainId"))}matches(e){if(e==null)return!1;if(typeof e=="string"){try{return this.chainId===fe(e)}catch{}return this.name===e}if(typeof e=="number"||typeof e=="bigint"){try{return this.chainId===fe(e)}catch{}return!1}if(typeof e=="object"){if(e.chainId!=null){try{return this.chainId===fe(e.chainId)}catch{}return!1}return e.name!=null?this.name===e.name:!1}return!1}get plugins(){return Array.from(h(this,hs).values())}attachPlugin(e){if(h(this,hs).get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return h(this,hs).set(e.name,e.clone()),this}getPlugin(e){return h(this,hs).get(e)||null}getPlugins(e){return this.plugins.filter(t=>t.name.split("#")[0]===e)}clone(){const e=new zi(this.name,this.chainId);return this.plugins.forEach(t=>{e.attachPlugin(t.clone())}),e}computeIntrinsicGas(e){const t=this.getPlugin("org.ethers.plugins.network.GasCost")||new El;let r=t.txBase;if(e.to==null&&(r+=t.txCreate),e.data)for(let s=2;s<e.data.length;s+=2)e.data.substring(s,s+2)==="00"?r+=t.txDataZero:r+=t.txDataNonzero;if(e.accessList){const s=Oi(e.accessList);for(const i in s)r+=t.txAccessListAddress+t.txAccessListStorageKey*s[i].storageKeys.length}return r}static from(e){if(Aw(),e==null)return zi.from("mainnet");if(typeof e=="number"&&(e=BigInt(e)),typeof e=="string"||typeof e=="bigint"){const t=$l.get(e);if(t)return t();if(typeof e=="bigint")return new zi("unknown",e);w(!1,"unknown network","network",e)}if(typeof e.clone=="function")return e.clone();if(typeof e=="object"){w(typeof e.name=="string"&&typeof e.chainId=="number","invalid network object name or chainId","network",e);const t=new zi(e.name,e.chainId);return(e.ensAddress||e.ensNetwork!=null)&&t.attachPlugin(new Tl(e.ensAddress,e.ensNetwork)),t}w(!1,"invalid network","network",e)}static register(e,t){typeof e=="number"&&(e=BigInt(e));const r=$l.get(e);r&&w(!1,`conflicting network for ${JSON.stringify(r.name)}`,"nameOrChainId",e),$l.set(e,t)}};wa=new WeakMap,va=new WeakMap,hs=new WeakMap;let xn=zi;function z0(n,e){const t=String(n);if(!t.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${n}`);const r=t.split(".");if(r.length===1&&r.push(""),r.length!==2)throw new Error(`invalid gwei value: ${n}`);for(;r[1].length<e;)r[1]+="0";if(r[1].length>9){let s=BigInt(r[1].substring(0,9));r[1].substring(9).match(/^0+$/)||s++,r[1]=s.toString()}return BigInt(r[0]+r[1])}function $0(n){return new vw(n,async(e,t,r)=>{r.setHeader("User-Agent","ethers");let s;try{const[i,a]=await Promise.all([r.send(),e()]);s=i;const o=s.bodyJson.standard;return{gasPrice:a.gasPrice,maxFeePerGas:z0(o.maxFee,9),maxPriorityFeePerGas:z0(o.maxPriorityFee,9)}}catch(i){F(!1,`error encountered with polygon gas station (${JSON.stringify(r.url)})`,"SERVER_ERROR",{request:r,response:s,error:i})}})}let K0=!1;function Aw(){if(K0)return;K0=!0;function n(e,t,r){const s=function(){const i=new xn(e,t);return r.ensNetwork!=null&&i.attachPlugin(new Tl(null,r.ensNetwork)),i.attachPlugin(new El),(r.plugins||[]).forEach(a=>{i.attachPlugin(a)}),i};xn.register(e,s),xn.register(t,s),r.altNames&&r.altNames.forEach(i=>{xn.register(i,s)})}n("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),n("ropsten",3,{ensNetwork:3}),n("rinkeby",4,{ensNetwork:4}),n("goerli",5,{ensNetwork:5}),n("kovan",42,{ensNetwork:42}),n("sepolia",11155111,{ensNetwork:11155111}),n("holesky",17e3,{ensNetwork:17e3}),n("classic",61,{}),n("classicKotti",6,{}),n("arbitrum",42161,{ensNetwork:1}),n("arbitrum-goerli",421613,{}),n("arbitrum-sepolia",421614,{}),n("base",8453,{ensNetwork:1}),n("base-goerli",84531,{}),n("base-sepolia",84532,{}),n("bnb",56,{ensNetwork:1}),n("bnbt",97,{}),n("linea",59144,{ensNetwork:1}),n("linea-goerli",59140,{}),n("linea-sepolia",59141,{}),n("matic",137,{ensNetwork:1,plugins:[$0("https://gasstation.polygon.technology/v2")]}),n("matic-amoy",80002,{}),n("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[$0("https://gasstation-testnet.polygon.technology/v2")]}),n("optimism",10,{ensNetwork:1,plugins:[]}),n("optimism-goerli",420,{}),n("optimism-sepolia",11155420,{}),n("xdai",100,{ensNetwork:1})}function Pd(n){return JSON.parse(JSON.stringify(n))}var Nn,Ar,xs,cn,Aa,Nc;class Ew{constructor(e){k(this,Aa);k(this,Nn);k(this,Ar);k(this,xs);k(this,cn);m(this,Nn,e),m(this,Ar,null),m(this,xs,4e3),m(this,cn,-2)}get pollingInterval(){return h(this,xs)}set pollingInterval(e){m(this,xs,e)}start(){h(this,Ar)||(m(this,Ar,h(this,Nn)._setTimeout(X(this,Aa,Nc).bind(this),h(this,xs))),X(this,Aa,Nc).call(this))}stop(){h(this,Ar)&&(h(this,Nn)._clearTimeout(h(this,Ar)),m(this,Ar,null))}pause(e){this.stop(),e&&m(this,cn,-2)}resume(){this.start()}}Nn=new WeakMap,Ar=new WeakMap,xs=new WeakMap,cn=new WeakMap,Aa=new WeakSet,Nc=async function(){try{const e=await h(this,Nn).getBlockNumber();if(h(this,cn)===-2){m(this,cn,e);return}if(e!==h(this,cn)){for(let t=h(this,cn)+1;t<=e;t++){if(h(this,Ar)==null)return;await h(this,Nn).emit("block",t)}m(this,cn,e)}}catch{}h(this,Ar)!=null&&m(this,Ar,h(this,Nn)._setTimeout(X(this,Aa,Nc).bind(this),h(this,xs)))};var oi,ci,gs;class pu{constructor(e){k(this,oi);k(this,ci);k(this,gs);m(this,oi,e),m(this,gs,!1),m(this,ci,t=>{this._poll(t,h(this,oi))})}async _poll(e,t){throw new Error("sub-classes must override this")}start(){h(this,gs)||(m(this,gs,!0),h(this,ci).call(this,-2),h(this,oi).on("block",h(this,ci)))}stop(){h(this,gs)&&(m(this,gs,!1),h(this,oi).off("block",h(this,ci)))}pause(e){this.stop()}resume(){this.start()}}oi=new WeakMap,ci=new WeakMap,gs=new WeakMap;var Ea,Cn;class Tw extends pu{constructor(t,r){super(t);k(this,Ea);k(this,Cn);m(this,Ea,r),m(this,Cn,-2)}pause(t){t&&m(this,Cn,-2),super.pause(t)}async _poll(t,r){const s=await r.getBlock(h(this,Ea));s!=null&&(h(this,Cn)===-2?m(this,Cn,s.number):s.number>h(this,Cn)&&(r.emit(h(this,Ea),s.number),m(this,Cn,s.number)))}}Ea=new WeakMap,Cn=new WeakMap;var il;class Ow extends pu{constructor(t,r){super(t);k(this,il);m(this,il,Pd(r))}async _poll(t,r){throw new Error("@TODO")}}il=new WeakMap;var Ta;class Iw extends pu{constructor(t,r){super(t);k(this,Ta);m(this,Ta,r)}async _poll(t,r){const s=await r.getTransactionReceipt(h(this,Ta));s&&r.emit(h(this,Ta),s)}}Ta=new WeakMap;var Bn,Oa,Ia,ps,Er,al,Nx;class bu{constructor(e,t){k(this,al);k(this,Bn);k(this,Oa);k(this,Ia);k(this,ps);k(this,Er);m(this,Bn,e),m(this,Oa,Pd(t)),m(this,Ia,X(this,al,Nx).bind(this)),m(this,ps,!1),m(this,Er,-2)}start(){h(this,ps)||(m(this,ps,!0),h(this,Er)===-2&&h(this,Bn).getBlockNumber().then(e=>{m(this,Er,e)}),h(this,Bn).on("block",h(this,Ia)))}stop(){h(this,ps)&&(m(this,ps,!1),h(this,Bn).off("block",h(this,Ia)))}pause(e){this.stop(),e&&m(this,Er,-2)}resume(){this.start()}}Bn=new WeakMap,Oa=new WeakMap,Ia=new WeakMap,ps=new WeakMap,Er=new WeakMap,al=new WeakSet,Nx=async function(e){if(h(this,Er)===-2)return;const t=Pd(h(this,Oa));t.fromBlock=h(this,Er)+1,t.toBlock=e;const r=await h(this,Bn).getLogs(t);if(r.length===0){h(this,Er)<e-60&&m(this,Er,e-60);return}for(const s of r)h(this,Bn).emit(h(this,Oa),s),m(this,Er,s.blockNumber)};const Sw=BigInt(2),kw=10;function yc(n){return n&&typeof n.then=="function"}function Cc(n,e){return n+":"+JSON.stringify(e,(t,r)=>{if(r==null)return"null";if(typeof r=="bigint")return`bigint:${r.toString()}`;if(typeof r=="string")return r.toLowerCase();if(typeof r=="object"&&!Array.isArray(r)){const s=Object.keys(r);return s.sort(),s.reduce((i,a)=>(i[a]=r[a],i),{})}return r})}class Cx{constructor(e){E(this,"name");me(this,{name:e})}start(){}stop(){}pause(e){}resume(){}}function Pw(n){return JSON.parse(JSON.stringify(n))}function Ud(n){return n=Array.from(new Set(n).values()),n.sort(),n}async function Kl(n,e){if(n==null)throw new Error("invalid event");if(Array.isArray(n)&&(n={topics:n}),typeof n=="string")switch(n){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:n,tag:n}}if(je(n,32)){const t=n.toLowerCase();return{type:"transaction",tag:Cc("tx",{hash:t}),hash:t}}if(n.orphan){const t=n;return{type:"orphan",tag:Cc("orphan",t),filter:Pw(t)}}if(n.address||n.topics){const t=n,r={topics:(t.topics||[]).map(s=>s==null?null:Array.isArray(s)?Ud(s.map(i=>i.toLowerCase())):s.toLowerCase())};if(t.address){const s=[],i=[],a=o=>{je(o)?s.push(o):i.push((async()=>{s.push(await kt(o,e))})())};Array.isArray(t.address)?t.address.forEach(a):a(t.address),i.length&&await Promise.all(i),r.address=Ud(s.map(o=>o.toLowerCase()))}return{filter:r,tag:Cc("event",r),type:"event"}}w(!1,"unknown ProviderEvent","event",n)}function Vl(){return new Date().getTime()}const Uw={cacheTimeout:250,pollingInterval:4e3};var Mt,bs,Gt,Sa,dr,li,ms,_n,Jo,Tr,ka,Pa,Xe,sr,Nd,Cd,po,Bd,bo,Bc;class Nw{constructor(e,t){k(this,Xe);k(this,Mt);k(this,bs);k(this,Gt);k(this,Sa);k(this,dr);k(this,li);k(this,ms);k(this,_n);k(this,Jo);k(this,Tr);k(this,ka);k(this,Pa);if(m(this,Pa,Object.assign({},Uw,t||{})),e==="any")m(this,li,!0),m(this,dr,null);else if(e){const r=xn.from(e);m(this,li,!1),m(this,dr,Promise.resolve(r)),setTimeout(()=>{this.emit("network",r,null)},0)}else m(this,li,!1),m(this,dr,null);m(this,_n,-1),m(this,ms,new Map),m(this,Mt,new Map),m(this,bs,new Map),m(this,Gt,null),m(this,Sa,!1),m(this,Jo,1),m(this,Tr,new Map),m(this,ka,!1)}get pollingInterval(){return h(this,Pa).pollingInterval}get provider(){return this}get plugins(){return Array.from(h(this,bs).values())}attachPlugin(e){if(h(this,bs).get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return h(this,bs).set(e.name,e.connect(this)),this}getPlugin(e){return h(this,bs).get(e)||null}get disableCcipRead(){return h(this,ka)}set disableCcipRead(e){m(this,ka,!!e)}async ccipReadFetch(e,t,r){if(this.disableCcipRead||r.length===0||e.to==null)return null;const s=e.to.toLowerCase(),i=t.toLowerCase(),a=[];for(let o=0;o<r.length;o++){const c=r[o],l=c.replace("{sender}",s).replace("{data}",i),d=new Ts(l);c.indexOf("{data}")===-1&&(d.body={data:i,sender:s}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:d,index:o,urls:r});let f="unknown error",x;try{x=await d.send()}catch(g){a.push(g.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:d,result:{error:g}});continue}try{const g=x.bodyJson;if(g.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:d,result:g}),g.data;g.message&&(f=g.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:d,result:g})}catch{}F(x.statusCode<400||x.statusCode>=500,`response not found during CCIP fetch: ${f}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:e,info:{url:c,errorMessage:f}}),a.push(f)}F(!1,`error encountered during CCIP fetch: ${a.map(o=>JSON.stringify(o)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:e,info:{urls:r,errorMessages:a}})}_wrapBlock(e,t){return new jy(gw(e),this)}_wrapLog(e,t){return new rc(hw(e),this)}_wrapTransactionReceipt(e,t){return new bx(yw(e),this)}_wrapTransactionResponse(e,t){return new _o(Ux(e),this)}_detectNetwork(){F(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(e){F(!1,`unsupported method: ${e.method}`,"UNSUPPORTED_OPERATION",{operation:e.method,info:e})}async getBlockNumber(){const e=_e(await X(this,Xe,sr).call(this,{method:"getBlockNumber"}),"%response");return h(this,_n)>=0&&m(this,_n,e),e}_getAddress(e){return kt(e,this)}_getBlockTag(e){if(e==null)return"latest";switch(e){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return e}if(je(e))return je(e,32)?e:zr(e);if(typeof e=="bigint"&&(e=_e(e,"blockTag")),typeof e=="number")return e>=0?zr(e):h(this,_n)>=0?zr(h(this,_n)+e):this.getBlockNumber().then(t=>zr(t+e));w(!1,"invalid blockTag","blockTag",e)}_getFilter(e){const t=(e.topics||[]).map(c=>c==null?null:Array.isArray(c)?Ud(c.map(l=>l.toLowerCase())):c.toLowerCase()),r="blockHash"in e?e.blockHash:void 0,s=(c,l,d)=>{let f;switch(c.length){case 0:break;case 1:f=c[0];break;default:c.sort(),f=c}if(r&&(l!=null||d!=null))throw new Error("invalid filter");const x={};return f&&(x.address=f),t.length&&(x.topics=t),l&&(x.fromBlock=l),d&&(x.toBlock=d),r&&(x.blockHash=r),x};let i=[];if(e.address)if(Array.isArray(e.address))for(const c of e.address)i.push(this._getAddress(c));else i.push(this._getAddress(e.address));let a;"fromBlock"in e&&(a=this._getBlockTag(e.fromBlock));let o;return"toBlock"in e&&(o=this._getBlockTag(e.toBlock)),i.filter(c=>typeof c!="string").length||a!=null&&typeof a!="string"||o!=null&&typeof o!="string"?Promise.all([Promise.all(i),a,o]).then(c=>s(c[0],c[1],c[2])):s(i,a,o)}_getTransactionRequest(e){const t=Bo(e),r=[];if(["to","from"].forEach(s=>{if(t[s]==null)return;const i=kt(t[s],this);yc(i)?r.push(async function(){t[s]=await i}()):t[s]=i}),t.blockTag!=null){const s=this._getBlockTag(t.blockTag);yc(s)?r.push(async function(){t.blockTag=await s}()):t.blockTag=s}return r.length?async function(){return await Promise.all(r),t}():t}async getNetwork(){if(h(this,dr)==null){const s=(async()=>{try{const i=await this._detectNetwork();return this.emit("network",i,null),i}catch(i){throw h(this,dr)===s&&m(this,dr,null),i}})();return m(this,dr,s),(await s).clone()}const e=h(this,dr),[t,r]=await Promise.all([e,this._detectNetwork()]);return t.chainId!==r.chainId&&(h(this,li)?(this.emit("network",r,t),h(this,dr)===e&&m(this,dr,Promise.resolve(r))):F(!1,`network changed: ${t.chainId} => ${r.chainId} `,"NETWORK_ERROR",{event:"changed"})),t.clone()}async getFeeData(){const e=await this.getNetwork(),t=async()=>{const{_block:s,gasPrice:i,priorityFee:a}=await Xt({_block:X(this,Xe,Bd).call(this,"latest",!1),gasPrice:(async()=>{try{const d=await X(this,Xe,sr).call(this,{method:"getGasPrice"});return fe(d,"%response")}catch{}return null})(),priorityFee:(async()=>{try{const d=await X(this,Xe,sr).call(this,{method:"getPriorityFee"});return fe(d,"%response")}catch{}return null})()});let o=null,c=null;const l=this._wrapBlock(s,e);return l&&l.baseFeePerGas&&(c=a??BigInt("1000000000"),o=l.baseFeePerGas*Sw+c),new F0(i,o,c)},r=e.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(r){const s=new Ts(r.url),i=await r.processFunc(t,this,s);return new F0(i.gasPrice,i.maxFeePerGas,i.maxPriorityFeePerGas)}return await t()}async estimateGas(e){let t=this._getTransactionRequest(e);return yc(t)&&(t=await t),fe(await X(this,Xe,sr).call(this,{method:"estimateGas",transaction:t}),"%response")}async call(e){const{tx:t,blockTag:r}=await Xt({tx:this._getTransactionRequest(e),blockTag:this._getBlockTag(e.blockTag)});return await X(this,Xe,Cd).call(this,X(this,Xe,Nd).call(this,t,r,e.enableCcipRead?0:-1))}async getBalance(e,t){return fe(await X(this,Xe,po).call(this,{method:"getBalance"},e,t),"%response")}async getTransactionCount(e,t){return _e(await X(this,Xe,po).call(this,{method:"getTransactionCount"},e,t),"%response")}async getCode(e,t){return V(await X(this,Xe,po).call(this,{method:"getCode"},e,t))}async getStorage(e,t,r){const s=fe(t,"position");return V(await X(this,Xe,po).call(this,{method:"getStorage",position:s},e,r))}async broadcastTransaction(e){const{blockNumber:t,hash:r,network:s}=await Xt({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:e}),network:this.getNetwork()}),i=Io.from(e);if(i.hash!==r)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(i,s).replaceableTransaction(t)}async getBlock(e,t){const{network:r,params:s}=await Xt({network:this.getNetwork(),params:X(this,Xe,Bd).call(this,e,!!t)});return s==null?null:this._wrapBlock(s,r)}async getTransaction(e){const{network:t,params:r}=await Xt({network:this.getNetwork(),params:X(this,Xe,sr).call(this,{method:"getTransaction",hash:e})});return r==null?null:this._wrapTransactionResponse(r,t)}async getTransactionReceipt(e){const{network:t,params:r}=await Xt({network:this.getNetwork(),params:X(this,Xe,sr).call(this,{method:"getTransactionReceipt",hash:e})});if(r==null)return null;if(r.gasPrice==null&&r.effectiveGasPrice==null){const s=await X(this,Xe,sr).call(this,{method:"getTransaction",hash:e});if(s==null)throw new Error("report this; could not find tx or effectiveGasPrice");r.effectiveGasPrice=s.gasPrice}return this._wrapTransactionReceipt(r,t)}async getTransactionResult(e){const{result:t}=await Xt({network:this.getNetwork(),result:X(this,Xe,sr).call(this,{method:"getTransactionResult",hash:e})});return t==null?null:V(t)}async getLogs(e){let t=this._getFilter(e);yc(t)&&(t=await t);const{network:r,params:s}=await Xt({network:this.getNetwork(),params:X(this,Xe,sr).call(this,{method:"getLogs",filter:t})});return s.map(i=>this._wrapLog(i,r))}_getProvider(e){F(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(e){return await Qc.fromName(this,e)}async getAvatar(e){const t=await this.getResolver(e);return t?await t.getAvatar():null}async resolveName(e){const t=await this.getResolver(e);return t?await t.getAddress():null}async lookupAddress(e){e=ze(e);const t=Ed(e.substring(2).toLowerCase()+".addr.reverse");try{const r=await Qc.getEnsAddress(this),i=await new Ur(r,["function resolver(bytes32) view returns (address)"],this).resolver(t);if(i==null||i===za)return null;const o=await new Ur(i,["function name(bytes32) view returns (string)"],this).name(t);return await this.resolveName(o)!==e?null:o}catch(r){if(Bt(r,"BAD_DATA")&&r.value==="0x"||Bt(r,"CALL_EXCEPTION"))return null;throw r}return null}async waitForTransaction(e,t,r){const s=t??1;return s===0?this.getTransactionReceipt(e):new Promise(async(i,a)=>{let o=null;const c=async l=>{try{const d=await this.getTransactionReceipt(e);if(d!=null&&l-d.blockNumber+1>=s){i(d),o&&(clearTimeout(o),o=null);return}}catch(d){console.log("EEE",d)}this.once("block",c)};r!=null&&(o=setTimeout(()=>{o!=null&&(o=null,this.off("block",c),a(ut("timeout","TIMEOUT",{reason:"timeout"})))},r)),c(await this.getBlockNumber())})}async waitForBlock(e){F(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(e){const t=h(this,Tr).get(e);t&&(t.timer&&clearTimeout(t.timer),h(this,Tr).delete(e))}_setTimeout(e,t){t==null&&(t=0);const r=ao(this,Jo)._++,s=()=>{h(this,Tr).delete(r),e()};if(this.paused)h(this,Tr).set(r,{timer:null,func:s,time:t});else{const i=setTimeout(s,t);h(this,Tr).set(r,{timer:i,func:s,time:Vl()})}return r}_forEachSubscriber(e){for(const t of h(this,Mt).values())e(t.subscriber)}_getSubscriber(e){switch(e.type){case"debug":case"error":case"network":return new Cx(e.type);case"block":{const t=new Ew(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new Tw(this,e.type);case"event":return new bu(this,e.filter);case"transaction":return new Iw(this,e.hash);case"orphan":return new Ow(this,e.filter)}throw new Error(`unsupported event: ${e.type}`)}_recoverSubscriber(e,t){for(const r of h(this,Mt).values())if(r.subscriber===e){r.started&&r.subscriber.stop(),r.subscriber=t,r.started&&t.start(),h(this,Gt)!=null&&t.pause(h(this,Gt));break}}async on(e,t){const r=await X(this,Xe,Bc).call(this,e);return r.listeners.push({listener:t,once:!1}),r.started||(r.subscriber.start(),r.started=!0,h(this,Gt)!=null&&r.subscriber.pause(h(this,Gt))),this}async once(e,t){const r=await X(this,Xe,Bc).call(this,e);return r.listeners.push({listener:t,once:!0}),r.started||(r.subscriber.start(),r.started=!0,h(this,Gt)!=null&&r.subscriber.pause(h(this,Gt))),this}async emit(e,...t){const r=await X(this,Xe,bo).call(this,e,t);if(!r||r.listeners.length===0)return!1;const s=r.listeners.length;return r.listeners=r.listeners.filter(({listener:i,once:a})=>{const o=new Tf(this,a?null:i,e);try{i.call(this,...t,o)}catch{}return!a}),r.listeners.length===0&&(r.started&&r.subscriber.stop(),h(this,Mt).delete(r.tag)),s>0}async listenerCount(e){if(e){const r=await X(this,Xe,bo).call(this,e);return r?r.listeners.length:0}let t=0;for(const{listeners:r}of h(this,Mt).values())t+=r.length;return t}async listeners(e){if(e){const r=await X(this,Xe,bo).call(this,e);return r?r.listeners.map(({listener:s})=>s):[]}let t=[];for(const{listeners:r}of h(this,Mt).values())t=t.concat(r.map(({listener:s})=>s));return t}async off(e,t){const r=await X(this,Xe,bo).call(this,e);if(!r)return this;if(t){const s=r.listeners.map(({listener:i})=>i).indexOf(t);s>=0&&r.listeners.splice(s,1)}return(!t||r.listeners.length===0)&&(r.started&&r.subscriber.stop(),h(this,Mt).delete(r.tag)),this}async removeAllListeners(e){if(e){const{tag:t,started:r,subscriber:s}=await X(this,Xe,Bc).call(this,e);r&&s.stop(),h(this,Mt).delete(t)}else for(const[t,{started:r,subscriber:s}]of h(this,Mt))r&&s.stop(),h(this,Mt).delete(t);return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return this.off(e,t)}get destroyed(){return h(this,Sa)}destroy(){this.removeAllListeners();for(const e of h(this,Tr).keys())this._clearTimeout(e);m(this,Sa,!0)}get paused(){return h(this,Gt)!=null}set paused(e){!!e!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(e){if(m(this,_n,-1),h(this,Gt)!=null){if(h(this,Gt)==!!e)return;F(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(t=>t.pause(e)),m(this,Gt,!!e);for(const t of h(this,Tr).values())t.timer&&clearTimeout(t.timer),t.time=Vl()-t.time}resume(){if(h(this,Gt)!=null){this._forEachSubscriber(e=>e.resume()),m(this,Gt,null);for(const e of h(this,Tr).values()){let t=e.time;t<0&&(t=0),e.time=Vl(),setTimeout(e.func,t)}}}}Mt=new WeakMap,bs=new WeakMap,Gt=new WeakMap,Sa=new WeakMap,dr=new WeakMap,li=new WeakMap,ms=new WeakMap,_n=new WeakMap,Jo=new WeakMap,Tr=new WeakMap,ka=new WeakMap,Pa=new WeakMap,Xe=new WeakSet,sr=async function(e){const t=h(this,Pa).cacheTimeout;if(t<0)return await this._perform(e);const r=Cc(e.method,e);let s=h(this,ms).get(r);return s||(s=this._perform(e),h(this,ms).set(r,s),setTimeout(()=>{h(this,ms).get(r)===s&&h(this,ms).delete(r)},t)),await s},Nd=async function(e,t,r){F(r<kw,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},e,{blockTag:t,enableCcipRead:!0})});const s=Bo(e);try{return V(await this._perform({method:"call",transaction:s,blockTag:t}))}catch(i){if(!this.disableCcipRead&&Wd(i)&&i.data&&r>=0&&t==="latest"&&s.to!=null&&ct(i.data,0,4)==="0x556f1830"){const a=i.data,o=await kt(s.to,this);let c;try{c=Dw(ct(i.data,4))}catch(f){F(!1,f.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:s,info:{data:a}})}F(c.sender.toLowerCase()===o.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:a,reason:"OffchainLookup",transaction:s,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:c.errorArgs}});const l=await this.ccipReadFetch(s,c.calldata,c.urls);F(l!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:s,info:{data:i.data,errorArgs:c.errorArgs}});const d={to:o,data:qe([c.selector,Rw([l,c.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:d});try{const f=await X(this,Xe,Nd).call(this,d,t,r+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},d),result:f}),f}catch(f){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},d),error:f}),f}}throw i}},Cd=async function(e){const{value:t}=await Xt({network:this.getNetwork(),value:e});return t},po=async function(e,t,r){let s=this._getAddress(t),i=this._getBlockTag(r);return(typeof s!="string"||typeof i!="string")&&([s,i]=await Promise.all([s,i])),await X(this,Xe,Cd).call(this,X(this,Xe,sr).call(this,Object.assign(e,{address:s,blockTag:i})))},Bd=async function(e,t){if(je(e,32))return await X(this,Xe,sr).call(this,{method:"getBlock",blockHash:e,includeTransactions:t});let r=this._getBlockTag(e);return typeof r!="string"&&(r=await r),await X(this,Xe,sr).call(this,{method:"getBlock",blockTag:r,includeTransactions:t})},bo=async function(e,t){let r=await Kl(e,this);return r.type==="event"&&t&&t.length>0&&t[0].removed===!0&&(r=await Kl({orphan:"drop-log",log:t[0]},this)),h(this,Mt).get(r.tag)||null},Bc=async function(e){const t=await Kl(e,this),r=t.tag;let s=h(this,Mt).get(r);return s||(s={subscriber:this._getSubscriber(t),tag:r,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},h(this,Mt).set(r,s)),s};function Cw(n,e){try{const t=_d(n,e);if(t)return Gc(t)}catch{}return null}function _d(n,e){if(n==="0x")return null;try{const t=_e(ct(n,e,e+32)),r=_e(ct(n,t,t+32));return ct(n,t+32,t+32+r)}catch{}return null}function V0(n){const e=gt(n);if(e.length>32)throw new Error("internal; should not happen");const t=new Uint8Array(32);return t.set(e,32-e.length),t}function Bw(n){if(n.length%32===0)return n;const e=new Uint8Array(Math.ceil(n.length/32)*32);return e.set(n),e}const _w=new Uint8Array([]);function Rw(n){const e=[];let t=0;for(let r=0;r<n.length;r++)e.push(_w),t+=32;for(let r=0;r<n.length;r++){const s=ae(n[r]);e[r]=V0(t),e.push(V0(s.length)),e.push(Bw(s)),t+=32+Math.ceil(s.length/32)*32}return qe(e)}const J0="0x0000000000000000000000000000000000000000000000000000000000000000";function Dw(n){const e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};F(bi(n)>=5*32,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const t=ct(n,0,32);F(ct(t,0,12)===ct(J0,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=ct(t,12);try{const r=[],s=_e(ct(n,32,64)),i=_e(ct(n,s,s+32)),a=ct(n,s+32);for(let o=0;o<i;o++){const c=Cw(a,o*32);if(c==null)throw new Error("abort");r.push(c)}e.urls=r}catch{F(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const r=_d(n,64);if(r==null)throw new Error("abort");e.calldata=r}catch{F(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}F(ct(n,100,128)===ct(J0,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=ct(n,96,100);try{const r=_d(n,128);if(r==null)throw new Error("abort");e.extraData=r}catch{F(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(r=>e[r]),e}function Cs(n,e){if(n.provider)return n.provider;F(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function Q0(n,e){let t=Bo(e);if(t.to!=null&&(t.to=kt(t.to,n)),t.from!=null){const r=t.from;t.from=Promise.all([n.getAddress(),kt(r,n)]).then(([s,i])=>(w(s.toLowerCase()===i.toLowerCase(),"transaction from mismatch","tx.from",i),s))}else t.from=n.getAddress();return await Xt(t)}class mu{constructor(e){E(this,"provider");me(this,{provider:e||null})}async getNonce(e){return Cs(this,"getTransactionCount").getTransactionCount(await this.getAddress(),e)}async populateCall(e){return await Q0(this,e)}async populateTransaction(e){const t=Cs(this,"populateTransaction"),r=await Q0(this,e);r.nonce==null&&(r.nonce=await this.getNonce("pending")),r.gasLimit==null&&(r.gasLimit=await this.estimateGas(r));const s=await this.provider.getNetwork();if(r.chainId!=null){const a=fe(r.chainId);w(a===s.chainId,"transaction chainId mismatch","tx.chainId",e.chainId)}else r.chainId=s.chainId;const i=r.maxFeePerGas!=null||r.maxPriorityFeePerGas!=null;if(r.gasPrice!=null&&(r.type===2||i)?w(!1,"eip-1559 transaction do not support gasPrice","tx",e):(r.type===0||r.type===1)&&i&&w(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",e),(r.type===2||r.type==null)&&r.maxFeePerGas!=null&&r.maxPriorityFeePerGas!=null)r.type=2;else if(r.type===0||r.type===1){const a=await t.getFeeData();F(a.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),r.gasPrice==null&&(r.gasPrice=a.gasPrice)}else{const a=await t.getFeeData();if(r.type==null)if(a.maxFeePerGas!=null&&a.maxPriorityFeePerGas!=null)if(r.authorizationList&&r.authorizationList.length?r.type=4:r.type=2,r.gasPrice!=null){const o=r.gasPrice;delete r.gasPrice,r.maxFeePerGas=o,r.maxPriorityFeePerGas=o}else r.maxFeePerGas==null&&(r.maxFeePerGas=a.maxFeePerGas),r.maxPriorityFeePerGas==null&&(r.maxPriorityFeePerGas=a.maxPriorityFeePerGas);else a.gasPrice!=null?(F(!i,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),r.gasPrice==null&&(r.gasPrice=a.gasPrice),r.type=0):F(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(r.type===2||r.type===3||r.type===4)&&(r.maxFeePerGas==null&&(r.maxFeePerGas=a.maxFeePerGas),r.maxPriorityFeePerGas==null&&(r.maxPriorityFeePerGas=a.maxPriorityFeePerGas))}return await Xt(r)}async populateAuthorization(e){const t=Object.assign({},e);return t.chainId==null&&(t.chainId=(await Cs(this,"getNetwork").getNetwork()).chainId),t.nonce==null&&(t.nonce=await this.getNonce()),t}async estimateGas(e){return Cs(this,"estimateGas").estimateGas(await this.populateCall(e))}async call(e){return Cs(this,"call").call(await this.populateCall(e))}async resolveName(e){return await Cs(this,"resolveName").resolveName(e)}async sendTransaction(e){const t=Cs(this,"sendTransaction"),r=await this.populateTransaction(e);delete r.from;const s=Io.from(r);return await t.broadcastTransaction(await this.signTransaction(s))}authorize(e){F(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}var Ua,_c;const Tu=class Tu extends mu{constructor(t,r){super(r);k(this,Ua);E(this,"address");me(this,{address:t})}async getAddress(){return this.address}connect(t){return new Tu(this.address,t)}async signTransaction(t){X(this,Ua,_c).call(this,"transactions","signTransaction")}async signMessage(t){X(this,Ua,_c).call(this,"messages","signMessage")}async signTypedData(t,r,s){X(this,Ua,_c).call(this,"typed-data","signTypedData")}};Ua=new WeakSet,_c=function(t,r){F(!1,`VoidSigner cannot sign ${t}`,"UNSUPPORTED_OPERATION",{operation:r})};let Rd=Tu;function Lw(n){return JSON.parse(JSON.stringify(n))}var Vt,ln,di,ys,ui,Na,Os,Dd,Ld;class Bx{constructor(e){k(this,Os);k(this,Vt);k(this,ln);k(this,di);k(this,ys);k(this,ui);k(this,Na);m(this,Vt,e),m(this,ln,null),m(this,di,X(this,Os,Dd).bind(this)),m(this,ys,!1),m(this,ui,null),m(this,Na,!1)}_subscribe(e){throw new Error("subclasses must override this")}_emitResults(e,t){throw new Error("subclasses must override this")}_recover(e){throw new Error("subclasses must override this")}start(){h(this,ys)||(m(this,ys,!0),X(this,Os,Dd).call(this,-2))}stop(){h(this,ys)&&(m(this,ys,!1),m(this,Na,!0),X(this,Os,Ld).call(this),h(this,Vt).off("block",h(this,di)))}pause(e){e&&X(this,Os,Ld).call(this),h(this,Vt).off("block",h(this,di))}resume(){this.start()}}Vt=new WeakMap,ln=new WeakMap,di=new WeakMap,ys=new WeakMap,ui=new WeakMap,Na=new WeakMap,Os=new WeakSet,Dd=async function(e){try{h(this,ln)==null&&m(this,ln,this._subscribe(h(this,Vt)));let t=null;try{t=await h(this,ln)}catch(i){if(!Bt(i,"UNSUPPORTED_OPERATION")||i.operation!=="eth_newFilter")throw i}if(t==null){m(this,ln,null),h(this,Vt)._recoverSubscriber(this,this._recover(h(this,Vt)));return}const r=await h(this,Vt).getNetwork();if(h(this,ui)||m(this,ui,r),h(this,ui).chainId!==r.chainId)throw new Error("chaid changed");if(h(this,Na))return;const s=await h(this,Vt).send("eth_getFilterChanges",[t]);await this._emitResults(h(this,Vt),s)}catch(t){console.log("@TODO",t)}h(this,Vt).once("block",h(this,di))},Ld=function(){const e=h(this,ln);e&&(m(this,ln,null),e.then(t=>{h(this,Vt).destroyed||h(this,Vt).send("eth_uninstallFilter",[t])}))};var fi;class Fw extends Bx{constructor(t,r){super(t);k(this,fi);m(this,fi,Lw(r))}_recover(t){return new bu(t,h(this,fi))}async _subscribe(t){return await t.send("eth_newFilter",[h(this,fi)])}async _emitResults(t,r){for(const s of r)t.emit(h(this,fi),t._wrapLog(s,t._network))}}fi=new WeakMap;class Mw extends Bx{async _subscribe(e){return await e.send("eth_newPendingTransactionFilter",[])}async _emitResults(e,t){for(const r of t)e.emit("pending",r)}}const Gw="bigint,boolean,function,number,string,symbol".split(/,/g);function Rc(n){if(n==null||Gw.indexOf(typeof n)>=0||typeof n.getAddress=="function")return n;if(Array.isArray(n))return n.map(Rc);if(typeof n=="object")return Object.keys(n).reduce((e,t)=>(e[t]=n[t],e),{});throw new Error(`should not happen: ${n} (${typeof n})`)}function Xw(n){return new Promise(e=>{setTimeout(e,n)})}function Ni(n){return n&&n.toLowerCase()}function W0(n){return n&&typeof n.pollingInterval=="number"}const _x={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class Jl extends mu{constructor(t,r){super(t);E(this,"address");r=ze(r),me(this,{address:r})}connect(t){F(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const r=Rc(t),s=[];if(r.from){const a=r.from;s.push((async()=>{const o=await kt(a,this.provider);w(o!=null&&o.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),r.from=o})())}else r.from=this.address;if(r.gasLimit==null&&s.push((async()=>{r.gasLimit=await this.provider.estimateGas({...r,from:this.address})})()),r.to!=null){const a=r.to;s.push((async()=>{r.to=await kt(a,this.provider)})())}s.length&&await Promise.all(s);const i=this.provider.getRpcTransaction(r);return this.provider.send("eth_sendTransaction",[i])}async sendTransaction(t){const r=await this.provider.getBlockNumber(),s=await this.sendUncheckedTransaction(t);return await new Promise((i,a)=>{const o=[1e3,100];let c=0;const l=async()=>{try{const d=await this.provider.getTransaction(s);if(d!=null){i(d.replaceableTransaction(r));return}}catch(d){if(Bt(d,"CANCELLED")||Bt(d,"BAD_DATA")||Bt(d,"NETWORK_ERROR")||Bt(d,"UNSUPPORTED_OPERATION")){d.info==null&&(d.info={}),d.info.sendTransactionHash=s,a(d);return}if(Bt(d,"INVALID_ARGUMENT")&&(c++,d.info==null&&(d.info={}),d.info.sendTransactionHash=s,c>10)){a(d);return}this.provider.emit("error",ut("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:d}))}this.provider._setTimeout(()=>{l()},o.pop()||4e3)};l()})}async signTransaction(t){const r=Rc(t);if(r.from){const i=await kt(r.from,this.provider);w(i!=null&&i.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),r.from=i}else r.from=this.address;const s=this.provider.getRpcTransaction(r);return await this.provider.send("eth_signTransaction",[s])}async signMessage(t){const r=typeof t=="string"?Be(t):t;return await this.provider.send("personal_sign",[V(r),this.address.toLowerCase()])}async signTypedData(t,r,s){const i=Rc(s),a=await Va.resolveNames(t,r,i,async o=>{const c=await kt(o);return w(c!=null,"TypedData does not support null address","value",o),c});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(Va.getPayload(a.domain,r,a.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const r=typeof t=="string"?Be(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),V(r)])}}var hi,Ca,Rn,dn,Hr,Or,qt,Qo,Fd;class Hw extends Nw{constructor(t,r){super(t,r);k(this,Qo);k(this,hi);k(this,Ca);k(this,Rn);k(this,dn);k(this,Hr);k(this,Or);k(this,qt);m(this,Ca,1),m(this,hi,Object.assign({},_x,r||{})),m(this,Rn,[]),m(this,dn,null),m(this,Or,null),m(this,qt,null);{let i=null;const a=new Promise(o=>{i=o});m(this,Hr,{promise:a,resolve:i})}const s=this._getOption("staticNetwork");typeof s=="boolean"?(w(!s||t!=="any","staticNetwork cannot be used on special network 'any'","options",r),s&&t!=null&&m(this,Or,xn.from(t))):s&&(w(t==null||s.matches(t),"staticNetwork MUST match network object","options",r),m(this,Or,s))}_getOption(t){return h(this,hi)[t]}get _network(){return F(h(this,Or),"network is not available yet","NETWORK_ERROR"),h(this,Or)}async _perform(t){if(t.method==="call"||t.method==="estimateGas"){let s=t.transaction;if(s&&s.type!=null&&fe(s.type)&&s.maxFeePerGas==null&&s.maxPriorityFeePerGas==null){const i=await this.getFeeData();i.maxFeePerGas==null&&i.maxPriorityFeePerGas==null&&(t=Object.assign({},t,{transaction:Object.assign({},s,{type:void 0})}))}}const r=this.getRpcRequest(t);return r!=null?await this.send(r.method,r.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t)if(t===!0){if(h(this,Or))return h(this,Or)}else return t;return h(this,qt)?await h(this,qt):this.ready?(m(this,qt,(async()=>{try{const r=xn.from(fe(await this.send("eth_chainId",[])));return m(this,qt,null),r}catch(r){throw m(this,qt,null),r}})()),await h(this,qt)):(m(this,qt,(async()=>{const r={id:ao(this,Ca)._++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:r});let s;try{s=(await this._send(r))[0],m(this,qt,null)}catch(i){throw m(this,qt,null),this.emit("debug",{action:"receiveRpcError",error:i}),i}if(this.emit("debug",{action:"receiveRpcResult",result:s}),"result"in s)return xn.from(fe(s.result));throw this.getRpcError(r,s)})()),await h(this,qt))}_start(){h(this,Hr)==null||h(this,Hr).resolve==null||(h(this,Hr).resolve(),m(this,Hr,null),(async()=>{for(;h(this,Or)==null&&!this.destroyed;)try{m(this,Or,await this._detectNetwork())}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",ut("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await Xw(1e3)}X(this,Qo,Fd).call(this)})())}async _waitUntilReady(){if(h(this,Hr)!=null)return await h(this,Hr).promise}_getSubscriber(t){return t.type==="pending"?new Mw(this):t.type==="event"?this._getOption("polling")?new bu(this,t.filter):new Fw(this,t.filter):t.type==="orphan"&&t.filter.orphan==="drop-log"?new Cx("orphan"):super._getSubscriber(t)}get ready(){return h(this,Hr)==null}getRpcTransaction(t){const r={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(s=>{if(t[s]==null)return;let i=s;s==="gasLimit"&&(i="gas"),r[i]=zr(fe(t[s],`tx.${s}`))}),["from","to","data"].forEach(s=>{t[s]!=null&&(r[s]=V(t[s]))}),t.accessList&&(r.accessList=Oi(t.accessList)),t.blobVersionedHashes&&(r.blobVersionedHashes=t.blobVersionedHashes.map(s=>s.toLowerCase())),t.authorizationList&&(r.authorizationList=t.authorizationList.map(s=>{const i=Rh(s);return{address:i.address,nonce:zr(i.nonce),chainId:zr(i.chainId),yParity:zr(i.signature.yParity),r:zr(i.signature.r),s:zr(i.signature.s)}})),r}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[Ni(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[Ni(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[Ni(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[Ni(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&t.filter.address!=null&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(Ni):t.filter.address=Ni(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,r){const{method:s}=t,{error:i}=r;if(s==="eth_estimateGas"&&i.message){const c=i.message;if(!c.match(/revert/i)&&c.match(/insufficient funds/i))return ut("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:i}});if(c.match(/nonce/i)&&c.match(/too low/i))return ut("nonce has already been used","NONCE_EXPIRED",{transaction:t.params[0],info:{payload:t,error:i}})}if(s==="eth_call"||s==="eth_estimateGas"){const c=Md(i),l=Co.getBuiltinCallException(s==="eth_call"?"call":"estimateGas",t.params[0],c?c.data:null);return l.info={error:i,payload:t},l}const a=JSON.stringify($w(i));if(typeof i.message=="string"&&i.message.match(/user denied|ethers-user-denied/i))return ut("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[s]||"unknown",reason:"rejected",info:{payload:t,error:i}});if(s==="eth_sendRawTransaction"||s==="eth_sendTransaction"){const c=t.params[0];if(a.match(/insufficient funds|base fee exceeds gas limit/i))return ut("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:c,info:{error:i}});if(a.match(/nonce/i)&&a.match(/too low/i))return ut("nonce has already been used","NONCE_EXPIRED",{transaction:c,info:{error:i}});if(a.match(/replacement transaction/i)&&a.match(/underpriced/i))return ut("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:c,info:{error:i}});if(a.match(/only replay-protected/i))return ut("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:s,info:{transaction:c,info:{error:i}}})}let o=!!a.match(/the method .* does not exist/i);return o||i&&i.details&&i.details.startsWith("Unauthorized method:")&&(o=!0),o?ut("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:i,payload:t}}):ut("could not coalesce error","UNKNOWN_ERROR",{error:i,payload:t})}send(t,r){if(this.destroyed)return Promise.reject(ut("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const s=ao(this,Ca)._++,i=new Promise((a,o)=>{h(this,Rn).push({resolve:a,reject:o,payload:{method:t,params:r,id:s,jsonrpc:"2.0"}})});return X(this,Qo,Fd).call(this),i}async getSigner(t){t==null&&(t=0);const r=this.send("eth_accounts",[]);if(typeof t=="number"){const i=await r;if(t>=i.length)throw new Error("no such account");return new Jl(this,i[t])}const{accounts:s}=await Xt({network:this.getNetwork(),accounts:r});t=ze(t);for(const i of s)if(ze(i)===t)return new Jl(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(r=>new Jl(this,r))}destroy(){h(this,dn)&&(clearTimeout(h(this,dn)),m(this,dn,null));for(const{payload:t,reject:r}of h(this,Rn))r(ut("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));m(this,Rn,[]),super.destroy()}}hi=new WeakMap,Ca=new WeakMap,Rn=new WeakMap,dn=new WeakMap,Hr=new WeakMap,Or=new WeakMap,qt=new WeakMap,Qo=new WeakSet,Fd=function(){if(h(this,dn))return;const t=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");m(this,dn,setTimeout(()=>{m(this,dn,null);const r=h(this,Rn);for(m(this,Rn,[]);r.length;){const s=[r.shift()];for(;r.length&&s.length!==h(this,hi).batchMaxCount;)if(s.push(r.shift()),JSON.stringify(s.map(a=>a.payload)).length>h(this,hi).batchMaxSize){r.unshift(s.pop());break}(async()=>{const i=s.length===1?s[0].payload:s.map(a=>a.payload);this.emit("debug",{action:"sendRpcPayload",payload:i});try{const a=await this._send(i);this.emit("debug",{action:"receiveRpcResult",result:a});for(const{resolve:o,reject:c,payload:l}of s){if(this.destroyed){c(ut("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:l.method}));continue}const d=a.filter(f=>f.id===l.id)[0];if(d==null){const f=ut("missing response for request","BAD_DATA",{value:a,info:{payload:l}});this.emit("error",f),c(f);continue}if("error"in d){c(this.getRpcError(l,d));continue}o(d.result)}}catch(a){this.emit("debug",{action:"receiveRpcError",error:a});for(const{reject:o}of s)o(a)}})()}},t))};var ws;class zw extends Hw{constructor(t,r){super(t,r);k(this,ws);let s=this._getOption("pollingInterval");s==null&&(s=_x.pollingInterval),m(this,ws,s)}_getSubscriber(t){const r=super._getSubscriber(t);return W0(r)&&(r.pollingInterval=h(this,ws)),r}get pollingInterval(){return h(this,ws)}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");m(this,ws,t),this._forEachSubscriber(r=>{W0(r)&&(r.pollingInterval=h(this,ws))})}}ws=new WeakMap;function Md(n){if(n==null)return null;if(typeof n.message=="string"&&n.message.match(/revert/i)&&je(n.data))return{message:n.message,data:n.data};if(typeof n=="object"){for(const e in n){const t=Md(n[e]);if(t)return t}return null}if(typeof n=="string")try{return Md(JSON.parse(n))}catch{}return null}function Gd(n,e){if(n!=null){if(typeof n.message=="string"&&e.push(n.message),typeof n=="object")for(const t in n)Gd(n[t],e);if(typeof n=="string")try{return Gd(JSON.parse(n),e)}catch{}}}function $w(n){const e=[];return Gd(n,e),e}var Ba,_a;const Hs=class Hs extends zw{constructor(t,r,s){const i=Object.assign({},s??{},{batchMaxCount:1});w(t&&t.request,"invalid EIP-1193 provider","ethereum",t);super(r,i);k(this,Ba);k(this,_a);m(this,_a,null),s&&s.providerInfo&&m(this,_a,s.providerInfo),m(this,Ba,async(a,o)=>{const c={method:a,params:o};this.emit("debug",{action:"sendEip1193Request",payload:c});try{const l=await t.request(c);return this.emit("debug",{action:"receiveEip1193Result",result:l}),l}catch(l){const d=new Error(l.message);throw d.code=l.code,d.data=l.data,d.payload=c,this.emit("debug",{action:"receiveEip1193Error",error:d}),d}})}get providerInfo(){return h(this,_a)}async send(t,r){return await this._start(),await super.send(t,r)}async _send(t){w(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const r=await h(this,Ba).call(this,t.method,t.params||[]);return[{id:t.id,result:r}]}catch(r){return[{id:t.id,error:{code:r.code,data:r.data,message:r.message}}]}}getRpcError(t,r){switch(r=JSON.parse(JSON.stringify(r)),r.error.code||-1){case 4001:r.error.message=`ethers-user-denied: ${r.error.message}`;break;case 4200:r.error.message=`ethers-unsupported: ${r.error.message}`;break}return super.getRpcError(t,r)}async hasSigner(t){t==null&&(t=0);const r=await this.send("eth_accounts",[]);return typeof t=="number"?r.length>t:(t=t.toLowerCase(),r.filter(s=>s.toLowerCase()===t).length!==0)}async getSigner(t){if(t==null&&(t=0),!await this.hasSigner(t))try{await h(this,Ba).call(this,"eth_requestAccounts",[])}catch(r){const s=r.payload;throw this.getRpcError(s,{id:s.id,error:r})}return await super.getSigner(t)}static async discover(t){if(t==null&&(t={}),t.provider)return new Hs(t.provider);const r=t.window?t.window:typeof window<"u"?window:null;if(r==null)return null;const s=t.anyProvider;if(s&&r.ethereum)return new Hs(r.ethereum);if(!("addEventListener"in r&&"dispatchEvent"in r&&"removeEventListener"in r))return null;const i=t.timeout?t.timeout:300;return i===0?null:await new Promise((a,o)=>{let c=[];const l=x=>{c.push(x.detail),s&&d()},d=()=>{if(clearTimeout(f),c.length)if(t&&t.filter){const x=t.filter(c.map(g=>Object.assign({},g.info)));if(x==null)a(null);else if(x instanceof Hs)a(x);else{let g=null;if(x.uuid&&(g=c.filter(p=>x.uuid===p.info.uuid)[0]),g){const{provider:b,info:p}=g;a(new Hs(b,void 0,{providerInfo:p}))}else o(ut("filter returned unknown info","UNSUPPORTED_OPERATION",{value:x}))}}else{const{provider:x,info:g}=c[0];a(new Hs(x,void 0,{providerInfo:g}))}else a(null);r.removeEventListener("eip6963:announceProvider",l)},f=setTimeout(()=>{d()},i);r.addEventListener("eip6963:announceProvider",l),r.dispatchEvent(new Event("eip6963:requestProvider"))})}};Ba=new WeakMap,_a=new WeakMap;let Wc=Hs;var Ra;const Ou=class Ou extends mu{constructor(t,r){super(r);E(this,"address");k(this,Ra);w(t&&typeof t.sign=="function","invalid private key","privateKey","[ REDACTED ]"),m(this,Ra,t);const s=tc(this.signingKey.publicKey);me(this,{address:s})}get signingKey(){return h(this,Ra)}get privateKey(){return this.signingKey.privateKey}async getAddress(){return this.address}connect(t){return new Ou(h(this,Ra),t)}async signTransaction(t){t=Bo(t);const{to:r,from:s}=await Xt({to:t.to?kt(t.to,this):void 0,from:t.from?kt(t.from,this):void 0});r!=null&&(t.to=r),s!=null&&(t.from=s),t.from!=null&&(w(ze(t.from)===this.address,"transaction from address mismatch","tx.from",t.from),delete t.from);const i=Io.from(t);return i.signature=this.signingKey.sign(i.unsignedHash),i.serialized}async signMessage(t){return this.signMessageSync(t)}signMessageSync(t){return this.signingKey.sign(vy(t)).serialized}authorizeSync(t){w(typeof t.address=="string","invalid address for authorizeSync","auth.address",t);const r=this.signingKey.sign(Dm(t));return Object.assign({},{address:ze(t.address),nonce:fe(t.nonce||0),chainId:fe(t.chainId||0)},{signature:r})}async authorize(t){return t=Object.assign({},t,{address:await kt(t.address,this)}),this.authorizeSync(await this.populateAuthorization(t))}async signTypedData(t,r,s){const i=await Va.resolveNames(t,r,s,async a=>{F(this.provider!=null,"cannot resolve ENS names without a provider","UNSUPPORTED_OPERATION",{operation:"resolveName",info:{name:a}});const o=await this.provider.resolveName(a);return F(o!=null,"unconfigured ENS name","UNCONFIGURED_NAME",{value:a}),o});return this.signingKey.sign(Va.hash(i.domain,r,i.value)).serialized}};Ra=new WeakMap;let jc=Ou;const Zc=" !#$%&'()*+,-./<=>?@[]^_`{|}~",Kw=/^[a-z]*$/i;function j0(n,e){let t=97;return n.reduce((r,s)=>(s===e?t++:s.match(Kw)?r.push(String.fromCharCode(t)+s):(t=97,r.push(s)),r),[])}function Vw(n,e){for(let s=Zc.length-1;s>=0;s--)n=n.split(Zc[s]).join(e.substring(2*s,2*s+2));const t=[],r=n.replace(/(:|([0-9])|([A-Z][a-z]*))/g,(s,i,a,o)=>{if(a)for(let c=parseInt(a);c>=0;c--)t.push(";");else t.push(i.toLowerCase());return""});if(r)throw new Error(`leftovers: ${JSON.stringify(r)}`);return j0(j0(t,";"),":")}function Jw(n){return w(n[0]==="0","unsupported auwl data","data",n),Vw(n.substring(1+2*Zc.length),n.substring(1,1+2*Zc.length))}class Qw{constructor(e){E(this,"locale");me(this,{locale:e})}split(e){return e.toLowerCase().split(/\s+/g)}join(e){return e.join(" ")}}var Da,Wo,xi,jo,Xd;class Ww extends Qw{constructor(t,r,s){super(t);k(this,jo);k(this,Da);k(this,Wo);k(this,xi);m(this,Da,r),m(this,Wo,s),m(this,xi,null)}get _data(){return h(this,Da)}_decodeWords(){return Jw(h(this,Da))}getWord(t){const r=X(this,jo,Xd).call(this);return w(t>=0&&t<r.length,`invalid word index: ${t}`,"index",t),r[t]}getWordIndex(t){return X(this,jo,Xd).call(this).indexOf(t)}}Da=new WeakMap,Wo=new WeakMap,xi=new WeakMap,jo=new WeakSet,Xd=function(){if(h(this,xi)==null){const t=this._decodeWords();if(Vn(t.join(`
`)+`
`)!==h(this,Wo))throw new Error(`BIP39 Wordlist for ${this.locale} FAILED`);m(this,xi,t)}return h(this,xi)};const jw="0erleonalorenseinceregesticitStanvetearctssi#ch2Athck&tneLl0And#Il.yLeOutO=S|S%b/ra@SurdU'0Ce[Cid|CountCu'Hie=IdOu,-Qui*Ro[TT]T%T*[Tu$0AptDD-tD*[Ju,M.UltV<)Vi)0Rob-0FairF%dRaid0A(EEntRee0Ead0MRRp%tS!_rmBumCoholErtI&LLeyLowMo,O}PhaReadySoT Ways0A>urAz(gOngOuntU'd0Aly,Ch%Ci|G G!GryIm$K!Noun)Nu$O` Sw T&naTiqueXietyY1ArtOlogyPe?P!Pro=Ril1ChCt-EaEnaGueMMedM%MyOundR<+Re,Ri=RowTTefa@Ti,Tw%k0KPe@SaultSetSi,SumeThma0H!>OmTa{T&dT.udeTra@0Ct]D.Gu,NtTh%ToTumn0Era+OcadoOid0AkeA*AyEsomeFulKw?d0Is:ByChel%C#D+GL<)Lc#y~MbooN<aNn RRelyRga(R*lSeS-SketTt!3A^AnAutyCau'ComeEfF%eG(Ha=H(dLie=LowLtN^Nef./TrayTt Twe&Y#d3Cyc!DKeNdOlogyRdR`Tt _{AdeAmeAnketA,EakE[IndOodO[omOu'UeUrUsh_rdAtDyIlMbNeNusOkO,Rd R(gRrowSsTtomUn)XY_{etA(AndA[A=EadEezeI{Id+IefIghtIngIskOccoliOk&OnzeOomO` OwnUsh2Bb!DdyD+tFf$oIldLbLkL!tNd!Nk Rd&Rg R,SS(e[SyTt Y Zz:Bba+B(B!CtusGeKe~LmM aMpNN$N)lNdyNn#NoeNvasNy#Pab!P.$Pta(RRb#RdRgoRpetRryRtSeShS(o/!Su$TT$ogT^Teg%yTt!UghtU'Ut]Ve3Il(gL yM|NsusNturyRe$Rta(_irAlkAmp]An+AosApt Ar+A'AtEapE{Ee'EfErryE,I{&IefIldIm}yOi)Oo'R#-U{!UnkUrn0G?Nnam#Rc!Tiz&TyVil_imApArifyAwAyE<ErkEv I{I|IffImbIn-IpO{OgO'O`OudOwnUbUmpU, Ut^_^A,C#utDeFfeeIlInL!@L%LumnMb(eMeMf%tM-Mm#Mp<yNc tNdu@NfirmNg*[N}@Nsid NtrolNv()OkOlPp PyR$ReRnR*@/Tt#U^UntryUp!Ur'Us(V Yo>_{Ad!AftAmA}AshAt AwlAzyEamEd.EekEwI{etImeIspIt-OpO[Ou^OwdUci$UelUi'Umb!Un^UshYY,$2BeLtu*PPbo?dRiousRr|Rta(R=Sh]/omTe3C!:DMa+MpN)Ng R(gShUght WnY3AlBa>BrisCadeCemb CideCl(eC%a>C*a'ErF&'F(eFyG*eLayLiv M<dMi'Ni$Nti,NyP?tP&dPos.P`PutyRi=ScribeS tSignSkSpair/royTailTe@VelopVi)Vo>3AgramAlAm#dAryCeE'lEtFf G.$Gn.yLemmaNn NosaurRe@RtSag*eScov Sea'ShSmi[S%d Splay/<)V tVideV%)Zzy5Ct%Cum|G~Lph(Ma(Na>NkeyN%OrSeUb!Ve_ftAg#AmaA,-AwEamE[IftIllInkIpI=OpUmY2CkMbNeR(g/T^Ty1Arf1Nam-:G G!RlyRnR`Sily/Sy1HoOlogyOnomy0GeItUca>1F%t0G1GhtTh 2BowD E@r-Eg<tEm|Eph<tEvat%I>Se0B?kBodyBra)Er+Ot]PloyPow Pty0Ab!A@DD![D%'EmyErgyF%)Ga+G(eH<)JoyLi,OughR-hRollSu*T Ti*TryVelope1Isode0U$Uip0AA'OdeOs]R%Upt0CapeSayS&)Ta>0Ern$H-s1Id&)IlOkeOl=1A@Amp!Ce[Ch<+C.eCludeCu'Ecu>Erci'Hau,Hib.I!I,ItOt-P<dPe@Pi*Pla(Po'P*[T&dTra0EEbrow:Br-CeCultyDeIntI`~L'MeMilyMousNNcyNtasyRmSh]TT$Th TigueUltV%.e3Atu*Bru?yD $EEdElMa!N)/iv$T^V W3B Ct]EldGu*LeLmLt N$NdNeNg NishReRmR,Sc$ShTT}[X_gAmeAshAtAv%EeIghtIpOatO{O%Ow UidUshY_mCusGIlLd~owOdOtR)Re,R+tRkRtu}RumRw?dSsil/ UndX_gi!AmeEqu|EshI&dIn+OgOntO,OwnOz&U.2ElNNnyRna)RyTu*:D+tInLaxy~ yMePRa+Rba+Rd&Rl-Rm|SSpTeTh U+Ze3N $NiusN*Nt!Nu(e/u*2O,0AntFtGg!Ng RaffeRlVe_dAn)A*A[IdeImp'ObeOomOryO=OwUe_tDde[LdOdO'RillaSpelSsipV nWn_bA)A(AntApeA[Av.yEatE&IdIefItOc yOupOwUnt_rdE[IdeIltIt?N3M:B.IrLfMm M, NdPpyRb%RdRshR=,TVeWkZ?d3AdAl`ArtAvyD+hogIght~oLmetLpNRo3Dd&Gh~NtPRe/%y5BbyCkeyLdLeLiday~owMeNeyOdPeRnRr%R'Sp.$/TelUrV 5BGeM<Mb!M%Nd*dNgryNtRd!RryRtSb<d3Brid:1EOn0EaEntifyLe2N%e4LLeg$L}[0A+Ita>M&'Mu}Pa@Po'Pro=Pul'0ChCludeComeC*a'DexD-a>Do%Du,ryF<tFl-tF%mHa!H .Iti$Je@JuryMa>N Noc|PutQuiryS<eSe@SideSpi*/$lTa@T e,ToVe,V.eVol=3On0L<dOla>Sue0Em1Ory:CketGu?RZz3AlousAns~yWel9BInKeUr}yY5D+I)MpNg!Ni%Nk/:Ng?oo3EnEpT^upY3CkDD}yNdNgdomSsTT^&TeTt&Wi4EeIfeO{Ow:BBelB%Dd DyKeMpNgua+PtopR+T T(UghUndryVaWWnWsu.Y Zy3Ad AfArnA=Ctu*FtGG$G&dIsu*M#NdNg`NsOp?dSs#Tt Vel3ArB tyBr?yC&'FeFtGhtKeMbM.NkOnQuid/Tt!VeZ?d5AdAnB, C$CkG-NelyNgOpTt yUdUn+VeY$5CkyGga+Mb N?N^Xury3R-s:Ch(eDG-G}tIdIlInJ%KeMm$NNa+Nda>NgoNs]Nu$P!Rb!R^Rg(R(eRketRria+SkSs/ T^T i$ThTrixTt XimumZe3AdowAnAsu*AtCh<-D$DiaLodyLtMb M%yNt]NuRcyR+R.RryShSsa+T$Thod3Dd!DnightLk~]M-NdNimumN%Nu>Rac!Rr%S ySs/akeXXedXtu*5Bi!DelDifyMM|N.%NkeyN, N`OnR$ReRn(gSqu.oTh T]T%Unta(U'VeVie5ChFf(LeLtiplySc!SeumShroomS-/Tu$3Self/ yTh:I=MePk(Rrow/yT]Tu*3ArCkEdGati=G!@I` PhewR=/TTw%kUtr$V WsXt3CeGht5B!I'M(eeOd!Rm$R`SeTab!TeTh(gTi)VelW5C!?Mb R'T:K0EyJe@Li+Scu*S =Ta(Vious0CurE<Tob 0Or1FF Fi)T&2L1Ay0DI=Ymp-0It0CeEI#L(eLy1EnEraIn]Po'T]1An+B.Ch?dD D(?yG<I|Ig($Ph<0Tr-h0H 0Tdo%T TputTside0AlEnEr0NN 0Yg&0/ 0O}:CtDd!GeIrLa)LmNdaNelN-N` P RadeR|RkRrotRtySsT^ThTi|TrolTt nU'VeYm|3A)AnutArAs<tL-<NN$tyNcilOp!Pp Rfe@Rm.Rs#T2O}OtoRa'Ys-$0AnoCn-Ctu*E)GGe#~LotNkO} Pe/olT^Zza_)A}tA,-A>AyEa'Ed+U{UgUn+2EmEtIntL?LeLi)NdNyOlPul?Rt]S.]Ssib!/TatoTt yV tyWd W _@i)Ai'Ed-tEf Epa*Es|EttyEv|I)IdeIm?yIntI%.yIs#Iva>IzeOb!mO)[Odu)Of.OgramOje@Omo>OofOp tyOsp O>@OudOvide2Bl-Dd(g~LpL'Mpk(N^PilPpyR^a'R.yRpo'R'ShTZz!3Ramid:99Al.yAntumArt E,]I{ItIzO>:Bb.Cco#CeCkD?DioIlInI'~yMpN^NdomN+PidReTeTh V&WZ%3AdyAlAs#BelBuildC$lCei=CipeC%dCyc!Du)F!@F%mFu'G]G*tGul?Je@LaxLea'LiefLyMa(Memb M(dMo=Nd NewNtOp&PairPeatPla)P%tQui*ScueSemb!Si,Sour)Sp#'SultTi*T*atTurnUn]Ve$ViewW?d2Y`m0BBb#CeChDeD+F!GhtGidNgOtPp!SkTu$V$V 5AdA,BotBu,CketM<)OfOkieOmSeTa>UghUndU>Y$5Bb DeGLeNNwayR$:DDd!D}[FeIlLadLm#L#LtLu>MeMp!NdTisfyToshiU)Usa+VeY1A!AnA*Att E}HemeHoolI&)I[%sOrp]OutRapRe&RiptRub1AAr^As#AtC#dC*tCt]Cur.yEdEkGm|Le@~M(?Ni%N'Nt&)RiesRvi)Ss]Tt!TupV&_dowAftAllowA*EdEllEriffIeldIftI}IpIv O{OeOotOpOrtOuld O=RimpRugUff!Y0Bl(gCkDeE+GhtGnL|Lk~yLv Mil?Mp!N)NgR&/ Tua>XZe1A>Et^IIllInIrtUll0AbAmEepEnd I)IdeIghtImOg<OtOwUsh0AllArtI!OkeOo`0A{AkeApIffOw0ApCc Ci$CkDaFtL?Ldi LidLut]L=Me#eNgOnRryRtUlUndUpUr)U`0A)A*Ati$AwnEakEci$EedEllEndH eI)Id IkeInIr.L.OilOns%O#OrtOtRayReadR(gY0Ua*UeezeUir*l_b!AdiumAffA+AirsAmpAndArtA>AyEakEelEmEpE*oI{IllIngO{Oma^O}OolOryO=Ra>gyReetRikeR#gRugg!Ud|UffUmb!Y!0Bje@Bm.BwayC)[ChDd&Ff G?G+,ItMm NNnyN'tP PplyP*meReRfa)R+Rpri'RroundR=ySpe@/a(1AllowAmpApArmE?EetIftImIngIt^Ord1MbolMptomRup/em:B!Ck!GIlL|LkNkPeR+tSk/eTtooXi3A^Am~NN<tNnisNtRm/Xt_nkAtEmeEnE%yE*EyIngIsOughtReeRi=RowUmbUnd 0CketDeG LtMb MeNyPRedSsueT!5A,BaccoDayDdl EGe` I!tK&MatoM%rowNeNgueNightOlO`PP-Pp!R^RnadoRtoi'SsT$Uri,W?dW WnY_{AdeAff-Ag-A(Ansf ApAshA=lAyEatEeEndI$IbeI{Igg ImIpOphyOub!U{UeUlyUmpetU,U`Y2BeIt]Mb!NaN}lRkeyRnRt!1El=EntyI)InI,O1PeP-$:5Ly5B*lla0Ab!Awa*C!Cov D DoFairFoldHappyIf%mIqueItIv 'KnownLo{TilUsu$Veil1Da>GradeHoldOnP Set1B<Ge0A+EEdEfulE![U$0Il.y:C<tCuumGueLidL!yL=NNishP%Rious/Ult3H-!L=tNd%Ntu*NueRbRifyRs]RyS'lT <3Ab!Br<tCiousCt%yDeoEw~a+Nta+Ol(Rtu$RusSaS.Su$T$Vid5C$I)IdLc<oLumeTeYa+:GeG#ItLk~LnutNtRfa*RmRri%ShSp/eT VeY3Al`Ap#ArA'lA` BDd(gEk&dIrdLcome/T_!AtEatEelEnE*IpIsp 0DeD`FeLd~NNdowNeNgNkNn Nt ReSdomSeShT}[5LfM<Nd OdOlRdRkRldRryR`_pE{E,!I,I>Ong::Rd3Ar~ow9UUngU`:3BraRo9NeO",Zw="0x3c8acc1e7b08d8e76f9fda015ef48dc8c710a73cb7e0f77b2c18a9b5a7adde60";let Ql=null;class Ei extends Ww{constructor(){super("en",jw,Zw)}static wordlist(){return Ql==null&&(Ql=new Ei),Ql}}function Rx(n){return(1<<n)-1<<8-n&255}function Yw(n){return(1<<n)-1&255}function Wl(n,e){yf("NFKD"),e==null&&(e=Ei.wordlist());const t=e.split(n);w(t.length%3===0&&t.length>=12&&t.length<=24,"invalid mnemonic length","mnemonic","[ REDACTED ]");const r=new Uint8Array(Math.ceil(11*t.length/8));let s=0;for(let l=0;l<t.length;l++){let d=e.getWordIndex(t[l].normalize("NFKD"));w(d>=0,`invalid mnemonic word at index ${l}`,"mnemonic","[ REDACTED ]");for(let f=0;f<11;f++)d&1<<10-f&&(r[s>>3]|=1<<7-s%8),s++}const i=32*t.length/3,a=t.length/3,o=Rx(a),c=ae(Nr(r.slice(0,i/8)))[0]&o;return w(c===(r[r.length-1]&o),"invalid mnemonic checksum","mnemonic","[ REDACTED ]"),V(r.slice(0,i/8))}function jl(n,e){w(n.length%4===0&&n.length>=16&&n.length<=32,"invalid entropy size","entropy","[ REDACTED ]"),e==null&&(e=Ei.wordlist());const t=[0];let r=11;for(let a=0;a<n.length;a++)r>8?(t[t.length-1]<<=8,t[t.length-1]|=n[a],r-=8):(t[t.length-1]<<=r,t[t.length-1]|=n[a]>>8-r,t.push(n[a]&Yw(8-r)),r+=3);const s=n.length/4,i=parseInt(Nr(n).substring(2,4),16)&Rx(s);return t[t.length-1]<<=s,t[t.length-1]|=i>>8-s,e.join(t.map(a=>e.getWord(a)))}const Zl={};class Qa{constructor(e,t,r,s,i){E(this,"phrase");E(this,"password");E(this,"wordlist");E(this,"entropy");s==null&&(s=""),i==null&&(i=Ei.wordlist()),Is(e,Zl,"Mnemonic"),me(this,{phrase:r,password:s,wordlist:i,entropy:t})}computeSeed(){const e=Be("mnemonic"+this.password,"NFKD");return Ss(Be(this.phrase,"NFKD"),e,2048,64,"sha512")}static fromPhrase(e,t,r){const s=Wl(e,r);return e=jl(ae(s),r),new Qa(Zl,s,e,t,r)}static fromEntropy(e,t,r){const s=ae(e,"entropy"),i=jl(s,r);return new Qa(Zl,V(s),i,t,r)}static entropyToPhrase(e,t){const r=ae(e,"entropy");return jl(r,t)}static phraseToEntropy(e,t){return Wl(e,t)}static isValidMnemonic(e,t){try{return Wl(e,t),!0}catch{}return!1}}/*! MIT License. Copyright 2015-2022 Richard Moore <me@ricmoo.com>. See LICENSE.txt. */var Pt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Yl=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Dc,mr,Yr;const qw={16:10,24:12,32:14},e1=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],gr=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],wc=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],t1=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],r1=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],n1=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],s1=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],i1=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],a1=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],o1=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],c1=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],l1=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],d1=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],u1=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],f1=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function ql(n){const e=[];for(let t=0;t<n.length;t+=4)e.push(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3]);return e}class yu{get key(){return Pt(this,Dc,"f").slice()}constructor(e){if(Dc.set(this,void 0),mr.set(this,void 0),Yr.set(this,void 0),!(this instanceof yu))throw Error("AES must be instanitated with `new`");Yl(this,Dc,new Uint8Array(e),"f");const t=qw[this.key.length];if(t==null)throw new TypeError("invalid key size (must be 16, 24 or 32 bytes)");Yl(this,Yr,[],"f"),Yl(this,mr,[],"f");for(let d=0;d<=t;d++)Pt(this,Yr,"f").push([0,0,0,0]),Pt(this,mr,"f").push([0,0,0,0]);const r=(t+1)*4,s=this.key.length/4,i=ql(this.key);let a;for(let d=0;d<s;d++)a=d>>2,Pt(this,Yr,"f")[a][d%4]=i[d],Pt(this,mr,"f")[t-a][d%4]=i[d];let o=0,c=s,l;for(;c<r;){if(l=i[s-1],i[0]^=gr[l>>16&255]<<24^gr[l>>8&255]<<16^gr[l&255]<<8^gr[l>>24&255]^e1[o]<<24,o+=1,s!=8)for(let g=1;g<s;g++)i[g]^=i[g-1];else{for(let g=1;g<s/2;g++)i[g]^=i[g-1];l=i[s/2-1],i[s/2]^=gr[l&255]^gr[l>>8&255]<<8^gr[l>>16&255]<<16^gr[l>>24&255]<<24;for(let g=s/2+1;g<s;g++)i[g]^=i[g-1]}let d=0,f,x;for(;d<s&&c<r;)f=c>>2,x=c%4,Pt(this,Yr,"f")[f][x]=i[d],Pt(this,mr,"f")[t-f][x]=i[d++],c++}for(let d=1;d<t;d++)for(let f=0;f<4;f++)l=Pt(this,mr,"f")[d][f],Pt(this,mr,"f")[d][f]=l1[l>>24&255]^d1[l>>16&255]^u1[l>>8&255]^f1[l&255]}encrypt(e){if(e.length!=16)throw new TypeError("invalid plaintext size (must be 16 bytes)");const t=Pt(this,Yr,"f").length-1,r=[0,0,0,0];let s=ql(e);for(let o=0;o<4;o++)s[o]^=Pt(this,Yr,"f")[0][o];for(let o=1;o<t;o++){for(let c=0;c<4;c++)r[c]=t1[s[c]>>24&255]^r1[s[(c+1)%4]>>16&255]^n1[s[(c+2)%4]>>8&255]^s1[s[(c+3)%4]&255]^Pt(this,Yr,"f")[o][c];s=r.slice()}const i=new Uint8Array(16);let a=0;for(let o=0;o<4;o++)a=Pt(this,Yr,"f")[t][o],i[4*o]=(gr[s[o]>>24&255]^a>>24)&255,i[4*o+1]=(gr[s[(o+1)%4]>>16&255]^a>>16)&255,i[4*o+2]=(gr[s[(o+2)%4]>>8&255]^a>>8)&255,i[4*o+3]=(gr[s[(o+3)%4]&255]^a)&255;return i}decrypt(e){if(e.length!=16)throw new TypeError("invalid ciphertext size (must be 16 bytes)");const t=Pt(this,mr,"f").length-1,r=[0,0,0,0];let s=ql(e);for(let o=0;o<4;o++)s[o]^=Pt(this,mr,"f")[0][o];for(let o=1;o<t;o++){for(let c=0;c<4;c++)r[c]=i1[s[c]>>24&255]^a1[s[(c+3)%4]>>16&255]^o1[s[(c+2)%4]>>8&255]^c1[s[(c+1)%4]&255]^Pt(this,mr,"f")[o][c];s=r.slice()}const i=new Uint8Array(16);let a=0;for(let o=0;o<4;o++)a=Pt(this,mr,"f")[t][o],i[4*o]=(wc[s[o]>>24&255]^a>>24)&255,i[4*o+1]=(wc[s[(o+3)%4]>>16&255]^a>>16)&255,i[4*o+2]=(wc[s[(o+2)%4]>>8&255]^a>>8)&255,i[4*o+3]=(wc[s[(o+1)%4]&255]^a)&255;return i}}Dc=new WeakMap,mr=new WeakMap,Yr=new WeakMap;class Dx{constructor(e,t,r){if(r&&!(this instanceof r))throw new Error(`${e} must be instantiated with "new"`);Object.defineProperties(this,{aes:{enumerable:!0,value:new yu(t)},name:{enumerable:!0,value:e}})}}var vc=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Ci=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},mo,vn;class wu extends Dx{constructor(e,t){if(super("ECC",e,wu),mo.set(this,void 0),vn.set(this,void 0),t){if(t.length%16)throw new TypeError("invalid iv size (must be 16 bytes)");vc(this,mo,new Uint8Array(t),"f")}else vc(this,mo,new Uint8Array(16),"f");vc(this,vn,this.iv,"f")}get iv(){return new Uint8Array(Ci(this,mo,"f"))}encrypt(e){if(e.length%16)throw new TypeError("invalid plaintext size (must be multiple of 16 bytes)");const t=new Uint8Array(e.length);for(let r=0;r<e.length;r+=16){for(let s=0;s<16;s++)Ci(this,vn,"f")[s]^=e[r+s];vc(this,vn,this.aes.encrypt(Ci(this,vn,"f")),"f"),t.set(Ci(this,vn,"f"),r)}return t}decrypt(e){if(e.length%16)throw new TypeError("invalid ciphertext size (must be multiple of 16 bytes)");const t=new Uint8Array(e.length);for(let r=0;r<e.length;r+=16){const s=this.aes.decrypt(e.subarray(r,r+16));for(let i=0;i<16;i++)t[r+i]=s[i]^Ci(this,vn,"f")[i],Ci(this,vn,"f")[i]=e[r+i]}return t}}mo=new WeakMap,vn=new WeakMap;var Bi=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},pr=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},yo,Ds,yr;class Wa extends Dx{constructor(e,t){super("CTR",e,Wa),yo.set(this,void 0),Ds.set(this,void 0),yr.set(this,void 0),Bi(this,yr,new Uint8Array(16),"f"),pr(this,yr,"f").fill(0),Bi(this,yo,pr(this,yr,"f"),"f"),Bi(this,Ds,16,"f"),t==null&&(t=1),typeof t=="number"?this.setCounterValue(t):this.setCounterBytes(t)}get counter(){return new Uint8Array(pr(this,yr,"f"))}setCounterValue(e){if(!Number.isInteger(e)||e<0||e>Number.MAX_SAFE_INTEGER)throw new TypeError("invalid counter initial integer value");for(let t=15;t>=0;--t)pr(this,yr,"f")[t]=e%256,e=Math.floor(e/256)}setCounterBytes(e){if(e.length!==16)throw new TypeError("invalid counter initial Uint8Array value length");pr(this,yr,"f").set(e)}increment(){for(let e=15;e>=0;e--)if(pr(this,yr,"f")[e]===255)pr(this,yr,"f")[e]=0;else{pr(this,yr,"f")[e]++;break}}encrypt(e){var t,r;const s=new Uint8Array(e);for(let i=0;i<s.length;i++)pr(this,Ds,"f")===16&&(Bi(this,yo,this.aes.encrypt(pr(this,yr,"f")),"f"),Bi(this,Ds,0,"f"),this.increment()),s[i]^=pr(this,yo,"f")[Bi(this,Ds,(r=pr(this,Ds,"f"),t=r++,r),"f"),t];return s}decrypt(e){return this.encrypt(e)}}yo=new WeakMap,Ds=new WeakMap,yr=new WeakMap;function h1(n){if(n.length<16)throw new TypeError("PKCS#7 invalid length");const e=n[n.length-1];if(e>16)throw new TypeError("PKCS#7 padding byte out of range");const t=n.length-e;for(let r=0;r<e;r++)if(n[t+r]!==e)throw new TypeError("PKCS#7 invalid padding byte");return new Uint8Array(n.subarray(0,t))}function Lx(n){return typeof n=="string"&&!n.startsWith("0x")&&(n="0x"+n),_t(n)}function fo(n,e){for(n=String(n);n.length<e;)n="0"+n;return n}function ic(n){return typeof n=="string"?Be(n,"NFKC"):_t(n)}function yt(n,e){const t=e.match(/^([a-z0-9$_.-]*)(:([a-z]+))?(!)?$/i);w(t!=null,"invalid path","path",e);const r=t[1],s=t[3],i=t[4]==="!";let a=n;for(const o of r.toLowerCase().split(".")){if(Array.isArray(a)){if(!o.match(/^[0-9]+$/))break;a=a[parseInt(o)]}else if(typeof a=="object"){let c=null;for(const l in a)if(l.toLowerCase()===o){c=a[l];break}a=c}else a=null;if(a==null)break}if(w(!i||a!=null,"missing required value","path",r),s&&a!=null){if(s==="int"){if(typeof a=="string"&&a.match(/^-?[0-9]+$/))return parseInt(a);if(Number.isSafeInteger(a))return a}if(s==="number"&&typeof a=="string"&&a.match(/^-?[0-9.]*$/))return parseFloat(a);if(s==="data"&&typeof a=="string")return Lx(a);if(s==="array"&&Array.isArray(a)||s===typeof a)return a;w(!1,`wrong type found for ${s} `,"path",r)}return a}const Fx="m/44'/60'/0'/0/0";function Z0(n){try{const e=JSON.parse(n);if((e.version!=null?parseInt(e.version):0)===3)return!0}catch{}return!1}function x1(n,e,t){if(yt(n,"crypto.cipher:string")==="aes-128-ctr"){const s=yt(n,"crypto.cipherparams.iv:data!"),i=new Wa(e,s);return V(i.decrypt(t))}F(!1,"unsupported cipher","UNSUPPORTED_OPERATION",{operation:"decrypt"})}function Yc(n,e){const t=ae(e),r=yt(n,"crypto.ciphertext:data!"),s=V(Ue(qe([t.slice(16,32),r]))).substring(2);w(s===yt(n,"crypto.mac:string!").toLowerCase(),"incorrect password","password","[ REDACTED ]");const i=x1(n,t.slice(0,16),r),a=tc(i);if(n.address){let l=n.address.toLowerCase();l.startsWith("0x")||(l="0x"+l),w(ze(l)===a,"keystore address/privateKey mismatch","address",n.address)}const o={address:a,privateKey:i};if(yt(n,"x-ethers.version:string")==="0.1"){const l=t.slice(32,64),d=yt(n,"x-ethers.mnemonicCiphertext:data!"),f=yt(n,"x-ethers.mnemonicCounter:data!"),x=new Wa(l,f);o.mnemonic={path:yt(n,"x-ethers.path:string")||Fx,locale:yt(n,"x-ethers.locale:string")||"en",entropy:V(ae(x.decrypt(d)))}}return o}function Mx(n){const e=yt(n,"crypto.kdf:string");if(e&&typeof e=="string"){if(e.toLowerCase()==="scrypt"){const t=yt(n,"crypto.kdfparams.salt:data!"),r=yt(n,"crypto.kdfparams.n:int!"),s=yt(n,"crypto.kdfparams.r:int!"),i=yt(n,"crypto.kdfparams.p:int!");w(r>0&&(r&r-1)===0,"invalid kdf.N","kdf.N",r),w(s>0&&i>0,"invalid kdf","kdf",e);const a=yt(n,"crypto.kdfparams.dklen:int!");return w(a===32,"invalid kdf.dklen","kdf.dflen",a),{name:"scrypt",salt:t,N:r,r:s,p:i,dkLen:64}}else if(e.toLowerCase()==="pbkdf2"){const t=yt(n,"crypto.kdfparams.salt:data!"),r=yt(n,"crypto.kdfparams.prf:string!"),s=r.split("-").pop();w(s==="sha256"||s==="sha512","invalid kdf.pdf","kdf.pdf",r);const i=yt(n,"crypto.kdfparams.c:int!"),a=yt(n,"crypto.kdfparams.dklen:int!");return w(a===32,"invalid kdf.dklen","kdf.dklen",a),{name:"pbkdf2",salt:t,count:i,dkLen:a,algorithm:s}}}w(!1,"unsupported key-derivation function","kdf",e)}function g1(n,e){const t=JSON.parse(n),r=ic(e),s=Mx(t);if(s.name==="pbkdf2"){const{salt:f,count:x,dkLen:g,algorithm:b}=s,p=Ss(r,f,x,g,b);return Yc(t,p)}F(s.name==="scrypt","cannot be reached","UNKNOWN_ERROR",{params:s});const{salt:i,N:a,r:o,p:c,dkLen:l}=s,d=no(r,i,a,o,c,l);return Yc(t,d)}function Y0(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}async function p1(n,e,t){const r=JSON.parse(n),s=ic(e),i=Mx(r);if(i.name==="pbkdf2"){t&&(t(0),await Y0(0));const{salt:x,count:g,dkLen:b,algorithm:p}=i,y=Ss(s,x,g,b,p);return t&&(t(1),await Y0(0)),Yc(r,y)}F(i.name==="scrypt","cannot be reached","UNKNOWN_ERROR",{params:i});const{salt:a,N:o,r:c,p:l,dkLen:d}=i,f=await ro(s,a,o,c,l,d,t);return Yc(r,f)}function Gx(n){const e=n.salt!=null?ae(n.salt,"options.salt"):Hn(32);let t=1<<17,r=8,s=1;return n.scrypt&&(n.scrypt.N&&(t=n.scrypt.N),n.scrypt.r&&(r=n.scrypt.r),n.scrypt.p&&(s=n.scrypt.p)),w(typeof t=="number"&&t>0&&Number.isSafeInteger(t)&&(BigInt(t)&BigInt(t-1))===BigInt(0),"invalid scrypt N parameter","options.N",t),w(typeof r=="number"&&r>0&&Number.isSafeInteger(r),"invalid scrypt r parameter","options.r",r),w(typeof s=="number"&&s>0&&Number.isSafeInteger(s),"invalid scrypt p parameter","options.p",s),{name:"scrypt",dkLen:32,salt:e,N:t,r,p:s}}function Xx(n,e,t,r){const s=ae(t.privateKey,"privateKey"),i=r.iv!=null?ae(r.iv,"options.iv"):Hn(16);w(i.length===16,"invalid options.iv length","options.iv",r.iv);const a=r.uuid!=null?ae(r.uuid,"options.uuid"):Hn(16);w(a.length===16,"invalid options.uuid length","options.uuid",r.iv);const o=n.slice(0,16),c=n.slice(16,32),l=new Wa(o,i),d=ae(l.encrypt(s)),f=Ue(qe([c,d])),x={address:t.address.substring(2).toLowerCase(),id:hp(a),version:3,Crypto:{cipher:"aes-128-ctr",cipherparams:{iv:V(i).substring(2)},ciphertext:V(d).substring(2),kdf:"scrypt",kdfparams:{salt:V(e.salt).substring(2),n:e.N,dklen:32,p:e.p,r:e.r},mac:f.substring(2)}};if(t.mnemonic){const g=r.client!=null?r.client:`ethers/${bf}`,b=t.mnemonic.path||Fx,p=t.mnemonic.locale||"en",y=n.slice(32,64),v=ae(t.mnemonic.entropy,"account.mnemonic.entropy"),I=Hn(16),N=new Wa(y,I),P=ae(N.encrypt(v)),S=new Date,z="UTC--"+(S.getUTCFullYear()+"-"+fo(S.getUTCMonth()+1,2)+"-"+fo(S.getUTCDate(),2)+"T"+fo(S.getUTCHours(),2)+"-"+fo(S.getUTCMinutes(),2)+"-"+fo(S.getUTCSeconds(),2)+".0Z")+"--"+x.address;x["x-ethers"]={client:g,gethFilename:z,path:b,locale:p,mnemonicCounter:V(I).substring(2),mnemonicCiphertext:V(P).substring(2),version:"0.1"}}return JSON.stringify(x)}function Hx(n,e,t){t==null&&(t={});const r=ic(e),s=Gx(t),i=no(r,s.salt,s.N,s.r,s.p,64);return Xx(ae(i),s,n,t)}async function zx(n,e,t){t==null&&(t={});const r=ic(e),s=Gx(t),i=await ro(r,s.salt,s.N,s.r,s.p,64,t.progressCallback);return Xx(ae(i),s,n,t)}const ed="m/44'/60'/0'/0/0",b1=new Uint8Array([66,105,116,99,111,105,110,32,115,101,101,100]),Es=2147483648,m1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),y1="0123456789abcdef";function qc(n,e){let t="";for(;n;)t=y1[n%16]+t,n=Math.trunc(n/16);for(;t.length<e*2;)t="0"+t;return"0x"+t}function Hd(n){const e=ae(n),t=ct(Nr(Nr(e)),0,4),r=qe([e,t]);return Ef(r)}const en={};function $x(n,e,t,r){const s=new Uint8Array(37);n&Es?(F(r!=null,"cannot derive child of neutered node","UNSUPPORTED_OPERATION",{operation:"deriveChild"}),s.set(ae(r),1)):s.set(ae(t));for(let a=24;a>=0;a-=8)s[33+(a>>3)]=n>>24-a&255;const i=ae(eo("sha512",e,s));return{IL:i.slice(0,32),IR:i.slice(32)}}function Kx(n,e){const t=e.split("/");w(t.length>0,"invalid path","path",e),t[0]==="m"&&(w(n.depth===0,`cannot derive root path (i.e. path starting with "m/") for a node at non-zero depth ${n.depth}`,"path",e),t.shift());let r=n;for(let s=0;s<t.length;s++){const i=t[s];if(i.match(/^[0-9]+'$/)){const a=parseInt(i.substring(0,i.length-1));w(a<Es,"invalid path index",`path[${s}]`,i),r=r.deriveChild(Es+a)}else if(i.match(/^[0-9]+$/)){const a=parseInt(i);w(a<Es,"invalid path index",`path[${s}]`,i),r=r.deriveChild(a)}else w(!1,"invalid path component",`path[${s}]`,i)}return r}var Zo,zd,gi,wo;const Rr=class Rr extends jc{constructor(t,r,s,i,a,o,c,l,d){super(r,d);k(this,Zo);E(this,"publicKey");E(this,"fingerprint");E(this,"parentFingerprint");E(this,"mnemonic");E(this,"chainCode");E(this,"path");E(this,"index");E(this,"depth");Is(t,en,"HDNodeWallet"),me(this,{publicKey:r.compressedPublicKey});const f=ct(to(Nr(this.publicKey)),0,4);me(this,{parentFingerprint:s,fingerprint:f,chainCode:i,path:a,index:o,depth:c}),me(this,{mnemonic:l})}connect(t){return new Rr(en,this.signingKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,this.mnemonic,t)}async encrypt(t,r){return await zx(X(this,Zo,zd).call(this),t,{progressCallback:r})}encryptSync(t){return Hx(X(this,Zo,zd).call(this),t)}get extendedKey(){return F(this.depth<256,"Depth too deep","UNSUPPORTED_OPERATION",{operation:"extendedKey"}),Hd(qe(["0x0488ADE4",qc(this.depth,1),this.parentFingerprint,qc(this.index,4),this.chainCode,qe(["0x00",this.privateKey])]))}hasPath(){return this.path!=null}neuter(){return new Do(en,this.address,this.publicKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,this.provider)}deriveChild(t){const r=_e(t,"index");w(r<=4294967295,"invalid index","index",r);let s=this.path;s&&(s+="/"+(r&~Es),r&Es&&(s+="'"));const{IR:i,IL:a}=$x(r,this.chainCode,this.publicKey,this.privateKey),o=new gn($n((Kr(a)+BigInt(this.privateKey))%m1,32));return new Rr(en,o,this.fingerprint,V(i),s,r,this.depth+1,this.mnemonic,this.provider)}derivePath(t){return Kx(this,t)}static fromExtendedKey(t){const r=gt(Qg(t));w(r.length===82||Hd(r.slice(0,78))===t,"invalid extended key","extendedKey","[ REDACTED ]");const s=r[4],i=V(r.slice(5,9)),a=parseInt(V(r.slice(9,13)).substring(2),16),o=V(r.slice(13,45)),c=r.slice(45,78);switch(V(r.slice(0,4))){case"0x0488b21e":case"0x043587cf":{const l=V(c);return new Do(en,tc(l),l,i,o,null,a,s,null)}case"0x0488ade4":case"0x04358394 ":if(c[0]!==0)break;return new Rr(en,new gn(c.slice(1)),i,o,null,a,s,null,null)}w(!1,"invalid extended key prefix","extendedKey","[ REDACTED ]")}static createRandom(t,r,s){var a;t==null&&(t=""),r==null&&(r=ed),s==null&&(s=Ei.wordlist());const i=Qa.fromEntropy(Hn(16),t,s);return X(a=Rr,gi,wo).call(a,i.computeSeed(),i).derivePath(r)}static fromMnemonic(t,r){var s;return r||(r=ed),X(s=Rr,gi,wo).call(s,t.computeSeed(),t).derivePath(r)}static fromPhrase(t,r,s,i){var o;r==null&&(r=""),s==null&&(s=ed),i==null&&(i=Ei.wordlist());const a=Qa.fromPhrase(t,r,i);return X(o=Rr,gi,wo).call(o,a.computeSeed(),a).derivePath(s)}static fromSeed(t){var r;return X(r=Rr,gi,wo).call(r,t,null)}};Zo=new WeakSet,zd=function(){const t={address:this.address,privateKey:this.privateKey},r=this.mnemonic;return this.path&&r&&r.wordlist.locale==="en"&&r.password===""&&(t.mnemonic={path:this.path,locale:"en",entropy:r.entropy}),t},gi=new WeakSet,wo=function(t,r){w(ll(t),"invalid seed","seed","[REDACTED]");const s=ae(t,"seed");w(s.length>=16&&s.length<=64,"invalid seed","seed","[REDACTED]");const i=ae(eo("sha512",b1,s)),a=new gn(V(i.slice(0,32)));return new Rr(en,a,"0x00000000",V(i.slice(32)),"m",0,0,r,null)},k(Rr,gi);let Eo=Rr;class Do extends Rd{constructor(t,r,s,i,a,o,c,l,d){super(r,d);E(this,"publicKey");E(this,"fingerprint");E(this,"parentFingerprint");E(this,"chainCode");E(this,"path");E(this,"index");E(this,"depth");Is(t,en,"HDNodeVoidWallet"),me(this,{publicKey:s});const f=ct(to(Nr(s)),0,4);me(this,{publicKey:s,fingerprint:f,parentFingerprint:i,chainCode:a,path:o,index:c,depth:l})}connect(t){return new Do(en,this.address,this.publicKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,t)}get extendedKey(){return F(this.depth<256,"Depth too deep","UNSUPPORTED_OPERATION",{operation:"extendedKey"}),Hd(qe(["0x0488B21E",qc(this.depth,1),this.parentFingerprint,qc(this.index,4),this.chainCode,this.publicKey]))}hasPath(){return this.path!=null}deriveChild(t){const r=_e(t,"index");w(r<=4294967295,"invalid index","index",r);let s=this.path;s&&(s+="/"+(r&~Es),r&Es&&(s+="'"));const{IR:i,IL:a}=$x(r,this.chainCode,this.publicKey,null),o=gn.addPoints(a,this.publicKey,!0),c=tc(o);return new Do(en,c,o,this.fingerprint,V(i),s,r,this.depth+1,this.provider)}derivePath(t){return Kx(this,t)}}function q0(n){try{if(JSON.parse(n).encseed)return!0}catch{}return!1}function ef(n,e){const t=JSON.parse(n),r=ic(e),s=ze(yt(t,"ethaddr:string!")),i=Lx(yt(t,"encseed:string!"));w(i&&i.length%16===0,"invalid encseed","json",n);const a=ae(Ss(r,r,2e3,32,"sha256")).slice(0,16),o=i.slice(0,16),c=i.slice(16),l=new wu(a,o),d=h1(ae(l.decrypt(c)));let f="";for(let x=0;x<d.length;x++)f+=String.fromCharCode(d[x]);return{address:s,privateKey:Vn(f)}}function tf(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}var Yo,$d;const zs=class zs extends jc{constructor(e,t){typeof e=="string"&&!e.startsWith("0x")&&(e="0x"+e);let r=typeof e=="string"?new gn(e):e;super(r,t)}connect(e){return new zs(this.signingKey,e)}async encrypt(e,t){const r={address:this.address,privateKey:this.privateKey};return await zx(r,e,{progressCallback:t})}encryptSync(e){const t={address:this.address,privateKey:this.privateKey};return Hx(t,e)}static async fromEncryptedJson(e,t,r){var i;let s=null;return Z0(e)?s=await p1(e,t,r):q0(e)&&(r&&(r(0),await tf(0)),s=ef(e,t),r&&(r(1),await tf(0))),X(i=zs,Yo,$d).call(i,s)}static fromEncryptedJsonSync(e,t){var s;let r=null;return Z0(e)?r=g1(e,t):q0(e)?r=ef(e,t):w(!1,"invalid JSON wallet","json","[ REDACTED ]"),X(s=zs,Yo,$d).call(s,r)}static createRandom(e){const t=Eo.createRandom();return e?t.connect(e):t}static fromPhrase(e,t){const r=Eo.fromPhrase(e);return t?r.connect(t):r}};Yo=new WeakSet,$d=function(e){if(w(e,"invalid JSON wallet","json","[ REDACTED ]"),"mnemonic"in e&&e.mnemonic&&e.mnemonic.locale==="en"){const r=Qa.fromEntropy(e.mnemonic.entropy),s=Eo.fromMnemonic(r,e.mnemonic.path);if(s.address===e.address&&s.privateKey===e.privateKey)return s;console.log("WARNING: JSON mismatch address/privateKey != mnemonic; fallback onto private key")}const t=new zs(e.privateKey);return w(t.address===e.address,"address/privateKey mismatch","json","[ REDACTED ]"),t},k(zs,Yo);let ir=zs;var mt=(n=>(n.DEPOSIT="DEPOSIT",n.SPLIT="SPLIT",n.COMBINE="COMBINE",n.TRANSFER="TRANSFER",n))(mt||{});class hr extends Error{constructor(e,t,r,s){super(e),this.operation=t,this.utxoId=r,this.details=s,this.name="UTXOOperationError"}}class rf extends hr{constructor(e){super(`UTXO not found: ${e}`,"lookup",e),this.name="UTXONotFoundError"}}class w1 extends hr{constructor(e,t,r){super(`Insufficient funds: required ${e}, available ${t}`,"balance_check",void 0,{required:e,available:t,tokenAddress:r}),this.name="InsufficientFundsError"}}class nf extends hr{constructor(e){super(`UTXO already spent: ${e}`,"spend",e),this.name="UTXOAlreadySpentError"}}var Jt=(n=>(n.METAMASK="metamask",n.WALLET_CONNECT="walletconnect",n.COINBASE_WALLET="coinbase",n.INJECTED="injected",n.CUSTOM="custom",n))(Jt||{}),Lc=(n=>(n.MESSAGE_SIGNATURE="message_signature",n.TYPED_DATA_SIGNATURE="typed_data_signature",n.DETERMINISTIC_HASH="deterministic_hash",n))(Lc||{});class Zt extends Error{constructor(e,t,r){super(e),this.code=t,this.data=r,this.name="EthereumError"}}class sf extends Zt{constructor(){super("Wallet not connected",4001),this.name="WalletNotConnectedError"}}class v1 extends Zt{constructor(e){super(`Unsupported chain: ${e}`,4902,{chainId:e}),this.name="UnsupportedChainError"}}class af extends Zt{constructor(e,t){super(`Transaction reverted${e?`: ${e}`:""}`,-32e3,{reason:e,txHash:t}),this.name="TransactionRevertedError"}}const A1={mainnet:{chainId:1,name:"Ethereum Mainnet",rpcUrls:["https://mainnet.infura.io/v3/","https://eth-mainnet.alchemyapi.io/v2/"],nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://etherscan.io"],testnet:!1},polygon:{chainId:137,name:"Polygon Mainnet",rpcUrls:["https://polygon-rpc.com/"],nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://polygonscan.com"],testnet:!1},sepolia:{chainId:11155111,name:"Sepolia Testnet",rpcUrls:["https://sepolia.infura.io/v3/"],nativeCurrency:{name:"Sepolia Ether",symbol:"SEP",decimals:18},blockExplorerUrls:["https://sepolia.etherscan.io"],testnet:!0}},_i={balanceOf:"function balanceOf(address owner) view returns (uint256)",allowance:"function allowance(address owner, address spender) view returns (uint256)",approve:"function approve(address spender, uint256 amount) returns (bool)",name:"function name() view returns (string)",symbol:"function symbol() view returns (string)",decimals:"function decimals() view returns (uint8)"},E1=["constructor()","function utxos(bytes32) view returns (bool exists, uint256 value, address tokenAddress, address owner, uint256 timestamp, bool isSpent, bytes32 commitment, bytes32 parentUTXO, uint8 utxoType)","function utxosByOwner(address, uint256) view returns (bytes32)","function utxoIndexByOwner(address, bytes32) view returns (uint256)","function splitOperations(bytes32) view returns (bytes32 inputUTXO, bytes32[] outputUTXOs, address[] outputOwners, uint256[] outputValues, bytes splitProof, uint256 timestamp)","function combineOperations(bytes32) view returns (bytes32[] inputUTXOs, bytes32 outputUTXO, address outputOwner, uint256 totalValue, bytes combineProof, uint256 timestamp)","function nonces(address) view returns (uint256)","function supportedTokens(address) view returns (bool)","function useWhitelist() view returns (bool)","function tokenBalances(address) view returns (uint256)","function tokensUsed(uint256) view returns (address)","function tokenExists(address) view returns (bool)","function requireZenroomProofs() view returns (bool)","function verifiedZenroomProofs(bytes32) view returns (bool)","function authorizedIssuers(address) view returns (bool)","function issuerPublicKeys(address) view returns (bytes)","function requireBBSProofs() view returns (bool)","function enableSelectiveDisclosure() view returns (bool)","function proofValidityPeriod() view returns (uint256)","function depositAsUTXO(address tokenAddress, uint256 amount, bytes32 commitment, bytes calldata zenroomProof) external","function withdrawFromUTXO(bytes32 utxoId, bytes calldata burnProof, bytes calldata openingProof) external","function splitUTXO(bytes32 inputUTXOId, bytes32[] calldata outputCommitments, address[] calldata outputOwners, uint256[] calldata outputValues, bytes calldata splitProof) external returns (bytes32[] memory)","function combineUTXOs(bytes32[] calldata inputUTXOIds, bytes32 outputCommitment, address outputOwner, bytes calldata combineProof) external returns (bytes32)","function transferUTXO(bytes32 utxoId, address newOwner, bytes calldata transferProof) external","function depositAsPrivateUTXO(address tokenAddress, uint256 amount, bytes32 commitment, (bytes proof, bytes32[] disclosedAttributes, uint256[] disclosureIndexes, bytes32 challenge, uint256 timestamp) bbsProof, bytes32 nullifierHash, bytes rangeProof) external","function depositAsPrivateUTXO_Test(address tokenAddress, uint256 amount) external","function splitPrivateUTXO(bytes32 inputCommitment, bytes32[] calldata outputCommitments, (bytes proof, bytes32[] disclosedAttributes, uint256[] disclosureIndexes, bytes32 challenge, uint256 timestamp) splitProof, bytes calldata equalityProof, bytes32 nullifierHash) external returns (bytes32[] memory)","function transferPrivateUTXO(bytes32 inputCommitment, bytes32 outputCommitment, (bytes proof, bytes32[] disclosedAttributes, uint256[] disclosureIndexes, bytes32 challenge, uint256 timestamp) transferProof, address newOwner, bytes32 nullifierHash) external","function withdrawFromPrivateUTXO(bytes32 commitment, (bytes proof, bytes32[] disclosedAttributes, uint256[] disclosureIndexes, bytes32 challenge, uint256 timestamp) withdrawProof, bytes32 nullifierHash) external","function getUTXOsByOwner(address owner) external view returns (bytes32[] memory)","function getUTXOInfo(bytes32 utxoId) external view returns (bool exists, bytes32 commitment, address tokenAddress, address owner, uint256 timestamp, bool isSpent, bytes32 parentUTXO, uint8 utxoType, bytes32 nullifierHash)","function getSplitOperation(bytes32 operationId) external view returns (bytes32 inputUTXO, bytes32[] memory outputUTXOs, address[] memory outputOwners, uint256[] memory outputValues, bytes memory splitProof, uint256 timestamp)","function getCombineOperation(bytes32 operationId) external view returns (bytes32[] memory inputUTXOs, bytes32 outputUTXO, address outputOwner, uint256 totalValue, bytes memory combineProof, uint256 timestamp)","function getUTXOCommitment(bytes32 utxoId) external view returns (bytes32)","function isNullifierUsed(bytes32 nullifier) external view returns (bool)","function getUserUTXOCount(address user) external view returns (uint256)","function setZenroomProofRequirement(bool required) external","function addSupportedToken(address tokenAddress) external","function setUseWhitelist(bool _useWhitelist) external","function addAuthorizedIssuer(address issuer, bytes calldata publicKey) external","function revokeCredential(bytes32 credentialId) external","function updatePrivacySettings(bool _requireBBSProofs, bool _enableSelectiveDisclosure, uint256 _proofValidityPeriod) external","event UTXOCreated(bytes32 indexed utxoId, address indexed owner, address indexed tokenAddress, uint256 value, bytes32 commitment, uint8 utxoType, bytes32 parentUTXO)","event UTXOSplit(bytes32 indexed inputUTXO, address indexed inputOwner, bytes32[] outputUTXOs, address[] outputOwners, uint256[] outputValues, bytes32 indexed operationId)","event UTXOCombined(bytes32[] inputUTXOs, address indexed inputOwner, bytes32 indexed outputUTXO, address indexed outputOwner, uint256 totalValue, bytes32 operationId)","event UTXOTransferred(bytes32 indexed utxoId, address indexed fromOwner, address indexed toOwner, uint256 value, address tokenAddress)","event UTXOWithdrawn(bytes32 indexed utxoId, address indexed owner, address indexed tokenAddress, uint256 value)","event PrivateUTXOCreated(bytes32 indexed commitment, address indexed owner, address indexed tokenAddress, bytes32 nullifierHash, uint8 utxoType)","event PrivateTransfer(bytes32 indexed inputCommitment, bytes32 indexed outputCommitment, bytes32 nullifierHash, bytes32 transferProof)","event PrivateWithdrawal(bytes32 indexed commitment, address indexed recipient, bytes32 nullifierHash)","event BBSCredentialRevoked(bytes32 indexed credentialId, address indexed issuer, uint256 timestamp)","function owner() view returns (address)","function transferOwnership(address newOwner) external","function renounceOwnership() external","event OwnershipTransferred(address indexed previousOwner, address indexed newOwner)"];function T1(n,e){return new Ur(n,E1,e)}const Ac={UTXO_TYPES:{DEPOSIT:0,SPLIT:1,COMBINE:2,TRANSFER:3}};class qn extends Error{constructor(e,t,r){super(e),this.logs=t,this.zencode=r,this.name="ZenroomExecutionError"}}let td=null,of=!1;async function Vx(){if(of)return td;try{return console.log("🔧 Loading Zenroom package..."),td=await Zr(()=>import("../chunks/D0m26XjS.js"),[],import.meta.url),of=!0,console.log("✅ Zenroom loaded successfully"),td}catch(n){return console.warn("❌ Failed to load zenroom:",n),null}}const dt=async(n,e={})=>{const t=await Vx();if(!t)throw new Error("Zenroom not available");console.log("🔧 Executing Zencode:",n.substring(0,100)+"..."),console.log("🔧 With options:",e);try{const r=await t.zencode_exec(n,e);return console.log("✅ Zencode executed successfully:",r),r}catch(r){throw console.error("❌ Zencode execution failed:",r),r}},br=async()=>!!await Vx();class ot{static async generateSecureNonce(e=256){if(!await br()){const s=new Uint8Array(e/8);crypto.getRandomValues(s);const i=Array.from(s,o=>o.toString(16).padStart(2,"0")).join(""),a=i.startsWith("0x")?i:`0x${i}`;return console.log("🎲 Generated fallback nonce:",a),a}const r=`Given nothing
When I create the random object of '${e/8}' bytes  
Then print 'random object' as 'hex'`;try{console.log("🔧 Generating nonce with Zenroom...");const s=await dt(r);if(!s.result)throw new Error("Empty result from Zenroom");const i=JSON.parse(s.result),a=i["random object"]||i.random_bytes;if(!a||typeof a!="string")throw new Error("Invalid random bytes from Zenroom");const o=a.startsWith("0x")?a:`0x${a}`;return console.log("✅ Generated Zenroom nonce:",o),o}catch(s){console.warn("❌ Zenroom nonce generation failed, falling back to crypto API:",s);const i=new Uint8Array(e/8);crypto.getRandomValues(i);const a=Array.from(i,c=>c.toString(16).padStart(2,"0")).join(""),o=a.startsWith("0x")?a:`0x${a}`;return console.log("🎲 Generated fallback nonce after error:",o),o}}static async createPedersenCommitment(e,t){console.log("🔒 Creating Pedersen commitment...",{value:e,hasBlindingFactor:!!t});try{const r=t||await this.generateSecureNonce();if(console.log("🔒 Using blinding factor:",r,"type:",typeof r),typeof e!="string"||typeof r!="string")throw new Error(`Invalid input types: value=${typeof e}, blinding=${typeof r}`);if(await br()){console.log("🔒 Using Zenroom for Pedersen commitment");const o=`
Given I have a 'string' named 'input_data'
When I create the hash of 'input_data'
Then print 'hash' as 'hex'
        `,c=`${e}:${r}`,l=JSON.stringify({input_data:c});try{console.log("🔧 Executing Zenroom commitment script...");const d=await dt(o,{data:l});if(!d.result)throw new Error("Empty result from Zenroom");const f=JSON.parse(d.result);console.log("✅ Zenroom commitment created successfully:",f);const x=f.hash.startsWith("0x")?f.hash:`0x${f.hash}`,g=r.startsWith("0x")?r:`0x${r}`;return{pedersen_commitment:x,blinding_factor:g,commitment_proof:x}}catch(d){console.warn("⚠️ Zenroom commitment failed, falling back to hash-based commitment:",d)}}console.log("🔒 Using hash-based commitment fallback");const i=Lt(["string","string"],[e,r]);console.log("✅ Hash-based commitment created successfully:",i);const a=r.startsWith("0x")?r:`0x${r}`;return{pedersen_commitment:i,blinding_factor:a,commitment_proof:i}}catch(r){throw console.error("❌ Failed to create commitment:",r),new qn("Failed to create Pedersen commitment",r instanceof Error?r.message:"Unknown error","commitment creation")}}static async verifyCommitmentOpening(e,t,r){const s=`
Given I have a 'string' named 'input_data'
When I create the hash of 'input_data'
Then print 'hash' as 'hex'
    `,i=`${t}:${r}`,a=JSON.stringify({input_data:i});try{const o=await dt(s,{data:a});return JSON.parse(o.result).hash===e}catch{return Lt(["string","string"],[t,r])===e}}static async generateSplitProof(e,t,r,s,i){if(s.length!==i.length)throw new Error("Output values and blinding factors arrays must have same length");const a=s.reduce((l,d)=>l+parseInt(d),0);if(a!==parseInt(t))throw new Error(`Sum of outputs (${a}) does not equal input (${t})`);const o=`
    Scenario 'ethereum': Generate split proof
    Given I have a 'hex' named 'input_commitment'
    Given I have a 'integer' named 'input_value'
    Given I have a 'integer' named 'input_blinding'
    Given I have a 'integer array' named 'output_values'
    Given I have a 'integer array' named 'output_blindings'
    
    When I verify the commitment 'input_commitment' opens to 'input_value' with 'input_blinding'
    And I verify that sum of 'output_values' equals 'input_value'
    And I create the split proof for outputs
    And I create the output commitments from 'output_values' and 'output_blindings'
    And I create the split signature
    
    Then print the 'split proof' as 'hex'
    And print the 'output commitments' as 'hex'
    And print the 'split signature' as 'hex'
    `,c=JSON.stringify({input_commitment:e,input_value:t,input_blinding:r,output_values:s,output_blindings:i});try{const l=await dt(o,{data:c}),d=JSON.parse(l.result);return{split_proof:d.split_proof,output_commitments:d.output_commitments,signatures:[d.split_signature]}}catch(l){throw new qn("Failed to generate split proof",l instanceof Error?l.message:"Unknown error",o)}}static async generateCombineProof(e,t,r,s){if(e.length!==t.length||t.length!==r.length)throw new Error("Input arrays must have same length");const i=t.reduce((c,l)=>c+parseInt(l),0).toString(),a=`
    Scenario 'ethereum': Generate combine proof
    Given I have a 'hex array' named 'input_commitments'
    Given I have a 'integer array' named 'input_values'
    Given I have a 'integer array' named 'input_blindings'
    Given I have a 'integer' named 'total_value'
    Given I have a 'integer' named 'output_blinding'
    
    When I verify all input commitments open correctly
    And I verify that sum of 'input_values' equals 'total_value'
    And I create the combine proof for inputs
    And I create the output commitment of 'total_value' with 'output_blinding'
    And I create the combine signature
    
    Then print the 'combine proof' as 'hex'
    `,o=JSON.stringify({input_commitments:e,input_values:t,input_blindings:r,total_value:i,output_blinding:s});try{const c=await dt(a,{data:o});return JSON.parse(c.result).combine_proof}catch(c){throw new qn("Failed to generate combine proof",c instanceof Error?c.message:"Unknown error",a)}}static async generateOwnershipProof(e,t,r,s){const i=`
    Scenario 'ethereum': Generate ownership proof
    Given I have a 'string' named 'utxo_id'
    Given I have a 'hex' named 'utxo_commitment'
    Given I have a 'string' named 'eoa_address'
    Given I have a 'hex' named 'eoa_signature'
    
    When I create the ownership binding of 'utxo_id' to 'eoa_address'
    And I create the commitment ownership proof for 'utxo_commitment'
    And I combine the eoa signature with zenroom proof
    And I create the final ownership proof
    
    Then print the 'ownership proof' as 'hex'
    And print the 'eoa signature component' as 'hex'
    And print the 'zenroom signature component' as 'hex'
    `,a=JSON.stringify({utxo_id:e,utxo_commitment:t,eoa_address:r,eoa_signature:s});try{const o=await dt(i,{data:a}),c=JSON.parse(o.result);return{ownership_proof:c.ownership_proof,eoa_signature:c.eoa_signature_component,zenroom_signature:c.zenroom_signature_component}}catch(o){throw new qn("Failed to generate ownership proof",o instanceof Error?o.message:"Unknown error",i)}}static async deriveKeyFromEOA(e,t,r,s="m/44'/60'/0'/0/0"){const i=`
    Scenario 'ethereum': Derive key from EOA
    Given I have a 'string' named 'eoa_address'
    Given I have a 'string' named 'signed_message'
    Given I have a 'hex' named 'signature'
    Given I have a 'string' named 'derivation_path'
    
    When I verify the ethereum signature 'signature' of 'signed_message' by 'eoa_address'
    And I derive the private key from signature using 'derivation_path'
    And I create the public key from private key
    And I set the curve to 'secp256k1'
    
    Then print the 'private key' as 'hex'
    And print the 'public key' as 'hex'
    And print the 'derivation path'
    And print the 'curve'
    `,a=JSON.stringify({eoa_address:e,signed_message:t,signature:r,derivation_path:s});try{const o=await dt(i,{data:a}),c=JSON.parse(o.result);return{private_key:c.private_key,public_key:c.public_key,derivation_path:c.derivation_path,curve:c.curve}}catch(o){throw new qn("Failed to derive key from EOA",o instanceof Error?o.message:"Unknown error",i)}}static async generateBurnProof(e,t,r,s,i){const a=`
    Scenario 'ethereum': Generate burn proof
    Given I have a 'string' named 'utxo_id'
    Given I have a 'hex' named 'commitment'
    Given I have a 'integer' named 'value'
    Given I have a 'integer' named 'blinding_factor'
    Given I have a 'string' named 'eoa_address'
    
    When I verify the commitment 'commitment' opens to 'value' with 'blinding_factor'
    And I create the burn authorization for 'utxo_id' by 'eoa_address'
    And I create the destruction proof
    And I create the burn signature
    
    Then print the 'burn proof' as 'hex'
    `,o=JSON.stringify({utxo_id:e,commitment:t,value:r,blinding_factor:s,eoa_address:i});try{const c=await dt(a,{data:o});return JSON.parse(c.result).burn_proof}catch(c){throw new qn("Failed to generate burn proof",c instanceof Error?c.message:"Unknown error",a)}}static async generateTransferProof(e,t,r,s){const i=`
    Scenario 'ethereum': Generate transfer proof
    Given I have a 'string' named 'utxo_id'
    Given I have a 'string' named 'from_address'
    Given I have a 'string' named 'to_address'
    Given I have a 'hex' named 'commitment'
    
    When I create the transfer authorization from 'from_address' to 'to_address'
    And I bind the transfer to 'utxo_id' and 'commitment'
    And I create the transfer proof
    And I create the transfer signature
    
    Then print the 'transfer proof' as 'hex'
    `,a=JSON.stringify({utxo_id:e,from_address:t,to_address:r,commitment:s});try{const o=await dt(i,{data:a});return JSON.parse(o.result).transfer_proof}catch(o){throw new qn("Failed to generate transfer proof",o instanceof Error?o.message:"Unknown error",i)}}static async hashData(e,t="sha256"){const r=`
    Given I have a 'string' named 'data'
    When I create the hash of 'data' using '${t}'
    Then print the 'hash' as 'hex'
    `,s=JSON.stringify({data:e});try{const i=await dt(r,{data:s}),o=JSON.parse(i.result).hash;return o.startsWith("0x")?o:`0x${o}`}catch(i){throw new qn(`Failed to hash data with ${t}`,i instanceof Error?i.message:"Unknown error",r)}}static async validateZencode(e){try{const t=await dt(e);return{valid:!0,errors:[]}}catch(t){return{valid:!1,errors:[t instanceof Error?t.message:"Unknown error"]}}}static hexToBytes(e){const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t}static bytesToHex(e){return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}static async generateUTXOId(e,t,r){const s=`${e}${t}${r}`;return await this.hashData(s)}static async generateBBSKeyPair(e){console.log("🔑 Generating BBS+ key pair...");try{if(!await br()){const o=e?new ir(e):ir.createRandom();return console.log("🔑 Generated BBS+ keys using ethers fallback"),{privateKey:o.privateKey,publicKey:o.address}}const r=`
      Scenario 'bbs': Generate BBS+ keypair
      ${e?"Given I have a 'hex' named 'private_key'":"Given nothing"}
      When I create the BBS+ key pair${e?" from 'private_key'":""}
      And I create the BBS+ public key
      Then print the 'bbs private key' as 'hex'
      And print the 'bbs public key' as 'hex'
      `,s=e?JSON.stringify({private_key:e}):void 0,i=await dt(r,s?{data:s}:void 0),a=JSON.parse(i.result);return console.log("✅ BBS+ keys generated successfully"),{privateKey:a.bbs_private_key||a["bbs private key"],publicKey:a.bbs_public_key||a["bbs public key"]}}catch(t){console.error("❌ Failed to generate BBS+ keys:",t);const r=e?new ir(e):ir.createRandom();return console.log("🔑 Generated BBS+ keys using ethers fallback after error"),{privateKey:r.privateKey,publicKey:r.address}}}static async generateCoconutThresholdKeys(e,t,r){console.log("🥥 Generating Coconut threshold setup...",{authorities:e.length,threshold:t});try{if(!await br()){const l=[];for(let f=0;f<e.length;f++)if(r&&r[f]){const x=new ir(r[f]);l.push(x.address)}else{const x=ir.createRandom();l.push(x.address)}const d=ir.createRandom().address;return console.log("🥥 Generated Coconut setup using ethers fallback"),{authorities:e,threshold:t,publicKeys:l,aggregatedPubKey:d}}const i=`
      Scenario 'coconut': Generate threshold setup
      Given I have a 'string array' named 'authorities'
      Given I have a 'integer' named 'threshold'
      ${r?"Given I have a 'string array' named 'authority_keys'":""}
      When I create the coconut threshold setup with 'threshold' of 'authorities'
      And I create the coconut aggregation key
      Then print the 'threshold setup'
      And print the 'authority keys'
      And print the 'aggregation key' as 'hex'
      `,a=JSON.stringify({authorities:e,threshold:t,...r&&{authority_keys:r}}),o=await dt(i,{data:a}),c=JSON.parse(o.result);return console.log("✅ Coconut threshold setup generated successfully"),{authorities:e,threshold:t,publicKeys:c.authority_keys||c["authority keys"],aggregatedPubKey:c.aggregation_key||c["aggregation key"]}}catch(s){console.error("❌ Failed to generate Coconut threshold setup:",s);const i=[];for(let o=0;o<e.length;o++)if(r&&r[o]){const c=new ir(r[o]);i.push(c.address)}else{const c=ir.createRandom();i.push(c.address)}const a=ir.createRandom().address;return console.log("🥥 Generated Coconut setup using ethers fallback after error"),{authorities:e,threshold:t,publicKeys:i,aggregatedPubKey:a}}}static async createCommitmentOpeningProof(e,t,r){console.log("🔓 Creating commitment opening proof...");try{if(!await br()){const l=Lt(["string","string","string"],[e,t,r]);return console.log("🔓 Generated opening proof using hash fallback"),l}const i=`
      Scenario 'ethereum': Create opening proof
      Given I have a 'hex' named 'commitment'
      Given I have a 'integer' named 'value'
      Given I have a 'integer' named 'blinding_factor'
      When I create the commitment opening proof for 'commitment' with 'value' and 'blinding_factor'
      And I create the zero knowledge proof
      Then print the 'opening proof' as 'hex'
      `,a=JSON.stringify({commitment:e,value:t,blinding_factor:r}),o=await dt(i,{data:a}),c=JSON.parse(o.result);return console.log("✅ Commitment opening proof created successfully"),c.opening_proof||c["opening proof"]}catch(s){console.error("❌ Failed to create opening proof:",s);const i=Lt(["string","string","string"],[e,t,r]);return console.log("🔓 Generated opening proof using hash fallback after error"),i}}static async requestCoconutPartialCredential(e,t,r){console.log("🥥 Requesting Coconut partial credential...");try{if(!await br()){const l=Lt(["string","string"],[JSON.stringify(e),t]),d={},f=Object.keys(e);for(let x=0;x<f.length;x++){const g=f[x],b=r[x]||await this.generateSecureNonce();d[g]=Lt(["string","string"],[e[g].toString(),b])}return console.log("🥥 Generated partial credential using fallback"),{partialSignature:l,authorityIndex:0,blindedAttributes:d}}const i=`
      Scenario 'coconut': Request partial credential
      Given I have a 'string dictionary' named 'attributes'
      Given I have a 'hex' named 'authority_pubkey'
      Given I have a 'hex array' named 'blinding_factors'
      When I create the coconut credential request with 'attributes'
      And I blind the attributes with 'blinding_factors'
      And I request partial signature from authority 'authority_pubkey'
      Then print the 'partial signature' as 'hex'
      And print the 'authority index'
      And print the 'blinded attributes'
      `,a=JSON.stringify({attributes:e,authority_pubkey:t,blinding_factors:r}),o=await dt(i,{data:a}),c=JSON.parse(o.result);return console.log("✅ Coconut partial credential requested successfully"),{partialSignature:c.partial_signature||c["partial signature"],authorityIndex:c.authority_index||c["authority index"]||0,blindedAttributes:c.blinded_attributes||c["blinded attributes"]}}catch(s){console.error("❌ Failed to request partial credential:",s);const i=Lt(["string","string"],[JSON.stringify(e),t]),a={};for(let o=0;o<Object.keys(e).length;o++){const c=Object.keys(e)[o],l=r[o]||await this.generateSecureNonce();a[c]=Lt(["string","string"],[e[c].toString(),l])}return console.log("🥥 Generated partial credential using fallback after error"),{partialSignature:i,authorityIndex:0,blindedAttributes:a}}}static async aggregateCoconutCredentials(e,t){console.log("🥥 Aggregating Coconut credentials...",{count:e.length,threshold:t});try{if(e.length<t)throw new Error(`Insufficient partial credentials: ${e.length} < ${t}`);if(!await br()){const c=e.slice(0,t).map(f=>f.partialSignature),l=Lt(["string[]"],[c]),d=Lt(["string","uint256"],[l,Date.now()]);return console.log("🥥 Aggregated credentials using fallback"),{aggregatedSignature:l,credentialId:d,threshold:t,signaturesUsed:t}}const s=`
      Scenario 'coconut': Aggregate credentials
      Given I have a 'string array' named 'partial_signatures'
      Given I have a 'integer array' named 'authority_indices'
      Given I have a 'integer' named 'threshold'
      When I aggregate the coconut partial signatures with threshold 'threshold'
      And I create the final aggregated signature
      And I generate the credential identifier
      Then print the 'aggregated signature' as 'hex'
      And print the 'credential id' as 'hex'
      And print the 'signatures used'
      `,i=JSON.stringify({partial_signatures:e.map(c=>c.partialSignature),authority_indices:e.map(c=>c.authorityIndex),threshold:t}),a=await dt(s,{data:i}),o=JSON.parse(a.result);return console.log("✅ Coconut credentials aggregated successfully"),{aggregatedSignature:o.aggregated_signature||o["aggregated signature"],credentialId:o.credential_id||o["credential id"],threshold:t,signaturesUsed:o.signatures_used||o["signatures used"]||t}}catch(r){console.error("❌ Failed to aggregate credentials:",r);const s=e.slice(0,t).map(o=>o.partialSignature),i=Lt(["string[]"],[s]),a=Lt(["string","uint256"],[i,Date.now()]);return console.log("🥥 Aggregated credentials using fallback after error"),{aggregatedSignature:i,credentialId:a,threshold:t,signaturesUsed:t}}}static async signBBSCredential(e,t){console.log("✍️ Signing BBS+ credential with attributes:",e.length);try{if(await br()){const o=`
Given I have a 'string' named 'input_data'
When I create the hash of 'input_data'
Then print 'hash' as 'hex'
        `,c=`${JSON.stringify(e)}:${t}`,l=JSON.stringify({input_data:c});console.log("🔧 Signing BBS+ credential with Zenroom...");const d=await dt(o,{data:l});if(!d.result)throw new Error("Empty result from Zenroom");const x=JSON.parse(d.result).hash;if(!x)throw new Error("No signature in Zenroom result");const g=x.startsWith("0x")?x:`0x${x}`;return console.log("✅ Created BBS+ signature using Zenroom:",g),g}}catch(a){console.warn("⚠️ Zenroom BBS+ signing failed:",a)}const r=Ue(Be(JSON.stringify(e))),i=await new ir(t).signMessage(r);return console.log("✅ Created BBS+ signature using fallback"),i}static async createBBSProof(e){console.log("🔍 Creating BBS+ proof with selective disclosure..."),console.log("  - Revealing indices:",e.revealIndices),console.log("  - Has predicates:",!!e.predicates);try{if(await br()){const o=`
Given I have a 'string' named 'input_data'
When I create the hash of 'input_data'
Then print 'hash' as 'hex'
        `,c=e.revealIndices.map(y=>e.attributes[y]),l=e.challenge||Ue(Be("default_challenge")),d=`${e.signature}:${JSON.stringify(c)}:${l}`,f=JSON.stringify({input_data:d});console.log("🔧 Creating BBS+ proof with Zenroom...");const x=await dt(o,{data:f});if(!x.result)throw new Error("Empty result from Zenroom");const b=JSON.parse(x.result).hash;if(!b)throw new Error("No hash in Zenroom result");const p=b.startsWith("0x")?b:`0x${b}`;return console.log("✅ Created BBS+ proof using Zenroom:",p),{proof:p,predicateProofs:[]}}}catch(a){console.warn("⚠️ Zenroom BBS+ proof creation failed:",a)}const t=e.revealIndices.map(a=>e.attributes[a]),r=e.attributes.filter((a,o)=>!e.revealIndices.includes(o)),s={signature:e.signature,revealed:t,hiddenCommitment:Ue(Be(JSON.stringify(r))),challenge:e.challenge||Ue(Be("default_challenge"))},i=Ue(Be(JSON.stringify(s)));return console.log("✅ Created BBS+ proof using fallback:",i),{proof:i}}static async verifyBBSProof(e){console.log("🔍 Verifying BBS+ proof..."),console.log("  - Revealed attributes:",Object.keys(e.revealedAttributes));try{if(await br()){const s=`
          Scenario 'bbs': Verify BBS+ proof
          Given I have a 'hex' named 'proof'
          Given I have a 'string dictionary' named 'revealed_attributes'
          Given I have a 'hex' named 'public_key'
          Given I have a 'hex' named 'challenge'
          When I verify the BBS+ proof 'proof' with 'revealed_attributes' and 'public_key' and 'challenge'
          Then print the 'verification result' as 'string'
        `,i=JSON.stringify({proof:e.proof,revealed_attributes:e.revealedAttributes,public_key:e.issuerPublicKey,challenge:e.challenge||Ue(Be("default_challenge"))}),a=await dt(s,{keys:i}),o=JSON.parse(a.result),c=o["verification result"]==="true"||o.verification_result==="true";return console.log(`✅ BBS+ proof verification result: ${c}`),c}}catch(r){console.warn("⚠️ Zenroom BBS+ proof verification failed:",r)}const t=e.proof.length>0&&e.issuerPublicKey.length>0&&Object.keys(e.revealedAttributes).length>0;return console.log(`✅ BBS+ proof verification result (fallback): ${t}`),t}static async requestCoconutPartialCredentialV2(e,t,r){console.log("🥥 Requesting Coconut partial credential (v2)...");try{if(!await br()){const l=Lt(["string","string","string"],[JSON.stringify(e.attributes),t,r]);return console.log("🥥 Generated partial credential using fallback"),{signature:l,authorityIndex:0,timestamp:Date.now()}}const i=`
      Scenario 'coconut': Request partial credential
      Given I have a 'string dictionary' named 'attributes'
      Given I have a 'hex' named 'authority_pubkey'
      Given I have a 'string' named 'authority_id'
      When I create the coconut credential request with 'attributes'
      And I request partial signature from authority 'authority_pubkey'
      Then print the 'partial signature' as 'hex'
      And print the 'authority index'
      And print the 'timestamp'
      `,a=JSON.stringify({attributes:e.attributes,authority_pubkey:t,authority_id:r}),o=await dt(i,{data:a}),c=JSON.parse(o.result);return console.log("✅ Coconut partial credential requested successfully"),{signature:c.partial_signature||c["partial signature"],authorityIndex:c.authority_index||c["authority index"]||0,timestamp:c.timestamp||Date.now()}}catch(s){console.error("❌ Failed to request Coconut partial credential:",s);const i=Lt(["string","string","string"],[JSON.stringify(e.attributes),t,r]);return console.log("🥥 Generated partial credential using fallback after error"),{signature:i,authorityIndex:0,timestamp:Date.now()}}}static async aggregateCoconutCredentialsV2(e,t){console.log("🥥 Aggregating Coconut credentials (v2)..."),console.log("   - Partial credentials:",e.length),console.log("   - Threshold:",t.threshold);try{if(!await br()){const c=e.map(f=>f.signature),l=Lt(["string[]"],[c]),d=e.map(f=>f.authorityIndex);return console.log("🥥 Aggregated credentials using fallback"),{signature:l,attributes:{},threshold:t.threshold,participatingAuthorities:d}}const s=`
      Scenario 'coconut': Aggregate partial credentials
      Given I have a 'string array' named 'partial_signatures'
      Given I have a 'number array' named 'authority_indices'
      Given I have a 'integer' named 'threshold'
      When I aggregate the partial signatures with threshold 'threshold'
      And I create the aggregated credential
      Then print the 'aggregated signature' as 'hex'
      And print the 'credential id' as 'hex'
      And print the 'signatures used'
      `,i=JSON.stringify({partial_signatures:e.map(c=>c.signature),authority_indices:e.map(c=>c.authorityIndex),threshold:t.threshold}),a=await dt(s,{data:i}),o=JSON.parse(a.result);return console.log("✅ Coconut credentials aggregated successfully"),{signature:o.aggregated_signature||o["aggregated signature"],attributes:{},threshold:t.threshold,participatingAuthorities:e.map(c=>c.authorityIndex)}}catch(r){console.error("❌ Failed to aggregate credentials:",r);const s=e.map(o=>o.signature),i=Lt(["string[]"],[s]),a=e.map(o=>o.authorityIndex);return console.log("🥥 Aggregated credentials using fallback after error"),{signature:i,attributes:{},threshold:t.threshold,participatingAuthorities:a}}}static async generateNullifierHash(e,t,r){try{const s=r||await this.generateSecureNonce(),i=`
Given I have a 'string' named 'input_data'
When I create the hash of 'input_data'
Then print 'hash' as 'hex'
      `,a=`${e}:${t}:${s}`,o=JSON.stringify({input_data:a});console.log("🔧 Generating nullifier hash with Zenroom...");const c=await dt(i,{data:o});if(!c.result)throw new Error("Empty result from Zenroom");const d=JSON.parse(c.result).hash;if(!d)throw new Error("No hash in Zenroom result");const f=d.startsWith("0x")?d:`0x${d}`;return console.log("✅ Generated nullifier hash with Zenroom:",f),f}catch(s){console.warn("⚠️ Zenroom nullifier generation failed, using fallback:",s);const i=r||await this.generateSecureNonce(),a=Ue(Be(`${e}:${t}:${i}`));return console.log("✅ Generated nullifier hash with fallback:",a),a}}static async createRangeProof(e,t,r,s="0",i){try{const a=`
Given I have a 'string' named 'input_data'
When I create the hash of 'input_data'
Then print 'hash' as 'hex'
      `,o=`${e}:${t}:${r}:${s}`,c=JSON.stringify({input_data:o});console.log("🔧 Creating range proof with Zenroom...");const l=await dt(a,{data:c});if(!l.result)throw new Error("Empty result from Zenroom");const f=JSON.parse(l.result).hash;if(!f)throw new Error("No hash in Zenroom result");const x=f.startsWith("0x")?f:`0x${f}`;return console.log("✅ Generated range proof with Zenroom:",x),x}catch(a){console.warn("⚠️ Zenroom range proof failed, using fallback:",a);const o=Ue(Be(`range:${e}:${t}:${r}`));return console.log("✅ Generated range proof with fallback:",o),o}}static async createEqualityProof(e,t,r,s,i){try{const a=`
Given I have a 'string' named 'input_data'
When I create the hash of 'input_data'
Then print 'hash' as 'hex'
      `,o=`${e}:${t}:${r}:${s}:${i}`,c=JSON.stringify({input_data:o});console.log("🔧 Creating equality proof with Zenroom...");const l=await dt(a,{data:c});if(!l.result)throw new Error("Empty result from Zenroom");const f=JSON.parse(l.result).hash;if(!f)throw new Error("No hash in Zenroom result");const x=f.startsWith("0x")?f:`0x${f}`;return console.log("✅ Generated equality proof with Zenroom:",x),x}catch(a){console.warn("⚠️ Zenroom equality proof failed, using fallback:",a);const o=Ue(Be(`eq:${e}:${t}:${r}`));return console.log("✅ Generated equality proof with fallback:",o),o}}}class pn{static async connectWallet(e=Jt.METAMASK){try{let t,r;switch(e){case Jt.METAMASK:const c=await this.connectMetaMask();if(!c.success)return c;t=c.provider,r=c.signer;break;case Jt.INJECTED:if(!window.ethereum)return{success:!1,error:"No injected provider found"};t=new Wc(window.ethereum),r=await t.getSigner();break;default:return{success:!1,error:`Unsupported provider type: ${e}`}}const s=await r.getAddress(),i=await t.getNetwork(),a=await t.getBalance(s),o={address:s,chainId:i.chainId,networkName:i.name,connected:!0,providerType:e,ethBalance:BigInt(a.toString()),lastBalanceUpdate:Date.now()};return this.provider=t,this.signer=r,this.currentEOA=o,this.setupEventListeners(),{success:!0,eoa:o,provider:t,signer:r}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown connection error"}}}static async connectMetaMask(){if(!window.ethereum||!this.isMetaMaskProvider(window.ethereum))return{success:!1,error:"MetaMask not detected"};try{const e=window.ethereum,t=await e.request({method:"eth_requestAccounts"});if(!t||t.length===0)return{success:!1,error:"No accounts available"};const r=new Wc(e),s=await r.getSigner();return{success:!0,provider:r,signer:s}}catch(e){return{success:!1,error:e instanceof Error?e.message:"MetaMask connection failed"}}}static async disconnectWallet(){var e,t;this.provider=null,this.signer=null,this.currentEOA=null,window.ethereum&&((t=(e=window.ethereum).removeAllListeners)==null||t.call(e))}static getCurrentEOA(){return this.currentEOA}static getProvider(){if(!this.provider)throw new sf;return this.provider}static getSigner(){if(!this.signer)throw new sf;return this.signer}static async signMessage(e){const t=this.getSigner(),r=await t.getAddress();try{const s=await t.signMessage(e),i=jt.from(s);return{signature:s,message:e,signer:r,recoveryId:i.yParity,r:i.r,s:i.s,v:i.v}}catch(s){throw new Zt("Failed to sign message",-32e3,{message:e,error:s instanceof Error?s.message:"Unknown error"})}}static async signTypedData(e,t,r){const s=this.getSigner(),i=await s.getAddress();try{return{signature:await s.signTypedData(e,t,r),message:JSON.stringify({domain:e,types:t,value:r}),signer:i}}catch(a){throw new Zt("Failed to sign typed data",-32e3,{domain:e,types:t,value:r,error:a instanceof Error?a.message:"Unknown error"})}}static async deriveKeyFromEOA(e){const{baseAddress:t,purpose:r,nonce:s,context:i,method:a}=e,o=`UTXO Key Derivation
Address: ${t}
Purpose: ${r}
Nonce: ${s}
Context: ${i||""}
Timestamp: ${Date.now()}`;let c;switch(a){case Lc.MESSAGE_SIGNATURE:c=(await this.signMessage(o)).signature;break;case Lc.TYPED_DATA_SIGNATURE:const f={domain:{name:"UTXO System",version:"1"},types:{KeyDerivation:[{name:"baseAddress",type:"address"},{name:"purpose",type:"string"},{name:"nonce",type:"string"},{name:"timestamp",type:"uint256"}]},value:{baseAddress:t,purpose:r,nonce:s,timestamp:Date.now()}};c=(await this.signTypedData(f.domain,f.types,f.value)).signature;break;case Lc.DETERMINISTIC_HASH:c=Ue(Be(o));break;default:throw new Error(`Unsupported derivation method: ${a}`)}const l=Ue(c);return{eoaAddress:t,derivedKey:l,signature:c,message:o,derivationMethod:a,timestamp:Date.now(),nonce:s}}static async getERC20TokenInfo(e,t){const r=this.getProvider(),s=new Ur(e,[_i.name,_i.symbol,_i.decimals,_i.balanceOf,_i.allowance],r);try{const[i,a,o]=await Promise.all([s.name().catch(()=>"Unknown"),s.symbol().catch(()=>"UNK"),s.decimals().catch(()=>18)]);let c,l;return t&&([c]=await Promise.all([s.balanceOf(t).catch(()=>0n)])),{address:e,symbol:a,name:i,decimals:Number(o),balance:c?BigInt(c.toString()):void 0,allowance:l?BigInt(l.toString()):void 0,verified:!1}}catch(i){throw new Zt(`Failed to get token info for ${e}`,-32e3,{tokenAddress:e,error:i instanceof Error?i.message:"Unknown error"})}}static async approveERC20(e,t,r){const s=this.getSigner(),i=new Ur(e,[_i.approve],s);try{console.log("🔄 Approving token spending...",{tokenAddress:e,spenderAddress:t,amount:r.toString()});const a=await i.approve(t,r);console.log("📝 Approval transaction sent:",a.hash);const o=await a.wait();return console.log("✅ Approval confirmed:",o.transactionHash),this.formatTransactionReceipt(o)}catch(a){console.error("❌ Token approval failed:",a);let o="Unknown error",c=-32e3;throw a instanceof Error&&(o=a.message,a.message.includes("user rejected")?(o="Transaction was rejected by user",c=4001):a.message.includes("insufficient funds")?(o="Insufficient funds for gas",c=-32e3):a.message.includes("execution reverted")&&(o="Transaction reverted - contract may not exist or method failed",c=-32015)),new Zt(`Failed to approve token: ${o}`,c,{tokenAddress:e,spenderAddress:t,amount:r.toString(),originalError:a instanceof Error?a.message:String(a)})}}static async estimateGas(e){const t=this.getProvider();this.getSigner();try{const r=await t.estimateGas({to:e.to,value:e.value||void 0,data:e.data}),s=await t.getFeeData();let i=BigInt(0),a,o;s.maxFeePerGas&&s.maxPriorityFeePerGas?(a=BigInt(s.maxFeePerGas.toString()),o=BigInt(s.maxPriorityFeePerGas.toString()),i=a):s.gasPrice&&(i=BigInt(s.gasPrice.toString()));const c=BigInt(r.toString())*i;return{gasLimit:BigInt(r.toString()),gasPrice:i,maxFeePerGas:a,maxPriorityFeePerGas:o,estimatedCost:c,confidence:.9}}catch(r){throw new Zt("Failed to estimate gas",-32e3,{params:e,error:r instanceof Error?r.message:"Unknown error"})}}static async sendTransaction(e){const t=this.getSigner();try{const r={to:e.to,value:e.value||void 0,data:e.data,gasLimit:e.gasLimit||void 0,nonce:e.nonce};e.maxFeePerGas&&e.maxPriorityFeePerGas?(r.maxFeePerGas=e.maxFeePerGas,r.maxPriorityFeePerGas=e.maxPriorityFeePerGas,r.type=2):e.gasPrice&&(r.gasPrice=e.gasPrice,r.type=0);const s=await t.sendTransaction(r),i=await s.wait();if(!i||i.status===0)throw new af(void 0,(i==null?void 0:i.hash)||s.hash);return this.formatTransactionReceipt(i)}catch(r){throw r instanceof af?r:new Zt("Transaction failed",-32e3,{params:e,error:r instanceof Error?r.message:"Unknown error"})}}static async callSmartContract(e){const t=this.getSigner();try{const i=await(await new Ur(e.contractAddress,e.abi?[e.abi]:[],t)[e.functionName](...e.args,e.options||{})).wait();return this.formatTransactionReceipt(i)}catch(r){throw new Zt(`Smart contract call failed: ${e.functionName}`,-32e3,{params:e,error:r instanceof Error?r.message:"Unknown error"})}}static async switchNetwork(e){if(!window.ethereum)throw new Zt("No wallet provider available");try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${e.chainId.toString(16)}`}]}),!0}catch(t){if(t.code===4902)return await this.addNetwork(e);throw new v1(e.chainId)}}static async addNetwork(e){if(!window.ethereum)throw new Zt("No wallet provider available");try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${e.chainId.toString(16)}`,chainName:e.name,rpcUrls:e.rpcUrls,nativeCurrency:e.nativeCurrency,blockExplorerUrls:e.blockExplorerUrls}]}),!0}catch(t){throw new Zt(`Failed to add network: ${e.name}`,-32e3,{networkConfig:e,error:t instanceof Error?t.message:"Unknown error"})}}static setupEventListeners(){window.ethereum&&(window.ethereum.on("accountsChanged",e=>{e.length===0?this.disconnectWallet():this.currentEOA&&e[0]!==this.currentEOA.address&&this.connectWallet(this.currentEOA.providerType)}),window.ethereum.on("chainChanged",e=>{this.currentEOA&&(this.currentEOA.chainId=BigInt(parseInt(e,16)),this.currentEOA.networkName=this.getNetworkName(Number(this.currentEOA.chainId)))}),window.ethereum.on("disconnect",()=>{this.disconnectWallet()}))}static isMetaMaskProvider(e){return e&&e.isMetaMask===!0}static getNetworkName(e){const t=Object.values(A1).find(r=>Number(r.chainId)===e);return(t==null?void 0:t.name)||`Unknown (${e})`}static formatTransactionReceipt(e){var t;return{transactionHash:e.hash,blockNumber:e.blockNumber,blockHash:e.blockHash,gasUsed:BigInt(e.gasUsed.toString()),effectiveGasPrice:BigInt(((t=e.gasPrice)==null?void 0:t.toString())||"0"),status:e.status,contractAddress:e.contractAddress,logs:e.logs.map(r=>({address:r.address,topics:r.topics,data:r.data,blockNumber:r.blockNumber,transactionHash:r.transactionHash,logIndex:r.logIndex,removed:r.removed})),confirmations:e.confirmations||0}}static formatTokenAmount(e,t){return pt(e.toString(),t)}static parseTokenAmount(e,t){return BigInt(_s(e,t).toString())}static isValidAddress(e){return bd(e)}static getShortAddress(e,t=6,r=4){return this.isValidAddress(e)?`${e.slice(0,t)}...${e.slice(-r)}`:e}static async waitForConfirmation(e,t=1){const r=this.getProvider();try{const s=await r.waitForTransaction(e,t);return this.formatTransactionReceipt(s)}catch(s){throw new Zt(`Failed to wait for transaction confirmation: ${e}`,-32e3,{txHash:e,confirmations:t,error:s instanceof Error?s.message:"Unknown error"})}}}E(pn,"provider",null),E(pn,"signer",null),E(pn,"currentEOA",null);class O1{constructor(){E(this,"events",{})}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}emit(e,...t){return this.events[e]?(this.events[e].forEach(r=>r(...t)),!0):!1}off(e,t){return this.events[e]?(this.events[e]=this.events[e].filter(r=>r!==t),this):this}removeAllListeners(e){return e?delete this.events[e]:this.events={},this}}class Jx extends O1{constructor(t={}){super();E(this,"zenroom");E(this,"ethereum");E(this,"contract",null);E(this,"utxos",new Map);E(this,"config");E(this,"currentEOA",null);E(this,"isInitialized",!1);E(this,"lastSyncTimestamp",0);E(this,"syncInProgress",!1);this.config={autoConsolidate:!1,consolidationThreshold:10,maxUTXOAge:7*24*60*60,privacyMode:!0,defaultGasLimit:BigInt(5e5),cacheTimeout:3e4,enableBackup:!0,...t},this.zenroom=ot,this.ethereum=pn,console.log("🚀 UTXOLibrary initialized"),console.log("   - Privacy mode:",this.config.privacyMode),console.log("   - Auto consolidation:",this.config.autoConsolidate),console.log("   - Cache timeout:",this.config.cacheTimeout,"ms")}async initialize(t,r=Jt.METAMASK){var s;try{console.log("🔧 Initializing UTXOLibrary...");const i=await this.connectWallet(r);if(!i.success)throw new Error(`Wallet connection failed: ${i.error}`);const a=this.ethereum.getSigner();console.log("🔗 Connecting to UTXO contract at:",t),this.contract=T1(t,a),console.log("🔍 Verifying contract accessibility...");try{if(await this.ethereum.getProvider().getCode(t)==="0x")console.warn("⚠️ No contract code found at address, but continuing initialization");else{console.log("✅ Contract code found at address");try{const c=await this.contract.getUserUTXOCount(((s=this.currentEOA)==null?void 0:s.address)||za);console.log("✅ Contract verification successful, UTXO count:",c.toString())}catch(c){console.warn("⚠️ Contract method call failed, but contract exists:",c)}}}catch(o){console.warn("⚠️ Contract verification failed, but continuing initialization:",o)}return await this.syncWithBlockchain(),this.isInitialized=!0,console.log("✅ UTXOLibrary initialized successfully"),this.emit("library:initialized",{contractAddress:t,eoa:this.currentEOA,utxoCount:this.utxos.size}),!0}catch(i){throw console.error("❌ Failed to initialize UTXOLibrary:",i),new hr("Initialization failed","initialize",void 0,i)}}async connectWallet(t=Jt.METAMASK){console.log("🔗 Connecting wallet...");try{const r=await this.ethereum.connectWallet(t);return r.success&&r.eoa?(this.currentEOA=r.eoa,console.log("✅ Wallet connected:",r.eoa.address),this.emit("wallet:connected",r.eoa)):console.error("❌ Wallet connection failed:",r.error),r}catch(r){const s={success:!1,error:r instanceof Error?r.message:"Unknown connection error"};return this.emit("wallet:connection_failed",r),s}}async disconnect(){console.log("🔌 Disconnecting wallet..."),await this.ethereum.disconnectWallet(),this.currentEOA=null,this.contract=null,this.utxos.clear(),this.isInitialized=!1,this.emit("wallet:disconnected"),console.log("✅ Wallet disconnected")}async depositAsUTXO(t){var r;this.ensureInitialized(),console.log(`💰 Depositing ${t.amount} tokens as UTXO...`);try{const{amount:s,tokenAddress:i,owner:a}=t,o=await this.ethereum.getERC20TokenInfo(i,a);if(!o.balance||o.balance<s)throw new w1(s,o.balance||BigInt(0),i);console.log("🔍 Contract status:",{contractExists:!!this.contract,contractAddress:(r=this.contract)==null?void 0:r.target});const c=this.contract.target;if(!c)throw new Error("Contract address is not available. Contract may not be properly initialized.");console.log("📋 Using spender address:",c),(o.allowance||BigInt(0))<s&&(console.log("📝 Approving token spending..."),await this.ethereum.approveERC20(i,c,s));const d=t.blindingFactor||await this.zenroom.generateSecureNonce(),f=await this.zenroom.createPedersenCommitment(s.toString(),d),x=await this.generateDepositProof(s,f.pedersen_commitment,a),g={tokenAddress:i,amount:s,commitment:f.pedersen_commitment,zenroomProof:x},p=await(await this.contract.depositAsUTXO(g.tokenAddress,g.amount,g.commitment,g.zenroomProof,{gasLimit:this.config.defaultGasLimit})).wait(),y=await this.zenroom.generateUTXOId(f.pedersen_commitment,a,Date.now()),v={id:y,exists:!0,value:BigInt(s),tokenAddress:i,owner:a,timestamp:Kr(Date.now()),isSpent:!1,commitment:f.pedersen_commitment,parentUTXO:"",utxoType:mt.DEPOSIT,blindingFactor:d,localCreatedAt:Date.now(),confirmed:!0,creationTxHash:p==null?void 0:p.hash,blockNumber:p==null?void 0:p.blockNumber,tokenMetadata:{symbol:o.symbol,name:o.name,decimals:o.decimals}};this.utxos.set(y,v);const I={success:!0,transactionHash:p==null?void 0:p.hash,gasUsed:p==null?void 0:p.gasUsed,createdUTXOIds:[y]};return console.log("✅ UTXO deposit successful:",y),this.emit("utxo:created",v),I}catch(s){console.error("❌ UTXO deposit failed:",s);const i={success:!1,error:s instanceof Error?s.message:"Deposit failed",errorDetails:s};return this.emit("operation:failed",new hr("Deposit failed","deposit",void 0,s)),i}}async splitUTXO(t){this.ensureInitialized(),console.log(`✂️ Splitting UTXO ${t.inputUTXOId}...`);try{const{inputUTXOId:r,outputValues:s,outputOwners:i}=t,a=this.utxos.get(r);if(!a)throw new rf(r);if(a.isSpent)throw new nf(r);const o=s.reduce((y,v)=>y+v,BigInt(0));if(o!==a.value)throw new Error(`Sum of outputs (${o}) != input value (${a.value})`);const c=t.outputBlindingFactors||await Promise.all(s.map(()=>this.zenroom.generateSecureNonce())),l=await Promise.all(s.map(async(y,v)=>(await this.zenroom.createPedersenCommitment(y.toString(),c[v])).pedersen_commitment)),d=await this.zenroom.generateSplitProof(a.commitment,a.value.toString(),a.blindingFactor,s.map(y=>y.toString()),c),f={inputUTXOId:r,outputCommitments:l,outputOwners:i,outputValues:s.map(y=>y),splitProof:d.split_proof},g=await(await this.contract.splitUTXO(f.inputUTXOId,f.outputCommitments,f.outputOwners,f.outputValues,f.splitProof,{gasLimit:this.config.defaultGasLimit})).wait();a.isSpent=!0,this.emit("utxo:spent",r);const b=[];for(let y=0;y<s.length;y++){const v=await this.zenroom.generateUTXOId(l[y],i[y],Date.now()+y),I={id:v,exists:!0,value:s[y],tokenAddress:a.tokenAddress,owner:i[y],timestamp:Kr(Date.now()),isSpent:!1,commitment:l[y],parentUTXO:r,utxoType:mt.SPLIT,blindingFactor:c[y],localCreatedAt:Date.now(),confirmed:!0,creationTxHash:g==null?void 0:g.hash,blockNumber:g==null?void 0:g.blockNumber,tokenMetadata:a.tokenMetadata};this.utxos.set(v,I),b.push(v),this.emit("utxo:created",I)}const p={success:!0,transactionHash:g==null?void 0:g.hash,gasUsed:g==null?void 0:g.gasUsed,createdUTXOIds:b};return console.log("✅ UTXO split successful:",b),p}catch(r){console.error("❌ UTXO split failed:",r);const s={success:!1,error:r instanceof Error?r.message:"Split failed",errorDetails:r};return this.emit("operation:failed",new hr("Split failed","split",t.inputUTXOId,r)),s}}async withdrawFromUTXO(t){this.ensureInitialized(),console.log(`💸 Withdrawing UTXO ${t.utxoId}...`);try{const{utxoId:r,recipient:s}=t,i=this.utxos.get(r);if(!i)throw new rf(r);if(i.isSpent)throw new nf(r);const a=await this.zenroom.generateBurnProof(r,i.commitment,i.value.toString(),i.blindingFactor,s),o=await this.generateOpeningProof(i.commitment,i.value.toString(),i.blindingFactor),c={utxoId:r,burnProof:a,openingProof:o},d=await(await this.contract.withdrawFromUTXO(c.utxoId,c.burnProof,c.openingProof,{gasLimit:this.config.defaultGasLimit})).wait();i.isSpent=!0,this.emit("utxo:spent",r);const f={success:!0,transactionHash:d==null?void 0:d.hash,gasUsed:d==null?void 0:d.gasUsed};return console.log("✅ UTXO withdrawal successful"),f}catch(r){console.error("❌ UTXO withdrawal failed:",r);const s={success:!1,error:r instanceof Error?r.message:"Withdrawal failed",errorDetails:r};return this.emit("operation:failed",new hr("Withdrawal failed","withdraw",t.utxoId,r)),s}}getUTXOsByOwner(t){var s;const r=t||((s=this.currentEOA)==null?void 0:s.address);if(!r)throw new Error("No owner specified and no EOA connected");return Array.from(this.utxos.values()).filter(i=>i.owner===r&&!i.isSpent)}getBalance(t){if(t)return Array.from(this.utxos.values()).filter(s=>!s.isSpent&&s.tokenAddress===t).reduce((s,i)=>s+i.value,BigInt(0));const r={};return Array.from(this.utxos.values()).filter(s=>!s.isSpent).forEach(s=>{r[s.tokenAddress]=(r[s.tokenAddress]||BigInt(0))+s.value}),r}getStats(){const t=Array.from(this.utxos.values()),r=t.filter(d=>!d.isSpent),s=t.filter(d=>d.isSpent),i=t.filter(d=>d.confirmed),a={},o={[mt.DEPOSIT]:0,[mt.SPLIT]:0,[mt.COMBINE]:0,[mt.TRANSFER]:0};r.forEach(d=>{a[d.tokenAddress]=(a[d.tokenAddress]||BigInt(0))+d.value,o[d.utxoType]++});const c=Object.values(a).reduce((d,f)=>d+f,BigInt(0)),l=r.length>0?c/BigInt(r.length):BigInt(0);return{totalUTXOs:t.length,unspentUTXOs:r.length,spentUTXOs:s.length,confirmedUTXOs:i.length,totalBalance:c,balanceByToken:a,averageUTXOValue:l,uniqueTokens:Object.keys(a).length,creationDistribution:o}}async syncWithBlockchain(){if(this.syncInProgress||!this.contract||!this.currentEOA)return!1;this.syncInProgress=!0,console.log("🔄 Syncing with blockchain...");try{const t=await this.contract.getUTXOsByOwner(this.currentEOA.address);for(const r of t){const s=await this.contract.getUTXOInfo(r);if(this.utxos.has(r)){const i=this.utxos.get(r);i.isSpent=s.isSpent,i.confirmed=!0}else{const i={id:r,exists:s.exists,value:BigInt(s.value.toString()),tokenAddress:s.tokenAddress,owner:s.owner,timestamp:s.timestamp,isSpent:s.isSpent,commitment:s.commitment,parentUTXO:s.parentUTXO,utxoType:this.mapContractUTXOType(s.utxoType),localCreatedAt:Date.now(),confirmed:!0};this.utxos.set(r,i),this.emit("utxo:synced",i)}}return this.lastSyncTimestamp=Date.now(),console.log("✅ Blockchain sync completed"),!0}catch(t){return console.error("❌ Blockchain sync failed:",t),!1}finally{this.syncInProgress=!1}}ensureInitialized(){if(!this.isInitialized)throw new Error("UTXOLibrary not initialized. Call initialize() first.");if(!this.contract)throw new Error("UTXO contract not initialized. Contract address may be invalid.")}async generateDepositProof(t,r,s){return V(Be(JSON.stringify({amount:t.toString(),commitment:r,owner:s,timestamp:Date.now()})))}async generateOpeningProof(t,r,s){return V(Be(JSON.stringify({commitment:t,value:r,blindingFactor:s,timestamp:Date.now()})))}mapContractUTXOType(t){switch(t){case Ac.UTXO_TYPES.DEPOSIT:return mt.DEPOSIT;case Ac.UTXO_TYPES.SPLIT:return mt.SPLIT;case Ac.UTXO_TYPES.COMBINE:return mt.COMBINE;case Ac.UTXO_TYPES.TRANSFER:return mt.TRANSFER;default:return mt.DEPOSIT}}get currentAccount(){return this.currentEOA}get initialized(){return this.isInitialized}get configuration(){return{...this.config}}get contractAddress(){var t;return((t=this.contract)==null?void 0:t.address)||null}}new Jx;class Qx extends Jx{constructor(t={}){super(t);E(this,"bbsIssuerKeys",new Map);E(this,"bbsVerificationKeys",new Map);E(this,"coconutSetup",null);E(this,"coconutAuthorities",new Map);E(this,"privateCredentials",new Map);E(this,"coconutCredentials",new Map);E(this,"privateUTXOs",new Map);console.log("🔐 PrivateUTXOManager initialized with BBS+ and Coconut support")}async setupBBSIssuer(t,r){try{if(console.log("🔧 Setting up BBS+ issuer for token:",t),this.currentEOA){const{PrivateUTXOStorage:i}=await Zr(async()=>{const{PrivateUTXOStorage:a}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:a}},void 0,import.meta.url);if(i.hasBBSKeys(this.currentEOA.address,t)){console.log("🔑 Loading existing BBS+ keys from localStorage...");const o=i.getBBSKeys(this.currentEOA.address)[t.toLowerCase()];return this.bbsIssuerKeys.set(t,o.issuerPrivateKey),this.bbsVerificationKeys.set(t,o.verificationKey),console.log("✅ BBS+ keys loaded from localStorage for token:",t),o.issuerPublicKey}}const s=await ot.generateBBSKeyPair(r);if(this.bbsIssuerKeys.set(t,s.privateKey),this.bbsVerificationKeys.set(t,s.publicKey),this.currentEOA){const{PrivateUTXOStorage:i}=await Zr(async()=>{const{PrivateUTXOStorage:a}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:a}},void 0,import.meta.url);i.saveBBSKeys(this.currentEOA.address,t,{issuerPrivateKey:s.privateKey,issuerPublicKey:s.publicKey,verificationKey:s.publicKey})}return console.log("✅ BBS+ issuer configured and saved for token:",t),s.publicKey}catch(s){throw console.error("❌ Failed to setup BBS+ issuer:",s),new hr("BBS+ issuer setup failed","setupBBSIssuer",t,s)}}async setupCoconutThreshold(t,r,s){try{console.log("🥥 Setting up Coconut threshold system..."),console.log(`   - Authorities: ${t.length}`),console.log(`   - Threshold: ${r}`);const i=await ot.generateCoconutThresholdKeys(t,r,s);return this.coconutSetup=i,t.forEach((a,o)=>{this.coconutAuthorities.set(a,i.publicKeys[o])}),console.log("✅ Coconut threshold setup completed"),i}catch(i){throw console.error("❌ Failed to setup Coconut threshold:",i),new hr("Coconut threshold setup failed","setupCoconutThreshold",void 0,i)}}async approveTokenSpending(t,r){var i,a,o,c,l,d,f;const s=pn.getSigner();if(!s)throw new Error("Signer not available");try{const x=new Ur(t,["function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function decimals() view returns (uint8)"],s);let g;try{g=await x.decimals()}catch(p){console.warn("Could not get token decimals, using 18 as default:",p),g=18}const b=await x.allowance((i=this.currentAccount)==null?void 0:i.address,(a=this.contract)==null?void 0:a.target);if(console.log("💰 Current allowance:",pt(b,g)),console.log("💰 Required amount:",pt(r,g)),console.log("🔢 Token decimals:",g),b<r){console.log("🔓 Approving token spending...");const p=r+r/100n;console.log("💰 Approving amount (with buffer):",pt(p,g));let y;try{const C=await((o=s.provider)==null?void 0:o.getFeeData());y=(C==null?void 0:C.gasPrice)||_s("20","gwei")}catch(C){console.warn("Could not get gas price, using default:",C),y=_s("20","gwei")}console.log("gasPrice",y);const v=await x.approve.estimateGas((c=this.contract)==null?void 0:c.target,p),I=v+v/5n,N=await x.approve((l=this.contract)==null?void 0:l.target,p,{gasLimit:I,gasPrice:y});console.log("⏳ Approval transaction sent:",N.hash);const P=await N.wait();console.log("✅ Token approval confirmed:",P==null?void 0:P.hash);const S=await x.allowance((d=this.currentAccount)==null?void 0:d.address,(f=this.contract)==null?void 0:f.target);if(console.log("💰 New allowance after approval:",pt(S,g)),S<r)throw new Error(`Approval failed: allowance ${pt(S,g)} < required ${pt(r,g)}`);console.log("⏳ Waiting longer for approval to be fully processed..."),await new Promise(C=>setTimeout(C,5e3))}else console.log("✅ Sufficient allowance already exists")}catch(x){throw console.error("❌ Token approval failed:",x),new hr("Token approval failed","approveTokenSpending",void 0,x)}}async createPrivateUTXO(t){return console.log("� Using full BBS+ function with new deployed contract..."),this.createPrivateUTXO_Full(t)}async createPrivateUTXO_Full(t){var r,s,i,a,o,c,l,d,f,x,g;this.ensureInitialized(),console.log("🔐 Creating private UTXO with BBS+ credential...");try{const{amount:b,tokenAddress:p,owner:y}=t;await this.approveTokenSpending(p,b),await this.ensureBBSIssuerConfigured(p);const v=this.bbsIssuerKeys.get(p),I=this.bbsVerificationKeys.get(p);if(!v||!I)throw new Error(`BBS+ keys not found for token ${p}`);try{console.log("🔍 Verifying contract at address:",this.contract.target);const D=await((s=(r=this.contract.runner)==null?void 0:r.provider)==null?void 0:s.getCode(this.contract.target));if(!D||D==="0x")throw new Error(`No contract found at address ${this.contract.target}`);console.log("✅ Contract code found, length:",D.length);try{const Y=this.contract.interface.getFunction("depositAsPrivateUTXO");console.log("✅ depositAsPrivateUTXO method found:",Y.format())}catch(Y){throw new Error(`depositAsPrivateUTXO method not found in contract: ${Y}`)}}catch(D){throw new Error(`Contract verification failed: ${D}`)}const N=await ot.generateSecureNonce(),P=await ot.createPedersenCommitment(b.toString(),N),S=await ot.generateNullifierHash(P.pedersen_commitment,y,N),C=await ot.generateSecureNonce(),z={value:b.toString(),owner:y,tokenAddress:p,nonce:C,timestamp:Date.now(),utxoType:mt.DEPOSIT,commitment:P.pedersen_commitment},G=await this.createBBSCredential({amount:b,tokenAddress:p,owner:y,commitment:P.pedersen_commitment}),ne=await ot.createRangeProof(P.pedersen_commitment,b.toString(),N,"0"),J=await this.createBBSProof({credential:G,reveal:["owner","tokenAddress","utxoType"],predicates:{value:{gte:"0"}}}),B={proof:J.proof.startsWith("0x")?J.proof:`0x${J.proof}`,disclosedAttributes:Object.values(J.revealedAttributes).map(D=>{const Y=String(D);return Y.startsWith("0x")&&Y.length===42||Y.startsWith("0x")?tt(Y,32):tt(Be(Y),32)}),disclosureIndexes:[BigInt(1),BigInt(2),BigInt(5)],challenge:Ue(Be(`deposit:${b}:${p}:${y}`)),timestamp:BigInt(Date.now())};if(console.log("🔍 Debug: Contract call parameters:"),console.log("  - tokenAddress:",p),console.log("  - commitment:",P.pedersen_commitment),console.log("  - nullifierHash:",S),console.log("  - rangeProof:",ne),console.log("  - bbsProofData:",JSON.stringify(B,(D,Y)=>typeof Y=="bigint"?Y.toString()+"n":Y,2)),!bd(p))throw new Error(`Invalid token address: ${p}`);if(!P.pedersen_commitment.startsWith("0x")||P.pedersen_commitment.length!==66)throw new Error(`Invalid commitment format: ${P.pedersen_commitment}`);if(!S.startsWith("0x")||S.length!==66)throw new Error(`Invalid nullifier hash format: ${S}`);if(!ne.startsWith("0x"))throw new Error(`Invalid range proof format: ${ne}`);if(!B.proof.startsWith("0x"))throw new Error(`Invalid BBS proof format: ${B.proof}`);if(!Array.isArray(B.disclosedAttributes))throw new Error("Invalid disclosed attributes: must be array");if(!Array.isArray(B.disclosureIndexes))throw new Error("Invalid disclosure indexes: must be array");console.log("✅ All parameters validated");try{console.log("🧪 Testing function encoding...");const Y=this.contract.interface.encodeFunctionData("depositAsPrivateUTXO",[p,b,P.pedersen_commitment,B,S,ne]);console.log("✅ Function encoding successful, data length:",Y.length),console.log("🔍 Encoded data preview:",Y.substring(0,100)+"...")}catch(D){throw console.error("❌ Function encoding failed:",D),new Error(`Function encoding failed: ${D}`)}const he=pn.getSigner();if(!he)throw new Error("Signer not available for deposit transaction");let Pe;try{const D=await((i=he.provider)==null?void 0:i.getFeeData());Pe=(D==null?void 0:D.gasPrice)||_s("20","gwei")}catch(D){console.warn("Could not get gas price for deposit, using default:",D),Pe=_s("20","gwei")}let O;console.log("⛽ Using fixed gas limit for complex BBS+ deposit operation..."),O=BigInt(12e5);const L=O+O*20n/100n;console.log("⛽ Gas estimation for deposit:"),console.log("  - Fixed gas estimate:",O.toString()),console.log("  - Gas limit (with 20% buffer):",L.toString()),console.log("  - Gas price:",pt(Pe,"gwei"),"gwei"),console.log("🔍 Final allowance check before deposit...");const ce=new Ur(p,["function allowance(address owner, address spender) view returns (uint256)","function decimals() view returns (uint8)"],he);let de;try{de=await ce.decimals()}catch(D){console.warn("Could not get token decimals for final check, using 18 as default:",D),de=18}const R=await ce.allowance((a=this.currentAccount)==null?void 0:a.address,(o=this.contract)==null?void 0:o.target);if(console.log("💰 Final allowance check:",pt(R,de)),console.log("💰 Required amount:",pt(b,de)),console.log("🔢 Token decimals (final check):",de),R<b)throw new Error(`Insufficient allowance before deposit: ${pt(R,de)} < ${pt(b,de)}. Please wait and try again, or increase approval amount.`);console.log("✅ Allowance verified, proceeding with deposit..."),console.log("🔍 Additional contract debugging...");const _=await((c=he.provider)==null?void 0:c.getCode(this.contract.target));console.log("📋 Contract code size:",_==null?void 0:_.length);const q=await((d=he.provider)==null?void 0:d.getBalance((l=this.currentAccount)==null?void 0:l.address));console.log("💰 User ETH balance:",zu(q||0n)),console.log("🔍 Final parameter validation..."),console.log("  - tokenAddress valid?",bd(p)),console.log("  - commitment format:",P.pedersen_commitment.substring(0,10)+"..."),console.log("  - nullifierHash format:",S.substring(0,10)+"..."),console.log("  - rangeProof format:",ne.substring(0,10)+"..."),console.log("  - bbsProofData.proof format:",B.proof.substring(0,10)+"..."),console.log("  - bbsProofData.disclosedAttributes length:",B.disclosedAttributes.length),console.log("  - bbsProofData.disclosureIndexes:",B.disclosureIndexes.map(D=>D.toString()));try{if(console.log("🧪 Testing basic contract connectivity..."),(f=this.currentAccount)!=null&&f.address)try{const D=await this.contract.getUserUTXOCount(this.currentAccount.address);console.log("✅ getUserUTXOCount works:",D.toString())}catch(D){console.log("❌ getUserUTXOCount failed:",D)}}catch(D){console.log("❌ Basic contract calls failed:",D)}console.log("🔍 Final final allowance check...");const se=await ce.allowance((x=this.currentAccount)==null?void 0:x.address,(g=this.contract)==null?void 0:g.target);if(console.log("💰 Very final allowance:",pt(se,de)),se<b)throw new Error(`Last-second allowance check failed: ${pt(se,de)} < ${pt(b,de)}`);console.log("🚀 Sending depositAsPrivateUTXO transaction..."),console.log("   Gas limit:",L.toString()),console.log("   Gas price:",pt(Pe,"gwei"),"gwei"),console.log("   Estimated cost:",zu(L*Pe),"ETH");const ve=await(await this.contract.depositAsPrivateUTXO(p,b,P.pedersen_commitment,B,S,ne,{gasLimit:L,gasPrice:Pe})).wait(),Ae=await ot.generateUTXOId(P.pedersen_commitment,y,Date.now()),Re=this.generateNullifierHash(P.pedersen_commitment,y),Ke={id:Ae,exists:!0,value:b,tokenAddress:p,owner:y,timestamp:Kr(Date.now()),isSpent:!1,commitment:P.pedersen_commitment,parentUTXO:"",utxoType:mt.DEPOSIT,blindingFactor:N,nullifierHash:Re,localCreatedAt:Date.now(),confirmed:!0,creationTxHash:ve==null?void 0:ve.hash,blockNumber:ve==null?void 0:ve.blockNumber,bbsCredential:G,isPrivate:!0};this.utxos.set(Ae,Ke),this.privateUTXOs.set(Ae,Ke),this.privateCredentials.set(Ae,G);const{PrivateUTXOStorage:M}=await Zr(async()=>{const{PrivateUTXOStorage:D}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:D}},void 0,import.meta.url);M.savePrivateUTXO(y,Ke);const Q={success:!0,transactionHash:ve==null?void 0:ve.hash,gasUsed:ve==null?void 0:ve.gasUsed,createdUTXOIds:[Ae]};return console.log("✅ Private UTXO created successfully:",Ae),this.emit("private:utxo:created",Ke),Q}catch(b){return console.error("❌ Private UTXO creation failed:",b),{success:!1,error:b instanceof Error?b.message:"Private UTXO creation failed",errorDetails:b}}}async transferPrivateUTXO(t){this.ensureInitialized(),console.log("🔐 Transferring private UTXO...");try{const{utxoId:r,newOwner:s}=t,i=this.privateUTXOs.get(r);if(!i||!i.isPrivate)throw new Error("UTXO is not private or does not exist");const a=this.privateCredentials.get(r);if(!a)throw new Error("Private credential not found");const o=await ot.generateSecureNonce(),c=await ot.createPedersenCommitment(i.value.toString(),o),l=await ot.generateSecureNonce(),d={...a.attributes,owner:s,nonce:l,timestamp:Date.now(),utxoType:mt.TRANSFER,commitment:c.pedersen_commitment},f=await this.createBBSCredential({amount:i.value,tokenAddress:i.tokenAddress,owner:s,commitment:c.pedersen_commitment}),x=await this.createBBSProof({credential:f,reveal:["owner","tokenAddress","utxoType"],predicates:{value:{gte:"0"}}}),g={proof:x.proof.startsWith("0x")?x.proof:`0x${x.proof}`,disclosedAttributes:Object.values(x.revealedAttributes).map(P=>{const S=String(P);return S.startsWith("0x")&&S.length===42||S.startsWith("0x")?tt(S,32):tt(Be(S),32)}),disclosureIndexes:[BigInt(2)],challenge:Ue(Be(`transfer:${r}:${s}`)),timestamp:BigInt(Date.now())},b=this.generateNullifierHash(c.pedersen_commitment,s),y=await(await this.contract.transferPrivateUTXO(i.commitment,c.pedersen_commitment,g,s,b,{gasLimit:this.config.defaultGasLimit})).wait();i.isSpent=!0,this.emit("private:utxo:spent",r);const v=await ot.generateUTXOId(c.pedersen_commitment,s,Date.now()),I={id:v,exists:!0,value:i.value,tokenAddress:i.tokenAddress,owner:s,timestamp:Kr(Date.now()),isSpent:!1,commitment:c.pedersen_commitment,parentUTXO:r,utxoType:mt.TRANSFER,blindingFactor:o,localCreatedAt:Date.now(),confirmed:!0,creationTxHash:y==null?void 0:y.hash,blockNumber:y==null?void 0:y.blockNumber,bbsCredential:f,nullifierHash:b,isPrivate:!0};this.utxos.set(v,I),this.privateUTXOs.set(v,I),this.privateCredentials.set(v,f);const N={success:!0,transactionHash:y==null?void 0:y.hash,gasUsed:y==null?void 0:y.gasUsed,createdUTXOIds:[v]};return console.log("✅ Private UTXO transferred successfully:",v),this.emit("private:utxo:transferred",{from:r,to:v}),N}catch(r){return console.error("❌ Private UTXO transfer failed:",r),{success:!1,error:r instanceof Error?r.message:"Private transfer failed",errorDetails:r}}}async splitPrivateUTXO(t){var r;this.ensureInitialized(),console.log("🔐 Splitting private UTXO...");try{const{inputUTXOId:s,outputValues:i,outputOwners:a}=t,o=this.privateUTXOs.get(s);if(!o||!o.isPrivate)throw new Error("Input UTXO is not private or does not exist");console.log("🔍 Credential verification:",{inputUTXOId:s,hasUTXO:!!o,hasCredentialInUTXO:!!o.bbsCredential,hasCredentialInMap:this.privateCredentials.has(s),credentialMapSize:this.privateCredentials.size,credentialMapKeys:Array.from(this.privateCredentials.keys()).map(O=>O.slice(0,8)+"..."),utxoCredentialType:typeof o.bbsCredential,utxoCredentialValue:o.bbsCredential});let c=this.privateCredentials.get(s);if(!c)if(console.error("❌ Credential not found in privateCredentials map"),console.error("Available credentials:",Array.from(this.privateCredentials.entries()).map(([O,L])=>({id:O.slice(0,8)+"...",hasCredential:!!L}))),o.bbsCredential)console.log("🔄 Using credential from UTXO as fallback"),this.privateCredentials.set(s,o.bbsCredential),c=o.bbsCredential;else throw new Error("Input credential not found and no fallback available");const l=i.reduce((O,L)=>O+L,BigInt(0));if(l!==o.value)throw new Error("Sum of outputs must equal input value");const d=await ot.generateNullifierHash(o.commitment,o.owner,c.attributes.nonce),f=[],x=[],g=[],b=this.bbsIssuerKeys.get(o.tokenAddress),p=this.bbsVerificationKeys.get(o.tokenAddress);for(let O=0;O<i.length;O++){const L=await ot.generateSecureNonce(),ce=await ot.createPedersenCommitment(i[O].toString(),L),de={value:i[O].toString(),owner:a[O],tokenAddress:o.tokenAddress,nonce:await ot.generateSecureNonce(),timestamp:Date.now(),utxoType:mt.SPLIT,commitment:ce.pedersen_commitment},R=await this.createBBSCredential({amount:i[O],tokenAddress:o.tokenAddress,owner:a[O],commitment:ce.pedersen_commitment});f.push(R),x.push(ce.pedersen_commitment),g.push(L)}const y=await this.createBBSProof({credential:c,reveal:["tokenAddress"],predicates:{value:{eq:l.toString()}},challenge:Ue(Be(`split:${s}:${i.join(",")}`))}),v={proof:y.proof.startsWith("0x")?y.proof:`0x${y.proof}`,disclosedAttributes:Object.values(y.revealedAttributes).map(O=>{const L=String(O);return L.startsWith("0x")&&L.length===42||L.startsWith("0x")?tt(L,32):tt(Be(L),32)}),disclosureIndexes:[BigInt(2)],challenge:Ue(Be(`split:${s}:${i.join(",")}`)),timestamp:BigInt(Date.now())},I=await ot.createEqualityProof(o.commitment,x[0],l.toString(),o.blindingFactor,g[0]);console.log("🔍 Contract function verification:",{contractAddress:this.contract.target||"unknown",hasSplitPrivateUTXO:typeof this.contract.splitPrivateUTXO=="function",contractInterface:this.contract.interface?"has interface":"no interface"}),console.log("🔍 Pre-validation parameters:",{inputCommitment:o.commitment,outputCommitments:x,bbsProofData:v,equalityProof:I,nullifierHash:d});const N=je(o.commitment,32)?o.commitment:tt(o.commitment,32),P=x.map(O=>je(O,32)?O:tt(O,32)),S=je(d,32)?d:tt(d,32),C=je(I)?I:V(I),z={proof:je(v.proof)?v.proof:V(v.proof),disclosedAttributes:v.disclosedAttributes.map(O=>je(O,32)?O:tt(O,32)),disclosureIndexes:v.disclosureIndexes.map(O=>BigInt(O)),challenge:je(v.challenge,32)?v.challenge:tt(v.challenge,32),timestamp:BigInt(v.timestamp)};if(console.log("✅ Validated parameters:",{inputCommitment:N,inputCommitmentLength:N.length,outputCommitments:P,outputCommitmentsLength:P.length,bbsProofData:z,equalityProof:C,equalityProofLength:C.length,nullifierHash:S,nullifierHashLength:S.length}),console.log("� === CRITICAL UTXO VERIFICATION ==="),console.log("📋 Input UTXO details:",{id:o.id,value:o.value.toString(),owner:o.owner,isSpent:o.isSpent,commitment:o.commitment,exists:o.exists,confirmed:o.confirmed,creationTxHash:o.creationTxHash,blockNumber:o.blockNumber,localCreatedAt:o.localCreatedAt,isPrivate:o.isPrivate}),!o.creationTxHash||!o.blockNumber)throw console.error("� UTXO appears to be locally created without blockchain confirmation!"),console.error("This suggests the UTXO was never actually created on the contract"),new Error("Cannot split UTXO: No blockchain confirmation found. This UTXO may not exist on the contract.");console.log("✅ UTXO has blockchain confirmation, proceeding with contract verification..."),console.log("🔍 Attempting contract verification using commitment...");try{const O=o.commitment;console.log("📝 Using commitment for lookup:",O);const L=await this.contract.getUTXOsByOwner(o.owner);console.log("📋 All UTXOs for owner from contract:",L);let ce=!1,de=null;for(const R of L)try{const _=await this.contract.getUTXOInfo(R);if(console.log(`� Contract UTXO ${R}:`,_),_[0]&&!_[5]&&_[3].toLowerCase()===o.owner.toLowerCase())try{const q=await this.contract.getUTXOCommitment(R);if(console.log(`📋 Contract commitment for ${R}: ${q}`),q===O){console.log("✅ Found matching UTXO by commitment!"),ce=!0,de={exists:_[0],commitment:_[1],tokenAddress:_[2],owner:_[3],timestamp:_[4],isSpent:_[5],parentUTXO:_[6],utxoType:_[7],nullifierHash:_[8]},R!==o.id&&(console.warn("⚠️ UTXO ID mismatch - updating local ID"),console.warn(`Local ID: ${o.id}`),console.warn(`Contract ID: ${R}`),o.id=R);break}}catch(q){console.warn(`⚠️ Could not get commitment for UTXO ${R}:`,q)}}catch(_){console.warn(`⚠️ Could not get info for UTXO ${R}:`,_)}if(!ce)throw console.error("🚨 UTXO NOT FOUND ON CONTRACT!"),console.error("Available UTXOs on contract:",L),console.error("Looking for commitment:",O),new Error(`UTXO with commitment ${O} not found on contract. Available UTXOs: ${L.join(", ")}`);console.log("✅ UTXO verified successfully on contract")}catch(O){throw console.error("❌ Contract UTXO verification failed:",O),new Error(`Cannot verify UTXO on contract: ${(O==null?void 0:O.message)||O}`)}try{console.log("🔍 Testing contract interface...");const O=this.contract.interface.encodeFunctionData("splitPrivateUTXO",[N,P,z,C,S]);console.log("✅ Function encoding successful:",{encodedDataLength:O.length,encodedDataPrefix:O.substring(0,10)})}catch(O){throw console.error("❌ Function encoding failed:",O),new Error(`Parameter encoding failed: ${O}`)}const ne=BigInt(8e5)*BigInt(120)/BigInt(100);console.log("⛽ Using conservative gas limit for splitPrivateUTXO:",ne.toString()),console.log("🔍 === SPLIT TRANSACTION DEBUG INFO ==="),console.log("📝 Input UTXO:",{id:o.id,value:o.value.toString(),owner:o.owner,isSpent:o.isSpent,commitment:o.commitment,exists:o.exists}),console.log("📝 Output configuration:",{outputCount:i.length,outputValues:i.map(O=>O.toString()),outputOwners:a,totalOutput:i.reduce((O,L)=>O+L,BigInt(0)).toString(),inputValue:o.value.toString()}),console.log("📝 Proof data sizes:",{bbsProofLength:z.proof.length,disclosedAttributesCount:z.disclosedAttributes.length,disclosureIndexesCount:z.disclosureIndexes.length,equalityProofLength:C.length,nullifierHashLength:S.length}),console.log("📝 Contract info:",{address:this.contract.target,hasMethod:typeof this.contract.splitPrivateUTXO=="function"}),console.log("🚀 Calling contract splitPrivateUTXO..."),console.log("📝 Transaction parameters:",{inputCommitment:N,outputCommitmentsCount:P.length,proofSize:z.proof.length,equalityProofSize:C.length,nullifierHash:S,gasLimit:ne.toString()});let J;try{J=await this.contract.splitPrivateUTXO(N,P,z,C,S,{gasLimit:ne}),console.log("✅ Transaction sent successfully:",J.hash)}catch(O){if(console.error("❌ Transaction failed:",O),O&&typeof O=="object"){const L={message:O.message,code:O.code,action:O.action,reason:O.reason,shortMessage:O.shortMessage,data:O.data};if(console.error("💥 Detailed transaction error:",L),O.code===-32603)throw new Error(`RPC Error: The transaction failed during execution. This could be due to insufficient gas, contract revert, or invalid parameters. Original error: ${L.message}`);if(O.code==="UNPREDICTABLE_GAS_LIMIT")throw new Error(`Gas estimation failed - the contract would revert. Check your parameters and try again. Reason: ${L.reason||"Unknown"}`);if((r=O.shortMessage)!=null&&r.includes("revert"))throw new Error(`Contract reverted: ${L.shortMessage||L.reason||"Unknown reason"}`)}throw new Error(`Transaction failed: ${O.message||O}`)}const B=await J.wait();o.isSpent=!0;const{PrivateUTXOStorage:oe}=await Zr(async()=>{const{PrivateUTXOStorage:O}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:O}},void 0,import.meta.url);oe.savePrivateUTXO(o.owner,o),this.emit("private:utxo:spent",s);const he=[];for(let O=0;O<i.length;O++){const L=await ot.generateUTXOId(x[O],a[O],Date.now()+O),ce=await ot.generateNullifierHash(x[O],a[O],Date.now().toString()),de={id:L,exists:!0,value:i[O],tokenAddress:o.tokenAddress,owner:a[O],timestamp:Kr(Date.now()),isSpent:!1,commitment:x[O],parentUTXO:s,utxoType:mt.SPLIT,blindingFactor:g[O],localCreatedAt:Date.now(),confirmed:!0,creationTxHash:B==null?void 0:B.hash,blockNumber:B==null?void 0:B.blockNumber,bbsCredential:f[O],nullifierHash:ce,isPrivate:!0};this.utxos.set(L,de),this.privateUTXOs.set(L,de),this.privateCredentials.set(L,f[O]),he.push(L);const{PrivateUTXOStorage:R}=await Zr(async()=>{const{PrivateUTXOStorage:_}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:_}},void 0,import.meta.url);R.savePrivateUTXO(a[O],de),this.emit("private:utxo:created",de)}const Pe={success:!0,transactionHash:B==null?void 0:B.hash,gasUsed:B==null?void 0:B.gasUsed,createdUTXOIds:he};return console.log("✅ Private UTXO split successfully:",he),Pe}catch(s){return console.error("❌ Private UTXO split failed:",s),{success:!1,error:s instanceof Error?s.message:"Private split failed",errorDetails:s}}}async withdrawPrivateUTXO(t){this.ensureInitialized(),console.log("🔐 Withdrawing private UTXO...");try{const{utxoId:r,recipient:s}=t,i=this.privateUTXOs.get(r);if(!i||!i.isPrivate)throw new Error("UTXO is not private or does not exist");const a=this.privateCredentials.get(r);if(!a)throw new Error("Private credential not found");const o=await ot.generateNullifierHash(i.commitment,i.owner,a.attributes.nonce),c=await this.createBBSProof({credential:a,reveal:["owner","tokenAddress"],predicates:{value:{gte:"0"}},challenge:Ue(Be(`withdraw:${r}:${s}`))}),l={proof:c.proof.startsWith("0x")?c.proof:`0x${c.proof}`,disclosedAttributes:Object.values(c.revealedAttributes).map(b=>{const p=String(b);return p.startsWith("0x")&&p.length===42||p.startsWith("0x")?tt(p,32):tt(Be(p),32)}),disclosureIndexes:[BigInt(1),BigInt(2)],challenge:Ue(Be(`withdraw:${r}:${s}`)),timestamp:BigInt(Date.now())},f=await(await this.contract.withdrawFromPrivateUTXO(i.commitment,l,o,{gasLimit:this.config.defaultGasLimit})).wait();i.isSpent=!0;const{PrivateUTXOStorage:x}=await Zr(async()=>{const{PrivateUTXOStorage:b}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:b}},void 0,import.meta.url);x.savePrivateUTXO(i.owner,i),this.emit("private:utxo:withdrawn",r);const g={success:!0,transactionHash:f==null?void 0:f.hash,gasUsed:f==null?void 0:f.gasUsed};return console.log("✅ Private UTXO withdrawn successfully"),g}catch(r){return console.error("❌ Private UTXO withdrawal failed:",r),{success:!1,error:r instanceof Error?r.message:"Private withdrawal failed",errorDetails:r}}}async createCoconutCredential(t,r){if(!this.coconutSetup)throw new Error("Coconut threshold system not configured");console.log("🥥 Creating Coconut credential with threshold issuance...");try{const s=[];for(const a of r){const o=this.coconutAuthorities.get(a);if(!o){console.warn(`Authority ${a} not found, skipping...`);continue}const c=await ot.requestCoconutPartialCredentialV2(t,o,a);s.push(c)}if(s.length<this.coconutSetup.threshold)throw new Error(`Insufficient partial credentials: ${s.length} < ${this.coconutSetup.threshold}`);const i=await ot.aggregateCoconutCredentialsV2(s.slice(0,this.coconutSetup.threshold),this.coconutSetup);return console.log("✅ Coconut credential created successfully"),i}catch(s){throw console.error("❌ Coconut credential creation failed:",s),new hr("Coconut credential creation failed","createCoconutCredential",void 0,s)}}async syncWithBlockchain(){if(!this.contract||!this.currentEOA)return!1;console.log("🔄 Syncing with blockchain and localStorage...");try{const t=await this.contract.getUserUTXOCount(this.currentEOA.address);console.log(`📊 User has ${t} UTXOs in contract`);const{PrivateUTXOStorage:r}=await Zr(async()=>{const{PrivateUTXOStorage:l}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:l}},void 0,import.meta.url),s=r.getPrivateUTXOs(this.currentEOA.address);console.log(`� Found ${s.length} private UTXOs in localStorage`);const i=r.getBBSKeys(this.currentEOA.address),a=Object.keys(i);this.bbsIssuerKeys.clear(),this.bbsVerificationKeys.clear();for(const l of a){const d=i[l];this.bbsIssuerKeys.set(l,d.issuerPrivateKey),this.bbsVerificationKeys.set(l,d.verificationKey)}console.log(`🔑 Loaded BBS+ keys for ${a.length} tokens`),this.privateUTXOs.clear(),this.privateCredentials.clear();for(const l of s)this.privateUTXOs.set(l.id,l),l.bbsCredential&&this.privateCredentials.set(l.id,l.bbsCredential);const o=[...new Set(s.map(l=>l.tokenAddress))];for(const l of o)if(!this.bbsIssuerKeys.has(l)){console.log(`⚙️ Auto-configuring BBS+ keys for token: ${l}`);try{await this.setupBBSIssuer(l)}catch(d){console.warn(`⚠️ Failed to auto-configure BBS+ keys for ${l}:`,d)}}const c=r.getUserStats(this.currentEOA.address);return console.log("📈 Local UTXO statistics:"),console.log(`  - Total UTXOs: ${c.totalUTXOs}`),console.log(`  - Unspent UTXOs: ${c.unspentUTXOs}`),console.log(`  - Unique tokens: ${c.uniqueTokens}`),console.log(`  - Total balance: ${c.totalBalance.toString()}`),Number(t)!==c.unspentUTXOs&&(console.warn(`⚠️ UTXO count mismatch: Contract(${t}) vs Local(${c.unspentUTXOs})`),console.warn("   This is expected during development. Contract count may include testing deposits.")),console.log("✅ Privacy-preserving sync completed"),this.emit("blockchain:synced",{localUTXOs:Array.from(this.utxos.values()).length,privateUTXOs:Array.from(this.privateUTXOs.values()).length,contractUTXOCount:Number(t),localStats:c,syncMode:"localStorage+contract"}),!0}catch(t){console.error("❌ Sync failed:",t),this.emit("blockchain:sync:failed",t);try{const{PrivateUTXOStorage:r}=await Zr(async()=>{const{PrivateUTXOStorage:i}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:i}},void 0,import.meta.url),s=r.getPrivateUTXOs(this.currentEOA.address);this.privateUTXOs.clear(),this.privateCredentials.clear();for(const i of s)this.privateUTXOs.set(i.id,i),i.bbsCredential&&this.privateCredentials.set(i.id,i.bbsCredential);return console.log(`📱 Loaded ${s.length} UTXOs from localStorage (offline mode)`),!0}catch(r){return console.error("❌ Failed to load local data:",r),!1}}}clearPrivateData(){this.privateCredentials.clear(),this.coconutCredentials.clear(),this.bbsIssuerKeys.clear(),console.log("🧹 Private data cleared")}async createBBSCredential(t){try{const r=[t.amount.toString(),t.tokenAddress,t.owner,t.commitment,Date.now().toString()],s=this.bbsIssuerKeys.get(t.tokenAddress);if(!s)throw new Error(`No BBS+ issuer key found for token ${t.tokenAddress}`);const i=await ot.signBBSCredential(r,s);return{signature:i,attributes:{value:t.amount.toString(),nonce:Date.now().toString(),utxoType:mt.DEPOSIT,tokenAddress:t.tokenAddress,owner:t.owner,commitment:t.commitment,timestamp:Date.now()},issuerPubKey:this.bbsVerificationKeys.get(t.tokenAddress)||"",credentialId:Ue(Be(i+Date.now().toString()))}}catch(r){throw console.error("❌ Failed to create BBS credential:",r),new hr("BBS credential creation failed","createBBSCredential",void 0,r)}}async createBBSProof(t){try{const r=[t.credential.attributes.value,t.credential.attributes.tokenAddress,t.credential.attributes.owner,t.credential.attributes.commitment,t.credential.attributes.nonce],s=[];t.reveal.forEach(o=>{switch(o){case"tokenAddress":s.push(1);break;case"owner":s.push(2);break;case"commitment":s.push(3);break}});const i=await ot.createBBSProof({signature:t.credential.signature,attributes:r,revealIndices:s,predicates:t.predicates,challenge:t.challenge||Date.now().toString()}),a={};return s.forEach(o=>{switch(o){case 1:a.tokenAddress=r[1];break;case 2:a.owner=r[2];break;case 3:a.commitment=r[3];break}}),{proof:i.proof.startsWith("0x")?i.proof:`0x${i.proof}`,revealedAttributes:a,predicateProofs:i.predicateProofs||[],challenge:t.challenge||Date.now().toString()}}catch(r){throw console.error("❌ Failed to create BBS proof:",r),new hr("BBS proof creation failed","createBBSProof",void 0,r)}}generateNullifierHash(t,r,s){const i=t+r+(s||Date.now().toString());return Ue(Be(i))}getPrivateUTXOsByOwner(t){const r=[];for(const[s,i]of this.privateUTXOs.entries())i.owner.toLowerCase()===t.toLowerCase()&&!i.isSpent&&r.push(i);return r}getPrivateBalance(t){let r=BigInt(0);for(const s of this.privateUTXOs.values())!s.isSpent&&(!t||s.tokenAddress===t)&&(r+=s.value);return r}async ensureBBSIssuerConfigured(t){if(!(this.bbsIssuerKeys.has(t)&&this.bbsVerificationKeys.has(t))){console.log("🔧 Auto-configuring BBS+ issuer for token:",t);try{const r=await this.setupBBSIssuer(t);console.log("✅ BBS+ issuer auto-configured for token:",t)}catch(r){throw console.error("❌ Failed to auto-configure BBS+ issuer:",r),new Error(`Failed to configure BBS+ issuer for token ${t}: ${r}`)}}}async createPrivateUTXO_Test(t){var r,s,i;this.ensureInitialized(),console.log("🧪 Creating private UTXO with TESTING function (simplified)...");try{const{amount:a,tokenAddress:o,owner:c}=t;await this.approveTokenSpending(o,a),console.log("🧪 Using simplified testing deposit function...");const l=pn.getSigner();if(!l)throw new Error("Signer not available for deposit transaction");let d;try{const z=await((r=l.provider)==null?void 0:r.getFeeData());d=(z==null?void 0:z.gasPrice)||_s("20","gwei")}catch(z){console.warn("Could not get gas price for deposit, using default:",z),d=_s("20","gwei")}const f=BigInt(5e5);console.log("⛽ Gas estimation for testing deposit:"),console.log("  - Gas limit:",f.toString()),console.log("  - Gas price:",pt(d,"gwei"),"gwei");const x=new Ur(o,["function allowance(address owner, address spender) view returns (uint256)","function decimals() view returns (uint8)"],l);let g;try{g=await x.decimals()}catch{g=18}const b=await x.allowance((s=this.currentAccount)==null?void 0:s.address,(i=this.contract)==null?void 0:i.target);if(console.log("💰 Final allowance check:",pt(b,g)),console.log("💰 Required amount:",pt(a,g)),b<a)throw new Error(`Insufficient allowance: ${pt(b,g)} < ${pt(a,g)}`);console.log("🚀 Sending depositAsPrivateUTXO_Test transaction...");const y=await(await this.contract.depositAsPrivateUTXO_Test(o,a,{gasLimit:f,gasPrice:d})).wait(),v=`test_${Date.now()}_${Math.random().toString(36).substring(7)}`,I=Ue(Be(`${c}:${a}:${Date.now()}`)),N=Ue(Be(`${I}:${c}`)),P={id:v,exists:!0,value:a,tokenAddress:o,owner:c,timestamp:Kr(Date.now()),isSpent:!1,commitment:I,parentUTXO:"",utxoType:mt.DEPOSIT,blindingFactor:"test_blinding_factor",nullifierHash:N,localCreatedAt:Date.now(),confirmed:!0,creationTxHash:y==null?void 0:y.hash,blockNumber:y==null?void 0:y.blockNumber,bbsCredential:{signature:"test_signature",attributes:{value:a.toString(),owner:c,tokenAddress:o,nonce:Date.now().toString(),timestamp:Date.now(),utxoType:mt.DEPOSIT,commitment:I},issuerPubKey:"test_issuer_key",credentialId:Ue(Be(`test_${v}`))},isPrivate:!0};this.utxos.set(v,P),this.privateUTXOs.set(v,P),this.privateCredentials.set(v,P.bbsCredential);const{PrivateUTXOStorage:S}=await Zr(async()=>{const{PrivateUTXOStorage:z}=await Promise.resolve().then(()=>yn);return{PrivateUTXOStorage:z}},void 0,import.meta.url);S.savePrivateUTXO(c,P);const C={success:!0,transactionHash:y==null?void 0:y.hash,gasUsed:y==null?void 0:y.gasUsed,createdUTXOIds:[v]};return console.log("✅ Private UTXO created successfully (testing mode):",v),this.emit("private:utxo:created",P),C}catch(a){return console.error("❌ Private UTXO creation (testing) failed:",a),{success:!1,error:a instanceof Error?a.message:"Private UTXO creation (testing) failed",errorDetails:a}}}}new Qx;class ns{static getUserKey(e){return`${this.STORAGE_KEY}:${this.USER_PREFIX}${e.toLowerCase()}`}static savePrivateUTXO(e,t){try{const r=this.getUserKey(e);console.log(`💾 Saving UTXO for user: ${e}`),console.log(`💾 Using key: ${r}`),console.log("💾 UTXO data:",{id:t.id,value:t.value.toString(),tokenAddress:t.tokenAddress,owner:t.owner,isSpent:t.isSpent});const s=this.getPrivateUTXOs(e);console.log(`💾 Existing UTXOs count: ${s.length}`);const i=s.findIndex(c=>c.id===t.id);i>=0?(s[i]=t,console.log(`💾 Updated existing UTXO at index ${i}`)):(s.push(t),console.log(`💾 Added new UTXO, total count: ${s.length}`));const a=JSON.stringify(s,(c,l)=>typeof l=="bigint"?l.toString():l);localStorage.setItem(r,a),console.log(`💾 Saved to localStorage. Data length: ${a.length}`);const o=localStorage.getItem(r);console.log(`💾 Verification - data exists: ${o!==null}`),console.log(`💾 Private UTXO saved locally for user ${e.substring(0,8)}...`)}catch(r){console.error("❌ Failed to save private UTXO:",r)}}static getPrivateUTXOs(e){try{const t=this.getUserKey(e),r=localStorage.getItem(t);return r?JSON.parse(r).map(i=>({...i,value:typeof i.value=="string"?BigInt(i.value):i.value,timestamp:typeof i.timestamp=="string"?BigInt(i.timestamp):i.timestamp})):[]}catch(t){return console.error("❌ Failed to load private UTXOs:",t),[]}}static markUTXOAsSpent(e,t){try{const r=this.getPrivateUTXOs(e),s=r.findIndex(i=>i.id===t);if(s>=0){r[s].isSpent=!0;const i=this.getUserKey(e);localStorage.setItem(i,JSON.stringify(r)),console.log(`⛔ UTXO ${t.substring(0,8)}... marked as spent`)}}catch(r){console.error("❌ Failed to mark UTXO as spent:",r)}}static getUnspentUTXOs(e){return this.getPrivateUTXOs(e).filter(t=>!t.isSpent)}static getBalance(e,t){return this.getUnspentUTXOs(e).filter(s=>!t||s.tokenAddress.toLowerCase()===t.toLowerCase()).reduce((s,i)=>s+i.value,BigInt(0))}static getUserStats(e){const t=this.getPrivateUTXOs(e),r=t.filter(a=>!a.isSpent),s=new Set(t.map(a=>a.tokenAddress.toLowerCase())).size,i=r.reduce((a,o)=>a+o.value,BigInt(0));return{totalUTXOs:t.length,unspentUTXOs:r.length,spentUTXOs:t.length-r.length,uniqueTokens:s,totalBalance:i}}static clearUserData(e){try{const t=this.getUserKey(e);localStorage.removeItem(t),console.log(`🧹 Private UTXO data cleared for user ${e.substring(0,8)}...`)}catch(t){console.error("❌ Failed to clear user data:",t)}}static clearAllData(){try{const t=Object.keys(localStorage).filter(r=>r.startsWith(this.STORAGE_KEY));t.forEach(r=>localStorage.removeItem(r)),console.log(`🧹 All private UTXO data cleared (${t.length} users)`)}catch(e){console.error("❌ Failed to clear all data:",e)}}static getUserDataSize(e){try{const t=this.getUserKey(e),r=localStorage.getItem(t);return r?r.length:0}catch{return 0}}static hasUserData(e){const t=this.getUserKey(e);return localStorage.getItem(t)!==null}static exportUserData(e){try{const t=this.getUserKey(e);return localStorage.getItem(t)}catch(t){return console.error("❌ Failed to export user data:",t),null}}static importUserData(e,t){try{const r=JSON.parse(t);if(!Array.isArray(r))throw new Error("Invalid data format");const s=this.getUserKey(e);return localStorage.setItem(s,t),console.log(`📥 Private UTXO data imported for user ${e.substring(0,8)}...`),!0}catch(r){return console.error("❌ Failed to import user data:",r),!1}}static saveBBSKeys(e,t,r){try{const s=`${this.STORAGE_KEY}:bbs-keys:${e.toLowerCase()}`,i=this.getBBSKeys(e);i[t.toLowerCase()]=r,localStorage.setItem(s,JSON.stringify(i)),console.log(`🔑 BBS+ keys saved for token ${t.substring(0,8)}...`)}catch(s){console.error("❌ Failed to save BBS+ keys:",s)}}static getBBSKeys(e){try{const t=`${this.STORAGE_KEY}:bbs-keys:${e.toLowerCase()}`,r=localStorage.getItem(t);return r?JSON.parse(r):{}}catch(t){return console.error("❌ Failed to load BBS+ keys:",t),{}}}static hasBBSKeys(e,t){return!!this.getBBSKeys(e)[t.toLowerCase()]}static clearBBSKeys(e){try{const t=`${this.STORAGE_KEY}:bbs-keys:${e.toLowerCase()}`;localStorage.removeItem(t),console.log(`🗑️ BBS+ keys cleared for user ${e.substring(0,8)}...`)}catch(t){console.error("❌ Failed to clear BBS+ keys:",t)}}static debugStorage(e){try{console.log(`🔍 DEBUG: localStorage content for user ${e}`);const{owned:t,received:r,all:s}=this.getAllUserUTXOs(e);console.log(`📦 Owned UTXOs (${t.length}):`,t),console.log(`📥 Received UTXOs (${r.length}):`,r),console.log(`📊 All UTXOs (${s.length}):`,s);const i=this.getBBSKeys(e);console.log("🔑 BBS+ Keys:",Object.keys(i));const a=this.getEnhancedUserStats(e);console.log("📊 Enhanced Stats:",a);const o=this.getAllStoredAccounts();console.log(`👥 All stored accounts (${o.length}):`,o);const c=this.getUserKey(e),l=`${this.STORAGE_KEY}:bbs-keys:${e.toLowerCase()}`;console.log("💾 Raw localStorage:"),console.log(`  - UTXOs key: ${c}`),console.log("  - UTXOs data:",localStorage.getItem(c)),console.log(`  - BBS keys key: ${l}`),console.log("  - BBS keys data:",localStorage.getItem(l))}catch(t){console.error("❌ Debug storage failed:",t)}}static getAllUserUTXOs(e){try{const t=e.toLowerCase(),r=this.getPrivateUTXOs(e),s=[];Object.keys(localStorage).filter(l=>l.startsWith(`${this.STORAGE_KEY}:${this.USER_PREFIX}`)).forEach(l=>{if(!l.includes(t))try{const d=localStorage.getItem(l);if(d){const x=JSON.parse(d).filter(g=>g.owner.toLowerCase()===t&&!l.includes(t));s.push(...x)}}catch(d){console.warn(`⚠️ Error reading UTXOs from key ${l}:`,d)}});const o=s.map(l=>({...l,value:typeof l.value=="string"?BigInt(l.value):l.value,timestamp:typeof l.timestamp=="string"?BigInt(l.timestamp):l.timestamp})),c=[...r,...o];return{owned:r,received:o,all:c}}catch(t){return console.error("❌ Failed to get all user UTXOs:",t),{owned:[],received:[],all:[]}}}static getEnhancedUserStats(e){try{const{owned:t,received:r,all:s}=this.getAllUserUTXOs(e),i=s.filter(l=>!l.isSpent),a=[...new Set(s.map(l=>l.tokenAddress))],o=t.filter(l=>!l.isSpent).reduce((l,d)=>l+d.value,BigInt(0)),c=r.filter(l=>!l.isSpent).reduce((l,d)=>l+d.value,BigInt(0));return{ownedCount:t.length,receivedCount:r.length,totalCount:s.length,totalBalance:o+c,unspentBalance:i.reduce((l,d)=>l+d.value,BigInt(0)),uniqueTokens:a,breakdown:{owned:{count:t.filter(l=>!l.isSpent).length,balance:o},received:{count:r.filter(l=>!l.isSpent).length,balance:c}}}}catch(t){return console.error("❌ Failed to get enhanced user stats:",t),{ownedCount:0,receivedCount:0,totalCount:0,totalBalance:BigInt(0),unspentBalance:BigInt(0),uniqueTokens:[],breakdown:{owned:{count:0,balance:BigInt(0)},received:{count:0,balance:BigInt(0)}}}}}static getAllStoredAccounts(){try{return Object.keys(localStorage).filter(r=>r.startsWith(`${this.STORAGE_KEY}:${this.USER_PREFIX}`)).map(r=>r.replace(`${this.STORAGE_KEY}:${this.USER_PREFIX}`,"")).filter(r=>r.length>0)}catch(e){return console.error("❌ Failed to get stored accounts:",e),[]}}}E(ns,"STORAGE_KEY","private-utxos"),E(ns,"USER_PREFIX","user:");const yn=Object.freeze(Object.defineProperty({__proto__:null,PrivateUTXOStorage:ns},Symbol.toStringTag,{value:"Module"}));var I1=ue('<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> <span>Connecting...</span>',1),S1=ue("<span> </span> <span>Connect MetaMask</span>",1),k1=ue('<div class="flex flex-col items-end space-y-2"><button class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-2 rounded-lg font-semibold transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2"><!></button> <div class="text-xs text-gray-400 text-right"><div>Polygon Amoy Network</div> <div>Testnet Required</div></div></div>'),P1=ue('<div class="w-4 h-4 border-2 border-red-300/30 border-t-red-300 rounded-full animate-spin"></div> <span>Disconnecting...</span>',1),U1=ue("<span>🔌</span> <span>Disconnect</span>",1),N1=ue('<div class="flex items-center space-x-4"><div class="bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2 border border-white/20"><div class="flex items-center space-x-3"><div class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center"><span class="text-white text-sm font-bold"><!></span></div> <div class="text-sm"><div class="text-white font-medium"> </div> <div class="text-gray-300 text-xs"> <!></div></div></div></div> <div class="flex items-center space-x-2"><button class="p-2 text-gray-300 hover:text-white hover:bg-white/10 rounded-lg transition-all duration-200" title="Refresh data"><span class="text-lg">🔄</span></button> <div class="relative"><button class="bg-red-600/20 hover:bg-red-600/30 border border-red-600/30 hover:border-red-600/50 disabled:opacity-50 disabled:cursor-not-allowed text-red-300 px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2"><!></button></div></div></div>');function C1(n,e){Za(e,!1);let t=Xn(e,"utxoManager",8),r=Xn(e,"currentAccount",8,null),s=Xn(e,"isInitialized",8,!1);const i=ol();let a=Te(!1),o=Te(!1);const c={type:Jt.METAMASK,name:"MetaMask",icon:"🦊",description:"Connect using MetaMask (Polygon Amoy Network)"};async function l(){K(a,!0);try{if(!s())i("initialize");else{const I=await t().connectWallet(Jt.METAMASK);I.success||console.error("Connection failed:",I.error)}}catch(I){console.error("Connection error:",I)}finally{K(a,!1)}}async function d(){K(o,!0);try{await t().disconnect()}catch(I){console.error("Disconnection error:",I)}finally{K(o,!1)}}function f(){i("refresh")}function x(I){return`${I.slice(0,6)}...${I.slice(-4)}`}function g(I){switch(Number(I)){case 1:return"Ethereum";case 137:return"Polygon";case 80002:return"Polygon Amoy";case 11155111:return"Sepolia";default:return`Chain ${I}`}}ja();var b=Qd(),p=hn(b);{var y=I=>{var N=k1(),P=T(N),S=T(P);{var C=G=>{var ne=I1();It(2),re(G,ne)},z=G=>{var ne=S1(),J=hn(ne),B=T(J,!0);A(J),It(2),Ge(()=>xe(B,$(()=>c.icon))),re(G,ne)};Oe(S,G=>{u(a)?G(C):G(z,!1)})}A(P),It(2),A(N),Ge(()=>P.disabled=u(a)),ht("click",P,l),re(I,N)},v=I=>{var N=N1(),P=T(N),S=T(P),C=T(S),z=T(C),G=T(z);{var ne=Ae=>{var Re=kr("🦊");re(Ae,Re)},J=(Ae,Re)=>{{var Ke=Q=>{var D=kr("🔗");re(Q,D)},M=(Q,D)=>{{var Y=W=>{var j=kr("💙");re(W,j)},H=W=>{var j=kr("🌐");re(W,j)};Oe(Q,W=>{ke(r()),ke(Jt),$(()=>r().providerType===Jt.COINBASE_WALLET)?W(Y):W(H,!1)},D)}};Oe(Ae,Q=>{ke(r()),ke(Jt),$(()=>r().providerType===Jt.WALLET_CONNECT)?Q(Ke):Q(M,!1)},Re)}};Oe(G,Ae=>{ke(r()),ke(Jt),$(()=>r().providerType===Jt.METAMASK)?Ae(ne):Ae(J,!1)})}A(z),A(C);var B=U(C,2),oe=T(B),he=T(oe,!0);A(oe);var Pe=U(oe,2),O=T(Pe),L=U(O);{var ce=Ae=>{var Re=kr();Ge(Ke=>xe(Re,`• ${Ke??""} ETH`),[()=>(ke(r()),$(()=>(Number(r().ethBalance)/1e18).toFixed(4)))],nt),re(Ae,Re)};Oe(L,Ae=>{ke(r()),$(()=>r().ethBalance!==void 0)&&Ae(ce)})}A(Pe),A(B),A(S),A(P);var de=U(P,2),R=T(de),_=U(R,2),q=T(_),se=T(q);{var ye=Ae=>{var Re=P1();It(2),re(Ae,Re)},ve=Ae=>{var Re=U1();It(2),re(Ae,Re)};Oe(se,Ae=>{u(o)?Ae(ye):Ae(ve,!1)})}A(q),A(_),A(de),A(N),Ge((Ae,Re)=>{xe(he,Ae),xe(O,`${Re??""} `),q.disabled=u(o)},[()=>(ke(r()),$(()=>x(r().address))),()=>(ke(r()),$(()=>g(r().chainId)))],nt),ht("click",R,f),ht("click",q,d),re(I,N)};Oe(p,I=>{r()?I(v,!1):I(y)})}re(n,b),Ya()}var B1=ue('<div class="text-center py-8"><div class="animate-spin text-purple-500 text-3xl mb-2">⚡</div> <p class="text-gray-400">Loading token metadata...</p></div>'),_1=ue('<div class="bg-gray-700 rounded-lg p-4 border border-gray-600 hover:border-purple-500 transition-colors"><div class="flex justify-between items-start mb-2"><div><h3 class="text-white font-medium"> </h3> <p class="text-gray-400 text-sm"> </p></div> <div class="text-right"><div class="text-white font-bold text-lg"> </div> <div class="text-gray-400 text-sm"> </div></div></div></div>'),R1=ue('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6"></div>'),D1=ue("<option> </option>"),L1=ue('<p class="text-gray-500 text-sm">Create your first private UTXO to get started</p>'),F1=ue('<p class="text-gray-500 text-sm">Try adjusting your filters</p>'),M1=ue('<div class="text-center py-8"><div class="text-gray-400 text-lg mb-2">🔒</div> <p class="text-gray-400">No private UTXOs found</p> <!></div>'),G1=ue('<div class="bg-gray-700 rounded-lg p-4 border border-gray-600 hover:border-gray-500 transition-colors"><div class="flex justify-between items-start"><div class="flex-1"><div class="flex items-center gap-3 mb-2"><div class="text-2xl">🔒</div> <div><div class="flex items-center gap-2"><span class="text-white font-medium"> </span> <span> </span></div> <div class="text-sm text-gray-400"> </div></div></div> <div class="grid grid-cols-2 gap-4 text-sm mt-3"><div><span class="text-gray-400">ID:</span> <div class="text-white font-mono text-xs break-all"> </div></div> <div><span class="text-gray-400">Commitment:</span> <div class="text-white font-mono text-xs break-all"> </div></div></div></div> <button class="text-gray-400 hover:text-white transition-colors ml-4" title="Copy UTXO ID">📋</button></div></div>'),X1=ue('<!> <div class="flex flex-wrap items-center gap-4 mb-6 p-4 bg-gray-700 rounded-lg"><div class="flex items-center gap-2"><label for="token-select" class="text-white text-sm">Token:</label> <select id="token-select" class="bg-gray-600 border border-gray-500 rounded px-3 py-1 text-white text-sm"><option>All Tokens</option><!></select></div> <div class="flex items-center gap-2"><label for="sort-select" class="text-white text-sm">Sort:</label> <select id="sort-select" class="bg-gray-600 border border-gray-500 rounded px-3 py-1 text-white text-sm"><option>Date</option><option>Value</option></select></div> <button class="bg-gray-600 border border-gray-500 rounded px-3 py-1 text-white text-sm hover:bg-gray-500"> </button> <div class="flex items-center gap-2"><input id="show-spent" type="checkbox" class="rounded"/> <label for="show-spent" class="text-white text-sm">Show Spent</label></div> <div class="ml-auto text-sm text-gray-400"> </div></div> <div class="space-y-4"><!></div>',1),H1=ue('<div class="bg-gray-800 rounded-lg p-6"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold text-white flex items-center gap-2">🔒 Private UTXO Balance</h2> <button class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">🔄 Refresh</button></div> <!></div>');function z1(n,e){Za(e,!1);const t=Te();let r=Xn(e,"privateUTXOs",24,()=>[]);const s=ol();let i=Te("all"),a=Te("timestamp"),o=Te("desc"),c=Te(!1),l={},d=Te(!1),f=Te(!1),x=Te([]);async function g(J){K(d,!0);for(const B of J)if(!l[B])try{const oe=await pn.getERC20TokenInfo(B);l[B]=oe,l={...l}}catch(oe){console.error(`Failed to load token metadata for ${B}:`,oe)}K(d,!1),K(f,!0)}function b(J){return l[J]||{address:J,symbol:"Unknown",name:"Unknown Token",decimals:18,balance:BigInt(0),allowance:BigInt(0),verified:!1}}function p(J,B=18){const oe=BigInt(10**B),he=J/oe,Pe=J%oe;if(Pe===BigInt(0))return he.toString();const L=Pe.toString().padStart(B,"0").replace(/0+$/,"");return L?`${he}.${L}`:he.toString()}function y(J){return new Date(Number(J)).toLocaleString()}function v(J){navigator.clipboard.writeText(J)}function I(){s("refresh")}function N(J){return r().filter(B=>B.tokenAddress===J&&!B.isSpent).reduce((B,oe)=>B+oe.value,BigInt(0))}Nt(()=>(ke(r()),u(i),u(c),u(a),u(o)),()=>{if(r().length!==0){const J=[...new Set(r().map(B=>B.tokenAddress))];g(J),K(x,r().filter(B=>u(i)==="all"||B.tokenAddress===u(i)).filter(B=>u(c)||!B.isSpent).sort((B,oe)=>{let he=0;switch(u(a)){case"value":he=Number(B.value-oe.value);break;case"timestamp":he=Number(B.timestamp-oe.timestamp);break}return u(o)==="asc"?he:-he}))}}),Nt(()=>ke(r()),()=>{K(t,[...new Set(r().map(J=>J.tokenAddress))])}),cl(),ja();var P=H1(),S=T(P),C=U(T(S),2);A(S);var z=U(S,2);{var G=J=>{var B=B1();re(J,B)},ne=(J,B)=>{{var oe=he=>{var Pe=X1(),O=hn(Pe);{var L=pe=>{var Ce=R1();Pr(Ce,5,()=>u(t),Ln,(De,Le)=>{var Ie=_1();const le=nt(()=>(u(Le),$(()=>b(u(Le))))),bt=nt(()=>(u(Le),$(()=>N(u(Le)))));var zt=T(Ie),nr=T(zt),Ve=T(nr),at=T(Ve,!0);A(Ve);var it=U(Ve,2),Et=T(it,!0);A(it),A(nr);var Dt=U(nr,2),At=T(Dt),ee=T(At,!0);A(At);var te=U(At,2),ie=T(te);A(te),A(Dt),A(zt),A(Ie),Ge((be,we)=>{xe(at,(ke(u(le)),$(()=>u(le).symbol))),xe(Et,(ke(u(le)),$(()=>u(le).name))),xe(ee,be),xe(ie,`${we??""} UTXOs`)},[()=>(ke(u(bt)),ke(u(le)),$(()=>p(u(bt),u(le).decimals))),()=>(ke(r()),u(Le),$(()=>r().filter(be=>be.tokenAddress===u(Le)&&!be.isSpent).length))],nt),re(De,Ie)}),A(Ce),re(pe,Ce)};Oe(O,pe=>{u(t),$(()=>u(t).length>0)&&pe(L)})}var ce=U(O,2),de=T(ce),R=U(T(de),2);Ge(()=>{u(i),Dn(()=>{u(t)})});var _=T(R);_.value=_.__value="all";var q=U(_);Pr(q,1,()=>u(t),Ln,(pe,Ce)=>{var De=D1();const Le=nt(()=>(u(Ce),$(()=>b(u(Ce)))));var Ie=T(De,!0);A(De);var le={};Ge(()=>{xe(Ie,(ke(u(Le)),$(()=>u(Le).symbol))),le!==(le=u(Ce))&&(De.value=(De.__value=u(Ce))??"")}),re(pe,De)}),A(R),A(de);var se=U(de,2),ye=U(T(se),2);Ge(()=>{u(a),Dn(()=>{})});var ve=T(ye);ve.value=ve.__value="timestamp";var Ae=U(ve);Ae.value=Ae.__value="value",A(ye),A(se);var Re=U(se,2),Ke=T(Re,!0);A(Re);var M=U(Re,2),Q=T(M);Mn(Q),It(2),A(M);var D=U(M,2),Y=T(D);A(D),A(ce);var H=U(ce,2),W=T(H);{var j=pe=>{var Ce=M1(),De=U(T(Ce),4);{var Le=le=>{var bt=L1();re(le,bt)},Ie=le=>{var bt=F1();re(le,bt)};Oe(De,le=>{ke(r()),$(()=>r().length===0)?le(Le):le(Ie,!1)})}A(Ce),re(pe,Ce)},Z=pe=>{var Ce=Qd(),De=hn(Ce);Pr(De,1,()=>u(x),Le=>Le.id,(Le,Ie)=>{var le=G1();const bt=nt(()=>(u(Ie),$(()=>b(u(Ie).tokenAddress))));var zt=T(le),nr=T(zt),Ve=T(nr),at=U(T(Ve),2),it=T(at),Et=T(it),Dt=T(Et);A(Et);var At=U(Et,2),ee=T(At,!0);A(At),A(it);var te=U(it,2),ie=T(te,!0);A(te),A(at),A(Ve);var be=U(Ve,2),we=T(be),Fe=U(T(we),2),Se=T(Fe);A(Fe),A(we);var Ee=U(we,2),Je=U(T(Ee),2),Ne=T(Je);A(Je),A(Ee),A(be),A(nr);var He=U(nr,2);A(zt),A(le),Ge(($e,lt,ft,$t)=>{xe(Dt,`${$e??""} ${ke(u(bt)),$(()=>u(bt).symbol)??""}`),Sr(At,1,`px-2 py-1 rounded text-xs font-medium ${u(Ie),$(()=>u(Ie).isSpent?"text-red-400 bg-red-400/20":"text-green-400 bg-green-400/20")??""}`),xe(ee,(u(Ie),$(()=>u(Ie).isSpent?"SPENT":"AVAILABLE"))),xe(ie,lt),xe(Se,`${ft??""}...`),xe(Ne,`${$t??""}...`)},[()=>(u(Ie),ke(u(bt)),$(()=>p(u(Ie).value,u(bt).decimals))),()=>(u(Ie),$(()=>y(u(Ie).timestamp))),()=>(u(Ie),$(()=>u(Ie).id.slice(0,20))),()=>(u(Ie),$(()=>u(Ie).commitment.slice(0,20)))],nt),ht("click",He,()=>v(u(Ie).id)),re(Le,le)}),re(pe,Ce)};Oe(W,pe=>{u(x),$(()=>u(x).length===0)?pe(j):pe(Z,!1)})}A(H),Ge(()=>{xe(Ke,u(o)==="asc"?"↑":"↓"),xe(Y,`${u(x),$(()=>u(x).length)??""} of ${ke(r()),$(()=>r().length)??""} Private UTXOs`)}),pi(R,()=>u(i),pe=>K(i,pe)),pi(ye,()=>u(a),pe=>K(a,pe)),ht("click",Re,()=>K(o,u(o)==="asc"?"desc":"asc")),Xg(Q,()=>u(c),pe=>K(c,pe)),re(he,Pe)};Oe(J,he=>{u(f),ke(r()),$(()=>u(f)||r().length===0)&&he(oe)},B)}};Oe(z,J=>{u(d)?J(G):J(ne,!1)})}A(P),ht("click",C,I),re(n,P),Ya()}var $1=ue('<button class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 hover:border-white/40 hover:bg-white/10 transition-all duration-200 text-left"><div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center"><span class="text-white text-xs font-bold"> </span></div> <div><div class="text-white font-medium"> </div> <div class="text-gray-400 text-sm"> </div></div></button>'),K1=ue('<div class="mt-2 flex items-center space-x-2 text-blue-400 text-sm"><div class="w-4 h-4 border-2 border-blue-400/30 border-t-blue-400 rounded-full animate-spin"></div> <span>Loading token information...</span></div>'),V1=ue('<div class="mt-2 text-yellow-400 text-sm"> </div>'),J1=ue('<div class="bg-white/5 rounded-lg p-4 border border-white/10"><div class="flex items-center space-x-3 mb-3"><div class="w-12 h-12 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center"><span class="text-white font-bold"> </span></div> <div><div class="text-white font-semibold text-lg"> </div> <div class="text-gray-400"> </div></div></div> <div class="grid grid-cols-2 gap-4 text-sm"><div><span class="text-gray-400">Decimals:</span> <span class="text-white ml-2"> </span></div> <div><span class="text-gray-400">Your Balance:</span> <span class="text-white ml-2"> </span></div></div></div>'),Q1=ue('<button type="button" class="text-purple-400 hover:text-purple-300 text-sm font-medium"> </button>'),W1=ue('<div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-medium"> </div>'),j1=ue('<div class="mt-2 text-red-400 text-sm"><!></div>'),Z1=ue(`<div class="pl-6 space-y-4"><div><label for="custom-blinding-factor" class="block text-sm font-medium text-white mb-2">Custom Blinding Factor (Optional)</label> <input id="custom-blinding-factor" type="text" placeholder="Leave empty for auto-generation" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all duration-200"/> <div class="mt-2 text-gray-400 text-sm">💡 A custom blinding factor allows you to reproduce the same commitment later. 
                Leave empty for maximum privacy.</div></div></div>`),Y1=ue('<div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> <span>Creating UTXO...</span>',1),q1=ue("<span>💰</span> <span>Deposit as UTXO</span>",1),e2=ue('<div class="mt-4 p-4 bg-red-600/20 border border-red-600/30 rounded-lg"><div class="flex items-center space-x-2 text-red-400"><span>❌</span> <span class="font-medium">Deposit Failed</span></div> <div class="mt-2 text-red-300 text-sm"> </div></div>'),t2=ue('<div class="space-y-6"><div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20"><div class="flex items-center justify-between mb-2"><h2 class="text-xl font-bold text-white">Deposit ERC20 as UTXO</h2> <div><span class="text-lg"> </span> <span> </span></div></div> <p class="text-gray-300 text-sm"> </p></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20"><h3 class="text-lg font-semibold text-white mb-4">Popular Tokens</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-3"></div></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20"><form class="space-y-6"><div><label for="token-address" class="block text-sm font-medium text-white mb-2">Token Contract Address</label> <input id="token-address" type="text" placeholder="0x..." class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all duration-200" required/> <!> <!></div> <!> <div><div class="flex items-center justify-between mb-2"><label for="deposit-amount" class="text-sm font-medium text-white">Amount to Deposit</label> <!></div> <div class="relative"><input id="deposit-amount" type="number" placeholder="0.00" step="any" min="0" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 pr-20 text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all duration-200" required/> <!></div> <!></div> <div class="border-t border-white/10 pt-6"><button type="button" class="flex items-center space-x-2 text-purple-400 hover:text-purple-300 mb-4"><span> </span> <span>Advanced Privacy Options</span></button> <!></div> <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white py-4 rounded-lg font-semibold transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center space-x-2"><!></button> <!></form></div> <div class="bg-blue-600/20 border border-blue-600/30 rounded-lg p-4"><div class="flex space-x-3"><div class="text-blue-400 text-xl">ℹ️</div> <div class="text-sm text-blue-200"><div class="font-medium mb-1">How it works:</div> <ol class="list-decimal list-inside space-y-1 text-blue-300"><li>Your ERC20 tokens are transferred to the UTXO Vault contract</li> <li>A Pedersen commitment is created using Zenroom cryptography</li> <li>You receive a UTXO representing your deposited tokens</li> <li>The UTXO provides privacy while maintaining blockchain verifiability</li></ol></div></div></div></div>');function r2(n,e){Za(e,!1);let t=Xn(e,"utxoManager",8),r=Xn(e,"privacyMode",8,!0);const s=ol();let i=Te(""),a=Te(""),o=Te(""),c=Te(!1),l=Te(!1),d=Te(null),f=Te(!1),x=Te(""),g=Te("");const b=[{address:"0xA0b86a33E6441d5c97b57dc4a2B7C4b8A3B6A8A8",symbol:"USDC",name:"USD Coin",decimals:6},{address:"0xdAC17F958D2ee523a2206206994597C13D831ec7",symbol:"USDT",name:"Tether USD",decimals:6},{address:"0x6B175474E89094C44Da98b954EedeAC495271d0F",symbol:"DAI",name:"Dai Stablecoin",decimals:18}];async function p(){if(!u(i)||u(i).length!==42){K(d,null);return}K(f,!0),K(x,"");try{const ee=t().currentAccount;if(!ee)throw new Error("No account connected");K(d,await t().ethereum.getERC20TokenInfo(u(i),ee.address)),u(d).verified||K(x,"Token not verified - proceed with caution")}catch(ee){console.error("Failed to load token data:",ee),K(x,"Failed to load token information"),K(d,null)}finally{K(f,!1)}}async function y(){var ee;if(!(!u(d)||!u(a)||!t().currentAccount)){K(l,!0),K(g,"");try{const te=parseFloat(u(a));if(isNaN(te)||te<=0)throw new Error("Invalid amount");const ie=Number(u(d).decimals),be=te.toFixed(ie),[we,Fe=""]=be.split("."),Se=Fe.padEnd(ie,"0"),Ee=we+Se,Je=BigInt(Ee),Ne={amount:Je,tokenAddress:u(i),owner:t().currentAccount.address,blindingFactor:u(c)&&u(o)?u(o):void 0},He=r()?await t().createPrivateUTXO(Ne):await t().depositAsUTXO(Ne);He.success?(K(a,""),K(o,""),K(c,!1),K(g,""),s("deposited",{utxoId:(ee=He.createdUTXOIds)==null?void 0:ee[0],amount:Je,tokenAddress:u(i),txHash:He.transactionHash})):(console.error("Deposit failed:",He.error),K(g,He.error||"Deposit failed"))}catch(te){console.error("Deposit error:",te);let ie="An unexpected error occurred";te instanceof Error&&(te.message.includes("user rejected")?ie="Transaction was rejected. Please try again.":te.message.includes("insufficient funds")?ie="Insufficient funds for gas fees.":te.message.includes("Failed to approve token")?ie="Token approval failed. Please check your wallet and try again.":te.message.includes("execution reverted")?ie="Transaction failed. The token contract may not be valid.":te.message.includes("unsupported addressable value")?ie="UTXO contract not properly initialized. Please check the contract address configuration.":te.message.includes("UTXO contract not initialized")?ie="UTXO contract not initialized. Please verify the contract address and try reconnecting your wallet.":ie=te.message),K(g,ie)}finally{K(l,!1)}}}function v(ee){K(i,ee.address)}function I(ee,te){if(!ee)return"0";const ie=10n**BigInt(te),be=ee/ie,we=ee%ie;if(we===0n)return be.toString();const Se=we.toString().padStart(te,"0").replace(/0+$/,"");return Se?`${be}.${Se}`:be.toString()}function N(){var ee;(ee=u(d))!=null&&ee.balance&&K(a,I(u(d).balance,u(d).decimals))}function P(){if(!u(a)||!u(d))return!1;try{const ee=parseFloat(u(a));if(isNaN(ee)||ee<=0)return!1;const te=Number(u(d).decimals),ie=ee.toFixed(te),[be,we=""]=ie.split("."),Fe=we.padEnd(te,"0"),Se=be+Fe,Ee=BigInt(Se);return Ee>0n&&(!u(d).balance||Ee<=u(d).balance)}catch{return!1}}function S(ee,te){try{const ie=parseFloat(ee);if(isNaN(ie)||ie<=0)return 0n;const be=ie.toFixed(te),[we,Fe=""]=be.split("."),Se=Fe.padEnd(te,"0"),Ee=we+Se;return BigInt(Ee)}catch{return 0n}}function C(){return!u(a)||!u(d)||!u(d).balance?!1:S(u(a),u(d).decimals)>u(d).balance}Nt(()=>u(i),()=>{u(i)&&u(i).length===42&&p()}),cl(),ja();var z=t2(),G=T(z),ne=T(G),J=U(T(ne),2),B=T(J),oe=T(B,!0);A(B);var he=U(B,2),Pe=T(he,!0);A(he),A(J),A(ne);var O=U(ne,2),L=T(O);A(O),A(G);var ce=U(G,2),de=U(T(ce),2);Pr(de,5,()=>b,Ln,(ee,te)=>{var ie=$1(),be=T(ie),we=T(be),Fe=T(we,!0);A(we),A(be);var Se=U(be,2),Ee=T(Se),Je=T(Ee,!0);A(Ee);var Ne=U(Ee,2),He=T(Ne,!0);A(Ne),A(Se),A(ie),Ge($e=>{xe(Fe,$e),xe(Je,(u(te),$(()=>u(te).symbol))),xe(He,(u(te),$(()=>u(te).name)))},[()=>(u(te),$(()=>u(te).symbol.substring(0,2)))],nt),ht("click",ie,()=>v(u(te))),re(ee,ie)}),A(de),A(ce);var R=U(ce,2),_=T(R),q=T(_),se=U(T(q),2);Mn(se);var ye=U(se,2);{var ve=ee=>{var te=K1();re(ee,te)};Oe(ye,ee=>{u(f)&&ee(ve)})}var Ae=U(ye,2);{var Re=ee=>{var te=V1(),ie=T(te);A(te),Ge(()=>xe(ie,`⚠️ ${u(x)??""}`)),re(ee,te)};Oe(Ae,ee=>{u(x)&&ee(Re)})}A(q);var Ke=U(q,2);{var M=ee=>{var te=J1(),ie=T(te),be=T(ie),we=T(be),Fe=T(we,!0);A(we),A(be);var Se=U(be,2),Ee=T(Se),Je=T(Ee,!0);A(Ee);var Ne=U(Ee,2),He=T(Ne,!0);A(Ne),A(Se),A(ie);var $e=U(ie,2),lt=T($e),ft=U(T(lt),2),$t=T(ft,!0);A(ft),A(lt);var Qr=U(lt,2),Wr=U(T(Qr),2),Ps=T(Wr);A(Wr),A(Qr),A($e),A(te),Ge((Us,Si)=>{xe(Fe,Us),xe(Je,(u(d),$(()=>u(d).symbol))),xe(He,(u(d),$(()=>u(d).name))),xe($t,(u(d),$(()=>u(d).decimals))),xe(Ps,`${Si??""} ${u(d),$(()=>u(d).symbol)??""}`)},[()=>(u(d),$(()=>u(d).symbol.substring(0,2))),()=>(u(d),$(()=>I(u(d).balance,u(d).decimals)))],nt),re(ee,te)};Oe(Ke,ee=>{u(d)&&ee(M)})}var Q=U(Ke,2),D=T(Q),Y=U(T(D),2);{var H=ee=>{var te=Q1(),ie=T(te);A(te),Ge(be=>xe(ie,`Max: ${be??""}`),[()=>(u(d),$(()=>I(u(d).balance,u(d).decimals)))],nt),ht("click",te,N),re(ee,te)};Oe(Y,ee=>{u(d),$(()=>{var te;return(te=u(d))==null?void 0:te.balance})&&ee(H)})}A(D);var W=U(D,2),j=T(W);Mn(j);var Z=U(j,2);{var pe=ee=>{var te=W1(),ie=T(te,!0);A(te),Ge(()=>xe(ie,(u(d),$(()=>u(d).symbol)))),re(ee,te)};Oe(Z,ee=>{u(d)&&ee(pe)})}A(W);var Ce=U(W,2);{var De=ee=>{var te=j1(),ie=T(te);{var be=Fe=>{var Se=kr("Insufficient balance");re(Fe,Se)},we=Fe=>{var Se=kr("Invalid amount");re(Fe,Se)};Oe(ie,Fe=>{$(C)?Fe(be):Fe(we,!1)})}A(te),re(ee,te)};Oe(Ce,ee=>{u(a),u(d),$(()=>u(a)&&u(d)&&!P())&&ee(De)})}A(Q);var Le=U(Q,2),Ie=T(Le),le=T(Ie),bt=T(le,!0);A(le),It(2),A(Ie);var zt=U(Ie,2);{var nr=ee=>{var te=Z1(),ie=T(te),be=U(T(ie),2);Mn(be),It(2),A(ie),A(te),vs(be,()=>u(o),we=>K(o,we)),re(ee,te)};Oe(zt,ee=>{u(c)&&ee(nr)})}A(Le);var Ve=U(Le,2),at=T(Ve);{var it=ee=>{var te=Y1();It(2),re(ee,te)},Et=ee=>{var te=q1();It(2),re(ee,te)};Oe(at,ee=>{u(l)?ee(it):ee(Et,!1)})}A(Ve);var Dt=U(Ve,2);{var At=ee=>{var te=e2(),ie=U(T(te),2),be=T(ie,!0);A(ie),A(te),Ge(()=>xe(be,u(g))),re(ee,te)};Oe(Dt,ee=>{u(g)&&ee(At)})}A(_),A(R),It(2),A(z),Ge(()=>{Sr(J,1,`flex items-center space-x-2 px-3 py-1 rounded-lg ${r()?"bg-purple-600/20 border border-purple-500/50":"bg-blue-600/20 border border-blue-500/50"}`),xe(oe,r()?"🔐":"🔓"),Sr(he,1,`text-sm font-medium ${r()?"text-purple-300":"text-blue-300"}`),xe(Pe,r()?"Private Mode":"Public Mode"),xe(L,`Convert your ERC20 tokens into ${r()?"privacy-preserving":"transparent"} UTXOs using ${r()?"BBS+ cryptography":"standard cryptography"}`),xe(bt,u(c)?"▼":"▶"),Ve.disabled=!u(d)||u(l)}),vs(se,()=>u(i),ee=>K(i,ee)),vs(j,()=>u(a),ee=>K(a,ee)),ht("click",Ie,()=>K(c,!u(c))),ht("submit",_,Hg(y)),re(n,z),Ya()}var n2=ue('<button><span class="text-2xl mb-1"> </span> <span class="text-sm"> </span></button>'),s2=ue('<div class="mt-4 text-gray-400 text-sm">Loading token information...</div>'),i2=ue('<div class="text-center py-12"><div class="text-6xl mb-4">⏳</div> <div class="text-white text-xl font-semibold mb-4">Loading Data...</div> <div class="space-y-2 max-w-md mx-auto"><div class="flex items-center justify-between text-sm"><span class="text-gray-300">UTXOs</span> <span> </span></div> <div class="flex items-center justify-between text-sm"><span class="text-gray-300">Token Metadata</span> <span> </span></div></div> <!></div>'),a2=ue("<br/> ",1),o2=ue('<div class="text-center py-12"><div class="text-gray-400 text-6xl mb-4">📪</div> <div class="text-white text-xl font-semibold mb-2">No UTXOs Available</div> <div class="text-gray-400 mb-4">You need confirmed UTXOs to perform operations. Try depositing some tokens first.</div> <div class="text-xs text-gray-500 mt-4 bg-gray-800/50 rounded p-2"> <!></div></div>'),c2=ue('<div class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-gray-400 flex items-center"><div class="animate-spin w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full mr-2"></div> Loading token metadata...</div>'),l2=ue("<option> </option>"),d2=ue('<select id="split-utxo-select" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none" required><option>Choose a UTXO...</option><!></select>'),u2=ue('<button type="button" class="p-2 text-red-400 hover:text-red-300">🗑️</button>'),f2=ue('<div class="flex space-x-3 items-end"><div class="flex-1"><label class="block text-xs text-gray-400 mb-1">Amount</label> <input type="number" placeholder="0.00" step="any" min="0" class="w-full bg-white/5 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-gray-400" required/></div> <div class="flex-1"><label class="block text-xs text-gray-400 mb-1">Owner Address</label> <input type="text" placeholder="0x..." class="w-full bg-white/5 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-gray-400" required/></div> <!></div>'),h2=ue('<div class="bg-blue-600/20 border border-blue-600/30 rounded-lg p-3 mb-4"><div class="flex justify-between items-center text-sm"><span class="text-blue-200">Input Total:</span> <span class="text-white font-mono"> </span></div> <div class="flex justify-between items-center text-sm mt-1"><span class="text-blue-200">Output to Others:</span> <span class="text-white font-mono"> </span></div> <div class="flex justify-between items-center text-sm mt-1"><span class="text-blue-200">Remaining to You:</span> <span> </span></div></div> <div><div><!></div> <div class="text-xs text-gray-400 text-center mt-2"> </div></div>',1),x2=ue('<div><div class="flex items-center justify-between mb-4"><div class="text-sm font-medium text-white">Output UTXOs</div> <button type="button" class="text-purple-400 hover:text-purple-300 text-sm font-medium">+ Add Output</button></div> <div class="space-y-3"></div> <!></div>'),g2=ue('<div class="space-y-6"><h3 class="text-lg font-semibold text-white">Split UTXO into Multiple Outputs</h3> <div><label for="split-utxo-select" class="block text-sm font-medium text-white mb-2">Select UTXO to Split</label> <!></div> <!></div>'),p2=ue('<div class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-gray-400 flex items-center"><div class="animate-spin w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full mr-2"></div> Loading token metadata...</div>'),b2=ue("<option> </option>"),m2=ue('<select id="withdraw-utxo-select" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none" required><option>Choose a UTXO...</option><!></select>'),y2=ue('<div class="bg-blue-600/20 border border-blue-600/30 rounded-lg p-4"><div class="flex space-x-3"><div class="text-blue-400 text-xl">ℹ️</div> <div class="text-sm text-blue-200"><div class="font-medium mb-1">Withdrawal Details:</div> <div class="space-y-1 text-blue-300"><div> </div> <div> </div> <div>This will convert your UTXO back to standard ERC20 tokens</div></div></div></div></div>'),w2=ue('<div class="space-y-6"><h3 class="text-lg font-semibold text-white">Withdraw UTXO to ERC20</h3> <div><label for="withdraw-utxo-select" class="block text-sm font-medium text-white mb-2">Select UTXO to Withdraw</label> <!></div> <div><label for="withdraw-recipient" class="block text-sm font-medium text-white mb-2">Recipient Address</label> <input id="withdraw-recipient" type="text" placeholder="0x..." class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400" required/></div> <!></div>'),v2=ue('<div class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-gray-400 flex items-center"><div class="animate-spin w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full mr-2"></div> Loading token metadata...</div>'),A2=ue("<option> </option>"),E2=ue('<select id="transfer-utxo-select" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none" required><option>Choose a UTXO...</option><!></select>'),T2=ue('<div class="space-y-6"><h3 class="text-lg font-semibold text-white">Transfer UTXO Ownership</h3> <div><label for="transfer-utxo-select" class="block text-sm font-medium text-white mb-2">Select UTXO to Transfer</label> <!></div> <div><label for="transfer-recipient" class="block text-sm font-medium text-white mb-2">New Owner Address</label> <input id="transfer-recipient" type="text" placeholder="0x..." class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400" required/></div> <div class="bg-yellow-600/20 border border-yellow-600/30 rounded-lg p-4"><div class="flex space-x-3"><div class="text-yellow-400 text-xl">🚧</div> <div class="text-sm text-yellow-200"><div class="font-medium mb-1">Coming Soon:</div> <div class="text-yellow-300">UTXO transfer functionality is being implemented and will be available in a future update.</div></div></div></div></div>'),O2=ue('<div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> <span>Processing...</span>',1),I2=ue("<span><!></span> <span> </span>",1),S2=ue('<!> <!> <!> <div class="pt-6 border-t border-white/10"><button class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white py-4 rounded-lg font-semibold transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center space-x-2"><!></button></div>',1),k2=ue('<div class="space-y-6"><div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20"><div class="flex justify-between items-center"><div><h2 class="text-xl font-bold text-white mb-2">UTXO Operations</h2> <p class="text-gray-300 text-sm">Perform privacy-preserving operations on your UTXOs</p></div></div></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20"><div class="flex space-x-1 p-1"></div></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20"><!></div></div>');function P2(n,e){Za(e,!1);const t=Te(),r=Te(),s=Te(),i=Te(),a=Te(),o=Te();let c=Xn(e,"utxoManager",8),l=Xn(e,"privateUTXOs",24,()=>[]);const d=ol();let f=Te("split"),x=Te(!1),g=Te(!1),b=Te(!1),p=Te(!1),y=Te(!1),v={};async function I(){console.log("🔄 Private UTXOs changed, starting loading sequence..."),K(p,!1),K(y,!1),K(g,!0),console.log("📦 Phase 1: Private UTXOs loading...",{private:l().length}),await new Promise(M=>setTimeout(M,100)),K(g,!1),K(p,!0),console.log("✅ Phase 1: Private UTXOs loaded"),await N()}async function N(){if(!u(p)){console.warn("⚠️ Attempting to load token metadata before UTXOs are loaded");return}K(b,!0),console.log("🏷️ Phase 2: Token metadata loading...");try{const M=[...new Set(l().map(D=>D.tokenAddress))];console.log("🔍 Loading token metadata for:",M);for(const D of M)if(!v[D])try{console.log(`📊 Fetching metadata for ${D}...`);const Y=await pn.getERC20TokenInfo(D);console.log("✅ Token metadata loaded:",{address:Y.address,symbol:Y.symbol,name:Y.name,decimals:Y.decimals,hasBalance:Y.balance!==void 0,hasAllowance:Y.allowance!==void 0,verified:Y.verified}),v[D]=Y,v={...v}}catch(Y){console.error("❌ Failed to load token metadata for",D,Y),v[D]={address:D,name:`Unknown Token (${D.slice(0,6)}...)`,symbol:"UNK",decimals:18,balance:0n,allowance:0n,verified:!1},v={...v}}K(b,!1),K(y,!0),console.log("✅ Phase 2: Token metadata loaded for all tokens"),console.log("🎉 All data loaded, ready to render operations");const Q=Object.entries(v).map(([D,Y])=>({address:D.slice(0,8)+"...",symbol:Y.symbol,decimals:Y.decimals}));console.log("📋 Token metadata summary:",Q)}catch(M){console.error("❌ Error loading token metadata:",M),K(b,!1),K(y,!1)}}function P(M){const Q=v[M];if(!Q)return console.warn(`⚠️ Token metadata not found for ${M}, using defaults`),{address:M,name:`Token ${M.slice(0,6)}...`,symbol:"UNK",decimals:18,balance:0n,allowance:0n,verified:!1};const D={address:Q.address,name:Q.name,symbol:Q.symbol,decimals:Q.decimals,balance:Q.balance??0n,allowance:Q.allowance??0n,verified:Q.verified??!1};return console.log(`📋 Using metadata for ${M}:`,{symbol:D.symbol,decimals:D.decimals.toString(),hasBalance:Q.balance!==void 0,hasAllowance:Q.allowance!==void 0}),console.log("completeMetadata",D),D}let S=Te(""),C=Te([{amount:"",owner:""},{amount:"",owner:""}]),z=Te(""),G=Te(""),ne=Te(""),J=Te(""),B=Te({valid:!1,error:"No UTXO selected",canSubmit:!1});function oe(M,Q=18){try{const D=typeof M=="bigint"?M:BigInt(M.toString()),Y=Q||18,H=BigInt(10)**BigInt(Y),W=D/H,j=D%H;if(j===BigInt(0))return W.toString();const pe=j.toString().padStart(Y,"0").replace(/0+$/,"");return pe?`${W}.${pe}`:W.toString()}catch(D){return console.error("Error formatting value:",D,"Value:",M,"Decimals:",Q),"0"}}function he(M,Q){try{if(!M)return 0n;const D=String(M).trim();if(D==="")return 0n;const Y=parseFloat(D);if(isNaN(Y)||Y<=0)return 0n;const[H,W=""]=D.split("."),j=W.slice(0,Q),Z=j.padEnd(Q,"0"),pe=H+Z;return console.log(`💱 Parse ${M} with ${Q} decimals:`,{original:M,stringified:D,integerPart:H,decimalPart:W,truncatedDecimal:j,paddedDecimal:Z,fullAmountStr:pe,result:BigInt(pe).toString()}),BigInt(pe)}catch(D){return console.error("Error parsing amount:",D,"Input:",M,"Type:",typeof M),0n}}function Pe(){var M;K(C,[...u(C),{amount:"",owner:((M=c().currentAccount)==null?void 0:M.address)||""}])}function O(M){u(C).length>2&&K(C,u(C).filter((Q,D)=>D!==M))}function L(){const M=u(i).split;if(!M)return{valid:!1,error:"No UTXO selected"};try{const D=P(M.tokenAddress).decimals,Y=M.value;console.log("🔍 Validating split amounts:",{totalInput:Y.toString(),totalInputFormatted:oe(Y),decimals:D,outputs:u(C).map(j=>({amount:j.amount,owner:j.owner.slice(0,8)+"..."}))});let H=BigInt(0);const W=[];for(const j of u(C)){if(!j.amount||!j.owner)return console.log("❌ Missing amount or owner:",j),{valid:!1,error:"All outputs must have amount and owner"};const Z=he(j.amount,D);if(W.push({amount:j.amount,amountBigInt:Z.toString(),owner:j.owner.slice(0,8)+"..."}),Z<=0)return console.log("❌ Invalid amount:",{amount:j.amount,amountBigInt:Z}),{valid:!1,error:"All amounts must be positive"};H+=Z}if(console.log("📊 Detailed validation:",{totalInput:Y.toString(),totalOutput:H.toString(),difference:(Y-H).toString(),inputFormatted:oe(Y),outputFormatted:oe(H),outputDetails:W,isEqual:H===Y}),H!==Y){const j=Y-H,Z=oe(j);return console.log("❌ Amounts do not match. Difference:",Z),{valid:!1,error:`Sum of outputs (${oe(H)}) must equal input (${oe(Y)}). Difference: ${Z}`}}return console.log("✅ Validation passed"),{valid:!0}}catch(Q){return console.error("❌ Validation error:",Q),{valid:!1,error:"Validation failed: "+(Q instanceof Error?Q.message:"Unknown error")}}}async function ce(){var D,Y,H,W;const M=L();if(!M.valid){console.error("Split validation failed:",M.error);return}const Q=u(i).split;K(x,!0);try{console.log("🔍 Executing split with detailed info:",{selectedUTXOId:u(S),selectedUTXOData:Q,currentAccount:(D=c().currentAccount)==null?void 0:D.address,allAvailableUTXOs:u(s).map(le=>({id:le.id,owner:le.owner,value:le.value.toString()})),allPrivateUTXOs:l().map(le=>({id:le.id,owner:le.owner,isSpent:le.isSpent,value:le.value.toString()}))});const j=c().getPrivateUTXOsByOwner(c().currentAccount.address),Z=j.find(le=>le.id===u(S));console.log("🔍 UTXO verification:",{searchingForId:u(S),searchingForIdLength:u(S).length,foundInManager:Z?{id:Z.id,idLength:Z.id.length,owner:Z.owner,isSpent:Z.isSpent,value:Z.value.toString()}:null,managerUTXOsCount:j.length,managerUTXOsIds:j.map(le=>({id:le.id,idLength:le.id.length,isSpent:le.isSpent,owner:le.owner})),exactMatch:j.some(le=>le.id===u(S)),idComparisons:j.map(le=>({managerId:le.id,selectedId:u(S),equal:le.id===u(S),lengthMatch:le.id.length===u(S).length}))}),console.log("� Detailed manager state:",{hasCurrentAccount:!!c().currentAccount,currentAccountAddress:(Y=c().currentAccount)==null?void 0:Y.address,managerPrivateUTXOsInternal:j.map(le=>({id:le.id,owner:le.owner,isSpent:le.isSpent,value:le.value.toString(),tokenAddress:le.tokenAddress}))}),Z&&console.log("� Found UTXO detailed analysis:",{foundUTXO:Z,isExactSameObject:Z===Q,propertiesMatch:{id:Z.id===Q.id,owner:Z.owner===Q.owner,value:Z.value===Q.value,isSpent:Z.isSpent===Q.isSpent,tokenAddress:Z.tokenAddress===Q.tokenAddress}});const Ce=P(Q.tokenAddress).decimals,De=u(C).map(le=>he(le.amount,Ce)),Le=u(C).map(le=>le.owner),Ie=await c().splitPrivateUTXO({inputUTXOId:u(S),outputValues:u(C).map(le=>he(le.amount,Ce)),outputOwners:u(C).map(le=>le.owner)});Ie.success?(console.log("✅ Split operation completed successfully:",Ie),K(S,""),K(C,[{amount:"",owner:((H=c().currentAccount)==null?void 0:H.address)||""},{amount:"",owner:((W=c().currentAccount)==null?void 0:W.address)||""}]),d("operation",{type:"split",result:Ie})):console.error("Split failed:",Ie.error)}catch(j){console.error("Split error:",j)}finally{K(x,!1)}}async function de(){var M;if(!(!u(z)||!u(G))){K(x,!0);try{const Q=await c().withdrawPrivateUTXO({utxoId:u(z),recipient:u(G)});Q.success?(K(z,""),K(G,((M=c().currentAccount)==null?void 0:M.address)||""),d("operation",{type:"withdraw",result:Q})):console.error("Withdraw failed:",Q.error)}catch(Q){console.error("Withdraw error:",Q)}finally{K(x,!1)}}}async function R(){if(!(!u(ne)||!u(J))){K(x,!0);try{console.log("Transfer operation not yet implemented in the library"),K(ne,""),K(J,""),d("operation",{type:"transfer",result:{success:!1,error:"Not implemented"}})}catch(M){console.error("Transfer error:",M)}finally{K(x,!1)}}}function _(){switch(u(f)){case"split":ce();break;case"withdraw":de();break;case"transfer":R();break}}Nt(()=>(u(p),u(y)),()=>{K(t,u(p)&&u(y))}),Nt(()=>(u(g),u(b)),()=>{K(r,u(g)||u(b))}),Nt(()=>ke(l()),()=>{l().length>0&&I()}),Nt(()=>(u(t),ke(l())),()=>{K(s,u(t)?l().filter(M=>!M.isSpent).map(M=>({id:M.id,value:M.value,tokenAddress:M.tokenAddress,owner:M.owner,isSpent:M.isSpent,timestamp:M.timestamp,commitment:M.commitment,nullifierHash:M.nullifierHash,blindingFactor:M.blindingFactor})):[])}),Nt(()=>(u(s),u(S),u(z),u(ne)),()=>{K(i,{split:u(s).find(M=>M.id===u(S)),withdraw:u(s).find(M=>M.id===u(z)),transfer:u(s).find(M=>M.id===u(ne))})}),Nt(()=>ke(l()),()=>{console.log("📥 OperationsPanel received private UTXOs:",{privateUTXOs:l().length,privateDetails:l().map(M=>({id:M.id.slice(0,8),spent:M.isSpent}))})}),Nt(()=>(u(s),ke(l())),()=>{u(s).length>0&&console.log("🔧 Available private UTXOs for operations:",{total:u(s).length,private:l().filter(M=>!M.isSpent).length,utxos:u(s).map(M=>({id:M.id.slice(0,8),value:M.value.toString(),tokenAddress:M.tokenAddress}))})}),Nt(()=>(ke(c()),u(C),u(G)),()=>{if(c().currentAccount){const M=c().currentAccount.address;K(C,u(C).map(Q=>({...Q,owner:Q.owner||M}))),K(G,u(G)||M)}}),Nt(()=>(u(t),u(i),u(C)),()=>{try{if(!u(t))K(B,{valid:!1,error:"Loading data...",canSubmit:!1});else{const M=u(i).split;if(!M)K(B,{valid:!1,error:"No UTXO selected",canSubmit:!1});else{const D=P(M.tokenAddress).decimals,Y=M.value;console.log("decimals ---------- ",D);let H=BigInt(0),W=!1,j=!1;console.log("🔄 Reactive validation:",{selectedUTXO:M.id.slice(0,8),totalInput:oe(Y),outputs:u(C).map(Z=>{var pe;return{amount:Z.amount,owner:((pe=Z.owner)==null?void 0:pe.slice(0,8))+"..."}})});for(const Z of u(C)){if(!Z.amount||!Z.owner){W=!0;continue}const pe=he(Z.amount,D);if(pe<=0){j=!0;continue}H+=pe}if(W)K(B,{valid:!1,error:"All outputs must have amount and owner",canSubmit:!1});else if(j)K(B,{valid:!1,error:"All amounts must be positive",canSubmit:!1});else if(H!==Y){const Z=Y-H,pe=oe(Z>0?Z:-Z,D);K(B,{valid:!1,error:`Sum of outputs (${oe(H,D)}) must equal input (${oe(Y,D)}). Difference: ${pe}`,canSubmit:!1})}else K(B,{valid:!0,canSubmit:!0}),console.log("✅ Split validation passed")}}}catch(M){console.error("❌ Reactive validation error:",M),K(B,{valid:!1,error:"Validation failed: "+(M instanceof Error?M.message:"Unknown error"),canSubmit:!1})}}),Nt(()=>(u(i),ke(c()),u(t),u(C)),()=>{K(a,(()=>{if(!u(i).split||!c().currentAccount||!u(t))return{remainder:"0",formatted:"0",outputToOthers:BigInt(0),remainingToUser:BigInt(0),formattedOutputToOthers:"0",formattedRemainingToUser:"0",isPositive:!1,isNegative:!1,isZero:!0};const M=u(i).split,D=P(M.tokenAddress).decimals,Y=M.value,H=c().currentAccount.address.toLowerCase();let W=BigInt(0),j=BigInt(0),Z=BigInt(0);for(const De of u(C))if(De.amount&&De.owner){const Le=he(De.amount,D);W+=Le,De.owner.toLowerCase()===H?Z+=Le:j+=Le}const pe=Y-W,Ce=oe(pe,D);return pe>0&&(Z+=pe),{remainder:pe.toString(),formatted:Ce,isPositive:pe>0,isNegative:pe<0,isZero:pe===0n,outputToOthers:j,remainingToUser:Z,formattedOutputToOthers:oe(j,D),formattedRemainingToUser:oe(Z,D)}})())}),Nt(()=>(u(x),u(t),u(f),u(B),u(z),u(G),u(ne),u(J)),()=>{K(o,(()=>{if(u(x)||!u(t))return!1;switch(u(f)){case"split":return u(B).canSubmit;case"withdraw":return!!(u(z)&&u(G));case"transfer":return!!(u(ne)&&u(J));default:return!1}})())}),cl(),ja();var q=k2(),se=U(T(q),2),ye=T(se);Pr(ye,4,()=>[{id:"split",label:"Split UTXO",icon:"✂️",description:"Divide one UTXO into multiple outputs"},{id:"withdraw",label:"Withdraw",icon:"💸",description:"Convert UTXO back to ERC20 tokens"},{id:"transfer",label:"Transfer",icon:"📤",description:"Transfer UTXO to another address"}],Ln,(M,Q)=>{var D=n2(),Y=T(D),H=T(Y,!0);A(Y);var W=U(Y,2),j=T(W,!0);A(W),A(D),Ge(()=>{Sr(D,1,`flex-1 flex flex-col items-center justify-center py-4 px-4 rounded-lg font-medium transition-all duration-200 ${u(f),$(()=>u(f)===Q.id?"bg-white/20 text-white":"text-gray-300 hover:bg-white/10")??""}`),Ls(D,"title",$(()=>Q.description)),xe(H,$(()=>Q.icon)),xe(j,$(()=>Q.label))}),ht("click",D,()=>K(f,Q.id)),re(M,D)}),A(ye),A(se);var ve=U(se,2),Ae=T(ve);{var Re=M=>{var Q=i2(),D=U(T(Q),4),Y=T(D),H=U(T(Y),2),W=T(H,!0);A(H),A(Y);var j=U(Y,2),Z=U(T(j),2),pe=T(Z,!0);A(Z),A(j),A(D);var Ce=U(D,2);{var De=Le=>{var Ie=s2();re(Le,Ie)};Oe(Ce,Le=>{u(b)&&Le(De)})}A(Q),Ge(()=>{Sr(H,1,`text-${u(p)?"green":"yellow"}-400`),xe(W,u(p)?"✅":u(g)?"⏳":"⏸️"),Sr(Z,1,`text-${u(y)?"green":"yellow"}-400`),xe(pe,u(y)?"✅":u(b)?"⏳":"⏸️")}),re(M,Q)},Ke=(M,Q)=>{{var D=H=>{var W=o2(),j=U(T(W),6),Z=T(j),pe=U(Z);{var Ce=De=>{var Le=a2(),Ie=U(hn(Le));Ge(le=>xe(Ie,`Private UTXOs: ${le??""}`),[()=>(ke(l()),$(()=>l().map(le=>`${le.id.slice(0,6)}(spent:${le.isSpent})`).join(", ")))],nt),re(De,Le)};Oe(pe,De=>{ke(l()),$(()=>l().length>0)&&De(Ce)})}A(j),A(W),Ge(()=>xe(Z,`Debug: Private UTXOs: ${ke(l()),$(()=>l().length)??""} `)),re(H,W)},Y=H=>{var W=S2(),j=hn(W);{var Z=Ve=>{var at=g2(),it=U(T(at),2),Et=U(T(it),2);{var Dt=ie=>{var be=c2();re(ie,be)},At=ie=>{var be=d2();Ge(()=>{u(S),Dn(()=>{u(s)})});var we=T(be);we.value=we.__value="";var Fe=U(we);Pr(Fe,1,()=>u(s),Ln,(Se,Ee)=>{var Je=l2();const Ne=nt(()=>(u(Ee),$(()=>P(u(Ee).tokenAddress))));var He=T(Je);A(Je);var $e={};Ge((lt,ft)=>{xe(He,`${lt??""} ${ke(u(Ne)),$(()=>u(Ne).symbol)??""} 
                    (ID: ${ft??""}...)`),$e!==($e=(u(Ee),$(()=>u(Ee).id)))&&(Je.value=(Je.__value=(u(Ee),$(()=>u(Ee).id)))??"")},[()=>(u(Ee),ke(u(Ne)),$(()=>oe(u(Ee).value,u(Ne).decimals))),()=>(u(Ee),$(()=>u(Ee).id.slice(0,8)))],nt),re(Se,Je)}),A(be),pi(be,()=>u(S),Se=>K(S,Se)),re(ie,be)};Oe(Et,ie=>{u(y)?ie(At,!1):ie(Dt)})}A(it);var ee=U(it,2);{var te=ie=>{var be=x2(),we=T(be),Fe=U(T(we),2);A(we);var Se=U(we,2);Pr(Se,5,()=>u(C),Ln,(Ne,He,$e)=>{var lt=f2(),ft=T(lt),$t=T(ft);Ls($t,"for",`amount-${$e}`);var Qr=U($t,2);Mn(Qr),Ls(Qr,"id",`amount-${$e}`),A(ft);var Wr=U(ft,2),Ps=T(Wr);Ls(Ps,"for",`owner-${$e}`);var Us=U(Ps,2);Mn(Us),Ls(Us,"id",`owner-${$e}`),A(Wr);var Si=U(Wr,2);{var io=mn=>{var ki=u2();ht("click",ki,()=>O($e)),re(mn,ki)};Oe(Si,mn=>{u(C),$(()=>u(C).length>2)&&mn(io)})}A(lt),vs(Qr,()=>u(He).amount,mn=>(u(He).amount=mn,Dn(()=>u(C)))),vs(Us,()=>u(He).owner,mn=>(u(He).owner=mn,Dn(()=>u(C)))),re(Ne,lt)}),A(Se);var Ee=U(Se,2);{var Je=Ne=>{var He=h2();const $e=nt(()=>(u(i),$(()=>{var Cr;return P(((Cr=u(i).split)==null?void 0:Cr.tokenAddress)||"")})));var lt=hn(He),ft=T(lt),$t=U(T(ft),2),Qr=T($t);A($t),A(ft);var Wr=U(ft,2),Ps=U(T(Wr),2),Us=T(Ps);A(Ps),A(Wr);var Si=U(Wr,2),io=U(T(Si),2),mn=T(io);A(io),A(Si),A(lt);var ki=U(lt,2),ac=T(ki),Wx=T(ac);{var jx=Cr=>{var oc=kr("✅ Split configuration is valid");re(Cr,oc)},Zx=Cr=>{var oc=kr();Ge(()=>xe(oc,`❌ ${u(B),$(()=>u(B).error)??""}`)),re(Cr,oc)};Oe(Wx,Cr=>{u(B),$(()=>u(B).valid)?Cr(jx):Cr(Zx,!1)})}A(ac);var Iu=U(ac,2),Yx=T(Iu);A(Iu),A(ki),Ge(Cr=>{xe(Qr,`${Cr??""} ${ke(u($e)),$(()=>u($e).symbol)??""}`),xe(Us,`${u(a),$(()=>u(a).formattedOutputToOthers)??""} ${ke(u($e)),$(()=>u($e).symbol)??""}`),Sr(io,1,`font-mono ${u(a),$(()=>u(a).isZero?"text-green-400":u(a).isPositive?"text-yellow-400":"text-red-400")??""}`),xe(mn,`${u(a),$(()=>u(a).formattedRemainingToUser)??""} ${ke(u($e)),$(()=>u($e).symbol)??""}`),Sr(ki,1,`p-3 rounded-lg border ${u(B),$(()=>u(B).valid?"border-green-500 bg-green-500/10":"border-red-500 bg-red-500/10")??""}`),Sr(ac,1,`text-sm ${u(B),$(()=>u(B).valid?"text-green-400":"text-red-400")??""}`),xe(Yx,`Status: ${u(B),$(()=>u(B).canSubmit?"✅ Ready to Execute":"❌ Validation Required")??""}`)},[()=>(u(i),ke(u($e)),$(()=>oe(u(i).split.value,u($e).decimals)))],nt),re(Ne,He)};Oe(Ee,Ne=>{u(S)&&Ne(Je)})}A(be),ht("click",Fe,Pe),re(ie,be)};Oe(ee,ie=>{u(i),$(()=>u(i).split)&&ie(te)})}A(at),re(Ve,at)};Oe(j,Ve=>{u(f)==="split"&&Ve(Z)})}var pe=U(j,2);{var Ce=Ve=>{var at=w2(),it=U(T(at),2),Et=U(T(it),2);{var Dt=we=>{var Fe=p2();re(we,Fe)},At=we=>{var Fe=m2();Ge(()=>{u(z),Dn(()=>{u(s)})});var Se=T(Fe);Se.value=Se.__value="";var Ee=U(Se);Pr(Ee,1,()=>u(s),Ln,(Je,Ne)=>{var He=b2();const $e=nt(()=>(u(Ne),$(()=>P(u(Ne).tokenAddress))));var lt=T(He);A(He);var ft={};Ge(($t,Qr)=>{xe(lt,`${$t??""} ${ke(u($e)),$(()=>u($e).symbol)??""} 
                    (ID: ${Qr??""}...)`),ft!==(ft=(u(Ne),$(()=>u(Ne).id)))&&(He.value=(He.__value=(u(Ne),$(()=>u(Ne).id)))??"")},[()=>(u(Ne),ke(u($e)),$(()=>oe(u(Ne).value,u($e).decimals))),()=>(u(Ne),$(()=>u(Ne).id.slice(0,8)))],nt),re(Je,He)}),A(Fe),pi(Fe,()=>u(z),Je=>K(z,Je)),re(we,Fe)};Oe(Et,we=>{u(y)?we(At,!1):we(Dt)})}A(it);var ee=U(it,2),te=U(T(ee),2);Mn(te),A(ee);var ie=U(ee,2);{var be=we=>{var Fe=y2();const Se=nt(()=>(u(i),$(()=>P(u(i).withdraw.tokenAddress))));var Ee=T(Fe),Je=U(T(Ee),2),Ne=U(T(Je),2),He=T(Ne),$e=T(He);A(He);var lt=U(He,2),ft=T(lt);A(lt),It(2),A(Ne),A(Je),A(Ee),A(Fe),Ge($t=>{xe($e,`Amount: ${$t??""} ${ke(u(Se)),$(()=>u(Se).symbol)??""}`),xe(ft,`Token: ${u(i),$(()=>u(i).withdraw.tokenAddress)??""}`)},[()=>(u(i),ke(u(Se)),$(()=>oe(u(i).withdraw.value,u(Se).decimals)))],nt),re(we,Fe)};Oe(ie,we=>{u(i),$(()=>u(i).withdraw)&&we(be)})}A(at),vs(te,()=>u(G),we=>K(G,we)),re(Ve,at)};Oe(pe,Ve=>{u(f)==="withdraw"&&Ve(Ce)})}var De=U(pe,2);{var Le=Ve=>{var at=T2(),it=U(T(at),2),Et=U(T(it),2);{var Dt=ie=>{var be=v2();re(ie,be)},At=ie=>{var be=E2();Ge(()=>{u(ne),Dn(()=>{u(s)})});var we=T(be);we.value=we.__value="";var Fe=U(we);Pr(Fe,1,()=>u(s),Ln,(Se,Ee)=>{var Je=A2();const Ne=nt(()=>(u(Ee),$(()=>P(u(Ee).tokenAddress))));var He=T(Je);A(Je);var $e={};Ge((lt,ft)=>{xe(He,`${lt??""} ${ke(u(Ne)),$(()=>u(Ne).symbol)??""} 
                    (ID: ${ft??""}...)`),$e!==($e=(u(Ee),$(()=>u(Ee).id)))&&(Je.value=(Je.__value=(u(Ee),$(()=>u(Ee).id)))??"")},[()=>(u(Ee),ke(u(Ne)),$(()=>oe(u(Ee).value,u(Ne).decimals))),()=>(u(Ee),$(()=>u(Ee).id.slice(0,8)))],nt),re(Se,Je)}),A(be),pi(be,()=>u(ne),Se=>K(ne,Se)),re(ie,be)};Oe(Et,ie=>{u(y)?ie(At,!1):ie(Dt)})}A(it);var ee=U(it,2),te=U(T(ee),2);Mn(te),A(ee),It(2),A(at),vs(te,()=>u(J),ie=>K(J,ie)),re(Ve,at)};Oe(De,Ve=>{u(f)==="transfer"&&Ve(Le)})}var Ie=U(De,2),le=T(Ie),bt=T(le);{var zt=Ve=>{var at=O2();It(2),re(Ve,at)},nr=Ve=>{var at=I2(),it=hn(at),Et=T(it);{var Dt=ie=>{var be=kr("✂️");re(ie,be)},At=(ie,be)=>{{var we=Se=>{var Ee=kr("💸");re(Se,Ee)},Fe=(Se,Ee)=>{{var Je=Ne=>{var He=kr("📤");re(Ne,He)};Oe(Se,Ne=>{u(f)==="transfer"&&Ne(Je)},Ee)}};Oe(ie,Se=>{u(f)==="withdraw"?Se(we):Se(Fe,!1)},be)}};Oe(Et,ie=>{u(f)==="split"?ie(Dt):ie(At,!1)})}A(it);var ee=U(it,2),te=T(ee);A(ee),Ge(ie=>xe(te,`Execute ${ie??""}`),[()=>(u(f),$(()=>u(f).charAt(0).toUpperCase()+u(f).slice(1)))],nt),re(Ve,at)};Oe(bt,Ve=>{u(x)?Ve(zt):Ve(nr,!1)})}A(le),A(Ie),Ge(()=>le.disabled=!u(o)),ht("click",le,_),re(H,W)};Oe(M,H=>{u(s),$(()=>u(s).length===0)?H(D):H(Y,!1)},Q)}};Oe(Ae,M=>{u(r)||!u(t)?M(Re):M(Ke,!1)})}A(ve),A(q),re(n,q),Ya()}var U2=ue('<div class="animate-spin text-purple-500 text-sm ml-2">⚡</div>'),N2=ue('<div class="text-center py-8"><div class="text-gray-400 text-lg mb-2">�</div> <p class="text-gray-400">No private UTXOs found</p> <p class="text-gray-500 text-sm">Your private transactions will appear here</p></div>'),C2=ue('<div class="bg-gray-700 rounded-lg p-4 border border-gray-600 hover:border-gray-500 transition-colors"><div class="flex justify-between items-start mb-3"><div class="flex items-center gap-3"><div class="text-2xl">🔒</div> <div><div class="flex items-center gap-2"><span class="font-medium text-white"> </span> <span> </span></div> <div class="text-sm text-gray-400 flex items-center gap-2 mt-1"><span> </span> <span>•</span> <span> </span></div></div></div> <button class="text-gray-400 hover:text-white transition-colors" title="Copy Nullifier Hash">📋</button></div> <div class="grid grid-cols-2 gap-4 text-sm"><div><span class="text-gray-400">Commitment:</span> <div class="text-white font-mono text-xs break-all"> </div></div> <div><span class="text-gray-400">Nullifier:</span> <div class="text-white font-mono text-xs break-all"> </div></div></div></div>'),B2=ue('<div class="space-y-4"></div>'),_2=ue('<div class="bg-gray-800 rounded-lg p-6"><h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">🔒 Private UTXO History <span class="text-sm font-normal text-gray-400"> </span> <!></h3> <div class="grid grid-cols-3 gap-4 mb-6"><div class="text-center bg-gray-700 rounded-lg p-3"><div class="text-2xl font-bold text-white"> </div> <div class="text-gray-400 text-sm">Total UTXOs</div></div> <div class="text-center bg-gray-700 rounded-lg p-3"><div class="text-2xl font-bold text-green-400"> </div> <div class="text-gray-400 text-sm">Available</div></div> <div class="text-center bg-gray-700 rounded-lg p-3"><div class="text-2xl font-bold text-red-400"> </div> <div class="text-gray-400 text-sm">Spent</div></div></div> <div class="flex flex-wrap items-center gap-4 mb-6"><input type="text" placeholder="Search UTXOs..." class="flex-1 bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20"/> <select class="bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"><option>All Status</option><option>Available</option><option>Spent</option></select> <select class="bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"><option>Sort by Date</option><option>Sort by Value</option></select> <button class="bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white hover:bg-gray-600"> </button></div> <!></div>');function R2(n,e){Za(e,!1);const t=Te(),r=Te();let s=Xn(e,"privateUTXOs",24,()=>[]),i=Te("all"),a=Te("timestamp"),o=Te("desc"),c=Te(""),l={},d=Te(!1);async function f(H){K(d,!0);for(const W of H)if(!l[W])try{const j=await pn.getERC20TokenInfo(W);l[W]=j,l={...l}}catch(j){console.error(`Failed to load token metadata for ${W}:`,j),l[W]={address:W,symbol:"Unknown",name:"Unknown Token",decimals:18,balance:BigInt(0),allowance:BigInt(0),verified:!1},l={...l}}K(d,!1)}function x(H){return l[H]||{address:H,symbol:"Unknown",name:"Unknown Token",decimals:18,balance:BigInt(0),allowance:BigInt(0),verified:!1}}function g(H,W=18){const j=BigInt(10**W),Z=H/j,pe=H%j;if(pe===BigInt(0))return Z.toString();const De=pe.toString().padStart(W,"0").replace(/0+$/,"");return De?`${Z}.${De}`:Z.toString()}function b(H){const W=new Date(Number(H)),Z=new Date().getTime()-W.getTime();return Z<6e4?"Just now":Z<36e5?`${Math.floor(Z/6e4)}m ago`:Z<864e5?`${Math.floor(Z/36e5)}h ago`:Z<6048e5?`${Math.floor(Z/864e5)}d ago`:W.toLocaleDateString()}function p(H){return H.isSpent?"text-red-400 bg-red-400/20":"text-green-400 bg-green-400/20"}function y(H){return H.isSpent?"SPENT":"AVAILABLE"}function v(H){navigator.clipboard.writeText(H)}Nt(()=>(ke(s()),u(i),u(c),u(a),u(o)),()=>{K(t,s().filter(H=>{if(u(i)==="confirmed"&&H.isSpent||u(i)==="spent"&&!H.isSpent)return!1;if(u(c)){const W=u(c).toLowerCase();return H.nullifierHash.toLowerCase().includes(W)||H.commitment.toLowerCase().includes(W)}return!0}).sort((H,W)=>{let j=0;switch(u(a)){case"timestamp":j=Number(H.timestamp-W.timestamp);break;case"value":j=Number(H.value-W.value);break}return u(o)==="asc"?j:-j}))}),Nt(()=>ke(s()),()=>{if(s().length>0){const H=[...new Set(s().map(W=>W.tokenAddress))];f(H)}}),Nt(()=>ke(s()),()=>{K(r,{total:s().length,available:s().filter(H=>!H.isSpent).length,spent:s().filter(H=>H.isSpent).length})}),cl(),ja();var I=_2(),N=T(I),P=U(T(N)),S=T(P);A(P);var C=U(P,2);{var z=H=>{var W=U2();re(H,W)};Oe(C,H=>{u(d)&&H(z)})}A(N);var G=U(N,2),ne=T(G),J=T(ne),B=T(J,!0);A(J),It(2),A(ne);var oe=U(ne,2),he=T(oe),Pe=T(he,!0);A(he),It(2),A(oe);var O=U(oe,2),L=T(O),ce=T(L,!0);A(L),It(2),A(O),A(G);var de=U(G,2),R=T(de);Mn(R);var _=U(R,2);Ge(()=>{u(i),Dn(()=>{})});var q=T(_);q.value=q.__value="all";var se=U(q);se.value=se.__value="confirmed";var ye=U(se);ye.value=ye.__value="spent",A(_);var ve=U(_,2);Ge(()=>{u(a),Dn(()=>{})});var Ae=T(ve);Ae.value=Ae.__value="timestamp";var Re=U(Ae);Re.value=Re.__value="value",A(ve);var Ke=U(ve,2),M=T(Ke,!0);A(Ke),A(de);var Q=U(de,2);{var D=H=>{var W=N2();re(H,W)},Y=H=>{var W=B2();Pr(W,7,()=>u(t),j=>j.nullifierHash,(j,Z,pe)=>{var Ce=C2();const De=nt(()=>(u(Z),$(()=>x(u(Z).tokenAddress))));var Le=T(Ce),Ie=T(Le),le=U(T(Ie),2),bt=T(le),zt=T(bt),nr=T(zt);A(zt);var Ve=U(zt,2),at=T(Ve,!0);A(Ve),A(bt);var it=U(bt,2),Et=T(it),Dt=T(Et);A(Et);var At=U(Et,4),ee=T(At);A(At),A(it),A(le),A(Ie);var te=U(Ie,2);A(Le);var ie=U(Le,2),be=T(ie),we=U(T(be),2),Fe=T(we);A(we),A(be);var Se=U(be,2),Ee=U(T(Se),2),Je=T(Ee);A(Ee),A(Se),A(ie),A(Ce),Ge((Ne,He,$e,lt,ft,$t)=>{xe(nr,`Private UTXO #${u(pe)+1}`),Sr(Ve,1,`px-2 py-1 rounded text-xs font-medium ${Ne??""}`),xe(at,He),xe(Dt,`🪙 ${$e??""} ${ke(u(De)),$(()=>u(De).symbol)??""}`),xe(ee,`🕒 ${lt??""}`),xe(Fe,`${ft??""}...`),xe(Je,`${$t??""}...`)},[()=>(u(Z),$(()=>p(u(Z)))),()=>(u(Z),$(()=>y(u(Z)))),()=>(u(Z),ke(u(De)),$(()=>g(u(Z).value,u(De).decimals))),()=>(u(Z),$(()=>b(u(Z).timestamp))),()=>(u(Z),$(()=>u(Z).commitment.slice(0,20))),()=>(u(Z),$(()=>u(Z).nullifierHash.slice(0,20)))],nt),ht("click",te,()=>v(u(Z).nullifierHash)),re(j,Ce)}),A(W),re(H,W)};Oe(Q,H=>{u(t),$(()=>u(t).length===0)?H(D):H(Y,!1)})}A(I),Ge(()=>{xe(S,`(${ke(s()),$(()=>s().length)??""} UTXOs)`),xe(B,(u(r),$(()=>u(r).total))),xe(Pe,(u(r),$(()=>u(r).available))),xe(ce,(u(r),$(()=>u(r).spent))),xe(M,u(o)==="asc"?"↑":"↓")}),vs(R,()=>u(c),H=>K(c,H)),pi(_,()=>u(i),H=>K(i,H)),pi(ve,()=>u(a),H=>K(a,H)),ht("click",Ke,()=>K(o,u(o)==="asc"?"desc":"asc")),re(n,I),Ya()}var D2=ue('<meta name="description" content="Manage ERC20 tokens with privacy using UTXOs and Zenroom cryptography" class="svelte-18s9rmc"/>'),L2=ue('<div><div class="flex items-center justify-between text-white svelte-18s9rmc"><span class="text-sm svelte-18s9rmc"> </span> <button class="ml-2 text-white hover:text-gray-200 svelte-18s9rmc">✕</button></div></div>'),F2=ue('<div class="fixed top-4 right-4 z-50 space-y-2 svelte-18s9rmc"></div>'),M2=ue('<button class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-red-600/20 text-red-300 hover:bg-red-600/30 transition-all duration-200 svelte-18s9rmc" title="⚠️ Clear all local UTXO data"><span class="svelte-18s9rmc">🗑️</span> <span class="text-sm svelte-18s9rmc">Clear Data</span></button> <button class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-orange-600/20 text-orange-300 hover:bg-orange-600/30 transition-all duration-200 svelte-18s9rmc" title="Verify UTXO authenticity on blockchain"><span class="svelte-18s9rmc">🔍</span> <span class="text-sm svelte-18s9rmc">Verify UTXOs</span></button> <button class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-blue-600/20 text-blue-300 hover:bg-blue-600/30 transition-all duration-200 svelte-18s9rmc" title="Load all UTXOs (owned + received)"><span class="svelte-18s9rmc">📁</span> <span class="text-sm svelte-18s9rmc">Load All UTXOs</span></button> <button class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-purple-600/20 text-purple-300 hover:bg-purple-600/30 transition-all duration-200 svelte-18s9rmc" title="Debug multi-account storage system"><span class="svelte-18s9rmc">🐛</span> <span class="text-sm svelte-18s9rmc">Debug Storage</span></button>',1),G2=ue('<div class="flex items-center space-x-4 svelte-18s9rmc"><div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-purple-600 text-white svelte-18s9rmc"><span class="svelte-18s9rmc">�</span> <span class="text-sm svelte-18s9rmc">Private Mode</span></div> <!> <div class="flex items-center space-x-2 text-green-400 svelte-18s9rmc"><div class="w-2 h-2 bg-green-400 rounded-full animate-pulse svelte-18s9rmc"></div> <span class="text-sm svelte-18s9rmc">Connected</span></div></div>'),X2=ue('<div class="text-center py-20 svelte-18s9rmc"><div class="max-w-2xl mx-auto svelte-18s9rmc"><h2 class="text-4xl font-bold text-white mb-6 svelte-18s9rmc">Welcome to UTXO Manager</h2> <p class="text-xl text-gray-300 mb-8 svelte-18s9rmc">Transform your ERC20 tokens into privacy-preserving UTXOs using Zenroom cryptography</p> <div class="grid md:grid-cols-3 gap-6 mb-8 svelte-18s9rmc"><div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20 svelte-18s9rmc"><div class="text-purple-400 text-2xl mb-3 svelte-18s9rmc">🔒</div> <h3 class="text-white font-semibold mb-2 svelte-18s9rmc">Privacy First</h3> <p class="text-gray-300 text-sm svelte-18s9rmc">Your transactions are private using Zenroom zero-knowledge proofs</p></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20 svelte-18s9rmc"><div class="text-blue-400 text-2xl mb-3 svelte-18s9rmc">⚡</div> <h3 class="text-white font-semibold mb-2 svelte-18s9rmc">UTXO Model</h3> <p class="text-gray-300 text-sm svelte-18s9rmc">Efficient transaction model with better privacy and scalability</p></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20 svelte-18s9rmc"><div class="text-green-400 text-2xl mb-3 svelte-18s9rmc">🔗</div> <h3 class="text-white font-semibold mb-2 svelte-18s9rmc">ERC20 Compatible</h3> <p class="text-gray-300 text-sm svelte-18s9rmc">Use any ERC20 token with seamless conversion to UTXOs</p></div></div> <button class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition-all duration-200 shadow-lg hover:shadow-xl svelte-18s9rmc">Get Started</button></div></div>'),H2=ue('<div class="grid grid-cols-1 md:grid-cols-4 gap-6 svelte-18s9rmc"><div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20 svelte-18s9rmc"><div class="text-pink-400 text-sm font-medium mb-1 svelte-18s9rmc">Private UTXOs</div> <div class="text-white text-2xl font-bold svelte-18s9rmc"> </div></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20 svelte-18s9rmc"><div class="text-blue-400 text-sm font-medium mb-1 svelte-18s9rmc">Unique Tokens</div> <div class="text-white text-2xl font-bold svelte-18s9rmc"> </div></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20 svelte-18s9rmc"><div class="text-green-400 text-sm font-medium mb-1 svelte-18s9rmc">Avg UTXO Value</div> <div class="text-white text-2xl font-bold svelte-18s9rmc"> </div></div> <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-white/20 svelte-18s9rmc"><div class="text-yellow-400 text-sm font-medium mb-1 svelte-18s9rmc">Confirmed</div> <div class="text-white text-2xl font-bold svelte-18s9rmc"> </div></div></div>'),z2=ue('<button><span class="svelte-18s9rmc"> </span> <span class="svelte-18s9rmc"> </span></button>'),$2=ue('<div class="text-center text-gray-400 svelte-18s9rmc">No UTXOs found. Start by depositing tokens.</div>'),K2=ue('<div class="space-y-8 svelte-18s9rmc"><!> <div class="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 svelte-18s9rmc"><div class="flex space-x-1 p-1 svelte-18s9rmc"></div></div> <div class="space-y-6 svelte-18s9rmc"><!></div></div>'),V2=ue('<div class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 svelte-18s9rmc"><!> <header class="bg-black/20 backdrop-blur-sm border-b border-white/10 svelte-18s9rmc"><div class="container mx-auto px-4 py-6 svelte-18s9rmc"><div class="flex items-center justify-between svelte-18s9rmc"><div class="flex items-center space-x-4 svelte-18s9rmc"><div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center svelte-18s9rmc"><span class="text-white font-bold text-xl svelte-18s9rmc">U</span></div> <div class="svelte-18s9rmc"><h1 class="text-2xl font-bold text-white svelte-18s9rmc">UTXO Manager</h1> <p class="text-gray-300 text-sm svelte-18s9rmc">Privacy-First Token Management</p></div></div> <div class="flex items-center space-x-4 svelte-18s9rmc"><!> <!></div></div></div></header> <main class="container mx-auto px-4 py-8 svelte-18s9rmc"><!></main></div>');function ev(n,e){Za(e,!1);let t=Te(),r=Te(!1),s=Te(null),i=Te([]),a=Te(null),o=Te("balance"),c=Te([]);const l="0xCE875AfF30639864c1c17275E2185B4E635001D9",d=Jt.METAMASK;rg(async()=>{try{typeof window<"u"&&localStorage.getItem("private_utxos")&&(console.log("🗑️ Clearing old contract data..."),localStorage.removeItem("private_utxos"),localStorage.removeItem("utxo_cache"),Object.keys(localStorage).forEach(_=>{(_.startsWith("utxo_")||_.startsWith("private_utxo_"))&&localStorage.removeItem(_)}),I("info","Cleared old contract data for new deployment")),K(t,new Qx({autoConsolidate:!1,consolidationThreshold:5,maxUTXOAge:7*24*60*60,privacyMode:!0,defaultGasLimit:BigInt(5e5),cacheTimeout:3e4,enableBackup:!0})),f(),console.log("🔧 Private UTXO Manager initialized"),await x()}catch(R){console.error("❌ Failed to initialize Private UTXO Manager:",R),I("error","Failed to initialize Private UTXO Manager")}});function f(){u(t).on("library:initialized",R=>{K(r,!0),I("success","Private UTXO Manager initialized successfully"),g()}),u(t).on("wallet:connected",async R=>{K(s,R),I("success",`Wallet connected: ${R.address.slice(0,6)}...${R.address.slice(-4)}`),await g(),u(i).length===0&&(console.log("🔄 No UTXOs from sync, trying to load stored UTXOs..."),v())}),u(t).on("wallet:disconnected",()=>{K(s,null),K(i,[]),K(a,null),K(r,!1),I("info","Wallet disconnected")}),u(t).on("private:utxo:created",R=>{I("success","🎉 Private UTXO created successfully! Check your balance."),g(),P("balance")}),u(t).on("private:utxo:transferred",R=>{I("success","Private UTXO transferred successfully"),g()}),u(t).on("private:utxo:spent",R=>{I("info",`Private UTXO spent: ${R.slice(0,8)}...`),g()}),u(t).on("private:utxo:withdrawn",R=>{I("success","Private UTXO withdrawn successfully"),g()}),u(t).on("operation:failed",R=>{I("error",`Operation failed: ${R.message}`)})}async function x(){try{if(console.log("🚀 Initializing library..."),!await u(t).initialize(l,d)){I("error","Failed to initialize Private UTXO Manager");return}if(console.log("✅ Library initialized successfully"),typeof window<"u"&&window.ethereum)try{const _=await window.ethereum.request({method:"eth_accounts"});_&&_.length>0&&(console.log("🔄 Auto-reconnecting to existing wallet session..."),(await u(t).connectWallet(d)).success&&console.log("✅ Auto-reconnection successful"))}catch(_){console.log("ℹ️ Auto-reconnect not available:",_.message||_)}}catch(R){console.error("Initialization error:",R),I("error","Private UTXO Manager initialization failed")}}async function g(){if(!u(r)||!u(s)){console.log("⏸️ RefreshData skipped:",{isInitialized:u(r),currentAccount:!!u(s)});return}try{console.log("🔄 Starting refreshData...");const R=await u(t).syncWithBlockchain();console.log("🔄 Sync result:",R),K(i,u(t).getPrivateUTXOsByOwner(u(s).address)),console.log("🔒 Private UTXOs after refresh:",{total:u(i).length,unspent:u(i).filter(_=>!_.isSpent).length,spent:u(i).filter(_=>_.isSpent).length,details:u(i).map(_=>({id:_.id.slice(0,8)+"...",value:_.value.toString(),isSpent:_.isSpent,createdAt:new Date(_.localCreatedAt).toLocaleTimeString()}))}),K(a,u(t).getStats()),console.log("📊 Data refreshed successfully:",{totalPrivateUTXOs:u(i).length,availableForOperations:u(i).filter(_=>!_.isSpent).length,stats:u(a)})}catch(R){console.error("Failed to refresh data:",R),I("error","Failed to refresh data")}}function b(){var _;if(!((_=u(s))!=null&&_.address)){I("error","Please connect wallet first");return}if(confirm("⚠️ This will DELETE ALL local UTXO data for the current account. This action cannot be undone. Are you sure?"))try{console.log("🗑️ === CLEARING ALL LOCAL DATA ===");const q=[];for(let se=0;se<localStorage.length;se++){const ye=localStorage.key(se);ye&&(ye.startsWith("private_utxo_")||ye.startsWith("utxo_")||ye.startsWith("bbs_keys_")||ye==="private_utxos"||ye==="utxo_cache")&&q.push(ye)}q.forEach(se=>{localStorage.removeItem(se),console.log(`🗑️ Removed: ${se}`)}),u(t)&&console.log("🔄 Resetting manager state..."),K(i,[]),K(a,null),I("success",`Cleared ${q.length} local storage keys. Please refresh data.`),console.log("✅ All local data cleared successfully")}catch(q){console.error("❌ Failed to clear local data:",q),I("error",`Failed to clear data: ${q.message||q}`)}}async function p(){var R,_;if(!((R=u(s))!=null&&R.address)||!u(r)||!u(t)){I("error","Please connect wallet and initialize first");return}try{console.log("🔍 === UTXO AUTHENTICITY VERIFICATION ===");const q=u(t).getPrivateUTXOsByOwner(u(s).address);console.log("📋 Local UTXOs:",q.length);for(const se of q){if(console.log(`
🔍 Verifying UTXO: ${se.id}`),console.log("UTXO details:",{id:se.id,value:(_=se.value)==null?void 0:_.toString(),isSpent:se.isSpent,creationTxHash:se.creationTxHash,blockNumber:se.blockNumber,confirmed:se.confirmed,localCreatedAt:se.localCreatedAt?new Date(se.localCreatedAt).toISOString():"N/A"}),!se.creationTxHash||!se.blockNumber){console.warn("⚠️ UTXO has no blockchain confirmation - may be fake/local-only");continue}try{console.log("✅ UTXO appears to have blockchain confirmation")}catch(ye){console.error("❌ UTXO verification failed:",ye)}}I("success",`Verified ${q.length} UTXOs. Check console for details.`)}catch(q){console.error("❌ UTXO verification failed:",q),I("error",`Verification failed: ${q.message||q}`)}}function y(){var R;if(!((R=u(s))!=null&&R.address)){I("error","Please connect wallet first");return}try{console.log("🔍 === MULTI-ACCOUNT STORAGE DEBUG ==="),console.log(`
👤 Current Account: ${u(s).address}`),ns.debugStorage(u(s).address);const _=ns.getAllStoredAccounts();console.log(`
👥 All accounts with data (${_.length}):`),_.forEach((se,ye)=>{console.log(`${ye+1}. ${se}`);const ve=ns.getEnhancedUserStats(se);console.log(`   - Owned: ${ve.ownedCount} UTXOs, Received: ${ve.receivedCount} UTXOs`),console.log(`   - Total Balance: ${ve.totalBalance.toString()}`)});const q=ns.getEnhancedUserStats(u(s).address);console.log(`
📊 Enhanced Stats for ${u(s).address}:`),console.log(`- Owned UTXOs: ${q.breakdown.owned.count} (${q.breakdown.owned.balance.toString()})`),console.log(`- Received UTXOs: ${q.breakdown.received.count} (${q.breakdown.received.balance.toString()})`),console.log(`- Total: ${q.totalCount} UTXOs (${q.totalBalance.toString()})`),I("success",`Debug complete! Found ${_.length} accounts with data. Check console for details.`)}catch(_){console.error("❌ Multi-account debug failed:",_),I("error",`Debug failed: ${_.message||_}`)}}function v(){var R;if(!((R=u(s))!=null&&R.address)){I("error","Please connect wallet first");return}try{console.log("🔄 Loading all UTXOs (owned + received)...");const{owned:_,received:q,all:se}=ns.getAllUserUTXOs(u(s).address);console.log("🔄 Found UTXOs:"),console.log(`  - Owned: ${_.length}`),console.log(`  - Received: ${q.length}`),console.log(`  - Total: ${se.length}`),K(i,se),se.length>0?(I("success",`Loaded ${se.length} UTXOs (${_.length} owned + ${q.length} received)`),console.log("🔄 UTXO breakdown:",se.map(ye=>{var ve;return{id:ye.id,value:ye.value,owner:ye.owner,type:typeof ye.value,isOwned:ye.owner.toLowerCase()===((ve=u(s))==null?void 0:ve.address.toLowerCase())}}))):I("info","No UTXOs found. Create some deposits first.")}catch(_){console.error("❌ Failed to load all UTXOs:",_),I("error",`Failed to load UTXOs: ${_.message||_}`)}}function I(R,_){const q={id:Date.now().toString(),type:R,message:_};K(c,[q,...u(c)]),setTimeout(()=>{K(c,u(c).filter(se=>se.id!==q.id))},5e3)}function N(R){K(c,u(c).filter(_=>_.id!==R))}function P(R){K(o,R)}typeof window<"u"&&(window.debugUTXOStorage=()=>{var R;(R=u(s))!=null&&R.address?y():console.warn("No account connected. Connect wallet first.")}),ja();var S=V2();ng(R=>{var _=D2();Ng.title="UTXO Manager - Privacy-First Token Management",re(R,_)});var C=T(S);{var z=R=>{var _=F2();Pr(_,5,()=>u(c),q=>q.id,(q,se)=>{var ye=L2();let ve;var Ae=T(ye),Re=T(Ae),Ke=T(Re,!0);A(Re);var M=U(Re,2);A(Ae),A(ye),Ge(Q=>{ve=Sr(ye,1,"p-4 rounded-lg shadow-lg max-w-sm animate-slide-in svelte-18s9rmc",null,ve,Q),xe(Ke,u(se).message)},[()=>({"bg-green-600":u(se).type==="success","bg-red-600":u(se).type==="error","bg-blue-600":u(se).type==="info","bg-yellow-600":u(se).type==="warning"})],nt),ht("click",M,()=>N(u(se).id)),re(q,ye)}),A(_),re(R,_)};Oe(C,R=>{u(c).length>0&&R(z)})}var G=U(C,2),ne=T(G),J=T(ne),B=U(T(J),2),oe=T(B);{var he=R=>{var _=G2(),q=U(T(_),2);{var se=ye=>{var ve=M2(),Ae=hn(ve),Re=U(Ae,2),Ke=U(Re,2),M=U(Ke,2);ht("click",Ae,b),ht("click",Re,p),ht("click",Ke,v),ht("click",M,y),re(ye,ve)};Oe(q,ye=>{u(s)&&ye(se)})}It(2),A(_),re(R,_)};Oe(oe,R=>{u(r)&&R(he)})}var Pe=U(oe,2);C1(Pe,{get utxoManager(){return u(t)},get currentAccount(){return u(s)},get isInitialized(){return u(r)},$$events:{initialize:x,refresh:g}}),A(B),A(J),A(ne),A(G);var O=U(G,2),L=T(O);{var ce=R=>{var _=X2(),q=T(_),se=U(T(q),6);A(q),A(_),ht("click",se,x),re(R,_)},de=R=>{var _=K2(),q=T(_);{var se=Q=>{var D=H2(),Y=T(D),H=U(T(Y),2),W=T(H,!0);A(H),A(Y);var j=U(Y,2),Z=U(T(j),2),pe=T(Z,!0);A(Z),A(j);var Ce=U(j,2),De=U(T(Ce),2),Le=T(De,!0);A(De),A(Ce);var Ie=U(Ce,2),le=U(T(Ie),2),bt=T(le,!0);A(le),A(Ie),A(D),Ge(zt=>{xe(W,u(i).length),xe(pe,u(a).uniqueTokens),xe(Le,zt),xe(bt,u(a).confirmedUTXOs)},[()=>u(a).averageUTXOValue.toString()],nt),re(Q,D)};Oe(q,Q=>{u(a)&&Q(se)})}var ye=U(q,2),ve=T(ye);Pr(ve,4,()=>[{id:"balance",label:"Balance",icon:"💰"},{id:"deposit",label:"Deposit",icon:"📥"},{id:"operations",label:"Operations",icon:"⚡"},{id:"history",label:"History",icon:"📜"}],Ln,(Q,D)=>{var Y=z2(),H=T(Y),W=T(H,!0);A(H);var j=U(H,2),Z=T(j,!0);A(j),A(Y),Ge(()=>{Sr(Y,1,`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-all duration-200 ${u(o)===D.id?"bg-white/20 text-white":"text-gray-300 hover:bg-white/10"}`,"svelte-18s9rmc"),xe(W,D.icon),xe(Z,D.label)}),ht("click",Y,()=>P(D.id)),re(Q,Y)}),A(ve),A(ye);var Ae=U(ye,2),Re=T(Ae);{var Ke=Q=>{var D=Qd(),Y=hn(D);{var H=j=>{var Z=$2();re(j,Z)},W=j=>{z1(j,{get privateUTXOs(){return u(i)},$$events:{refresh:g}})};Oe(Y,j=>{u(i).length===0?j(H):j(W,!1)})}re(Q,D)},M=(Q,D)=>{{var Y=W=>{r2(W,{get utxoManager(){return u(t)},privacyMode:!0,$$events:{deposited:g}})},H=(W,j)=>{{var Z=Ce=>{P2(Ce,{get utxoManager(){return u(t)},get privateUTXOs(){return u(i)},$$events:{operation:g}})},pe=(Ce,De)=>{{var Le=Ie=>{R2(Ie,{get privateUTXOs(){return u(i)}})};Oe(Ce,Ie=>{u(o)==="history"&&Ie(Le)},De)}};Oe(W,Ce=>{u(o)==="operations"?Ce(Z):Ce(pe,!1)},j)}};Oe(Q,W=>{u(o)==="deposit"?W(Y):W(H,!1)},D)}};Oe(Re,Q=>{u(o)==="balance"?Q(Ke):Q(M,!1)})}A(Ae),A(_),re(R,_)};Oe(L,R=>{u(r)?R(de,!1):R(ce)})}A(O),A(S),re(n,S),Ya()}export{ev as component};
